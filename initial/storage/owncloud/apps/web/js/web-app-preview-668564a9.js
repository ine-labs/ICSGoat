define(["./chunks/vendor-569e5121","./chunks/useAppDefaults-23e4907b","./chunks/cache-40bfe919","./chunks/useRoute-1812bd9a","./chunks/resources-a6033be8"],(function(e,i,t,a,s){"use strict";var r={cs:{},de:{"%{ displayIndex } of %{ availableMediaFiles }":"%{ displayIndex } von %{ availableMediaFiles }","Close preview":"Vorschau schließen","Download currently viewed file":"Aktuell betrachtete Datei herunterladen","Failed to load media file":"Fehler beim Laden der Mediendatei","Loading media file":"Lade Mediendatei","Media file %{ displayIndex } of %{ availableMediaFiles }":"Mediendatei %{ displayIndex } von %{ availableMediaFiles }",msg:"Nachricht",Preview:"Vorschau","Preview for %{currentMediumName}":"Vorschau für %{currentMediumName}","Show next media file in folder":"Nächste Mediendatei im Order anzeigen","Show previous media file in folder":"Vorherige Mediendatei im Order anzeigen"},es:{msg:"msg"},fr:{"%{ displayIndex } of %{ availableMediaFiles }":"%{ displayIndex } de %{ availableMediaFiles }","Close preview":"Fermer la prévisualisation","Download currently viewed file":"Télécharger le fichier affiché","Failed to load media file":"Impossible de charger le fichier média","Loading media file":"Chargement du fichier média","Media file %{ displayIndex } of %{ availableMediaFiles }":"Fichier média %{ displayIndex } de %{ availableMediaFiles }",msg:"msg",Preview:"Prévisualisation","Preview for %{currentMediumName}":"Prévisualisation de %{currentMediumName}","Show next media file in folder":"Afficher le fichier média suivant","Show previous media file in folder":"Afficher le fichier média précédent"},gl:{msg:"msx"},it:{}};const l={name:"Preview",setup:()=>({...i.useAppDefaults({applicationName:"media"})}),data:()=>({isFileContentLoading:!0,isFileContentError:!1,activeIndex:null,direction:"rtl",cachedFiles:[]}),computed:{...e.mapGetters(["getToken","capabilities"]),pageTitle(){const e=this.$gettext("Preview for %{currentMediumName}");return this.$gettextInterpolate(e,{currentMediumName:this.activeFilteredFile?.name})},ariaHiddenFileCount(){const e=this.$gettext("%{ displayIndex } of %{ availableMediaFiles }");return this.$gettextInterpolate(e,{displayIndex:this.activeIndex+1,availableMediaFiles:this.filteredFiles.length})},screenreaderFileCount(){const e=this.$gettext("Media file %{ displayIndex } of %{ availableMediaFiles }");return this.$gettextInterpolate(e,{displayIndex:this.activeIndex+1,availableMediaFiles:this.filteredFiles.length})},filteredFiles(){return this.activeFiles?this.activeFiles.filter((e=>c.mimeTypes.includes(e.mimeType?.toLowerCase()))):[]},activeFilteredFile(){return this.filteredFiles[this.activeIndex]},activeMediaFileCached(){const e=this.cachedFiles.find((e=>e.id===this.activeFilteredFile.id));return void 0!==e&&e},thumbDimensions(){switch(!0){case window.innerWidth<=1024:return 1024;case window.innerWidth<=1280:return 1280;case window.innerWidth<=1920:return 1920;case window.innerWidth<=2160:return 2160;default:return 3840}},thumbUrl(){const e={x:this.thumbDimensions,y:this.thumbDimensions,c:this.activeFilteredFile.etag?.substr(1,this.activeFilteredFile.etag.length-2),scalingup:0,preview:1,a:1};return this.getUrlForResource(this.activeFilteredFile,e)},rawMediaUrl(){return this.getUrlForResource(this.activeFilteredFile)},isActiveFileTypeVideo(){return this.activeFilteredFile.mimeType.toLowerCase().startsWith("video")},isActiveFileTypeImage(){return this.activeFilteredFile.mimeType.toLowerCase().startsWith("image")},isActiveFileTypeAudio(){return this.activeFilteredFile.mimeType.toLowerCase().startsWith("audio")},isUrlSigningEnabled(){return this.capabilities.core&&this.capabilities.core["support-url-signing"]}},watch:{activeIndex(e,i){e!==i&&this.loadMedium()}},async mounted(){window.addEventListener("popstate",this.handleLocalHistoryEvent),await this.loadFolderForFileContext(this.currentFileContext),this.setActiveFile(this.currentFileContext.path),this.$refs.preview.focus()},beforeDestroy(){window.removeEventListener("popstate",this.handleLocalHistoryEvent),this.cachedFiles.forEach((e=>{window.URL.revokeObjectURL(e.url)}))},methods:{setActiveFile(e){for(let i=0;i<this.filteredFiles.length;i++)if(this.filteredFiles[i].webDavPath===e){this.activeIndex=i;break}},handleLocalHistoryEvent(){const e=this.$router.resolve(document.location);this.setActiveFile(e.route.params.filePath)},updateLocalHistory(){this.$route.params.filePath=this.activeFilteredFile.webDavPath,history.pushState({},document.title,this.$router.resolve(this.$route).href)},loadMedium(){this.isFileContentLoading=!0,this.activeMediaFileCached?setTimeout((()=>{this.isFileContentLoading=!1}),50):this.loadActiveFileIntoCache(this.isActiveFileTypeImage)},async loadActiveFileIntoCache(e){const i=e?this.thumbUrl:this.rawMediaUrl;try{let t;t=!e&&this.isUrlSigningEnabled&&this.$route.meta.auth?await this.$client.signUrl(i,86400):await this.mediaSource(i,"url",null),this.cachedFiles.push({id:this.activeFilteredFile.id,name:this.activeFilteredFile.name,url:t,ext:this.activeFilteredFile.extension,mimeType:this.activeFilteredFile.mimeType,isVideo:this.isActiveFileTypeVideo,isImage:this.isActiveFileTypeImage,isAudio:this.isActiveFileTypeAudio}),this.isFileContentLoading=!1,this.isFileContentError=!1}catch(e){this.isFileContentLoading=!1,this.isFileContentError=!0,console.error(e)}},triggerActiveFileDownload(){if(!this.isFileContentLoading)return this.downloadFile(this.activeFilteredFile,this.isPublicLinkContext)},next(){this.isFileContentLoading||(this.isFileContentError=!1,this.direction="rtl",this.activeIndex+1>=this.filteredFiles.length?this.activeIndex=0:(this.activeIndex++,this.updateLocalHistory()))},prev(){this.isFileContentLoading||(this.isFileContentError=!1,this.direction="ltr",0!==this.activeIndex?(this.activeIndex--,this.updateLocalHistory()):this.activeIndex=this.filteredFiles.length-1)}}};var n=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("main",{ref:"preview",attrs:{id:"preview",tabindex:"-1"},on:{keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:e.prev.apply(null,arguments)},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"right",39,i.key,["Right","ArrowRight"])||"button"in i&&2!==i.button?null:e.next.apply(null,arguments)},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"esc",27,i.key,["Esc","Escape"])?null:e.closeApp.apply(null,arguments)}]}},[e.isFolderLoading||e.isFileContentLoading?t("div",{staticClass:"oc-position-center"},[t("oc-spinner",{attrs:{"aria-label":e.$gettext("Loading media file"),size:"xlarge"}})],1):e.isFileContentError?t("oc-icon",{staticClass:"oc-position-center",attrs:{name:"file-damage",variation:"danger",size:"xlarge","accessible-label":e.$gettext("Failed to load media file")}}):[t("h1",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.pageTitle)}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.activeMediaFileCached,expression:"activeMediaFileCached"}],staticClass:"\n        oc-width-1-1 oc-flex oc-flex-center oc-flex-middle oc-p-s oc-box-shadow-medium\n        preview-player\n      "},[e.activeMediaFileCached.isImage?t("img",{key:"media-image-"+e.activeMediaFileCached.id,attrs:{src:e.activeMediaFileCached.url,alt:e.activeMediaFileCached.name,"data-id":e.activeMediaFileCached.id}}):e.activeMediaFileCached.isVideo?t("video",{key:"media-video-"+e.activeMediaFileCached.id,attrs:{controls:"",preload:""}},[t("source",{attrs:{src:e.activeMediaFileCached.url,type:e.activeMediaFileCached.mimeType}})]):e.activeMediaFileCached.isAudio?t("audio",{key:"media-audio-"+e.activeMediaFileCached.id,attrs:{controls:"",preload:""}},[t("source",{attrs:{src:e.activeMediaFileCached.url,type:e.activeMediaFileCached.mimeType}})]):e._e()])],e._v(" "),t("div",{staticClass:"oc-position-medium oc-position-bottom-center preview-details"},[e.activeFilteredFile?t("p",{staticClass:"oc-text-lead oc-text-center oc-text-truncate oc-p-s preview-file-name",attrs:{"aria-hidden":"true"}},[e._v("\n      "+e._s(e.activeFilteredFile.name)+"\n    ")]):e._e(),e._v(" "),t("div",{staticClass:"\n        oc-background-brand\n        oc-p-s\n        oc-width-large\n        oc-flex\n        oc-flex-middle\n        oc-flex-center\n        oc-flex-around\n        preview-controls-action-bar\n      "},[t("oc-button",{staticClass:"preview-controls-previous",attrs:{appearance:"raw",variation:"inverse","aria-label":e.$gettext("Show previous media file in folder")},on:{click:e.prev}},[t("oc-icon",{attrs:{size:"large",name:"arrow-drop-left"}})],1),e._v(" "),e.isFolderLoading?e._e():t("p",{staticClass:"oc-m-rm preview-controls-action-count"},[t("span",{attrs:{"aria-hidden":"true"},domProps:{textContent:e._s(e.ariaHiddenFileCount)}}),e._v(" "),t("span",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.screenreaderFileCount)}})]),e._v(" "),t("oc-button",{staticClass:"preview-controls-next",attrs:{appearance:"raw",variation:"inverse","aria-label":e.$gettext("Show next media file in folder")},on:{click:e.next}},[t("oc-icon",{attrs:{size:"large",name:"arrow-drop-right"}})],1),e._v(" "),t("oc-button",{staticClass:"preview-controls-download",attrs:{appearance:"raw",variation:"inverse","aria-label":e.$gettext("Download currently viewed file")},on:{click:e.triggerActiveFileDownload}},[t("oc-icon",{attrs:{size:"large",name:"file-download","fill-type":"line"}})],1),e._v(" "),t("oc-button",{staticClass:"preview-controls-close",attrs:{appearance:"raw",variation:"inverse","aria-label":e.$gettext("Close preview")},on:{click:e.closeApp}},[t("oc-icon",{attrs:{size:"large",name:"close"}})],1)],1)])],2)};n._withStripped=!0;const o=[{path:"/:filePath*",component:e.normalizeComponent({render:n,staticRenderFns:[]},undefined,l,"data-v-4ae36072",false,undefined,!1,void 0,void 0,void 0),name:"media",meta:{auth:!1,title:"Preview",patchCleanPath:!0}}],d=["audio/flac","audio/mpeg","audio/ogg","audio/wav","audio/x-flac","audio/x-wav","image/gif","image/jpeg","image/png","video/mp4","video/webm"];var c={appInfo:{name:"Preview",id:"preview",icon:"eye",extensions:d.map((e=>({canBeDefault:!0,mimeType:e,routeName:"preview-media",label:"Preview"})))},routes:o,translations:r,mimeTypes:d};return c}));
