define(["./chunks/vendor-569e5121","./chunks/cache-40bfe919","./chunks/index-e33fde60"],(function(e,t,s){"use strict";var r={cs:{Cancel:"Zrušit",Create:"Vytvořit",Delete:"Odstranit",Groups:"Skupiny",Password:"Heslo",Role:"Role",Status:"Stav",Users:"Uživatelé"},de:{"%{ groupCount } selected":"%{ groupCount } ausgewählt","%{ userCount } selected":"%{ userCount } ausgewählt","%{groupCount} groups in total":"%{groupCount} Gruppen gesamt","%{userCount} users in total":"%{userCount} Benutzer gesamt","Are you sure you want to delete this group?":["Sicher, dass du diese Gruppe löschen möchtest?","Sicher, dass du alle ausgewählten Gruppen löschen möchtest?"],"Are you sure you want to delete this user?":["Sicher, dass du diesen Benutzer löschen möchtest?","Sicher, dass du alle ausgewählten Benutzer löschen möchtest?"],Cancel:"Abbrechen","Clear selection":"Auswahl aufheben",Create:"Erstellen","Create group":"Gruppe erstellen","Create user":"Benutzer erstellen",Delete:"Löschen","Delete group %{group}?":["Gruppe %{group} löschen?","Ausgewählte %{groupCount} Gruppen löschen?"],"Delete user %{user}?":["Benutzer %{user} löschen?","Ausgewählte %{userCount} Benutzer löschen?"],"Display name":"Anzeigename","Display name cannot be empty":"Anzeigename kann nicht leer sein",Email:"E-Mail","Failed to create group":"Fehler beim Erstellen der Gruppe","Failed to create user":"Fehler beim Erstellen des Benutzers",'Failed to delete group "%{group}"':['Fehler beim Löschen der Gruppe "%{group}"',"Fehler beim Löschen von %{groupCount} Gruppen"],'Failed to delete user "%{user}"':['Fehler beim Löschen des Benutzers "%{user}"',"Fehler beim Löschen von %{userCount} Benutzern"],"First and last name":"Vor- und Nachname",'Group "%{group}" was deleted successfully':['Gruppe "%{group}" wurde erfolgreich gelöscht',"%{groupCount} Gruppen wurden erfolgreich gelöscht"],'Group "%{groupName}" already exists':'Gruppe "%{groupName}" existiert bereits',"Group name":"Gruppenname","Group name cannot be empty":"Gruppenname kann nicht leer sein","Group was created successfully":"Gruppe wurde erfolgreich erstellt",Groups:"Gruppen",Members:"Mitglieder",msg:"Nachricht","New group":"Neue Gruppe","New user":"Neuer Benutzer","No groups in here":"Keine Gruppen vorhanden","No users in here":"Keine Benutzer vorhanden",Password:"Passwort","Password cannot be empty":"Passwort kann nicht leer sein","Please enter a valid email":"Bitte eine gültige Email-Adresse eingeben",Role:"Rolle","Select %{ group }":"%{ group } auswählen","Select %{ user }":"%{ user } auswählen","Select all groups":"Alle Gruppen auswählen","Select all users":"Alle Benutzer auswählen",Status:"Status",'User "%{user}" was deleted successfully':['Benutzer "%{user}" wurde erfolgreich gelöscht',"%{userCount} Benutzer wurden erfolgreich gelöscht"],'User "%{userName}" already exists':'Benutzer "%{userName}" ist bereits vorhanden',"User management":"Benutzermanagement","User name":"Benutzername","User name cannot be empty":"Benutzername kann nicht leer sein","User name cannot contain white spaces":"Benutzername kann keine Leerzeichen enthalten","User name cannot start with a number":"Benutzername kann nicht mit einer Nummer anfangen","User was created successfully":"Benutzer wurde erfolgreich erstellt",Users:"Benutzer","Your role":"Deine Rolle"},es:{Cancel:"Cancelar",Create:"Crear",Delete:"Eliminar","Display name":"Nombre a mostrar",Email:"Correo electrónico",Groups:"Grupos",msg:"msg",Password:"Contraseña",Role:"Rol",Status:"Estado",Users:"Usuarios"},fr:{"%{ groupCount } selected":"%{ groupCount } sélectionnés","%{ userCount } selected":"%{ userCount } sélectionnés","%{groupCount} groups in total":"%{groupCount} groupes en tout","%{userCount} users in total":"%{userCount} utilisateurs en tout","Are you sure you want to delete this group?":["Êtes vous certain de vouloir supprimer ce groupe ?","Êtes vous certain de vouloir supprimer tous les groupes sélectionnés ?"],"Are you sure you want to delete this user?":["Êtes vous certain de vouloir supprimer cet utilisateur ?","Êtes vous certain de vouloir supprimer tous les utilisateurs sélectionnés ?"],Cancel:"Annuler","Clear selection":"Annuler la sélection",Create:"Créer","Create group":"Créer un groupe","Create user":"Créer un utilisateur",Delete:"Supprimer","Delete group %{group}?":["Supprimer le groupe %{group} ?","Supprimer les %{groupCount} groupes sélectionnés ?"],"Delete user %{user}?":["Supprimer l'utilisateur %{user} ?","Supprimer les %{userCount} utilisateurs sélectionnés ?"],"Display name":"Nom affiché","Display name cannot be empty":"Le nom affiché ne peut pas être vide",Email:"Email","Failed to create group":"Impossible de créer le groupe","Failed to create user":"Impossible de créer l'utilisateur",'Failed to delete group "%{group}"':['Impossible de supprimer le groupe "%{group}"',"Impossible de supprimer %{groupCount} groupes"],'Failed to delete user "%{user}"':['Impossible de supprimer l\'utilisateur "%{user}"',"Impossible de supprimer %{userCount} utilisateurs"],"First and last name":"Prénom et nom",'Group "%{group}" was deleted successfully':['Le groupe "%{group}" a été supprimé avec succès',"%{groupCount} groupes ont été supprimés avec succès"],'Group "%{groupName}" already exists':'Le groupe "%{groupName}" existe déjà',"Group name":"Nom du groupe","Group name cannot be empty":"Le nom du groupe ne peut pas être vide","Group was created successfully":"Le groupe a été créé avec succès",Groups:"Groupes",Members:"Membres",msg:"msg","New group":"Nouveau groupe","New user":"Nouvel utilisateur","No groups in here":"Aucun groupe","No users in here":"Aucun utilisateur",Password:"Mot de passe","Password cannot be empty":"Le mot de passe ne peut pas être vide","Please enter a valid email":"Veuillez renseigner une adresse email valide",Role:"Rôle","Select %{ group }":"Sélectionner %{ group }","Select %{ user }":"Sélectionner %{ user }","Select all groups":"Sélectionner tous les groupes","Select all users":"Sélectionner tous les utilisateurs",Status:"État",'User "%{user}" was deleted successfully':["%{userCount} utilisateur a été supprimé avec succès","%{userCount} utilisateurs ont été supprimés avec succès"],'User "%{userName}" already exists':'L\'utilisateur "%{userName}" existe déjà',"User management":"Gestion des utilisateurs","User name":"Identifiant utilisateur","User name cannot be empty":"L'identifiant utilisateur ne peut pas être vide","User was created successfully":"L'utilisateur a été créé avec succès",Users:"Utilisateurs","Your role":"Votre rôle"},gl:{Cancel:"Cancelar","Clear selection":"Limpar a selección",Create:"Crear",Delete:"Eliminar",Groups:"Grupos",msg:"msx",Password:"Contrasinal",Role:"Rol",Status:"Estado",Users:"Usuarios"},it:{"Display name":"Mostra nome",Email:"Email"}};const a={name:"UsersList",props:{users:{type:Array,required:!0},roles:{type:Array,required:!0},userAssignments:{type:Array,required:!0},selectedUsers:{type:Array,required:!0}},data:()=>({sortBy:"onPremisesSamAccountName",sortDir:"asc"}),computed:{allUsersSelected(){return this.users.length===this.selectedUsers.length},footerText(){const e=this.$gettext("%{userCount} users in total");return this.$gettextInterpolate(e,{userCount:this.users.length})},fields(){return[{name:"select",title:"",type:"slot",width:"shrink",headerType:"slot"},{name:"avatar",title:"",type:"slot",width:"shrink"},{name:"onPremisesSamAccountName",title:this.$gettext("User name"),sortable:!0},{name:"displayName",title:this.$gettext("Display name"),sortable:!0},{name:"mail",title:this.$gettext("Email"),sortable:!0},{name:"role",title:this.$gettext("Role"),type:"slot",sortable:!0},{name:"status",title:this.$gettext("Status"),sortable:!0}]},data(){return e=[...this.users],t=this.sortBy,s="desc"===this.sortDir,[...e].sort(((e,r)=>(e=e[t],r=r[t],s?r.localeCompare(e):e.localeCompare(r))));var e,t,s},highlighted(){return this.selectedUsers.map((e=>e.id))}},methods:{handleSort(e){this.sortBy=e.sortBy,this.sortDir=e.sortDir},getSelectUserLabel(e){const t=this.$gettext("Select %{ user }");return this.$gettextInterpolate(t,{user:e.displayName},!0)},getUserRole(e){const t=this.userAssignments.find((t=>t.accountUuid===e.id));if(!t)return"";const s=t.find((e=>"roleId"in e));if(!s)return"";const r=this.roles.find((e=>e.id===s.roleId));return r?r.displayName:""}}};var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-table",{attrs:{"sort-by":e.sortBy,"sort-dir":e.sortDir,fields:e.fields,data:e.data,highlighted:e.highlighted},on:{sort:e.handleSort},scopedSlots:e._u([{key:"selectHeader",fn:function(){return[s("oc-checkbox",{staticClass:"oc-ml-s",attrs:{size:"large",label:e.$gettext("Select all users"),value:e.allUsersSelected,"hide-label":""},on:{input:function(t){return e.$emit("toggleSelectAllUsers")}}})]},proxy:!0},{key:"select",fn:function(t){var r=t.item;return[s("oc-checkbox",{staticClass:"oc-ml-s",attrs:{size:"large",value:e.selectedUsers,option:r,label:e.getSelectUserLabel(r),"hide-label":""},on:{input:function(t){return e.$emit("toggleSelectUser",r)}}})]}},{key:"avatar",fn:function(e){var t=e.item;return[s("avatar-image",{attrs:{width:32,userid:t.id,"user-name":t.displayName}})]}},{key:"role",fn:function(t){var s=t.item;return[e._v(" "+e._s(e.getUserRole(s.id))+" ")]}},{key:"footer",fn:function(){return[s("div",{staticClass:"oc-text-nowrap oc-text-center oc-width-1-1 oc-my-s"},[s("p",{staticClass:"oc-text-muted"},[e._v(e._s(e.footerText))])])]},proxy:!0}])})};o._withStripped=!0;const n=e.normalizeComponent({render:o,staticRenderFns:[]},undefined,a,undefined,false,undefined,!1,void 0,void 0,void 0);const i={name:"CreateUserModal",props:{existingUsers:{type:Array,required:!1,default:()=>[]}},data:function(){return{formData:{userName:{errorMessage:"",valid:!1},displayName:{errorMessage:"",valid:!1},email:{errorMessage:"",valid:!1},password:{errorMessage:"",valid:!1}},user:{onPremisesSamAccountName:"",displayName:"",mail:"",passwordProfile:{password:""}}}},computed:{buttonConfirmDisabled(){return Object.keys(this.formData).map((e=>!!this.formData[e].valid)).includes(!1)}},methods:{validateUserName(){return this.formData.userName.valid=!1,""===this.user.onPremisesSamAccountName.trim()?(this.formData.userName.errorMessage=this.$gettext("User name cannot be empty"),!1):this.user.onPremisesSamAccountName.includes(" ")?(this.formData.userName.errorMessage=this.$gettext("User name cannot contain white spaces"),!1):this.user.onPremisesSamAccountName.length&&!isNaN(this.user.onPremisesSamAccountName[0])?(this.formData.userName.errorMessage=this.$gettext("User name cannot start with a number"),!1):this.existingUsers.find((e=>e.onPremisesSamAccountName===this.user.onPremisesSamAccountName))?(this.formData.userName.errorMessage=this.$gettextInterpolate(this.$gettext('User "%{userName}" already exists'),{userName:this.user.onPremisesSamAccountName}),!1):(this.formData.userName.errorMessage="",this.formData.userName.valid=!0,!0)},validateDisplayName(){return this.formData.displayName.valid=!1,""===this.user.displayName.trim()?(this.formData.displayName.errorMessage=this.$gettext("Display name cannot be empty"),!1):(this.formData.displayName.errorMessage="",this.formData.displayName.valid=!0,!0)},validateEmail(){return this.formData.email.valid=!1,e.validate(this.user.mail)?(this.formData.email.errorMessage="",this.formData.email.valid=!0,!0):(this.formData.email.errorMessage=this.$gettext("Please enter a valid email"),!1)},validatePassword(){return this.formData.password.valid=!1,""===this.user.passwordProfile.password.trim()?(this.formData.password.errorMessage=this.$gettext("Password cannot be empty"),!1):(this.formData.password.errorMessage="",this.formData.password.valid=!0,!0)}}};var l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-modal",{attrs:{title:e.$gettext("Create user"),"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Create"),"button-confirm-disabled":e.buttonConfirmDisabled,"focus-trap-initial":"#input-user-name"},on:{cancel:function(t){return e.$emit("cancel")},confirm:function(t){return e.$emit("confirm",e.user)}},scopedSlots:e._u([{key:"content",fn:function(){return[s("oc-text-input",{staticClass:"oc-mb-s",attrs:{id:"input-user-name",label:e.$gettext("User name")+"*","error-message":e.formData.userName.errorMessage,"fix-message-line":!0},on:{input:e.validateUserName},model:{value:e.user.onPremisesSamAccountName,callback:function(t){e.$set(e.user,"onPremisesSamAccountName",t)},expression:"user.onPremisesSamAccountName"}}),e._v(" "),s("oc-text-input",{staticClass:"oc-mb-s",attrs:{id:"input-display-name",label:e.$gettext("First and last name")+"*","error-message":e.formData.displayName.errorMessage,"fix-message-line":!0},on:{input:e.validateDisplayName},model:{value:e.user.displayName,callback:function(t){e.$set(e.user,"displayName",t)},expression:"user.displayName"}}),e._v(" "),s("oc-text-input",{staticClass:"oc-mb-s",attrs:{id:"input-mail",label:e.$gettext("Email")+"*","error-message":e.formData.email.errorMessage,type:"email","fix-message-line":!0},on:{change:e.validateEmail},model:{value:e.user.mail,callback:function(t){e.$set(e.user,"mail",t)},expression:"user.mail"}}),e._v(" "),s("oc-text-input",{staticClass:"oc-mb-s",attrs:{id:"input-password",label:e.$gettext("Password")+"*","error-message":e.formData.password.errorMessage,type:"password","fix-message-line":!0},on:{input:e.validatePassword},model:{value:e.user.passwordProfile.password,callback:function(t){e.$set(e.user.passwordProfile,"password",t)},expression:"user.passwordProfile.password"}})]},proxy:!0}])})};l._withStripped=!0;const u=e.normalizeComponent({render:l,staticRenderFns:[]},undefined,i,undefined,false,undefined,!1,void 0,void 0,void 0);const c={name:"DeleteUserModal",props:{users:{type:Array,required:!0}},computed:{title(){return this.$gettextInterpolate(this.$ngettext("Delete user %{user}?","Delete %{userCount} selected users?",this.users.length),{userCount:this.users.length,user:this.users[0].onPremisesSamAccountName})},message(){return this.$ngettext("Are you sure you want to delete this user?","Are you sure you want to delete all selected users?",this.users.length)}}};var d=function(){var e=this,t=e.$createElement;return(e._self._c||t)("oc-modal",{attrs:{icon:"alarm-warning",title:e.title,message:e.message,"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Delete"),variation:"danger"},on:{confirm:function(t){return e.$emit("confirm",e.users)},cancel:function(t){return e.$emit("cancel")}}})};d._withStripped=!0;const p=e.normalizeComponent({render:d,staticRenderFns:[]},undefined,c,undefined,false,undefined,!1,void 0,void 0,void 0);const m={components:{UsersList:n,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,CreateUserModal:u,DeleteUserModal:p},setup(){const s=t.useStore(),r=e.ref([]),a=e.ref([]),o=e.ref([]),n=t.clientService.graphAuthenticated(s.getters.configuration.server,s.getters.getToken),i=e.q((function*(t,r){const o=yield e.axios.post("/api/v0/settings/roles-list",{},{headers:{authorization:s.getters.getToken}});a.value=o.data.bundles})),l=e.q((function*(t,r){const a=yield e.axios.post("/api/v0/settings/assignments-list",{account_uuid:r.user?.id},{headers:{authorization:s.getters.getToken}});o.value.push(a.data?.assignments)})),u=e.q((function*(e,t){const s=yield n.users.listUsers("displayName");r.value=s.data.value||[],yield i.perform();for(const e of r.value)yield l.perform({user:e})}));return{users:r,roles:a,userAssignments:o,loadResourcesTask:u,graphClient:n}},data:function(){return{selectedUsers:[],createUserModalOpen:!1,deleteUserModalOpen:!1}},computed:{selectedUsersText(){const e=this.$gettext("%{ userCount } selected");return this.$gettextInterpolate(e,{userCount:this.selectedUsers.length})},breadcrumbs(){return[{text:this.$gettext("User management"),to:{path:"/user-management"}},{text:this.$gettext("Users"),onClick:()=>s.bus.publish("app.user-management.list.load")}]},allUsersSelected(){return this.users.length===this.selectedUsers.length}},async mounted(){await this.loadResourcesTask.perform(this);const e=s.bus.subscribe("app.user-management.list.load",(()=>{this.loadResourcesTask.perform(this)}));this.$on("beforeDestroy",(()=>{s.bus.unsubscribe("app.user-management.list.load",e)}))},methods:{...e.mapActions(["showMessage"]),toggleSelectAllUsers(){if(this.allUsersSelected)return this.selectedUsers=[];this.selectedUsers=[...this.users]},toggleSelectUser(e){if(!this.selectedUsers.find((t=>t.id===e.id)))return this.selectedUsers.push(e);this.selectedUsers=this.selectedUsers.filter((t=>t.id!==e.id))},unselectAllUsers(){this.selectedUsers=[]},toggleCreateUserModal(){this.createUserModalOpen=!this.createUserModalOpen},toggleDeleteUserModal(){this.deleteUserModalOpen=!this.deleteUserModalOpen},async deleteUsers(e){const t=e.map((e=>this.graphClient.users.deleteUser(e.id)));try{await Promise.all(t),this.showMessage({title:this.$gettextInterpolate(this.$ngettext('User "%{user}" was deleted successfully',"%{userCount} users were deleted successfully",this.selectedUsers.length),{userCount:this.selectedUsers.length,user:this.selectedUsers[0].onPremisesSamAccountName},!0)}),this.users=this.users.filter((t=>!e.find((e=>t.id===e.id)))),this.selectedUsers=[],this.toggleDeleteUserModal()}catch(t){console.error(t),this.showMessage({title:this.$gettextInterpolate(this.$ngettext('Failed to delete user "%{user}"',"Failed to delete %{userCount} users",this.selectedUsers.length),{userCount:e.length,user:e.onPremisesSamAccountName},!0),status:"danger"})}},async createUser(e){try{const t=await this.graphClient.users.createUser(e);this.toggleCreateUserModal(),this.showMessage({title:this.$gettext("User was created successfully")}),this.users.push(t?.data)}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to create user"),status:"danger"})}}}};var g=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.createUserModalOpen?s("create-user-modal",{attrs:{"existing-users":e.users},on:{cancel:e.toggleCreateUserModal,confirm:e.createUser}}):e._e(),e._v(" "),e.deleteUserModalOpen?s("delete-user-modal",{attrs:{users:e.selectedUsers},on:{cancel:e.toggleDeleteUserModal,confirm:e.deleteUsers}}):e._e(),e._v(" "),s("main",{staticClass:"oc-flex oc-flex-column oc-height-1-1 oc-p-m"},[e.loadResourcesTask.isRunning?s("app-loading-spinner"):[s("div",{staticClass:"oc-app-bar"},[s("div",{staticClass:"oc-flex oc-flex-between"},[s("oc-breadcrumb",{staticClass:"oc-flex oc-flex-middle",attrs:{items:e.breadcrumbs}})],1),e._v(" "),s("div",{staticClass:"oc-flex-1 oc-flex oc-flex-start oc-mt-m"},[e.selectedUsers.length?s("div",{staticClass:"oc-flex oc-flex-middle"},[s("span",{domProps:{textContent:e._s(e.selectedUsersText)}}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Clear selection"),expression:"$gettext('Clear selection')"}],staticClass:"oc-ml-m",attrs:{id:"files-clear-selection","aria-label":e.$gettext("Clear selection"),appearance:"outline"},on:{click:e.unselectAllUsers}},[s("oc-icon",{attrs:{name:"close"}})],1),e._v(" "),s("oc-button",{staticClass:"oc-ml-m",attrs:{appearance:"outline"},on:{click:e.toggleDeleteUserModal}},[s("oc-icon",{attrs:{name:"delete-bin"}}),e._v(" "),s("translate",[e._v("Delete")])],1)],1):s("div",[s("oc-button",{attrs:{variation:"primary",appearance:"filled"},on:{click:e.toggleCreateUserModal}},[s("oc-icon",{attrs:{name:"add"}}),e._v(" "),s("translate",[e._v("New user")])],1)],1)])]),e._v(" "),e.users.length?s("div",[s("UsersList",{staticClass:"oc-mt-m",attrs:{users:e.users,roles:e.roles,"user-assignments":e.userAssignments,"selected-users":e.selectedUsers},on:{toggleSelectUser:e.toggleSelectUser,toggleSelectAllUsers:e.toggleSelectAllUsers}})],1):s("no-content-message",{staticClass:"files-empty",attrs:{id:"user-management-users-empty",icon:"user"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("No users in here")])]},proxy:!0}],null,!1,1415189524)})]],2)],1)};g._withStripped=!0;const h=e.normalizeComponent({render:g,staticRenderFns:[]},undefined,m,undefined,false,undefined,!1,void 0,void 0,void 0);const f={name:"GroupsList",props:{groups:{type:Array,required:!0},selectedGroups:{type:Array,required:!0}},data:()=>({sortBy:"displayName",sortDir:"asc"}),computed:{fields(){return[{name:"select",title:"",type:"slot",width:"shrink",headerType:"slot"},{name:"avatar",title:"",type:"slot",width:"shrink"},{name:"displayName",title:this.$gettext("Group name"),sortable:!0},{name:"role",title:this.$gettext("Your role"),sortable:!0},{name:"members",title:this.$gettext("Members"),sortable:!0}]},allGroupsSelected(){return this.groups.length===this.selectedGroups.length},footerText(){const e=this.$gettext("%{groupCount} groups in total");return this.$gettextInterpolate(e,{groupCount:this.groups.length})},data(){return e=[...this.groups],t=this.sortBy,s="desc"===this.sortDir,[...e].sort(((e,r)=>(e=e[t],r=r[t],s?r.localeCompare(e):e.localeCompare(r))));var e,t,s},highlighted(){return this.selectedGroups.map((e=>e.id))}},methods:{handleSort(e){this.sortBy=e.sortBy,this.sortDir=e.sortDir},getSelectGroupLabel(e){const t=this.$gettext("Select %{ group }");return this.$gettextInterpolate(t,{group:e.displayName},!0)}}};var v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-table",{attrs:{"sort-by":e.sortBy,"sort-dir":e.sortDir,fields:e.fields,data:e.data,highlighted:e.highlighted},on:{sort:e.handleSort},scopedSlots:e._u([{key:"selectHeader",fn:function(){return[s("oc-checkbox",{staticClass:"oc-ml-s",attrs:{size:"large",label:e.$gettext("Select all groups"),value:e.allGroupsSelected,"hide-label":""},on:{input:function(t){return e.$emit("toggleSelectAllGroups")}}})]},proxy:!0},{key:"select",fn:function(t){return[s("oc-checkbox",{staticClass:"oc-ml-s",attrs:{size:"large",value:e.selectedGroups,option:t.item,label:e.getSelectGroupLabel(t.item),"hide-label":""},on:{input:function(s){return e.$emit("toggleSelectGroup",t.item)}}})]}},{key:"avatar",fn:function(e){return[s("avatar-image",{attrs:{width:32,userid:e.item.id,"user-name":e.item.displayName}})]}},{key:"footer",fn:function(){return[s("div",{staticClass:"oc-text-nowrap oc-text-center oc-width-1-1 oc-my-s"},[s("p",{staticClass:"oc-text-muted"},[e._v(e._s(e.footerText))])])]},proxy:!0}])})};v._withStripped=!0;const y=e.normalizeComponent({render:v,staticRenderFns:[]},undefined,f,undefined,false,undefined,!1,void 0,void 0,void 0);const x={name:"CreateGroupModal",props:{existingGroups:{type:Array,required:!1,default:()=>[]}},data:function(){return{formData:{displayName:{errorMessage:"",valid:!1}},group:{displayName:""}}},computed:{buttonConfirmDisabled(){return Object.keys(this.formData).map((e=>!!this.formData[e].valid)).includes(!1)}},methods:{validateDisplayName(){return this.formData.displayName.valid=!1,""===this.group.displayName.trim()?(this.formData.displayName.errorMessage=this.$gettext("Group name cannot be empty"),!1):this.existingGroups.find((e=>e.displayName===this.group.displayName))?(this.formData.displayName.errorMessage=this.$gettextInterpolate(this.$gettext('Group "%{groupName}" already exists'),{groupName:this.group.displayName}),!1):(this.formData.displayName.errorMessage="",this.formData.displayName.valid=!0,!0)}}};var C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-modal",{attrs:{title:e.$gettext("Create group"),"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Create"),"button-confirm-disabled":e.buttonConfirmDisabled,"focus-trap-initial":"#input-display-name"},on:{cancel:function(t){return e.$emit("cancel")},confirm:function(t){return e.$emit("confirm",e.group)}},scopedSlots:e._u([{key:"content",fn:function(){return[s("oc-text-input",{staticClass:"oc-mb-s",attrs:{id:"input-display-name",label:e.$gettext("Group name")+"*","error-message":e.formData.displayName.errorMessage,"fix-message-line":!0},on:{input:e.validateDisplayName},model:{value:e.group.displayName,callback:function(t){e.$set(e.group,"displayName",t)},expression:"group.displayName"}})]},proxy:!0}])})};C._withStripped=!0;const b=e.normalizeComponent({render:C,staticRenderFns:[]},undefined,x,undefined,false,undefined,!1,void 0,void 0,void 0);const w={name:"DeleteGroupModal",props:{groups:{type:Array,required:!0}},computed:{title(){return this.$gettextInterpolate(this.$ngettext("Delete group %{group}?","Delete %{groupCount} selected groups?",this.groups.length),{group:this.groups[0].displayName,groupCount:this.groups.length})},message(){return this.$ngettext("Are you sure you want to delete this group?","Are you sure you want to delete all selected groups?",this.groups.length)}}};var G=function(){var e=this,t=e.$createElement;return(e._self._c||t)("oc-modal",{attrs:{icon:"alarm-warning",title:e.title,message:e.message,"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Delete"),variation:"danger"},on:{confirm:function(t){return e.$emit("confirm",e.groups)},cancel:function(t){return e.$emit("cancel")}}})};G._withStripped=!0;const U=e.normalizeComponent({render:G,staticRenderFns:[]},undefined,w,undefined,false,undefined,!1,void 0,void 0,void 0);const N={components:{GroupsList:y,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,CreateGroupModal:b,DeleteGroupModal:U},setup(){const s=t.useStore(),r=e.ref([]),a=t.clientService.graphAuthenticated(s.getters.configuration.server,s.getters.getToken),o=e.q((function*(e,t){const s=yield a.groups.listGroups("displayName");r.value=s.data.value||[]}));return{groups:r,loadResourcesTask:o,graphClient:a}},data:function(){return{selectedGroups:[],createGroupModalOpen:!1,deleteGroupModalOpen:!1}},computed:{selectedGroupsText(){const e=this.$gettext("%{ groupCount } selected");return this.$gettextInterpolate(e,{groupCount:this.selectedGroups.length})},breadcrumbs(){return[{text:this.$gettext("User management"),to:{path:"/user-management"}},{text:this.$gettext("Groups"),onClick:()=>s.bus.publish("app.user-management.list.load")}]},allGroupsSelected(){return this.groups.length===this.selectedGroups.length}},async mounted(){await this.loadResourcesTask.perform(this);const e=s.bus.subscribe("app.user-management.list.load",(()=>{this.loadResourcesTask.perform(this)}));this.$on("beforeDestroy",(()=>{s.bus.unsubscribe("app.user-management.list.load",e)}))},methods:{...e.mapActions(["showMessage"]),toggleSelectAllGroups(){if(this.allGroupsSelected)return this.selectedGroups=[];this.selectedGroups=[...this.groups]},toggleSelectGroup(e){if(!this.selectedGroups.find((t=>t.id===e.id)))return this.selectedGroups.push(e);this.selectedGroups=this.selectedGroups.filter((t=>t.id!==e.id))},unselectAllGroups(){this.selectedGroups=[]},toggleCreateGroupModal(){this.createGroupModalOpen=!this.createGroupModalOpen},toggleDeleteGroupModal(){this.deleteGroupModalOpen=!this.deleteGroupModalOpen},async deleteGroups(e){const t=e.map((e=>this.graphClient.groups.deleteGroup(e.id)));try{await Promise.all(t),this.showMessage({title:this.$gettextInterpolate(this.$ngettext('Group "%{group}" was deleted successfully',"%{groupCount} groups were deleted successfully",this.selectedGroups.length),{groupCount:this.selectedGroups.length,group:this.selectedGroups[0].displayName},!0)}),this.groups=this.groups.filter((t=>!e.find((e=>t.id===e.id)))),this.selectedGroups=[],this.toggleDeleteGroupModal()}catch(e){console.error(e),this.showMessage({title:this.$gettextInterpolate(this.$ngettext('Failed to delete group "%{group}"',"Failed to delete %{groupCount} groups",this.selectedGroups.length),{groupCount:this.selectedGroups.length,group:this.selectedGroups[0].displayName},!0),status:"danger"})}},async createGroup(e){try{const t=await this.graphClient.groups.createGroup(e);this.toggleCreateGroupModal(),this.showMessage({title:this.$gettext("Group was created successfully")}),this.groups.push(t?.data)}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to create group"),status:"danger"})}}}};var $=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.createGroupModalOpen?s("create-group-modal",{attrs:{"existing-groups":e.groups},on:{cancel:e.toggleCreateGroupModal,confirm:e.createGroup}}):e._e(),e._v(" "),e.deleteGroupModalOpen?s("delete-group-modal",{attrs:{groups:e.selectedGroups},on:{cancel:e.toggleDeleteGroupModal,confirm:e.deleteGroups}}):e._e(),e._v(" "),s("main",{staticClass:"oc-flex oc-flex-column oc-height-1-1 oc-p-m"},[e.loadResourcesTask.isRunning?s("app-loading-spinner"):[s("div",{staticClass:"oc-app-bar"},[s("div",{staticClass:"oc-flex oc-flex-between"},[s("oc-breadcrumb",{staticClass:"oc-flex oc-flex-middle",attrs:{items:e.breadcrumbs}})],1),e._v(" "),s("div",{staticClass:"oc-flex-1 oc-flex oc-flex-start oc-mt-m"},[e.selectedGroups.length?s("div",{staticClass:"oc-flex oc-flex-middle"},[s("span",{domProps:{textContent:e._s(e.selectedGroupsText)}}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Clear selection"),expression:"$gettext('Clear selection')"}],staticClass:"oc-ml-m",attrs:{id:"files-clear-selection","aria-label":e.$gettext("Clear selection"),appearance:"outline"},on:{click:e.unselectAllGroups}},[s("oc-icon",{attrs:{name:"close"}})],1),e._v(" "),s("oc-button",{staticClass:"oc-ml-m",attrs:{appearance:"outline"},on:{click:e.toggleDeleteGroupModal}},[s("oc-icon",{attrs:{name:"delete-bin"}}),e._v(" "),s("translate",[e._v("Delete")])],1)],1):s("div",[s("oc-button",{attrs:{variation:"primary",appearance:"filled"},on:{click:e.toggleCreateGroupModal}},[s("oc-icon",{attrs:{name:"add"}}),e._v(" "),s("translate",[e._v("New group")])],1)],1)])]),e._v(" "),e.groups.length?s("div",[s("GroupsList",{staticClass:"oc-mt-m",attrs:{groups:e.groups,"selected-groups":e.selectedGroups},on:{toggleSelectGroup:e.toggleSelectGroup,toggleSelectAllGroups:e.toggleSelectAllGroups}})],1):s("no-content-message",{staticClass:"files-empty",attrs:{id:"user-management-groups-empty",icon:"group-2"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("No groups in here")])]},proxy:!0}],null,!1,1866182106)})]],2)],1)};$._withStripped=!0;const S={name:"User management",id:"user-management",icon:"user-settings",isFileEditor:!1};return{appInfo:S,routes:[{path:"/",redirect:()=>({name:"user-management-users"})},{path:"/users",name:"user-management-users",component:h},{path:"/groups",name:"user-management-groups",component:e.normalizeComponent({render:$,staticRenderFns:[]},undefined,N,undefined,false,undefined,!1,void 0,void 0,void 0)}],translations:r,navItems:[{name:"Users",icon:"user",route:{path:`/${S.id}/users?`}},{name:"Groups",icon:"group-2",route:{path:`/${S.id}/groups?`}}]}}));
