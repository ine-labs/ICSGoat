define(["./chunks/vendor-569e5121","./chunks/useAppDefaults-23e4907b","./chunks/cache-40bfe919","./chunks/useRoute-1812bd9a","./chunks/resources-a6033be8"],(function(e,t,n,i,r){"use strict";const a={props:{currentFileContext:{type:Object,required:!0},isDirty:{type:Boolean,required:!0},isLoading:{type:Boolean,required:!0},isReadOnly:{type:Boolean,required:!0}},computed:{activeFilePath(){let e=this.currentFileContext.path;return(e.startsWith("/files/")||e.startsWith("/spaces/"))&&(e=e.split("/").splice(3).join("/")),e.replace(/^(\/|\\)+/,"")}}};var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"oc-app-bar oc-width-1-1 oc-my-s",attrs:{id:"text-editor-app-bar"}},[n("oc-grid",{attrs:{flex:"",gutter:"small"}},[n("div",{staticClass:"oc-width-auto"},[n("oc-button",{attrs:{id:"text-editor-controls-save",disabled:e.isReadOnly||!e.isDirty},on:{click:function(t){return e.$emit("save")}}},[n("oc-icon",{attrs:{name:"save"}})],1),e._v(" "),e.isLoading?n("oc-spinner",{attrs:{"aria-label":e.$gettext("Loading editor content")}}):e._e()],1),e._v(" "),n("div",{staticClass:"oc-width-expand oc-text-center"},[n("span",{attrs:{id:"text-editor-file-path"}},[e._v(e._s(e.activeFilePath))])]),e._v(" "),n("div",{staticClass:"oc-width-auto oc-text-right"},[n("oc-button",{attrs:{id:"text-editor-controls-close"},on:{click:function(t){return e.$emit("closeApp")}}},[n("oc-icon",{attrs:{name:"close"}})],1)],1)])],1)};o._withStripped=!0;const s={name:"TextEditor",components:{AppBar:e.normalizeComponent({render:o,staticRenderFns:[]},undefined,a,undefined,false,undefined,!1,void 0,void 0,void 0)},beforeRouteLeave(e,t,n){if(this.isDirty){const e={variation:"danger",icon:"warning",title:this.$gettext("Unsaved changes"),message:this.$gettext("Your changes were not saved. Do you want to save them?"),cancelText:this.$gettext("Don't Save"),confirmText:this.$gettext("Save"),onCancel:()=>{this.hideModal(),n()},onConfirm:()=>{this.save(),this.hideModal(),n()}};this.createModal(e)}else n()},setup(){const i=t.useAppDefaults({applicationName:"text-editor"}),{applicationConfig:r,currentFileContext:a}=i,o=e.ref(),s=e.ref(),d=e.ref(),c=e.ref(!0),l=e.q((function*(){const t=e.unref(a).path;return e.unref(i).getFileInfo(t,[n.DavProperty.Permissions]).then((e=>{c.value=-1===e.fileInfo[n.DavProperty.Permissions].indexOf(n.DavPermission.Updateable)})),yield e.unref(i).getFileContents(t).then((e=>(o.value=s.value=e.body,d.value=e.headers.ETag,e)))})).restartable(),u=e.q((function*(){const t=e.unref(a).path,n=e.unref(s);return yield e.unref(i).putFileContents(t,n,{previousEntityTag:e.unref(d)}).then((e=>{o.value=n,d.value=e.ETag}),(e=>{switch(e.statusCode){case 412:h.value="This file was updated outside this window. Please refresh the page (all changes will be lost).";break;case 500:h.value="Error when contacting the server";break;case 401:h.value="You're not authorized to save this file";break;default:h.value=e.message||e}}))})).restartable(),h=e.ref(),v=e.computed((()=>e.unref(s)&&m?e.sanitizeHtml_1(e.marked_umd.marked(e.unref(s))):null)),f=e.computed((()=>e.unref(o)!==e.unref(s))),p=e.computed((()=>l.isRunning||u.isRunning)),m=e.computed((()=>"md"===e.unref(g)||!e.unref(w).showPreviewOnlyMd)),g=e.computed((()=>e.unref(a).path.split(".").pop())),w=e.computed((()=>{const{showPreviewOnlyMd:t=!0}=e.unref(r);return{showPreviewOnlyMd:t}}));e.onMounted((()=>{l.perform(),document.addEventListener("keydown",y,!1),window.addEventListener("beforeunload",b)})),e.onBeforeUnmount((()=>{window.removeEventListener("beforeunload",b),document.removeEventListener("keydown",y,!1)}));const x=function(){u.perform()},y=function(e){(e.ctrlKey||e.metaKey)&&"KeyS"===e.code&&(e.preventDefault(),x())},b=function(t){e.unref(f)&&(t.preventDefault(),t.returnValue="")};return{...i,loadFileTask:l,saveFileTask:u,isLoading:p,showPreview:m,isDirty:f,isReadOnly:c,currentContent:s,lastError:h,renderedMarkdown:v,config:w,clearLastError:()=>{h.value=null},save:x,handleSKey:y,handleUnload:b}},methods:{...e.mapActions(["createModal","hideModal"])}};var d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("main",{staticClass:"oc-mx-l oc-my-m",attrs:{id:"text-editor"}},[n("app-bar",{attrs:{"current-file-context":e.currentFileContext,"is-loading":e.isLoading,"is-dirty":e.isDirty,"is-read-only":e.isReadOnly},on:{closeApp:e.closeApp,save:e.save}}),e._v(" "),n("oc-notifications",[e.lastError?n("oc-notification-message",{attrs:{message:e.lastError,status:"danger"},on:{close:e.clearLastError}}):e._e()],1),e._v(" "),n("div",{staticClass:"oc-flex"},[n("div",{class:e.showPreview?"oc-width-1-2":"oc-width-1-1"},[n("oc-textarea",{staticClass:"oc-height-1-1",attrs:{id:"text-editor-input",name:"input","full-width":"",label:"",rows:20,disabled:e.isReadOnly},model:{value:e.currentContent,callback:function(t){e.currentContent=t},expression:"currentContent"}})],1),e._v(" "),e.showPreview?n("div",{staticClass:"oc-container oc-width-1-2"},[n("div",{attrs:{id:"text-editor-preview"},domProps:{innerHTML:e._s(e.renderedMarkdown)}})]):e._e()])],1)};d._withStripped=!0;var c={cs:{Save:"Uložit"},de:{"Don't Save":"Verwerfen","Loading editor content":"Lade Editor Inhalt","Markdown file":"Markdown-Datei",msg:"Nachricht","Plain text file":"Text-Datei",Save:"Speichern","Text Editor":"Texteditor","Unsaved changes":"Ungespeicherte Änderungen","Your changes were not saved. Do you want to save them?":"Ungesicherte Änderungen. Möchtest Du sie speichern? "},es:{"Loading editor content":"Cargando el editor de contenido",msg:"msg",Save:"Guardar"},fr:{"Don't Save":"Ne pas enregistrer","Loading editor content":"Chargement du contenu de l'éditeur","Markdown file":"Fichier Markdown",msg:"msg","Plain text file":"Fichier texte brut",Save:"Sauvegarder","Text Editor":"Éditeur de texte","Unsaved changes":"Modifications non enregistrées","Your changes were not saved. Do you want to save them?":"Les modifications n'ont pas été enregistrées, souhaitez-vous les enregistrer ?"},gl:{msg:"msx",Save:"Gardar"},it:{}};const l=[{path:"/:filePath*",component:e.normalizeComponent({render:d,staticRenderFns:[]},undefined,s,"data-v-2d220566",false,undefined,!1,void 0,void 0,void 0),name:"text-editor",meta:{title:"Text Editor",auth:!1,patchCleanPath:!0}}],u={canBeDefault:!0},h={name:"Text Editor",id:"text-editor",icon:"file-text",isFileEditor:!0,extensions:[{extension:"txt",newFileMenu:{menuTitle:e=>e("Plain text file")},...u},{extension:"md",newFileMenu:{menuTitle:e=>e("Markdown file")},...u}]};for(const e of["js","json","xml","py","php","yaml"])h.extensions.push({extension:e,...u});return{appInfo:h,routes:l,translations:c}}));
