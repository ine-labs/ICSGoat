define(["./chunks/vendor-569e5121"],(function(e){"use strict";var t={cs:{},de:{'"%{appName}" app content area':'"%{appName}" Anwendungsinhaltsbereich','"%{appName}" app page':'"%{appName}" Anwendungsseite',"Error in app server response":"Fehler in der Antwort des App-Servers","External app":"Externe Anwendung","Loading app":"Lade Anwendung",msg:"Nachricht"},es:{msg:"msg"},fr:{"Error in app server response":"Erreur dans la rÃ©ponse du serveur","External app":"Application externe","Loading app":"Chargement de l'app",msg:"msg"},gl:{msg:"msx"},it:{"External app":"App esterna","Loading app":"Caricamento app"}};const r={name:"ErrorScreen",props:{message:{default:"",type:String,required:!1}}};var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"oc-text-center"},[r("oc-icon",{attrs:{size:"xxlarge",name:"error-warning","fill-type":"line"}}),e._v(" "),e.message?r("p",{staticClass:"oc-text-lead"},[e._v(e._s(e.message))]):e._e()],1)};a._withStripped=!0;const s=e.normalizeComponent({render:a,staticRenderFns:[]},undefined,r,undefined,false,undefined,!1,void 0,void 0,void 0);const i={name:"LoadingScreen"};var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"oc-text-center"},[r("oc-spinner",{attrs:{size:"xlarge"}}),e._v(" "),r("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-invisible"},[e._v("Loading app")])],1)};n._withStripped=!0;const o={name:"ExternalApp",components:{ErrorScreen:s,LoadingScreen:e.normalizeComponent({render:n,staticRenderFns:[]},undefined,i,undefined,false,undefined,!1,void 0,void 0,void 0)},data:()=>({loading:!1,loadingError:!1,errorMessage:"",appUrl:"",method:"",formParameters:{}}),computed:{...e.mapGetters(["getToken","capabilities","configuration"]),...e.mapGetters("Files",["publicLinkPassword"]),pageTitle(){const e=this.$gettext('"%{appName}" app page');return this.$gettextInterpolate(e,{appName:this.appName})},iFrameTitle(){const e=this.$gettext('"%{appName}" app content area');return this.$gettextInterpolate(e,{appName:this.appName})},appName(){return this.$route.params.appName},fileId(){return this.$route.params.fileId}},async created(){await(async(e,t)=>{if(t.getters.userReady)return;const r=e.currentRoute.query["public-token"],a=t.getters["Files/publicLinkPassword"];await t.dispatch("loadCapabilities",{publicToken:r,...a&&{user:"public",password:a}}),t.commit("SET_USER_READY",!0)})(this.$router,this.$store),this.loading=!0;const{"public-token":t}=this.$route.query,r=this.publicLinkPassword,a=this.getToken,s={"X-Requested-With":"XMLHttpRequest",...t&&{"public-token":t},...r&&{Authorization:"Basic "+e.Buffer.from(["public",r].join(":")).toString("base64")},...a&&{Authorization:"Bearer "+a}},i=this.configuration.server+this.capabilities.files.app_providers[0].open_url.replace(/^\/+/,"")+`?file_id=${this.fileId}`+(this.appName?`&app_name=${this.appName}`:""),n=await fetch(i,{method:"POST",headers:s});if(200!==n.status)return this.errorMessage=n.message,this.loading=!1,this.loadingError=!0,void console.error("Error fetching app information",n.status,this.errorMessage);const o=await n.json();if(!o.app_url||!o.method)return this.errorMessage=this.$gettext("Error in app server response"),this.loading=!1,this.loadingError=!0,void console.error("Error in app server response");this.appUrl=o.app_url,this.method=o.method,o.form_parameters&&(this.formParameters=o.form_parameters),"POST"===this.method&&this.formParameters&&this.$nextTick((()=>this.$refs.subm.click())),this.loading=!1}};var p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("main",{staticClass:"oc-height-1-1",class:{"oc-flex oc-flex-center oc-flex-middle":e.loading||e.loadingError}},[r("h1",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.pageTitle)}}),e._v(" "),e.loading?r("loading-screen"):e.loadingError?r("error-screen",{attrs:{message:e.errorMessage}}):e._e(),e._v(" "),e.appUrl&&"GET"===e.method?r("iframe",{staticClass:"oc-width-1-1 oc-height-1-1",attrs:{src:e.appUrl,title:e.iFrameTitle,allowfullscreen:""}}):e._e(),e._v(" "),e.appUrl&&"POST"===e.method&&e.formParameters?r("div",{staticClass:"oc-height-1-1"},[r("form",{attrs:{action:e.appUrl,target:"app-iframe",method:"post"}},[r("input",{ref:"subm",staticClass:"oc-hidden",attrs:{type:"submit"},domProps:{value:e.formParameters}}),e._v(" "),e._l(e.formParameters,(function(e,t,a){return r("div",{key:a},[r("input",{attrs:{name:t,type:"hidden"},domProps:{value:e}})])}))],2),e._v(" "),r("iframe",{staticClass:"oc-width-1-1 oc-height-1-1",attrs:{name:"app-iframe",title:e.iFrameTitle,allowfullscreen:""}})]):e._e()],1)};p._withStripped=!0;return{appInfo:{name:"External",id:"external"},routes:[{name:"apps",path:"/:fileId/:appName?",component:e.normalizeComponent({render:p,staticRenderFns:[]},undefined,o,undefined,false,undefined,!1,void 0,void 0,void 0),meta:{auth:!1,title:"External app"}}],store:{namespaced:!0,state:{mimeTypes:[]},actions:{async fetchMimeTypes({rootGetters:e,commit:t}){if(!e.capabilities.files.app_providers[0]?.enabled)return;const r=e.configuration.server+e.capabilities.files.app_providers[0].apps_url.replace("/app","app"),a=await fetch(r);if(!a.ok)throw new Error("Error fetching app provider MIME types");const{"mime-types":s}=await a.json();t("SET_MIME_TYPES",s)}},mutations:{SET_MIME_TYPES(e,t){e.mimeTypes=t}},getters:{mimeTypes:e=>e.mimeTypes}},translations:t,userReady({store:e}){e.dispatch("External/fetchMimeTypes")}}}));
