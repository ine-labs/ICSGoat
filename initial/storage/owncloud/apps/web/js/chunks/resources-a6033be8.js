define(["exports","./vendor-569e5121","./cache-40bfe919"],(function(e,a,n){"use strict";const t="contextRouteName",s="contextRouteParams",r="contextRouteQuery",i=e=>Array.isArray(e)?e[0]:e;var o={complex:["tar.bz2","tar.gz"]};const l=e=>e&&"string"==typeof e&&e.indexOf("!")>=0?e.split("!")[0]:"",p=e=>{const a=e.name;if("dir"===e.type||"folder"===e.type||e.isFolder)return"";const n=a.split(".");if(n.length>2)for(let e=0;e<n.length;e++){const a=n.slice(e,n.length).join(".");if(o.complex.includes(a))return a}return n.length<2?"":n[n.length-1]};function c(e,a){return"/"+`files/${e}/${a}`.split("/").filter(Boolean).join("/")}function d(e){const a=[];let t=null;for(const s of e)t?.storage_id!==s.storage_id||t?.file_source!==s.file_source?(n.ShareTypes.containsAnyValue(n.ShareTypes.authenticated,[s.share_type])?s.sharedWith=[{username:s.share_with,displayName:s.share_with_displayname,name:s.share_with_displayname,avatar:void 0,shareType:s.share_type}]:s.share_type===n.ShareTypes.link.value&&(s.sharedWith=[{name:s.name||s.token,link:!0,shareType:s.share_type}]),t=s,a.push(s)):n.ShareTypes.containsAnyValue(n.ShareTypes.authenticated,[s.share_type])?t.sharedWith.push({username:s.share_with,name:s.share_with_displayname,displayName:s.share_with_displayname,avatar:void 0,shareType:s.share_type}):s.share_type===n.ShareTypes.link.value&&t.sharedWith.push({name:s.name||s.token,link:!0,shareType:s.share_type});return a}function u(e,t=!1,s){const r="folder"===e.item_type,i={id:e.id,fileId:e.item_source,storageId:l(e.item_source),type:e.item_type,mimeType:0===e.state?e.mimetype:"",isFolder:r,sdate:a.DateTime_1.fromSeconds(e.stime).toRFC2822(),indicators:[],path:void 0,webDavPath:void 0};return t?(i.resourceOwner={username:e.uid_file_owner,displayName:e.displayname_file_owner},i.owner=[{username:e.uid_owner,displayName:e.displayname_owner,avatar:void 0,shareType:n.ShareTypes.user.value}],i.sharedWith=e.sharedWith||[],i.status=e.state,i.name=a.path.basename(e.file_target),i.path=e.file_target,i.webDavPath=c(e.share_with,e.file_target),i.canDownload=()=>e.state===n.ShareStatus.accepted,i.canShare=()=>n.SharePermissions.share.enabled(e.permissions),i.canRename=()=>n.SharePermissions.update.enabled(e.permissions),i.canBeDeleted=()=>n.SharePermissions.delete.enabled(e.permissions)):(i.sharedWith=e.sharedWith||[],i.shareOwner=e.uid_owner,i.shareOwnerDisplayname=e.displayname_owner,i.name=a.path.basename(e.path),i.path=e.path,i.webDavPath=c(e.uid_owner,e.path),i.canDownload=()=>!0,i.canShare=()=>!0,i.canRename=()=>!0,i.canBeDeleted=()=>!0),i.extension=p(i),i.isReceivedShare=()=>t,i.canUpload=()=>!0,i.isMounted=()=>!1,i.share=m(e,i,s),i}function m(e,t,s){return parseInt(e.share_type)===n.ShareTypes.link.value?function(e){let t="";const s=n.LinkShareRoles.getByBitmask(parseInt(e.permissions),"folder"===e.item_type);s&&(t=s.label);return{shareType:parseInt(e.share_type),id:e.id,token:e.token,url:e.url,path:e.path,permissions:e.permissions,description:t,stime:e.stime,name:"string"==typeof e.name?e.name:"",password:!(!e.share_with||!e.share_with_displayname),expiration:"string"==typeof e.expiration?a.DateTime_1.fromFormat(e.expiration,"yyyy-MM-dd HH:mm:ss").toFormat("yyyy-MM-dd"):null,itemSource:e.item_source,file:{parent:e.file_parent,source:e.file_source,target:e.file_target}}}(e):parseInt(e.share_type)===n.ShareTypes.space.value?h(e,t):y(e,t,s)}function h(e,a){let t,s;switch(e.role){case n.spaceRoleManager.name:t=n.spaceRoleManager.bitmask(!0),s=n.spaceRoleManager;break;case n.spaceRoleEditor.name:t=n.spaceRoleEditor.bitmask(!0),s=n.spaceRoleEditor;break;case n.spaceRoleViewer.name:t=n.spaceRoleViewer.bitmask(!0),s=n.spaceRoleViewer}return{shareType:n.ShareTypes.space.value,id:a,collaborator:{name:e.onPremisesSamAccountName,displayName:e.displayName,additionalInfo:null},permissions:t,role:s}}function f(e){return"string"!=typeof e?null:e}function y(e,a,t){const s={shareType:parseInt(e.share_type),id:e.id};return n.ShareTypes.containsAnyValue([n.ShareTypes.user,n.ShareTypes.remote,n.ShareTypes.group],[s.shareType])&&(s.collaborator={name:e.share_with,displayName:e.share_with_displayname,additionalInfo:f(e.share_with_additional_info)},s.owner={name:e.uid_owner,displayName:e.displayname_owner,additionalInfo:f(e.additional_info_owner)},s.fileOwner={name:e.uid_file_owner,displayName:e.displayname_file_owner,additionalInfo:f(e.additional_info_file_owner)},s.stime=e.stime,s.permissions=parseInt(e.permissions),s.customPermissions=n.SharePermissions.bitmaskToPermissions(e.permissions),s.role=n.PeopleShareRoles.getByBitmask(parseInt(e.permissions),a.isFolder,t)),("string"==typeof e.expiration||e.expiration instanceof String)&&(s.expires=new Date(e.expiration)),s.path=e.path,s}e.aggregateResourceShares=function(e,n=!1,t,s,r){return n?(e=d(e),a.orderBy(e,["file_target","permissions"],["asc","desc"]).map((e=>u(e,n,t)))):(e.sort(((e,a)=>e.path.localeCompare(a.path))),d(e).map((e=>u(e,n,t))))},e.buildCollaboratorShare=y,e.buildDeletedResource=function(e){const t="dir"===e.type||"folder"===e.type,s=e.fileInfo[n.DavProperty.TrashbinOriginalFilename],r=p({name:s,type:e.type});return{type:t?"folder":e.type,isFolder:t,ddate:e.fileInfo[n.DavProperty.TrashbinDeletedDate],name:a.path.basename(s),extension:r,path:e.fileInfo[n.DavProperty.TrashbinOriginalLocation],id:a.path.basename(e.name),indicators:[],canUpload:()=>!1,canDownload:()=>!1,canBeDeleted:()=>!0,canBeRestored:function(){return!0},canRename:()=>!1,canShare:()=>!1,canCreate:()=>!1,isMounted:()=>!1,isReceivedShare:()=>!1}},e.buildResource=function(e){const t="dir"===e.type||"folder"===e.type,s=p(e);let r;return r=e.name.startsWith("/files")||e.name.startsWith("/space")?e.name.split("/").slice(3).join("/"):e.name,r.startsWith("/")||(r=`/${r}`),{id:e.fileInfo[n.DavProperty.FileId],fileId:e.fileInfo[n.DavProperty.FileId],storageId:l(e.fileInfo[n.DavProperty.FileId]),mimeType:e.fileInfo[n.DavProperty.MimeType],name:a.path.basename(e.name),extension:t?"":s,path:r,webDavPath:e.name,type:t?"folder":e.type,isFolder:t,mdate:e.fileInfo[n.DavProperty.LastModifiedDate],size:t?e.fileInfo[n.DavProperty.ContentSize]:e.fileInfo[n.DavProperty.ContentLength],indicators:[],permissions:e.fileInfo[n.DavProperty.Permissions]||"",starred:"0"!==e.fileInfo[n.DavProperty.IsFavorite],etag:e.fileInfo[n.DavProperty.ETag],sharePermissions:e.fileInfo[n.DavProperty.SharePermissions],shareTypes:e.fileInfo[n.DavProperty.ShareTypes]?e.fileInfo[n.DavProperty.ShareTypes].map((e=>parseInt(e))):[],privateLink:e.fileInfo[n.DavProperty.PrivateLink],downloadURL:e.fileInfo[n.DavProperty.DownloadURL],ownerDisplayName:e.fileInfo[n.DavProperty.OwnerDisplayName],ownerId:e.fileInfo[n.DavProperty.OwnerId],canUpload:function(){return this.permissions.indexOf(n.DavPermission.FolderCreateable)>=0},canDownload:function(){return!0},canBeDeleted:function(){return this.permissions.indexOf(n.DavPermission.Deletable)>=0},canRename:function(){return this.permissions.indexOf(n.DavPermission.Renameable)>=0},canShare:function(){return this.permissions.indexOf(n.DavPermission.Shareable)>=0},canCreate:function(){return this.permissions.indexOf(n.DavPermission.FolderCreateable)>=0},isMounted:function(){return this.permissions.indexOf(n.DavPermission.Mounted)>=0},isReceivedShare:function(){return this.permissions.indexOf(n.DavPermission.Shared)>=0}}},e.buildShare=m,e.buildSharedResource=u,e.buildSpace=function(e){let a,t,s=!1;const r=Object.fromEntries(n.SpacePeopleShareRoles.list().map((e=>[e.name,[]])));if(e.special&&(a=e.special.find((e=>"image"===e.specialFolder.name)),t=e.special.find((e=>"readme"===e.specialFolder.name))),e.root){for(const a of e.root.permissions)for(const e of n.SpacePeopleShareRoles.list())a.roles.includes(e.name)&&r[e.name].push(...a.grantedTo.map((e=>e.user.id)));e.root.deleted&&(s="trashed"===e.root.deleted?.state)}return{id:e.id,fileId:"",storageId:e.id,mimeType:"",name:e.name,description:e.description,extension:"",path:"",webDavPath:"",type:"space",isFolder:!0,mdate:e.lastModifiedDateTime,size:"",indicators:[],permissions:"",starred:!1,etag:"",sharePermissions:"",shareTypes:[],privateLink:"",downloadURL:"",ownerDisplayName:"",ownerId:"",disabled:s,spaceQuota:e.quota,spaceRoles:r,spaceMemberIds:Object.values(r).reduce(((e,a)=>e.concat(a)),[]),spaceImageData:a,spaceReadmeData:t,canUpload:function({user:e}={}){const a=[...this.spaceRoles[n.spaceRoleManager.name],...this.spaceRoles[n.spaceRoleEditor.name]];return e&&a.includes(e.uuid)},canDownload:function(){return!0},canBeDeleted:function({user:e}={}){const a=[...this.spaceRoles[n.spaceRoleManager.name]];return this.disabled&&e&&a.includes(e.uuid)},canRename:function({user:e}={}){const a=[...this.spaceRoles[n.spaceRoleManager.name]];return e&&a.includes(e.uuid)},canEditDescription:function({user:e}={}){const a=[...this.spaceRoles[n.spaceRoleManager.name]];return e&&a.includes(e.uuid)},canRestore:function({user:e}={}){const a=[...this.spaceRoles[n.spaceRoleManager.name]];return this.disabled&&e&&a.includes(e.uuid)},canDisable:function({user:e}={}){const a=[...this.spaceRoles[n.spaceRoleManager.name]];return!this.disabled&&e&&a.includes(e.uuid)},canShare:function({user:e}={}){const a=[...this.spaceRoles[n.spaceRoleManager.name]];return e&&a.includes(e.uuid)},canEditImage:function({user:e}={}){const a=[...this.spaceRoles[n.spaceRoleManager.name],...this.spaceRoles[n.spaceRoleEditor.name]];return e&&a.includes(e.uuid)},canEditReadme:function({user:e}={}){const a=[...this.spaceRoles[n.spaceRoleManager.name],...this.spaceRoles[n.spaceRoleEditor.name]];return e&&a.includes(e.uuid)},canEditQuota:function({user:e}={}){const a=[...this.spaceRoles[n.spaceRoleManager.name]];return e&&a.includes(e.uuid)},canCreate:function(){return!0},isMounted:function(){return!0},isReceivedShare:function(){return!1}}},e.buildSpaceShare=h,e.buildWebDavFilesPath=c,e.buildWebDavFilesTrashPath=function(e,a=""){return"/"+`trash-bin/${e}/${a}`.split("/").filter(Boolean).join("/")},e.buildWebDavSpacesPath=function(e,a){return"/"+`spaces/${e}/${a}`.split("/").filter(Boolean).join("/")},e.buildWebDavSpacesTrashPath=function(e,a=""){return"/"+`/spaces/trash-bin/${e}/${a}`.split("/").filter(Boolean).join("/")},e.contextQueryToFileContextProps=e=>({routeName:i(e.contextRouteName),routeParams:e.contextRouteParams,routeQuery:e.contextRouteQuery}),e.contextRouteNameKey=t,e.extractNameWithoutExtension=e=>{const a=e.extension||"",n=e.name||"";if(!a.length)return n;const t=n.lastIndexOf(`.${a}`);return n.substring(0,t)},e.renameResource=function(e,a,n){let t="/"+n+a;return(t.startsWith("/files")||t.startsWith("/space"))&&(t=t.split("/").splice(3).join("/")),e.name=a,e.path=t,e.webDavPath="/"+n+a,e.extension=p(e),e},e.routeToContextQuery=e=>{const{params:a,query:n}=e,i={},o=e.meta?.contextQueryItems||[];for(const e of o)i[e]=n[e];return{[t]:e.name,[s]:a,[r]:i}},e.useAppNavigation=function(e){return{closeApp:()=>(n=>{const t=e.router,{path:s,routeName:r,routeParams:i,routeQuery:o}=a.unref(n);return t.push({name:a.unref(r),params:a.unref(i),query:{...a.unref(o),scrollTo:a.basename(a.unref(s))}})})(e.currentFileContext)}}}));
