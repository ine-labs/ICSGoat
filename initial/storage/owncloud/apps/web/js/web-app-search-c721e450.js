define(["./chunks/List-2df825b8","./chunks/vendor-569e5121","./chunks/index-e33fde60"],(function(e,t,i){"use strict";const r={name:"SearchBar",filters:{truncate:t.truncate},data:()=>({term:"",optionsVisible:!1,activeProvider:void 0,providerStore:e.providerStore}),computed:{availableProviders(){return this.providerStore.availableProviders},searchLabel(){return this.$gettext("Enter search term")}},watch:{$route(){this.activeProvider&&!this.activeProvider.available&&(this.activeProvider=void 0)}},mounted(){const e=this.$el.getElementsByTagName("input")[0],i=t.get(this,"$route.query.term");e&&i&&(this.term=i,e.value=i)},asyncComputed:{searchResults:{get(){return this.optionsVisible&&this.activeProvider&&this.activeProvider.previewSearch&&this.activeProvider.previewSearch.available?this.activeProvider.previewSearch.search(this.term):[]},watch:["term","activeProvider","optionsVisible"]}},created(){window.addEventListener("keyup",this.onEvent),window.addEventListener("focusin",this.onEvent),window.addEventListener("click",this.onEvent)},beforeDestroy(){window.removeEventListener("keyup",this.onEvent),window.removeEventListener("focusin",this.onEvent),window.removeEventListener("click",this.onEvent)},methods:{updateTerm(e){this.term=e,this.activeProvider.updateTerm(e)},resetProvider(){this.optionsVisible=!1,this.availableProviders.forEach((e=>e.reset()))},activateProvider(e){this.optionsVisible=!1,this.activeProvider=e,e.activate(this.term)},onEvent(e){this.activeProvider||(this.activeProvider=this.availableProviders[0]);const t=this.optionsVisible,i=this.$el.contains(e.target),r=e.target.classList.contains("oc-search-clear"),s=38===e.keyCode,a=40===e.keyCode,o=13===e.keyCode,n=27===e.keyCode,c=this.availableProviders.indexOf(this.activeProvider);if(e.stopPropagation(),this.optionsVisible=!r&&!n&&i,!this.optionsVisible)return;if(o)return void this.activateProvider(this.activeProvider);let d;if((s||a)&&this.availableProviders.length>0&&t){const e=a?c<this.availableProviders.length-1:c>0,t=a?0:this.availableProviders.length-1,i=a?c+1:c-1;d=e?i:t}isNaN(d)||d===c||(this.activeProvider=this.availableProviders[d])}}};var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.availableProviders.length?i("div",{class:{"options-visible":e.optionsVisible&&e.term},attrs:{id:"files-global-search"}},[i("oc-search-bar",{ref:"search",attrs:{id:"files-global-search-bar",label:e.searchLabel,"type-ahead":!0,placeholder:e.searchLabel,"button-hidden":!0},on:{input:e.updateTerm,clear:e.resetProvider}}),e._v(" "),e.optionsVisible&&e.term?i("div",{ref:"options",staticClass:"oc-mt-s oc-rounded",attrs:{id:"files-global-search-options"}},[i("ul",{staticClass:"oc-list oc-list-divider"},[e._l(e.availableProviders,(function(t){return i("li",{key:t.id,staticClass:"provider",class:{selected:!!e.activeProvider&&t.id===e.activeProvider.id},on:{click:function(i){return e.activateProvider(t)}}},[i("oc-icon",{attrs:{name:"search","fill-type":"line","accessible-label":"Search"}}),e._v(" "),i("span",{staticClass:"term"},[e._v(e._s(e._f("truncate")(e.term)))]),e._v(" "),t.label?i("button",{staticClass:"label oc-rounded"},[e._v(e._s(t.label))]):e._e()],1)})),e._v(" "),e.$asyncComputed.searchResults.updating?i("li",{staticClass:"loading spinner"},[i("oc-spinner",{attrs:{size:"small","aria-hidden":!0,"aria-label":""}})],1):e._e(),e._v(" "),e.$asyncComputed.searchResults.updating?e._e():e._l(e.searchResults,(function(t,r){return i("li",{key:t.id,staticClass:"preview",class:{first:0===r},on:{click:function(i){return e.activeProvider.previewSearch.activate(t)}}},[i(e.activeProvider.previewSearch.component,{tag:"component",attrs:{provider:e.activeProvider,"search-result":t}})],1)}))],2)]):e._e()],1):i("div")};s._withStripped=!0;const a=t.normalizeComponent({render:s,staticRenderFns:[]},undefined,r,undefined,false,undefined,!1,void 0,void 0,void 0);const o={name:"Search"};var n=function(){var e=this.$createElement,t=this._self._c||e;return t("main",{staticClass:"oc-flex oc-height-1-1",attrs:{id:"search"}},[t("router-view",{attrs:{id:"search-view"}})],1)};n._withStripped=!0;const c=t.normalizeComponent({render:n,staticRenderFns:[]},undefined,o,undefined,false,undefined,!1,void 0,void 0,void 0);var d={state:{options:{hideSearchBar:!1}},getters:{options:e=>e.options}},v=t.merge({namespaced:!0},d),l={cs:{},de:{"Enter search term":"Suchbegriff eingeben"},es:{"Enter search term":"Introduzca termino de búsqueda"},fr:{"Enter search term":"Saisissez le terme à rechercher"},gl:{},it:{}};return i.bus.subscribe("app.search.register.provider",(t=>{e.providerStore.addProvider(t)})),{appInfo:{name:"Search",id:"search",icon:"folder"},store:v,routes:[{name:"search",path:"/",component:c,children:[{name:"provider-list",path:"list/:page?",component:e.__vue_component__,meta:{contextQueryItems:["term","provider"]}}]}],translations:l,mounted({portal:e}){e.open("runtime","header",1,[a])}}}));
