define(["./chunks/vendor-569e5121","./chunks/resources-a6033be8","./chunks/cache-40bfe919","./chunks/useRoute-1812bd9a","./chunks/error-992e7064","./chunks/index-e33fde60","./chunks/List-2df825b8"],(function(e,t,s,i,a,r,o){"use strict";const n=()=>{const t=i.useRoute();return e.computed((()=>e.unref(t).name))},l=(t,s)=>{const a=i.useRouter();return e.customRef(((e,i)=>(a.afterEach(((e,s)=>e.query[t]!==s.query[t]&&i())),{get:()=>(e(),a.currentRoute.query[t]||s),async set(e){a.currentRoute.query[t]!==e&&(await a.replace({query:{...a.currentRoute.query,[t]:e}}),i())}})))},c=t=>{const s=l(t.name),i=a.useLocalStorage(d(t));return e.watch((()=>e.unref(s)?{value:e.unref(s),source:"route"}:e.unref(i)?{value:e.unref(i),source:"storage"}:{value:t.defaultValue,source:"default"}),(e=>{["route","default"].includes(e.source)&&(i.value=e.value===t.defaultValue?void 0:e.value),["storage","default"].includes(e.source)&&(s.value=e.value)}),{immediate:!0}),s},d=e=>["oc_options",e.routeName,e.name].filter(Boolean).join("_");function u(e="",t=!1){const s="/"+e.replace(/^\/+/,"").replace(/\/+$/,"");if("/"===s)return[];const i=[],a=s.split("/");for(t&&i.push(s),a.pop();a.length>0;)i.push(a.join("/")),a.pop();return i}const h=e=>void 0!==e.shareTypes?e.shareTypes:e.shares?Array.from(new Set(e.shares.map((e=>parseInt(e.type))))):[],p=e=>s.ShareTypes.containsAnyValue(s.ShareTypes.authenticated,h(e)),m=e=>s.ShareTypes.containsAnyValue(s.ShareTypes.unauthenticated,h(e)),f=(e,t)=>p(e)||((e,t)=>e.isReceivedShare()||s.ShareTypes.containsAnyValue(s.ShareTypes.authenticated,b(e.path,t)))(e,t),g=(e,t)=>m(e)||((e,t)=>s.ShareTypes.containsAnyValue(s.ShareTypes.unauthenticated,b(e.path,t)))(e,t),v=e=>p(e)?s.$gettext("This item is directly shared with others."):s.$gettext("This item is shared with others through one of the parent folders."),_=e=>m(e)?s.$gettext("This item is directly shared via links."):s.$gettext("This item is shared via links through one of the parent folders."),b=(e,t)=>{const s=u(e,!0);if(0===s.length)return[];s.pop();const i={};return s.forEach((e=>{const s=t[e];s&&s.forEach((e=>{i[e.shareType]=!0}))})),Object.keys(i).map((e=>parseInt(e,10)))},S=(e,t)=>[{id:`files-sharing-${e.id.replaceAll("=","")}`,accessibleDescription:v(e),label:s.$gettext("Show invited people"),visible:f(e,t),icon:"group",target:"sharing-item",type:p(e)?"user-direct":"user-indirect",handler:x},{id:`file-link-${e.id.replaceAll("=","")}`,accessibleDescription:_(e),label:s.$gettext("Show links"),visible:g(e,t),icon:"link",target:"sharing-item",type:m(e)?"link-direct":"link-indirect",handler:x}].filter((e=>e.visible)),x=async(e,t)=>{await window.Vue.$store.dispatch("Files/sidebar/openWithPanel",t)};const y=new class{serverUrl;capability;initialize(t,s=[]){this.serverUrl=t;const i=s.filter((e=>e.enabled)).sort(((t,s)=>e.semver.rcompare(t.version,s.version)));this.capability=i.length?i[0]:null}get available(){return!!this.capability?.version}get fileIdsSupported(){return e.semver.major(this.capability?.version)>=2}async triggerDownload(e){const t=e.clientService||s.clientService;if(!this.available)throw new a.RuntimeError("no archiver available");if((e.fileIds?.length||0)+(e.files?.length||0)===0)throw new a.RuntimeError("requested archive with empty list of resources");const i=this.buildDownloadUrl({...e,clientService:t});if(!i)throw new a.RuntimeError("download url could not be built");const r=e.publicToken?i:await t.owncloudSdk.signUrl(i);return window.location=r,r}buildDownloadUrl(t){const s=[];t.publicToken&&s.push(`public-token=${t.publicToken}`);switch(e.semver.major(this.capability.version)){case 2:return s.push(...t.fileIds.map((e=>`id=${e}`))),this.url+"?"+s.join("&");case 1:{const e=Math.random().toString(36).substring(2);return s.push(`dir=${encodeURIComponent(t.dir)}`,...t.files.map((e=>`files[]=${encodeURIComponent(e)}`)),`downloadStartSecret=${e}`),this.url+"?"+s.join("&")}default:return}}get url(){if(!this.available)throw new a.RuntimeError("no archiver available");return/^https?:\/\//i.test(this.capability.archiver_url)?this.capability.archiver_url:[this.serverUrl.replace(/\/+$/,""),this.capability.archiver_url.replace(/^\/+/,"")].join("/")}};const w=new class{serverUrl;capability;initialize(e=null){this.capability=e}get available(){return!!this.capability?.version}get supportedMimeTypes(){return this.capability?.supportedMimeTypes||[]}isMimetypeSupported(e,t=!1){return this.getSupportedMimeTypes(t?"image/":null).includes(e)}getSupportedMimeTypes(e){return e?this.supportedMimeTypes.filter((t=>t.startsWith(e))):this.supportedMimeTypes}};class ${static filterSearch;static sdkSearch}const C=t=>e.lib.stringify({scalingup:t.scalingup||0,preview:Object.hasOwnProperty.call(t,"preview")?t.preview:1,a:Object.hasOwnProperty.call(t,"a")?t.a:1,...t.etag&&{c:t.etag.replaceAll('"',"")},...t.dimensions&&t.dimensions[0]&&{x:t.dimensions[0]},...t.dimensions&&t.dimensions[1]&&{y:t.dimensions[1]}}),F=async(e,t=!1)=>{if(t)return E(e);const i=[e.server,"remote.php/dav",a.encodePath(e.resource.webDavPath),"?",C({etag:e.resource.etag,dimensions:e.dimensions})].join("");try{const{data:t}=await s.clientService.httpAuthenticated(e.token).get(i,{responseType:"blob"});return window.URL.createObjectURL(t)}catch(e){}},E=async t=>{const i=s.cacheService.filePreview.get(t.resource.id);if(i&&i.etag===t.resource.etag&&e.isEqual(t.dimensions,i.dimensions))return i.src;try{const e=await F(t);return s.cacheService.filePreview.set(t.resource.id,{src:e,etag:t.resource.etag,dimensions:t.dimensions},0).src}catch(e){}},R=async({resource:e,isPublic:t,dimensions:i,server:a,userId:r,token:o},n=!1)=>{let l="";return"folder"!==e.type&&e.extension&&(t||a&&r&&o)?(l=t?await(async e=>{const[t,i]=e.resource.downloadURL.split("?"),a=[t,[C({etag:e.resource.etag,dimensions:e.dimensions}),i].filter(Boolean).join("&")].filter(Boolean).join("?"),{status:r}=await s.clientService.httpUnAuthenticated.head(a);if(404!==r)return a})({resource:e,dimensions:i}):await F({server:a,userId:r,token:o,resource:e,dimensions:i},n),l):l},T=(t,s,i)=>new e.Fuse(t,{includeScore:!0,useExtendedSearch:!0,threshold:.3,keys:["name","type","icon","extension"]}).search(s,{limit:i}).map((e=>e.item)),k=(e,t)=>!(!e||!t)&&e.id===t.id,I=(t,i)=>a=>((t,s,i)=>e.computed((()=>{const a=e.get(t,`getters.capabilities.${s}`,i);if(void 0===a)throw new Error("useCapability: capability is not defined and no default was provided");return a})))(a||s.useStore(),t,i),D=I("files_sharing.resharing",!0),P=I("spaces.enabled",!1);var L={filters:{roundNumber:e=>parseInt(e.toFixed(0))},data:()=>({uploadQueue:new e._default({concurrency:1}),directoryQueue:new e._default({concurrency:1}),uploadFileUniqueId:0,existingResources:[]}),computed:{...e.mapGetters("Files",["files","highlightedFile","publicLinkPassword","currentFolder"]),...e.mapGetters(["getToken","capabilities","configuration"]),...e.mapGetters(["user"])},methods:{...e.mapActions("Files",["resetSearch","addFileToProgress","removeFileFromProgress"]),...e.mapActions(["showMessage","createModal","hideModal"]),formDateFromJSDate(t,s=e.DateTime_1.DATETIME_FULL){return e.DateTime_1.fromJSDate(t).setLocale(this.$language.current).toLocaleString(s)},formDateFromHTTP(t,s=e.DateTime_1.DATETIME_FULL){return e.DateTime_1.fromHTTP(t).setLocale(this.$language.current).toLocaleString(s)},formDateFromISO(t,s=e.DateTime_1.DATETIME_FULL){return e.DateTime_1.fromISO(t).setLocale(this.$language.current).toLocaleString(s)},formDateFromRFC(t,s=e.DateTime_1.DATETIME_FULL){return e.DateTime_1.fromRFC2822(t).setLocale(this.$language.current).toLocaleString(s)},formRelativeDateFromJSDate(t){return e.DateTime_1.fromJSDate(t).setLocale(this.$language.current).toRelative()},formRelativeDateFromHTTP(t){return e.DateTime_1.fromHTTP(t).setLocale(this.$language.current).toRelative()},formRelativeDateFromISO(t){return e.DateTime_1.fromISO(t).setLocale(this.$language.current).toRelative()},formRelativeDateFromRFC(t){return e.DateTime_1.fromRFC2822(t).setLocale(this.$language.current).toRelative()},delayForScreenreader(e,t=500){setTimeout((()=>e()),t)},checkIfBrowserSupportsFolderUpload(){const e=document.createElement("input");return e.type="file",void 0!==e.webkitdirectory||void 0!==e.mozdirectory||void 0!==e.directory},checkIfElementExists(e){const t=e.name||e;return this.files.find((e=>e.name===t))},async processDirectoryEntryRecursively(e){await this.$_buildCreateFolderCallback(this.rootPath,e.fullPath,{userId:this.user?.id,storageId:this.$route.params.storageId,publicLinkPassword:this.publicLinkPassword})();const t=e.createReader(),s=this;t.readEntries((function(e){e.forEach((function(e){e.isDirectory?s.processDirectoryEntryRecursively(e):e.file((t=>{s.$_ocUpload(t,e.fullPath,null,!1)}))}))}))},hideOverwriteDialog(){this.existingResources=[],this.hideModal()},confirmOverwrite(){for(const e of this.existingResources)this.$_ocUpload(e.file,e.path,e.etag);this.hideOverwriteDialog()},displayOverwriteDialog(){const e=this.$gettext('File "%{file}" already exists'),t=!this.publicPage()&&this.capabilities.files&&this.capabilities.files.versioning,s={variation:t?"passive":"danger",icon:"upload-cloud",title:this.existingResources.length>1?this.$gettext("Multiple files already exist"):this.$gettextInterpolate(e,{file:this.existingResources[0].file.name},!0),message:t?this.$gettext("Do you want to create a new version?"):this.$gettext("Do you want to overwrite it?"),cancelText:this.$gettext("Cancel"),confirmText:t?this.$gettext("Create"):this.$gettext("Overwrite"),onCancel:this.hideOverwriteDialog,onConfirm:this.confirmOverwrite};this.createModal(s)},$_ocUpload_addDropToQueue(e){const t=e.dataTransfer.items||e.dataTransfer.files,s=[];if(t instanceof FileList)this.$_ocUpload_addDirectoryToQueue(e);else{for(let e of t){e=e.webkitGetAsEntry();const t=this.checkIfElementExists(e);if(e.isDirectory){if(t){this.showMessage({title:this.$gettextInterpolate(this.$gettext('Folder "%{folder}" already exists.'),{folder:e.name},!0),status:"danger"});continue}this.processDirectoryEntryRecursively(e).then((()=>{this.$emit("success",null,e.name)}))}else t?s.push(new Promise((s=>{e.file((i=>{this.existingResources.push({file:i,path:e.fullPath,etag:t.etag}),s()}))}))):e.file((t=>{this.$_ocUpload(t,e.fullPath)}))}s.length>0&&Promise.all(s).then((()=>{this.displayOverwriteDialog()}))}},$_ocUpload_addFileToQueue(e){const t=e.target.files;if(!(t.length<1)){for(let e=0;e<t.length;e++){const s=this.checkIfElementExists(t[e]);s?this.existingResources.push({file:t[e],path:t[e].name,etag:s.etag}):this.$_ocUpload(t[e],t[e].name)}this.$_ocUploadInput_clean(),this.existingResources.length>0&&this.displayOverwriteDialog()}},$_ocUpload_addDirectoryToQueue(t){const s=t.target.files||t.dataTransfer.files;if(!s.length)return;let i=s[0].webkitRelativePath.replace("/"+s[0].name,"");const a=i.split("/")[0];if(this.checkIfElementExists(a))this.showMessage({title:this.$gettextInterpolate(this.$gettext('Folder "%{folder}" already exists.'),{folder:a},!0),status:"danger"});else{const t=[];for(const a of s){if(this.$_addFileToUploadProgress(a),i=a.webkitRelativePath.replace("/"+a.name,""),t.indexOf(i)>-1)continue;const s=i.split("/");for(let i=0;i<s.length;i++){if(0===i){-1===t.indexOf(s[0])&&t.push(s[0]);continue}const a=`${e.path.join.apply(null,s.slice(0,i))}/${s[i]}`;-1===t.indexOf(a)&&t.push(a)}}const a=[],r=t[0];for(const e of t)a.push(this.directoryQueue.add(this.$_buildCreateFolderCallback(this.rootPath,e,{userId:this.user?.id,storageId:this.$route.params.storageId,publicLinkPassword:this.publicLinkPassword})));const o=[];Promise.all(a).then((()=>{for(const e of s)o.push(this.$_ocUpload(e,e.webkitRelativePath,null,!1,!1));Promise.all(o).then((()=>{this.$emit("success",null,r),this.$_ocUploadInput_clean()}))}))}},$_buildCreateFolderCallback(e,s,{userId:i,storageId:a,publicLinkPassword:r}){if(this.publicPage())return()=>this.$client.publicFiles.createFolder(e,s,r);const o=a?t.buildWebDavSpacesPath(a,`${e}${s}`):t.buildWebDavFilesPath(i,`${e}${s}`);return()=>this.$client.files.createFolder(o)},$_addFileToUploadProgress(e){e.id=this.uploadFileUniqueId,this.uploadFileUniqueId++,this.addFileToProgress(e)},$_ocUpload(s,i,a=null,r=!0,o=!0){this.$root.$emit("upload-start");let n,l=this.path||"",c=i;if(o&&this.$_addFileToUploadProgress(s),this.publicPage()){const t=l.indexOf("/"),i=l.substring(0,t);l=l.substring(t+1)||"",c=e.path.join(l,c);const r={};s.lastModifiedDate?r["X-OC-Mtime"]=""+s.lastModifiedDate.getTime()/1e3:s.lastModified&&(r["X-OC-Mtime"]=""+s.lastModified/1e3),n=this.uploadQueue.add((()=>this.$client.publicFiles.putFileContents(i,c,this.publicLinkPassword,s,{headers:r,onProgress:e=>{this.$_ocUpload_onProgress(e,s)},overwrite:a})))}else{l=this.path||"";const i=e.path.join(l,c);if(c=this.$route.params.storageId?t.buildWebDavSpacesPath(this.$route.params.storageId,i):t.buildWebDavFilesPath(this.user.id,i),this.browserSupportsChunked&&this.currentFolder.isChunkedUploadSupported){let t=this.configuration.uploadChunkSize;this.capabilities.files.tus_support.max_chunk_size>0&&(null===t||0===t||t>this.capabilities.files.tus_support.max_chunk_size)&&(t=this.capabilities.files.tus_support.max_chunk_size),n=this.uploadQueue.add((()=>this.uploadChunkedFile(s,e.path.dirname(c),{chunkSize:t,overridePatchMethod:!!this.capabilities.files.tus_support.http_method_override,emitProgress:e=>{this.$_ocUpload_onProgress(e,s)}})))}else{const e={};s.lastModifiedDate?e["X-OC-Mtime"]=""+s.lastModifiedDate.getTime()/1e3:s.lastModified&&(e["X-OC-Mtime"]=""+s.lastModified/1e3),n=this.uploadQueue.add((()=>this.$client.files.putFileContents(c,s,{headers:e,onProgress:e=>{this.$_ocUpload_onProgress(e,s)},overwrite:a})))}}n.then((e=>{this.$root.$emit("upload-end"),this.removeFileFromProgress(s),r&&this.$emit("success",e,s)})).catch((e=>{this.removeFileFromProgress(s),this.$emit("error",e)}))},$_ocUpload_onProgress(e,t){const s=parseInt(100*e.loaded/e.total);this.$emit("progress",{id:t.id,fileName:t.name,progress:s})},$_ocUploadInput_clean(){const e=this.$refs.input;e&&(e.value="")}}};const A=(e,...t)=>{const{href:s}=e.resolve(e.currentRoute);return t.map((t=>{const{href:i}=e.resolve({...t});return"/"!==i&&"#/"!==i&&s.startsWith(i)})).some(Boolean)},M=(...e)=>(t,...s)=>{if(!s.length)return A(t,...e);const[i,...a]=s.map((t=>{const s=e.find((e=>e.name===t));if(!s)throw new Error(`unknown comparative '${t}'`);return s}));return A(t,i,...a)},O=t=>!0===e.get(t,"meta.auth",!0);const N=(t,...s)=>e.merge({},{name:t},...s.map((e=>({...e.params&&{params:e.params},...e.query&&{query:e.query}})))),U=(e,t={})=>N(e,t),z=U("files-common-favorites"),B=U("files-common-search"),G=M(z,B),q=e=>[{path:"/search",component:e.App,children:[{name:B.name,path:"list/:page?",component:e.SearchResults,meta:{title:"Search results",contextQueryItems:["term","provider"]}}]},{path:"/favorites",component:e.App,children:[{name:z.name,path:"",component:e.Favorites,meta:{title:"Favorite files"}}]}],V=(e,t={})=>N(e,{params:{..."files-spaces-personal-home"===e&&{storage:"home"}}},t),j=V("files-spaces-project"),H=V("files-spaces-projects"),W=V("files-spaces-personal-home"),Q=M(j,H,W),Y=e=>[{path:"/spaces",component:e.App,children:[{path:"projects",name:H.name,component:e.Spaces.Projects,meta:{title:"Spaces"}},{path:"projects/:storageId?/:item*",name:j.name,component:e.Spaces.Project,meta:{patchCleanPath:!0,title:"Space"}},{path:"personal/:storage/:item*",name:W.name,component:e.Personal,meta:{title:"Personal",patchCleanPath:!0}}]}],J=(e,t={})=>N(e,t),K=J("files-shares-with-me"),Z=J("files-shares-with-others"),X=J("files-shares-via-link"),ee=M(K,Z,X),te=e=>[{path:"/shares",component:e.App,redirect:K,children:[{name:K.name,path:"with-me",component:e.SharedWithMe,meta:{title:"Files shared with me"}},{name:Z.name,path:"with-others",component:e.SharedWithOthers,meta:{title:"Files shared with others"}},{name:X.name,path:"via-link",component:e.SharedViaLink,meta:{title:"Files shared via link"}}]}],se=(e,t={})=>N(e,t),ie=se("files-operations-location-picker"),ae=se("files-operations-resolver-public-link"),re=se("files-operations-resolver-private-link"),oe=e=>[{name:ie.name,path:"/ops/location-picker/:context/:action/:item*",component:e.LocationPicker,meta:{verbose:!0,auth:!1,patchCleanPath:!0}},{name:ae.name,path:"/ops/resolver/public-link/:token",component:e.PublicLink,meta:{auth:!1,title:"Resolving public link"}},{name:re.name,path:"/ops/resolver/private-link/:fileId",component:e.PrivateLink,meta:{title:"Resolving private link"}}],ne=(e,t={})=>N(e,t),le=ne("files-public-files"),ce=ne("files-public-drop"),de=M(le,ce),ue=e=>[{path:"/public",component:e.App,meta:{auth:!1},children:[{name:le.name,path:"show/:item*",component:e.PublicFiles,meta:{auth:!1,title:"Public files",patchCleanPath:!0}}]},{name:ce.name,path:"/public/drop/:token",component:e.FilesDrop,meta:{auth:!1,title:"Public file upload"}}],he=(e,t={})=>N(e,t),pe=he("files-trash-personal"),me=he("files-trash-spaces-project"),fe=M(pe,me),ge=e=>[{path:"/trash",redirect:e=>he("files-trash-personal",e),component:e.App,children:[{name:pe.name,path:"personal",component:e.Trashbin,meta:{title:"Deleted files"}},{name:me.name,path:"spaces/projects/:storageId?",component:e.Spaces.Trashbin,meta:{title:"Deleted files"}}]}],ve=e=>({meta:e.meta,path:e.path,redirect:t=>{const s=e.redirect(t);return console.warn(`route "${e.path}" is deprecated, use "${s.path||s.name}" instead.`),s}}),_e={path:"/",redirect:e=>V("files-spaces-personal-home",e)};var be={methods:{getResourceSize(t){if(t<0)return"";if(isNaN(t))return"?";return e.filesize_min(t,{round:t<1048576?0:1})}}};const Se={props:{text:{type:String,required:!1,default:""},value:{type:String,required:!0},label:{type:String,required:!0},successMsgTitle:{type:String,required:!0},successMsgText:{type:String,required:!0}},data:()=>({copied:!1,timeout:null}),methods:{...e.mapActions(["showMessage"]),copyValueToClipboard(){e.copyToClipboard(this.value),this.clipboardSuccessHandler(),this.showMessage({title:this.successMsgTitle,desc:this.successMsgText})},clipboardSuccessHandler(){this.copied=!0,clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.copied=!1}),550)}}};var xe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.label,expression:"label"}],attrs:{"aria-label":e.label,appearance:"raw"},on:{click:e.copyValueToClipboard}},[s("span",{domProps:{textContent:e._s(e.text)}}),e._v(" "),e.copied?s("oc-icon",{key:"oc-copy-to-clipboard-copied",staticClass:"_clipboard-success-animation",attrs:{name:"checkbox-circle"}}):s("oc-icon",{key:"oc-copy-to-clipboard-copy",attrs:{name:"clipboard"}})],1)};xe._withStripped=!0;const ye=e.normalizeComponent({render:xe,staticRenderFns:[]},undefined,Se,"data-v-ba6af4bc",false,undefined,!1,void 0,void 0,void 0);const we={name:"PrivateLinkItem",components:{CopyToClipboardButton:ye},inject:["displayedItem"],computed:{link(){return this.displayedItem.value.privateLink},copyToClipboardText(){return this.$gettext("Private link")},copyToClipboardLabel(){return this.$gettext("Copy private link to clipboard")},copyToClipboardSuccessMsgTitle(){return this.$gettext("Private link copied")},copyToClipboardSuccessMsgText(){return this.$gettext("The private link has been copied to your clipboard.")}}};var $e=function(){var e=this,t=e.$createElement;return(e._self._c||t)("copy-to-clipboard-button",{staticClass:"oc-files-private-link-copy-url",attrs:{value:e.link,label:e.copyToClipboardLabel,text:e.copyToClipboardText,"success-msg-title":e.copyToClipboardSuccessMsgTitle,"success-msg-text":e.copyToClipboardSuccessMsgText}})};$e._withStripped=!0;const Ce=e.normalizeComponent({render:$e,staticRenderFns:[]},undefined,we,undefined,false,undefined,!1,void 0,void 0,void 0);class Fe{static perPageDefault="100";static perPageQueryName="items-per-page"}function Ee(t){const s=function(t){if(t.perPage)return e.computed((()=>e.unref(t.perPage)));const s=c({name:Fe.perPageQueryName,defaultValue:Fe.perPageDefault});return e.computed((()=>parseInt(String(e.unref(s)))))}(t),i=e.ref(t.page),a=e.computed((()=>Math.ceil(e.unref(t.items).length/e.unref(s))||1));return{items:e.computed((()=>{if(!e.unref(s))return e.unref(t.items);const a=(e.unref(i)-1)*e.unref(s),r=a+e.unref(s);return e.unref(t.items).slice(a,r)})),total:a,perPage:s}}class Re{isEnabled(e){return G(e,"files-common-favorites")}getTask(i){const{store:a,clientService:{owncloudSdk:r}}=i;return e.q((function*(e,i){a.commit("Files/CLEAR_CURRENT_FILES_LIST");let o=yield r.files.getFavoriteFiles(s.DavProperties.Default);o=o.map(t.buildResource),a.commit("Files/LOAD_FILES",{currentFolder:null,files:o}),a.dispatch("Files/loadIndicators",{client:r,currentFolder:"/"})}))}}const Te=async(e,t,s)=>{try{return await e.files.list(t,1,s)}catch(e){console.error(e)}};class ke{isEnabled(e){return Q(e,"files-spaces-personal-home")}getTask(i){const{store:a,router:r,clientService:{owncloudSdk:o}}=i;return e.q((function*(e,i,n,l,c=null){try{a.commit("Files/CLEAR_CURRENT_FILES_LIST");let e=yield Te(n.$client,t.buildWebDavFilesPath(n.user.id,c||r.currentRoute.params.item||""),s.DavProperties.Default);e=e.map(t.buildResource);const i=e.shift();a.commit("Files/LOAD_FILES",{currentFolder:i,files:e}),a.dispatch("Files/loadIndicators",{client:o,currentFolder:i.path});const l=o.users.getUser(n.user.id);(async()=>{const e=await l;a.commit("SET_QUOTA",e.quota)})()}catch(e){a.commit("Files/SET_CURRENT_FOLDER",null),console.error(e)}n.refreshFileListHeaderPosition(),n.accessibleBreadcrumb_focusAndAnnounceBreadcrumb(l),n.scrollToResourceFromRoute()})).restartable()}}class Ie{isEnabled(e){return Q(e,"files-spaces-project")}getTask(i){const a=i.router,r=i.store;return e.q((function*(e,i,o,n,l=null){let c;if(o.CLEAR_CURRENT_FILES_LIST(),n)c=o.space;else{const e=s.clientService.graphAuthenticated(r.getters.configuration.server,r.getters.getToken),i=a.currentRoute.params.storageId,o=yield e.drives.getDrive(i);if(!o.data)return;c=t.buildSpace(o.data)}const d=yield o.$client.files.list(t.buildWebDavSpacesPath(o.$route.params.storageId,l||""),1,s.DavProperties.Default);let u=[];if(l)u=d.map(t.buildResource);else{u.push(c);const e=d.map(t.buildResource);e.shift(),u=u.concat(e)}const h=u.shift();o.LOAD_FILES({currentFolder:h,files:u}),o.loadIndicators({client:o.$client,currentFolder:h?.path,storageId:c.id}),n||(o.space=c)}))}}class De{isEnabled(e){return de(e,"files-public-files")}getTask(i){const{store:a,router:r,clientService:{owncloudSdk:o}}=i;return e.q((function*(e,i,n,l,c=null){a.commit("Files/CLEAR_CURRENT_FILES_LIST");const d=a.getters["Files/publicLinkPassword"];try{let e=yield o.publicFiles.list(c||r.currentRoute.params.item,d,s.DavProperties.PublicLink);const i=parseInt(e[0].getProperty(s.DavProperty.PublicLinkPermission));if(s.linkRoleUploaderFolder.bitmask(!1)===i)return void r.replace(ne("files-public-drop",{params:{token:r.currentRoute.params.item}}));e=e.map(t.buildResource),a.commit("Files/LOAD_FILES",{currentFolder:e[0],files:e.slice(1)}),n.refreshFileListHeaderPosition()}catch(e){if(a.commit("Files/SET_CURRENT_FOLDER",null),console.error(e),401===e.statusCode)return void Pe(r)}yield Le(r,a),n.accessibleBreadcrumb_focusAndAnnounceBreadcrumb(l)}))}}const Pe=e=>{e.push(se("files-operations-resolver-public-link",{params:{token:e.currentRoute.params.item}}))},Le=async(t,s)=>{if(s.getters.userReady)return;const i=(t.currentRoute.params.item||"").split("/")[0],a=s.getters["Files/publicLinkPassword"];await s.dispatch("loadCapabilities",{publicToken:i,...a&&{user:"public",password:a}}),a&&s.commit("SET_CAPABILITIES",{capabilities:e.omit(s.getters.capabilities,["files.archivers"]),version:s.getters.version}),s.commit("SET_USER_READY",!0)};class Ae{isEnabled(e){return ee(e,"files-shares-via-link")}getTask(s){const{store:i,clientService:{owncloudSdk:a}}=s,r=D(i);return e.q((function*(s,o){i.commit("Files/CLEAR_CURRENT_FILES_LIST");let n=yield a.requests.ocs({service:"apps/files_sharing",action:"/api/v1/shares?format=json&share_types=3&include_tags=false",method:"GET"});if(n=yield n.json(),n=n.ocs.data,n.length){const s=i.getters.configuration;i.getters.getToken,n=t.aggregateResourceShares(n,!1,e.unref(r),s.server)}i.commit("Files/LOAD_FILES",{currentFolder:null,files:n})}))}}class Me{isEnabled(e){return ee(e,"files-shares-with-me")}getTask(s){const{store:i,clientService:{owncloudSdk:a}}=s,r=D(i);return e.q((function*(s,o){i.commit("Files/CLEAR_CURRENT_FILES_LIST");let n=yield a.requests.ocs({service:"apps/files_sharing",action:"/api/v1/shares?format=json&shared_with_me=true&state=all&include_tags=false",method:"GET"});if(n=yield n.json(),n=n.ocs.data,n.length){const s=i.getters.configuration;i.getters.getToken,n=t.aggregateResourceShares(n,!0,e.unref(r),s.server)}i.commit("Files/LOAD_FILES",{currentFolder:null,files:n})}))}}class Oe{isEnabled(e){return ee(e,"files-shares-with-others")}getTask(i){const{store:a,clientService:{owncloudSdk:r}}=i,o=D(a);return e.q((function*(i,n){a.commit("Files/CLEAR_CURRENT_FILES_LIST");const l=s.ShareTypes.authenticated.filter((e=>e.value!==s.ShareTypes.space.value)).map((e=>e.value)).join(",");let c=yield r.requests.ocs({service:"apps/files_sharing",action:`/api/v1/shares?format=json&reshares=true&include_tags=false&share_types=${l}`,method:"GET"});if(c=yield c.json(),c=c.ocs.data,c.length){const s=a.getters.configuration;a.getters.getToken,c=t.aggregateResourceShares(c,!1,e.unref(o),s.server)}a.commit("Files/LOAD_FILES",{currentFolder:null,files:c})}))}}class Ne{isEnabled(e){return fe(e,"files-trash-personal")||fe(e,"files-trash-spaces-project")}getTask(i){const{store:a,clientService:{owncloudSdk:r},router:o}=i;return e.q((function*(e,i,n){a.commit("Files/CLEAR_CURRENT_FILES_LIST");const l=fe(o,"files-trash-spaces-project")?t.buildWebDavSpacesTrashPath(o.currentRoute.params.storageId):t.buildWebDavFilesTrashPath(a.getters.user.id),c=yield r.fileTrash.list(l,"1",s.DavProperties.Trashbin);a.commit("Files/LOAD_FILES",{currentFolder:t.buildResource(c[0]),files:c.slice(1).map(t.buildDeletedResource)}),n.refreshFileListHeaderPosition()}))}}const Ue=new class{loaders;constructor(){this.loaders=[new Re,new ke,new Ie,new De,new Ae,new Me,new Oe,new Ne]}getTask(){const t=s.useStore(),a=i.useRouter(),r=e.getCurrentInstance().proxy.$clientService,o=this.loaders;return e.q((function*(...s){const i=o.find((t=>t.isEnabled(e.unref(a))));if(!i)throw new Error("No folder loader found for route");const n={clientService:r,store:t,router:a};yield i.getTask(n).perform(...s)}))}};class ze{static sortByQueryName="sort-by";static sortDirQueryName="sort-dir"}var Be;function Ge(t){const s=function(t){if(t.sortBy)return e.isRef(t.sortBy)?t.sortBy:e.ref(t.sortBy);return c({name:e.unref(t.sortByQueryName)||ze.sortByQueryName,defaultValue:e.unref(qe(e.unref(t.fields))?.name),routeName:e.unref(t.routeName||n())})}(t),i=function(t){if(t.sortDir)return e.isRef(t.sortDir)?t.sortDir:e.ref(t.sortDir);return c({name:e.unref(t.sortDirQueryName)||ze.sortDirQueryName,defaultValue:e.unref(qe(e.unref(t.fields))?.sortDir),routeName:e.unref(t.routeName||n())})}(t),a=e.computed((()=>We(e.unref(s))||e.unref(qe(e.unref(o))?.name))),r=e.computed((()=>Qe(e.unref(i))||Ve(e.unref(a),e.unref(o)))),o=t.fields;return{items:e.computed((()=>{const s=e.unref(t.items);return e.unref(a)?je(s,e.unref(o),e.unref(a),e.unref(r)):s})),sortBy:a,sortDir:r,handleSort:({sortBy:e,sortDir:t})=>{s.value=e,i.value=t}}}!function(e){e.Desc="desc",e.Asc="asc"}(Be||(Be={}));const qe=e=>{const t=e.filter((e=>e.sortable));return t?t[0]:null},Ve=(t,s)=>{const i=s.find((e=>e.name===t));return i&&i.sortDir?e.unref(i.sortDir):Be.Desc},je=(e,t,s,i)=>{const a=t.find((e=>e.name===s));if(!a)return e;const{sortable:r}=a,o=new Intl.Collator(navigator.language,{sensitivity:"base",numeric:!0});if("name"===s){const t=[...e.filter((e=>"folder"===e.type))].sort(((e,t)=>He(e,t,o,s,i,r))),a=[...e.filter((e=>"folder"!==e.type))].sort(((e,t)=>He(e,t,o,s,i,r)));return i===Be.Asc?t.concat(a):a.concat(t)}return[...e].sort(((e,t)=>He(e,t,o,s,i,r)))},He=(e,t,s,i,a,r)=>{let o=e[i],n=t[i];const l=a===Be.Asc?1:-1;if(r)if("string"==typeof r){const e=e=>e.map((e=>e[r])).join("");o=e(o),n=e(n)}else"function"==typeof r&&(o=r(o),n=r(n));if(!isNaN(o)&&!isNaN(n))return(o-n)*l;return s.compare((o||"").toString(),(n||"").toString())*l},We=e=>Array.isArray(e)?e[0]:e,Qe=e=>{switch(We(e)){case Be.Asc:return Be.Asc;case Be.Desc:return Be.Desc}return null},Ye=t=>e.DateTime_1.fromRFC2822(t).toUTC().valueOf(),Je=e=>e?[{name:"name",sortable:!0,sortDir:Be.Asc},{name:"size",sortable:!0,sortDir:Be.Desc},{name:"sharedWith",sortable:e=>e.length>0&&e[0].displayName,sortDir:Be.Asc},{name:"owner",sortable:"displayName",sortDir:Be.Asc},{name:"mdate",sortable:e=>Ye(e),sortDir:Be.Desc},{name:"sdate",sortable:e=>Ye(e),sortDir:Be.Desc},{name:"ddate",sortable:e=>Ye(e),sortDir:Be.Desc}].filter((t=>Object.prototype.hasOwnProperty.call(e,t.name))):[],Ke=(t={})=>{const i=t.loadResourcesTask||Ue.getTask(),a=s.useStore(),{refresh:r,y:o}=(()=>{const t=s.useStore(),i=e.ref(0),a=async()=>{await e.nextTick();const t=document.querySelector("#files-app-bar"),s=t?t.getBoundingClientRect().height:0;i.value!==s&&(i.value=s)};return window.onresize=a,e.onMounted(a),e.watch((()=>t.getters["Files/inProgress"].length>0),a),{y:i,refresh:a}})(),n=e.computed((()=>a.getters["Files/activeFiles"]||[])),c=e.computed((()=>Je(e.unref(n)[0]))),{sortBy:d,sortDir:u,items:h,handleSort:p}=Ge({items:n,fields:c}),m=l("page","1"),f=e.computed((()=>parseInt(String(m.value)))),{items:g,total:v}=Ee({page:f,items:h});((t,i,a)=>{let r;e.onMounted((()=>{r=s.useStore().subscribe((e=>t.includes(e.type)&&i(e)),a)})),e.onBeforeUnmount((()=>r()))})(["Files/UPSERT_RESOURCE"],(async({payload:t})=>{await e.nextTick(),((e,t=3500)=>{const s=document.querySelectorAll(`[data-item-id='${e}']`)[0];s&&(s.classList.add("oc-table-accentuated"),setTimeout((()=>{s.classList.remove("oc-table-accentuated")}),t))})(t.id)}));const _=e.computed({get:()=>a.getters["Files/selectedFiles"],set(e){a.commit("Files/SET_FILE_SELECTION",e)}});return{fileListHeaderY:o,refreshFileListHeaderPosition:r,loadResourcesTask:i,storeItems:n,fields:c,paginatedResources:g,paginationPages:v,paginationPage:f,handleSort:p,sortBy:d,sortDir:u,selectedResources:_,isResourceInSelection:t=>e.unref(_).includes(t)}},Ze=(t,...s)=>{const a=e.ref(!1),r=i.useRouter(),o=i.useRoute();return e.watch(o,(()=>{a.value=t(r,...s)}),{immediate:!0}),a};const Xe={name:"FileInfo",components:{PrivateLinkItem:Ce},mixins:[L,be],inject:["displayedItem"],props:{isContentDisplayed:{type:Boolean,default:!1}},setup:()=>({isPersonalLocation:Ze(Q,"files-spaces-personal-home")}),computed:{...e.mapGetters(["capabilities","user"]),timeData(){const e=e=>(e.time=this.formDateFromRFC(e.sourceTime),e.timeRelative=this.formRelativeDateFromRFC(e.sourceTime),e.infoString=this.$gettextInterpolate(e.infoString,e),e.ariaLabel=this.$gettextInterpolate(e.ariaLabel,e),e);return fe(this.$router,"files-trash-personal")||fe(this.$router,"files-trash-spaces-project")?e({sourceTime:this.file.ddate,infoString:this.$pgettext("inline info about deletion date","deleted %{timeRelative}"),ariaLabel:this.$pgettext("aria label for inline info about deletion date","deleted %{timeRelative} (%{time})")}):e({sourceTime:this.file.mdate,infoString:this.$pgettext("inline info about last modification date","modified %{timeRelative}"),ariaLabel:this.$pgettext("aria label for inline info about last modification date","modified %{timeRelative} (%{time})")})},privateLinkEnabled(){return this.isPersonalLocation&&this.capabilities.files.privateLinks&&this.user?.id&&this.displayedItem?.owner?.username===this.user.username},file(){return this.displayedItem.value}}};var et=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"file_info"},[s("oc-resource-icon",{staticClass:"file_info__icon",attrs:{resource:e.file,size:"large"}}),e._v(" "),s("div",{staticClass:"file_info__body oc-text-overflow"},[s("h3",{attrs:{"data-testid":"files-info-name"}},[s("oc-resource-name",{attrs:{name:e.file.name,extension:e.file.extension,type:e.file.type,"full-path":e.file.webDavPath,"is-path-displayed":!1}})],1),e._v(" "),s("p",{staticClass:"oc-my-rm"},[e.file.size>-1?[e._v(e._s(e.getResourceSize(e.file.size))+",")]:e._e(),e._v(" "),s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.timeData.time,expression:"timeData.time"}],attrs:{"data-testid":"files-info-mdate",tabindex:"0","aria-label":e.timeData.ariaLabel}},[e._v(e._s(e.timeData.infoString))])],2)]),e._v(" "),e.privateLinkEnabled?s("private-link-item"):e._e()],1)};et._withStripped=!0;const tt=e.normalizeComponent({render:et,staticRenderFns:[]},undefined,Xe,undefined,false,undefined,!1,void 0,void 0,void 0);const st={name:"SpaceInfo",mixins:[L],inject:["displayedItem"],computed:{space(){return this.displayedItem.value}}};var it=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"space_info"},[s("div",{staticClass:"space_info__body oc-text-overflow oc-flex oc-flex-middle"},[s("div",{staticClass:"oc-mr-s"},[s("oc-icon",{staticClass:"oc-display-block",attrs:{name:"layout-grid",size:e.space.description?"large":"medium"}})],1),e._v(" "),s("div",[s("h3",{attrs:{"data-testid":"space-info-name"},domProps:{textContent:e._s(e.space.name)}}),e._v(" "),s("span",{attrs:{"data-testid":"space-info-subtitle"},domProps:{textContent:e._s(e.space.description)}})])])])};it._withStripped=!0;const at=e.normalizeComponent({render:it,staticRenderFns:[]},undefined,st,undefined,false,undefined,!1,void 0,void 0,void 0);const rt=e.defineComponent({components:{FileInfo:tt,SpaceInfo:at,SideBar:e.__vue_component__},provide(){return{displayedItem:e.computed((()=>this.selectedFile))}},data:()=>({focused:void 0,oldPanelName:null,selectedFile:{},loading:!1}),computed:{...e.mapGetters("Files",["highlightedFile","selectedFiles","publicLinkPassword"]),...e.mapGetters(["fileSideBars","capabilities"]),...e.mapState("Files/sidebar",{sidebarActivePanel:"activePanel"}),...e.mapState(["user"]),availablePanels(){const{panels:e}=this.fileSideBars.reduce(((e,t)=>{const s=t({capabilities:this.capabilities,highlightedFile:this.highlightedFile,route:this.$route,router:this.$router,multipleSelection:this.areMultipleSelected,rootFolder:this.isRootFolder,user:this.user});return s.enabled&&e.panels.push(s),e}),{panels:[]});return e},isShareAccepted(){return 0===this.highlightedFile?.status},isContentDisplayed(){return!ee(this.$router,"files-shares-with-me")||this.isShareAccepted},sidebarAccordionsWarningMessage(){return this.isShareAccepted?null:this.$gettext("Please, accept this share first to display available actions")},isSingleResource(){return!this.areMultipleSelected&&(!this.isRootFolder||this.highlightedFileIsSpace)},areMultipleSelected(){return this.selectedFiles&&this.selectedFiles.length>1},isRootFolder(){const e=this.highlightedFile?.path?.split("/").filter(Boolean)||[];return de(this.$router,"files-public-files")?1===e.length:!e.length},highlightedFileThumbnail(){return this.highlightedFile?.thumbnail},highlightedFileFavorite(){return this.highlightedFile?.starred},highlightedFileIsSpace(){return"space"===this.highlightedFile?.type}},watch:{highlightedFile(e,t){this.isSingleResource&&this.fetchFileInfo()},highlightedFileThumbnail(e){this.$set(this.selectedFile,"thumbnail",e)},highlightedFileFavorite(e){this.$set(this.selectedFile,"starred",e)}},async created(){this.areMultipleSelected||await this.fetchFileInfo()},methods:{async fetchFileInfo(){if(this.highlightedFile)if(fe(this.$router,"files-trash-personal")||fe(this.$router,"files-trash-spaces-project")||this.highlightedFileIsSpace)this.selectedFile=this.highlightedFile;else{this.loading=!0;try{let e;e=de(this.$router,"files-public-files")?await this.$client.publicFiles.getFileInfo(this.highlightedFile.webDavPath,this.publicLinkPassword,s.DavProperties.PublicLink):await this.$client.files.fileInfo(this.highlightedFile.webDavPath,s.DavProperties.Default),this.selectedFile=t.buildResource(e),this.$set(this.selectedFile,"thumbnail",this.highlightedFile.thumbnail||null)}catch(e){this.selectedFile=this.highlightedFile,console.error(e)}this.loading=!1}else this.selectedFile=this.highlightedFile}}});var ot=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("SideBar",e._g(e._b({ref:"sidebar",attrs:{"available-panels":e.availablePanels,"sidebar-accordions-warning-message":e.sidebarAccordionsWarningMessage,"is-content-displayed":e.isContentDisplayed,loading:e.loading,"is-header-compact":e.isSingleResource},scopedSlots:e._u([{key:"header",fn:function(){return[e.isSingleResource&&!e.highlightedFileIsSpace?s("file-info",{staticClass:"sidebar-panel__file_info",attrs:{"is-content-displayed":e.isContentDisplayed}}):e._e(),e._v(" "),e.highlightedFileIsSpace?s("space-info",{staticClass:"sidebar-panel__space_info"}):e._e()]},proxy:!0}])},"SideBar",e.$attrs,!1),e.$listeners))};ot._withStripped=!0;const nt=e.normalizeComponent({render:ot,staticRenderFns:[]},undefined,rt,undefined,false,undefined,!1,void 0,void 0,void 0);const lt=e.defineComponent({components:{SideBar:nt},mixins:[L],computed:{...e.mapGetters("Files",["dropzone"]),...e.mapState("Files/sidebar",{sidebarClosed:"closed",sidebarActivePanel:"activePanel"}),showSidebar(){return!this.sidebarClosed}},watch:{$route:{handler:function(e,t){this.resetFileSelection(),t?.name!==e.name&&this.closeSidebar()}}},created(){this.$root.$on("upload-end",(()=>{this.delayForScreenreader((()=>this.$refs.filesListWrapper.focus()))}))},methods:{...e.mapActions("Files",["dragOver","resetFileSelection"]),...e.mapActions("Files/sidebar",{closeSidebar:"close",setActiveSidebarPanel:"setActivePanel"}),...e.mapActions(["showMessage"]),focusSideBar(e,t){this.focus({from:document.activeElement,to:this.$refs.filesSidebar?.$el,revert:"beforeDestroy"===t})},$_ocApp_dragOver(e){const t=(e.dataTransfer.types||[]).some((e=>"Files"===e));this.dragOver(t)}}});var ct=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"oc-flex oc-height-1-1",attrs:{id:"files"}},[s("div",{ref:"filesListWrapper",staticClass:"files-list-wrapper oc-width-expand",attrs:{tabindex:"-1"},on:{dragover:e.$_ocApp_dragOver}},[s("router-view",{attrs:{id:"files-view"}})],1),e._v(" "),e.showSidebar?s("side-bar",{ref:"filesSidebar",staticClass:"oc-width-1-1 oc-width-1-3@m oc-width-1-4@xl",attrs:{id:"files-sidebar",tabindex:"-1","sidebar-active-panel":e.sidebarActivePanel},on:{beforeDestroy:e.focusSideBar,mounted:e.focusSideBar,fileChanged:e.focusSideBar,selectPanel:e.setActiveSidebarPanel,close:e.closeSidebar}}):e._e()],1)};ct._withStripped=!0;const dt=e.normalizeComponent({render:ct,staticRenderFns:[]},undefined,lt,"data-v-33e67be4",false,undefined,!1,void 0,void 0,void 0);class ut{static Thumbnail=[36,36];static Preview=[1200,1200];static Avatar=64}class ht{static Thumbnail="thumbnail";static Preview="preview";static Avatar="avatar"}var pt={computed:{...e.mapGetters("Files",["files","currentFolder"]),...e.mapGetters(["capabilities"]),$_rename_items(){return[{name:"rename",icon:"pencil",label:()=>this.$gettext("Rename"),handler:this.$_rename_trigger,isEnabled:({resources:e})=>{if(fe(this.$router,"files-trash-personal")||fe(this.$router,"files-trash-spaces-project"))return!1;if(ee(this.$router,"files-shares-with-me")&&!1===this.capabilities?.files_sharing?.can_rename)return!1;if(1!==e.length)return!1;return!e.some((e=>!e.canRename()))},componentType:"oc-button",class:"oc-files-actions-rename-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapActions("Files",["renameFile"]),async $_rename_trigger({resources:e}){let s;if(k(e[0],this.currentFolder)){const i=e[0].webDavPath.slice(0,-e[0].path.length),a=u(e[0].path,!1).map((e=>i+e));s=await this.$client.files.list(a[0],1),s=s.map(t.buildResource)}const i=this.$gettextInterpolate(e[0].isFolder?this.$gettext("Rename folder %{name}"):this.$gettext("Rename file %{name}"),{name:e[0].name}),a=t.extractNameWithoutExtension(e[0]),r={variation:"passive",title:i,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Rename"),hasInput:!0,inputValue:e[0].name,inputSelectionRange:e[0].isFolder?null:[0,a.length],inputLabel:e[0].isFolder?this.$gettext("Folder name"):this.$gettext("File name"),onCancel:this.hideModal,onConfirm:t=>{this.$_rename_renameResource(e[0],t)},onInput:t=>{this.$_rename_checkNewName(e[0].name,t,s)}};this.createModal(r)},$_rename_checkNewName(e,t,s){if(!t)return this.setModalInputErrorMessage(this.$gettext("The name cannot be empty"));if(/[/]/.test(t))return this.setModalInputErrorMessage(this.$gettext('The name cannot contain "/"'));if("."===t)return this.setModalInputErrorMessage(this.$gettext('The name cannot be equal to "."'));if(".."===t)return this.setModalInputErrorMessage(this.$gettext('The name cannot be equal to ".."'));if(/\s+$/.test(t))return this.setModalInputErrorMessage(this.$gettext("The name cannot end with whitespace"));if(!this.flatFileList){if(this.files.find((s=>s.name===t&&e!==t))){const e=this.$gettext('The name "%{name}" is already taken');return this.setModalInputErrorMessage(this.$gettextInterpolate(e,{name:t},!0))}}if(s){if(s.find((s=>s.name===t&&e!==t))){const e=this.$gettext('The name "%{name}" is already taken');return this.setModalInputErrorMessage(this.$gettextInterpolate(e,{name:t},!0))}}this.setModalInputErrorMessage(null)},$_rename_renameResource(e,t){this.toggleModalConfirmButton();const s=k(e,this.currentFolder);this.renameFile({client:this.$client,file:e,newValue:t,publicPage:this.publicPage(),isSameResource:s}).then((()=>{if(this.hideModal(),s){const s=e.path.substr(1,e.path.lastIndexOf("/"));this.$router.push({params:{item:"/"+s+t||"/"}})}})).catch((s=>{this.toggleModalConfirmButton();let i=this.$gettext('Failed to rename "%{file}" to "%{newName}"');423===s.statusCode&&(i=this.$gettext('Failed to rename "%{file}" to "%{newName}" - the file is locked'));const a=this.$gettextInterpolate(i,{file:e.name,newName:t},!0);this.showMessage({title:a,status:"danger"})}))}}};const mt=e.defineComponent({mixins:[pt],model:{prop:"selection",event:"select"},props:{resources:{type:Array,required:!0},resourceDomSelector:{type:Function,required:!1,default:e=>e.id.replace(/[^A-Za-z0-9\-_]/g,"")},arePathsDisplayed:{type:Boolean,required:!1,default:!1},areThumbnailsDisplayed:{type:Boolean,required:!1,default:!0},selection:{type:Array,default:()=>[]},hasActions:{type:Boolean,required:!1,default:!0},targetRoute:{type:Object,required:!1,default:null},areResourcesClickable:{type:Boolean,required:!1,default:!0},headerPosition:{type:Number,required:!1,default:0},isSelectable:{type:Boolean,required:!1,default:!0},disabled:{type:[String,Array],required:!1,default:null},paddingX:{type:String,required:!1,default:"small",validator:e=>/(xsmall|small|medium|large|xlarge)/.test(e)},dragDrop:{type:Boolean,required:!1,default:!1},hover:{type:Boolean,required:!1,default:!0},sortBy:{type:String,required:!1,default:void 0},fieldsDisplayed:{type:Array,required:!1,default:null},sortDir:{type:String,required:!1,default:void 0,validator:e=>void 0===e||[Be.Asc.toString(),Be.Desc.toString()].includes(e)}},setup:()=>({hasSpaces:P()}),data:()=>({constants:{EVENT_TROW_MOUNTED:"rowMounted"}}),computed:{...e.mapGetters(["configuration"]),popperOptions:()=>({modifiers:[e.maxSize,{name:"applyMaxSize",enabled:!0,phase:"beforeWrite",requires:["maxSize"],fn({state:e}){const{height:t}=e.modifiersData.maxSize;e.styles.popper.overflowY="auto",e.styles.popper.maxHeight=t-5+"px"}}]}),fields(){if(0===this.resources.length)return[];const e=this.resources[0],t=[];this.isSelectable&&t.push({name:"select",title:"",type:"slot",headerType:"slot",width:"shrink"});const s=Je(e);return t.push(...[{name:"name",title:this.$gettext("Name"),type:"slot",width:"expand",wrap:"truncate"},{name:"indicators",title:this.$gettext("Shares"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"size",title:this.$gettext("Size"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"status",title:this.$gettext("Status"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"owner",title:this.$gettext("Share owner"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"sharedWith",title:this.$gettext("Shared with"),type:"slot",alignH:"right",wrap:"nowrap"},{name:"mdate",title:this.$gettext("Modified"),type:"slot",alignH:"right",wrap:"nowrap",accessibleLabelCallback:e=>this.formatDateRelative(e.mdate)+" ("+this.formatDate(e.mdate)+")"},{name:"sdate",title:this.$gettext("Shared on"),type:"slot",alignH:"right",wrap:"nowrap",accessibleLabelCallback:e=>this.formatDateRelative(e.sdate)+" ("+this.formatDate(e.sdate)+")"},{name:"ddate",title:this.$gettext("Deleted"),type:"slot",alignH:"right",wrap:"nowrap",accessibleLabelCallback:e=>this.formatDateRelative(e.ddate)+" ("+this.formatDate(e.ddate)+")"}].filter((t=>{const s=Object.prototype.hasOwnProperty.call(e,t.name);return this.fieldsDisplayed?s&&this.fieldsDisplayed.includes(t.name):s})).map((e=>{const t=s.find((t=>t.name===e.name));return t&&Object.assign(e,{sortable:t.sortable,sortDir:t.sortDir}),e}))),this.hasActions&&t.push({name:"actions",title:this.$gettext("Actions"),type:"slot",alignH:"right",wrap:"nowrap"}),this.configuration?.options?.displayResourcesLazy&&t.forEach((e=>Object.assign(e,{lazy:{delay:250}}))),t},areAllResourcesSelected(){return this.selection.length===this.resources.length},selectedIds(){return this.selection.map((e=>e.id))},allResourcesCheckboxLabel(){return this.$gettext("Select all resources")},contextMenuLabel(){return this.$gettext("Show context menu")},currentLanguage(){return(this.$language?.current||"").split("_")[0]},defaultParentFolderName(){return this.hasSpaces?this.$gettext("Personal"):this.$gettext("All files and folders")}},methods:{...e.mapActions("Files/sidebar",["openWithPanel"]),hasRenameAction(e){return this.$_rename_items.filter((t=>t.isEnabled({resources:[e]}))).length},openRenameDialog(e){this.$_rename_trigger({resources:[e]})},openSharingSidebar(e){e.share?.shareType!==s.ShareTypes.link.value?this.openWithPanel("sharing-item"):this.openWithPanel("links-item")},folderLink(e){return this.createFolderLink(e.path,e.storageId)},parentFolderLink(t){return this.createFolderLink(e.dirname(t.path),t.storageId)},createFolderLink(e,t){return null===this.targetRoute?{}:{name:this.targetRoute.name,query:this.targetRoute.query,params:{item:e.replace(/^\//,""),...this.targetRoute.params,...t&&{storageId:t}}}},fileDragged(e){this.addSelectedResource(e)},fileDropped(e){this.$emit("fileDropped",e)},sort(e){this.$emit("sort",e)},addSelectedResource(e){this.selection.some((t=>t.id===e.id))?this.$emit("select",this.selection):this.$emit("select",this.selection.concat([e]))},resetDropPosition(e,t,s){const i=this.$refs[e].tippy;void 0!==i&&(this.selection.includes(s)||this.emitSelect([s]),this.displayPositionedDropdown(i,t))},showContextMenu(e,t,s){t.preventDefault();const i=e.$el.getElementsByClassName("resource-table-btn-action-dropdown")[0];void 0!==i&&(this.selection.includes(s)||this.emitSelect([s]),this.displayPositionedDropdown(i._tippy,t))},displayPositionedDropdown(e,t){e.setProps({getReferenceClientRect:()=>({width:0,height:0,top:t.clientY,bottom:t.clientY,left:t.clientX,right:t.clientX})}),e.show()},rowMounted(e,t){this.$emit("rowMounted",e,t)},fileClicked(e){this.emitSelect([e])},formatDate(t){return e.DateTime_1.fromJSDate(new Date(t)).setLocale(this.currentLanguage).toLocaleString(e.DateTime_1.DATETIME_FULL)},formatDateRelative(t){return e.DateTime_1.fromJSDate(new Date(t)).setLocale(this.currentLanguage).toRelative()},emitSelect(e){this.$emit("select",e)},toggleSelectionAll(){if(this.areAllResourcesSelected)return this.emitSelect([]);this.emitSelect(this.resources)},emitFileClick(e){this.$emit("fileClick",e)},isResourceClickable(e){return!!this.areResourcesClickable&&(Array.isArray(this.disabled)?!this.disabled.includes(e):this.disabled!==e)},getResourceCheckboxLabel(e){return"folder"===e.type?this.$gettext("Select folder"):this.$gettext("Select file")},getSharedWithAvatarDescription(e){const t="folder"===e.type?this.$gettext("folder"):this.$gettext("file"),s=e.sharedWith.filter((e=>!e.link)).length,i=e.sharedWith.filter((e=>!!e.link)).length,a=[s>0?this.$ngettext("This %{ resourceType } is shared via %{ shareCount } invite","This %{ resourceType } is shared via %{ shareCount } invites",s):"",i>0?this.$ngettext("This %{ resourceType } is shared via %{ linkCount } link","This %{ resourceType } is shared via %{ linkCount } links",i):""].join(" ");return this.$gettextInterpolate(a,{resourceType:t,shareCount:s,linkCount:i})},getOwnerAvatarDescription(e){const t=this.$gettext("This %{ resourceType } is owned by %{ ownerName }"),s="folder"===e.type?this.$gettext("folder"):this.$gettext("file");return this.$gettextInterpolate(t,{resourceType:s,ownerName:e.owner[0].displayName})}}});var ft=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-table",{attrs:{data:e.resources,fields:e.fields,highlighted:e.selectedIds,disabled:e.disabled,sticky:!0,"header-position":e.headerPosition,"drag-drop":e.dragDrop,hover:e.hover,"item-dom-selector":e.resourceDomSelector,selection:e.selection,"sort-by":e.sortBy,"sort-dir":e.sortDir,"padding-x":"medium"},on:{highlight:e.fileClicked,rowMounted:e.rowMounted,contextmenuClicked:e.showContextMenu,itemDropped:e.fileDropped,itemDragged:e.fileDragged,sort:e.sort},scopedSlots:e._u([{key:"selectHeader",fn:function(){return[s("div",{staticClass:"resource-table-select-all"},[s("oc-checkbox",{attrs:{id:"resource-table-select-all",size:"large",label:e.allResourcesCheckboxLabel,"hide-label":!0,value:e.areAllResourcesSelected},on:{input:e.toggleSelectionAll}})],1)]},proxy:!0},{key:"select",fn:function(t){var i=t.item;return[s("oc-checkbox",{attrs:{id:"resource-table-select-"+e.resourceDomSelector(i),label:e.getResourceCheckboxLabel(i),"hide-label":!0,size:"large",value:e.selection,option:i},on:{input:e.emitSelect},nativeOn:{click:function(e){e.stopPropagation()}}})]}},{key:"name",fn:function(t){var i=t.item;return[s("div",{staticClass:"resource-table-resource-wrapper"},[s("oc-resource",{key:i.path+"-"+e.resourceDomSelector(i)+"-"+i.thumbnail,attrs:{resource:i,"is-path-displayed":e.arePathsDisplayed,"parent-folder-name-default":e.defaultParentFolderName,"is-thumbnail-displayed":e.areThumbnailsDisplayed,"is-resource-clickable":e.isResourceClickable(i.id),"folder-link":e.folderLink(i),"parent-folder-link":e.parentFolderLink(i)},on:{click:function(t){return e.emitFileClick(i)}}}),e._v(" "),e.hasRenameAction(i)?s("oc-button",{staticClass:"resource-table-edit-name",attrs:{appearance:"raw"},on:{click:function(t){return e.openRenameDialog(i)}}},[s("oc-icon",{attrs:{name:"edit-2","fill-type":"line",size:"small"}})],1):e._e()],1)]}},{key:"status",fn:function(t){var s=t.item;return[e._t("status",null,{resource:s})]}},{key:"size",fn:function(e){var t=e.item;return[s("oc-resource-size",{attrs:{size:t.size||Number.NaN}})]}},{key:"mdate",fn:function(t){var i=t.item;return[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.formatDate(i.mdate),expression:"formatDate(item.mdate)"}],attrs:{tabindex:"0"},domProps:{textContent:e._s(e.formatDateRelative(i.mdate))}})]}},{key:"indicators",fn:function(t){var i=t.item;return[i.indicators.length?s("oc-status-indicators",{attrs:{resource:i,indicators:i.indicators}}):e._e()]}},{key:"sdate",fn:function(t){var i=t.item;return[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.formatDate(i.sdate),expression:"formatDate(item.sdate)"}],attrs:{tabindex:"0"},domProps:{textContent:e._s(e.formatDateRelative(i.sdate))}})]}},{key:"ddate",fn:function(t){var i=t.item;return[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.formatDate(i.ddate),expression:"formatDate(item.ddate)"}],attrs:{tabindex:"0"},domProps:{textContent:e._s(e.formatDateRelative(i.ddate))}})]}},{key:"owner",fn:function(t){var i=t.item;return[s("oc-button",{attrs:{appearance:"raw",variation:"inverse"},on:{click:function(t){return e.openSharingSidebar(i)}}},[s("oc-avatars",{staticClass:"resource-table-people",attrs:{items:i.owner,"is-tooltip-displayed":!0,"accessible-description":e.getOwnerAvatarDescription(i)}})],1)]}},{key:"sharedWith",fn:function(t){var i=t.item;return[s("oc-button",{attrs:{appearance:"raw",variation:"inverse"},on:{click:function(t){return e.openSharingSidebar(i)}}},[s("oc-avatars",{staticClass:"resource-table-people",attrs:{items:i.sharedWith,stacked:!0,"max-displayed":3,"is-tooltip-displayed":!0,"accessible-description":e.getSharedWithAvatarDescription(i)}})],1)]}},{key:"actions",fn:function(t){var i=t.item;return[s("div",{staticClass:"resource-table-actions"},[e._t("quickActions",null,{resource:i}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.contextMenuLabel,expression:"contextMenuLabel"}],staticClass:"resource-table-btn-action-dropdown",attrs:{id:"context-menu-trigger-"+e.resourceDomSelector(i),"aria-label":e.contextMenuLabel,appearance:"raw"},on:{click:function(t){t.stopPropagation(),t.preventDefault(),e.resetDropPosition("context-menu-drop-ref-"+e.resourceDomSelector(i),t,i)}}},[s("oc-icon",{attrs:{name:"more-2"}})],1),e._v(" "),s("oc-drop",{ref:"context-menu-drop-ref-"+e.resourceDomSelector(i),attrs:{"drop-id":"context-menu-drop-"+e.resourceDomSelector(i),toggle:"#context-menu-trigger-"+e.resourceDomSelector(i),"popper-options":e.popperOptions,mode:"click","close-on-click":"","padding-size":"small"},nativeOn:{click:function(e){e.stopPropagation(),e.preventDefault()}}},[e._t("contextMenu",null,{resource:i})],2)],2)]}},e.$slots.footer?{key:"footer",fn:function(){return[e._t("footer")]},proxy:!0}:null],null,!0)})};ft._withStripped=!0;const gt=e.normalizeComponent({render:ft,staticRenderFns:[]},undefined,mt,undefined,false,undefined,!1,void 0,void 0,void 0);async function vt(e,i,a,r){const o=function(e){switch(e){case s.ShareStatus.accepted:return"POST";case s.ShareStatus.declined:return"DELETE";default:return null}}(i);if(!o)throw new Error("invalid new share status");let n=await r.requests.ocs({service:"apps/files_sharing",action:`api/v1/shares/pending/${e.share.id}`,method:o});if(200!==n.status)throw new Error(n.statusText);if(parseInt(n.headers.get("content-length"))>0&&(n=await n.json(),n.ocs.data.length>0)){const e=n.ocs.data[0];return t.buildSharedResource(e,!0,a)}return null}var _t={computed:{setup:()=>({hasResharing:D()}),$_acceptShare_items(){return[{name:"accept-share",icon:"check",handler:this.$_acceptShare_trigger,label:({resources:e})=>this.$ngettext("Accept share","Accept shares",e.length),isEnabled:({resources:e})=>{if(!ee(this.$router,"files-shares-with-me"))return!1;if(0===e.length)return!1;return!e.some((e=>e.status===s.ShareStatus.accepted))},componentType:"oc-button",class:"oc-files-actions-accept-share-trigger"}]}},methods:{...e.mapMutations("Files",["UPDATE_RESOURCE"]),...e.mapActions(["showMessage"]),...e.mapActions("Files",["resetFileSelection"]),async $_acceptShare_trigger({resources:t}){const i=[],a=[],r=new e._default({concurrency:4});t.forEach((e=>{a.push(r.add((async()=>{try{const t=await vt(e,s.ShareStatus.accepted,this.hasResharing,this.$client);t&&this.UPDATE_RESOURCE(t)}catch(e){console.error(e),i.push(e)}})))})),await Promise.all(a),0!==i.length?this.showMessage({title:this.$ngettext("Failed to accept the selected share.","Failed to accept selected shares.",t.length),status:"danger"}):this.resetFileSelection()}}},bt={computed:{$_copy_items(){return[{name:"copy",icon:"file-copy-2",handler:this.$_copy_trigger,label:()=>this.$pgettext("Action in the files list row to initiate copying resources","Copy"),isEnabled:({resources:e})=>!!(Q(this.$router,"files-spaces-personal-home")||Q(this.$router,"files-spaces-project")||de(this.$router,"files-public-files")||G(this.$router,"files-common-favorites"))&&(0!==e.length&&(!de(this.$router,"files-public-files")||this.currentFolder.canCreate())),componentType:"oc-button",class:"oc-files-actions-copy-trigger"}]}},methods:{$_copy_trigger({resources:e}){let t="private";const s={resource:e.map((e=>e.path))};de(this.$router,"files-public-files")&&(t="public"),Q(this.$router,"files-spaces-project")&&(t="space",s.storageId=this.$route.params.storageId);const i=this.currentFolder.path||this.homeFolder;return this.$router.push(se("files-operations-location-picker",{params:{context:t,item:i,action:"copy"},query:s}))}}},St={setup:()=>({hasResharing:D()}),computed:{$_declineShare_items(){return[{name:"decline-share",icon:"close",handler:this.$_declineShare_trigger,label:({resources:e})=>this.$ngettext("Decline share","Decline shares",e.length),isEnabled:({resources:e})=>{if(!ee(this.$router,"files-shares-with-me"))return!1;if(0===e.length)return!1;return!e.some((e=>e.status===s.ShareStatus.declined))},componentType:"oc-button",class:"oc-files-actions-decline-share-trigger"}]}},methods:{...e.mapMutations("Files",["UPDATE_RESOURCE"]),...e.mapActions(["showMessage"]),...e.mapActions("Files",["resetFileSelection"]),async $_declineShare_trigger({resources:t}){const i=[],a=[],r=new e._default({concurrency:4});t.forEach((e=>{a.push(r.add((async()=>{try{const t=await vt(e,s.ShareStatus.declined,this.hasResharing,this.$client);t&&this.UPDATE_RESOURCE(t)}catch(e){console.error(e),i.push(e)}})))})),await Promise.all(a),0!==i.length?this.showMessage({title:this.$ngettext("Failed to decline the selected share.","Failed to decline selected shares.",t.length),status:"danger"}):this.resetFileSelection()}}};function xt(e){if(void 0===e)throw new Error('cloneStateObject: cannot clone "undefined"');return JSON.parse(JSON.stringify(e))}var yt={mixins:[{data:()=>({deleteResources_queue:new e._default({concurrency:4}),deleteResources_deleteOps:[],resourcesToDelete:[]}),computed:{...e.mapGetters("Files",["selectedFiles"]),...e.mapGetters(["user"]),$_deleteResources_isInTrashbin(){return fe(this.$router,"files-trash-personal")||fe(this.$router,"files-trash-spaces-project")},$_deleteResources_resources(){return xt(this.resourcesToDelete)},$_deleteResources_dialogTitle(){const e=this.$_deleteResources_resources,t="folder"===e[0].type;let s=null;return 1===e.length?(s=t?this.$_deleteResources_isInTrashbin?this.$gettext("Permanently delete folder %{name}"):this.$gettext("Delete folder %{name}"):this.$_deleteResources_isInTrashbin?this.$gettext("Permanently delete file %{name}"):this.$gettext("Delete file %{name}"),this.$gettextInterpolate(s,{name:e[0].name},!0)):(s=this.$_deleteResources_isInTrashbin?this.$ngettext("Permanently delete selected resource?","Permanently delete %{amount} selected resources?",e.length):this.$ngettext("Delete selected resource?","Delete %{amount} selected resources?",e.length),this.$gettextInterpolate(s,{amount:e.length},!1))},$_deleteResources_dialogMessage(){const e=this.$_deleteResources_resources,t="folder"===e[0].type;return 1===e.length?t?this.$_deleteResources_isInTrashbin?this.$gettext("Are you sure you want to delete this folder? All it’s content will be permanently removed. This action cannot be undone."):this.$gettext("Are you sure you want to delete this folder?"):this.$_deleteResources_isInTrashbin?this.$gettext("Are you sure you want to delete this file? All it’s content will be permanently removed. This action cannot be undone."):this.$gettext("Are you sure you want to delete this file?"):this.$_deleteResources_isInTrashbin?this.$gettext("Are you sure you want to delete all selected resources? All their content will be permanently removed. This action cannot be undone."):this.$gettext("Are you sure you want to delete all selected resources?")}},methods:{...e.mapActions("Files",["pushResourcesToDeleteList","removeFilesFromTrashbin","deleteFiles"]),...e.mapActions(["showMessage","toggleModalConfirmButton","hideModal","createModal"]),...e.mapMutations(["SET_QUOTA"]),$_deleteResources_trashbin_deleteOp(e){const s=fe(this.$router,"files-trash-spaces-project")?t.buildWebDavSpacesTrashPath(this.$route.params.storageId):t.buildWebDavFilesTrashPath(this.user.id);return this.$client.fileTrash.clearTrashBin(s,e.id).then((()=>{this.removeFilesFromTrashbin([e]);const t=this.$gettext('"%{file}" was deleted successfully');this.showMessage({title:this.$gettextInterpolate(t,{file:e.name},!0)})})).catch((t=>{if(423===t.statusCode){const t=this.deleteResources_queue.add((()=>this.$_deleteResources_trashbin_deleteOp(e)));return void this.deleteResources_deleteOps.push(t)}const s=this.$gettext('Failed to delete "%{file}"');this.showMessage({title:this.$gettextInterpolate(s,{file:e.name},!0),desc:t.message,status:"danger"})}))},$_deleteResources_trashbin_delete(){this.toggleModalConfirmButton();for(const e of this.$_deleteResources_resources){const t=this.deleteResources_queue.add((()=>this.$_deleteResources_trashbin_deleteOp(e)));this.deleteResources_deleteOps.push(t)}Promise.all(this.deleteResources_deleteOps).then((()=>{this.hideModal(),this.toggleModalConfirmButton()}))},$_deleteResources_filesList_delete(){this.deleteFiles({client:this.$client,files:this.$_deleteResources_resources,publicPage:this.publicPage(),$gettext:this.$gettext,$gettextInterpolate:this.$gettextInterpolate}).then((async()=>{if(this.hideModal(),this.toggleModalConfirmButton(),this.user?.id){const e=await this.$client.users.getUser(this.user.id);this.SET_QUOTA(e.quota)}let e;if(this.resourcesToDelete.length&&k(this.resourcesToDelete[0],this.currentFolder)){const t=this.resourcesToDelete[0].path;e=t.substr(0,t.lastIndexOf("/"))}void 0!==e&&this.$router.push({params:{item:e}})}))},$_deleteResources_delete(){this.toggleModalConfirmButton(),this.$_deleteResources_isInTrashbin?this.$_deleteResources_trashbin_delete():this.$_deleteResources_filesList_delete()},$_deleteResources_displayDialog(e){this.resourcesToDelete=[...e];const t={variation:"danger",icon:"alarm-warning",title:this.$_deleteResources_dialogTitle,message:this.$_deleteResources_dialogMessage,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Delete"),onCancel:this.hideModal,onConfirm:this.$_deleteResources_delete};this.createModal(t)}}}],computed:{...e.mapState("Files",["currentFolder"]),...e.mapGetters(["capabilities"]),$_delete_items(){return[{name:"delete",icon:"delete-bin-5",label:()=>this.$gettext("Delete"),handler:this.$_delete_trigger,isEnabled:({resources:e})=>{if(!Q(this.$router,"files-spaces-personal-home")&&!Q(this.$router,"files-spaces-project")&&!de(this.$router,"files-public-files"))return!1;if(0===e.length)return!1;return!e.some((e=>!e.canBeDeleted()))},componentType:"oc-button",class:"oc-files-actions-delete-trigger"},{name:"delete-permanent",icon:"delete-bin-5",label:()=>this.$gettext("Delete"),handler:this.$_delete_trigger,isEnabled:({resources:e})=>!(!fe(this.$router,"files-trash-personal")&&!fe(this.$router,"files-trash-spaces-project"))&&(!1!==this.capabilities?.files?.permanent_deletion&&e.length>0),componentType:"oc-button",class:"oc-files-actions-delete-permanent-trigger"}]}},methods:{$_delete_trigger({resources:e}){this.$_deleteResources_displayDialog(e)}}};var wt={computed:{$_isFilesAppActive(){return"files"===a.activeApp(this.$route)}}},$t={mixins:[wt],computed:{$_downloadArchive_items(){return[{name:"download-archive",icon:"inbox-archive",handler:this.$_downloadArchive_trigger,label:()=>this.$gettext("Download"),isEnabled:({resources:e})=>{if(this.$_isFilesAppActive&&!Q(this.$router,"files-spaces-personal-home")&&!Q(this.$router,"files-spaces-project")&&!de(this.$router,"files-public-files")&&!G(this.$router,"files-common-favorites"))return!1;if(0===e.length)return!1;if(1===e.length&&!e[0].isFolder)return!1;if(!y.available)return!1;if(!y.fileIdsSupported&&G(this.$router,"files-common-favorites"))return!1;return!e.some((e=>!e.canDownload()))},canBeDefault:!0,componentType:"oc-button",class:"oc-files-actions-download-archive-trigger"}]}},methods:{async $_downloadArchive_trigger({resources:t}){const s=y.fileIdsSupported?{fileIds:t.map((e=>e.fileId))}:{dir:e.path.dirname(e.head(t).path)||"/",files:t.map((e=>e.name))};await y.triggerDownload({...s,...de(this.$router,"files-public-files")&&{publicToken:this.$route.params.item.split("/")[0]}}).catch((e=>{console.error(e),this.showMessage({title:this.$ngettext("Failed to download the selected folder.","Failed to download the selected files.",this.selectedFiles.length),status:"danger"})}))}}},Ct={mixins:[wt],computed:{$_downloadFile_items(){return[{name:"delete-file",icon:"file-download",handler:this.$_downloadFile_trigger,label:()=>this.$gettext("Download"),isEnabled:({resources:e})=>!!(!this.$_isFilesAppActive||Q(this.$router,"files-spaces-personal-home")||Q(this.$router,"files-spaces-project")||de(this.$router,"files-public-files")||G(this.$router,"files-common-favorites"))&&(1===e.length&&(!e[0].isFolder&&e[0].canDownload())),canBeDefault:!0,componentType:"oc-button",class:"oc-files-actions-download-file-trigger"}]}},methods:{$_downloadFile_trigger({resources:e}){this.downloadFile(e[0])}}},Ft={mixins:[wt],computed:{$_favorite_items(){return[{name:"favorite",icon:"star",handler:this.$_favorite_trigger,label:({resources:e})=>e[0].starred?this.$gettext("Remove from favorites"):this.$gettext("Add to favorites"),isEnabled:({resources:e})=>!(this.$_isFilesAppActive&&!Q(this.$router,"files-spaces-personal-home")&&!G(this.$router,"files-common-favorites"))&&(1===e.length&&(this.isAuthenticated&&this.capabilities.files&&this.capabilities.files.favorites)),componentType:"oc-button",class:"oc-files-actions-favorite-trigger"}]}},methods:{...e.mapActions("Files",["markFavorite"]),$_favorite_trigger({resources:e}){this.markFavorite({client:this.$client,file:e[0]}).catch((()=>{const t=this.$gettext('Failed to change favorite state of "%{file}"'),s=this.$gettextInterpolate(t,{file:e[0].name},!0);this.showMessage({title:s,status:"danger"})}))}}};var Et={computed:{$_move_items(){return[{name:"move",icon:"folder-shared",handler:this.$_move_trigger,label:()=>this.$pgettext("Action in the files list row to initiate moving resources","Move"),isEnabled:({resources:e})=>{if(!(Q(this.$router,"files-spaces-personal-home")||Q(this.$router,"files-spaces-project")||de(this.$router,"files-public-files")||G(this.$router,"files-common-favorites")))return!1;if(0===e.length)return!1;if(!this.currentFolder)return!1;return!e.some((e=>!1===function(e,t){const s=e.isReceivedShare()||e.isMounted(),i=""===t&&s;return e.canBeDeleted()&&!i}(e,this.currentFolder.path)))},componentType:"oc-button",class:"oc-files-actions-move-trigger"}]}},methods:{$_move_trigger({resources:e}){let t="private";const s={resource:e.map((e=>e.path))};de(this.$router,"files-public-files")&&(t="public"),Q(this.$router,"files-spaces-project")&&(t="space",s.storageId=this.$route.params.storageId);const i=this.currentFolder.path||this.homeFolder;return this.$router.push(se("files-operations-location-picker",{params:{context:t,item:i,action:"move"},query:s}))}}},Rt={computed:{...e.mapState("Files",["currentFolder"]),$_navigate_items(){return[{name:"navigate",icon:"folder-open",label:()=>this.$pgettext("Action in the files list row to open a folder","Open folder"),isEnabled:({resources:e})=>!fe(this.$router,"files-trash-personal")&&!fe(this.$router,"files-trash-spaces-project")&&(1===e.length&&((null===this.currentFolder||!k(e[0],this.currentFolder))&&(!!e[0].isFolder&&(!ee(this.$router,"files-shares-with-me")||e[0].status===s.ShareStatus.accepted)))),canBeDefault:!0,componentType:"router-link",route:({resources:t})=>e.merge({},this.routeName,{params:{item:t[0].path}}),class:"oc-files-actions-navigate-trigger"}]},routeName(){return de(this.$router,"files-public-files")?ne("files-public-files"):Q(this.$router,"files-spaces-project")?ne("files-spaces-project"):V("files-spaces-personal-home")}}},Tt={computed:{...e.mapState(["user"]),$_restore_items(){return[{name:"restore",icon:"arrow-go-back",label:()=>this.$gettext("Restore"),handler:this.$_restore_trigger,isEnabled:({resources:e})=>!(!fe(this.$router,"files-trash-personal")&&!fe(this.$router,"files-trash-spaces-project"))&&(!!e.every((e=>e.canBeRestored()))&&e.length>0),componentType:"oc-button",class:"oc-files-actions-restore-trigger"}]}},methods:{...e.mapActions("Files",["removeFilesFromTrashbin"]),...e.mapActions(["showMessage"]),async $_restore_trigger({resources:s}){const i=[],a=[],r=[],o=new e._default({concurrency:4});if(s.forEach((e=>{const s=fe(this.$router,"files-trash-spaces-project")?t.buildWebDavSpacesTrashPath(this.$route.params.storageId):t.buildWebDavFilesTrashPath(this.user.id),n=fe(this.$router,"files-trash-spaces-project")?t.buildWebDavSpacesPath(this.$route.params.storageId,e.path):t.buildWebDavFilesPath(this.user.id,e.path);r.push(o.add((async()=>{try{await this.$client.fileTrash.restore(s,e.id,n),i.push(e)}catch(t){console.error(t),a.push(e)}})))})),await Promise.all(r),i.length>0){let e;this.removeFilesFromTrashbin(i);const t={};1===i.length?(e=this.$gettext("%{resource} was restored successfully"),t.resource=i[0].name):(e=this.$gettext("%{resourceCount} files restored successfully"),t.resourceCount=i.length),this.showMessage({title:this.$gettextInterpolate(e,t,!0)})}if(a.length>0){let e;const t={};1===a.length?(e=this.$gettext('Failed to restore "%{resource}"'),t.resource=a[0].name):(e=this.$gettext("Failed to restore %{resourceCount} files"),t.resourceCount=a.length),this.showMessage({title:this.$gettextInterpolate(e,t,!0),status:"danger"})}}}};const kt=["navigate","downloadArchive","downloadFile","favorite","copy","move","rename","restore","delete","acceptShare","declineShare"];var It={mixins:[_t,bt,St,yt,Ct,$t,Ft,Et,Rt,pt,Tt],computed:{...e.mapState(["apps"]),...e.mapGetters("Files",["highlightedFile","currentFolder"]),...e.mapGetters(["capabilities","configuration"]),$_fileActions_systemActions(){return kt.flatMap((e=>this[`$_${e}_items`]))},$_fileActions_editorActions(){return fe(this.$router,"files-trash-personal")||fe(this.$router,"files-trash-spaces-project")?[]:this.apps.fileEditors.map((t=>({label:()=>{if(t.label)return this.$gettext(t.label);const e=this.$gettext("Open in %{app}");return this.$gettextInterpolate(e,{app:this.apps.meta[t.app].name},!0)},icon:this.apps.meta[t.app].icon,...this.apps.meta[t.app].iconFillType&&{iconFillType:this.apps.meta[t.app].iconFillType},img:this.apps.meta[t.app].img,handler:({resources:e})=>this.$_fileActions_openEditor(t,e[0].webDavPath,e[0].id,"edit"),isEnabled:({resources:e})=>1===e.length&&(e[0].extension&&t.extension?e[0].extension.toLowerCase()===t.extension.toLowerCase():!(!e[0].mimeType||!t.mimeType)&&(e[0].mimeType.toLowerCase()===t.mimeType.toLowerCase()||e[0].mimeType.split("/")[0].toLowerCase()===t.mimeType.toLowerCase())),canBeDefault:t.canBeDefault,componentType:"oc-button",class:`oc-files-actions-${e.kebabCase(this.apps.meta[t.app].name).toLowerCase()}-trigger`}))).sort(((e,t)=>t.canBeDefault!==e.canBeDefault&&t.canBeDefault?1:0))}},methods:{...e.mapActions(["openFile"]),$_fileActions__routeOpts(e,s,i,a){const r=this.$route;return{name:e.routeName||e.app,params:{filePath:s,fileId:i,mode:a},query:t.routeToContextQuery(r)}},$_fileActions_openEditor(e,t,s,i){if(e.handler)return e.handler({config:this.configuration,extensionConfig:e.config,filePath:t,fileId:s,mode:i});this.openFile({filePath:t});const a=this.$_fileActions__routeOpts(e,t,s,i);if(e.newTab){const s=this.$router.resolve(a).href,i=`${e.routeName}-${t}`,r=window.open(s,i);r&&r.focus()}else this.$router.push(a)},$_fileActions_triggerDefaultAction(e){const t=this.$_fileActions_getDefaultAction(e);t.handler({resources:[e],...t.handlerData})},$_fileActions_getDefaultAction(e){const t=[e],s=e=>e.canBeDefault&&e.isEnabled({resources:t,parent:this.currentFolder}),i=this.$_fileActions_editorActions.filter(s);if(i.length)return i[0];const a=this.$_fileActions_loadExternalAppActions(t).filter(s);return a.length?a[0]:this.$_fileActions_systemActions.filter(s)[0]},$_fileActions_getAllAvailableActions(e){return[...this.$_fileActions_editorActions,...this.$_fileActions_loadExternalAppActions(e),...this.$_fileActions_systemActions].filter((t=>t.isEnabled({resources:e})))},$_fileActions_loadExternalAppActions(t){if(fe(this.$router,"files-trash-personal")||fe(this.$router,"files-trash-spaces-project"))return[];if(1!==t.length)return[];const{mimeType:s,fileId:i}=t[0],a=this.$store.getters["External/mimeTypes"]||[];if(void 0===s||!e.get(this,"capabilities.files.app_providers")||!a.length)return[];const r=a.find((e=>e.mime_type===s));if(void 0===r)return[];const{app_providers:o=[],default_application:n}=r;return o.map((e=>{const t=this.$gettext("Open in %{ appName }");return{name:e.name,icon:e.icon,img:e.img,componentType:"oc-button",class:`oc-files-actions-${e.name}-trigger`,isEnabled:()=>!0,canBeDefault:n===e.name,handler:()=>this.$_fileActions_openLink(e.name,i),label:()=>this.$gettextInterpolate(t,{appName:e.name})}}))},$_fileActions_openLink(e,t){const s=this.$_fileActions__routeOpts({routeName:"external-apps"},void 0,t,void 0);s.params.appName=e,s.query={...s.query,...!O(this.$route)&&{"public-token":(this.$route.params.item||"").split("/")[0]}},window.open(this.$router.resolve(s).href,"_blank")}}},Dt={mounted(){const{filterSearch:e}=$;if(!e||!e.available)return;const t=e.subscribe("reset",(()=>{this.CLEAR_FILES_SEARCHED()})),s=e.subscribe("updateTerm",(e=>{e||this.CLEAR_FILES_SEARCHED()})),i=e.subscribe("activate",(({resources:e})=>{this.LOAD_FILES_SEARCHED(e)}));this.$on("beforeDestroy",(()=>{e.unsubscribe("reset",t),e.unsubscribe("updateTerm",s),e.unsubscribe("activate",i)}))},watch:{$route:{handler:function(e,t){e.name===t?.name&&e.params?.item===t?.params?.item||this.CLEAR_FILES_SEARCHED()},immediate:!0}},methods:{...e.mapMutations("Files",["CLEAR_FILES_SEARCHED","LOAD_FILES_SEARCHED"])}},Pt={methods:{...e.mapActions("Files/sidebar",{openSidebar:"open"}),$_mountSideBar_showDefaultPanel(){this.openSidebar()}}};const Lt={name:"ActionMenuItem",props:{action:{type:Object,required:!0},items:{type:Array,required:!0},appearance:{type:String,default:"raw"}},computed:{filterParams(){return{resources:this.items}}},methods:{getComponentProps(e,t){return"router-link"===e.componentType&&e.route?{to:e.route({resources:t})}:{appearance:this.appearance,...e.isDisabled&&{disabled:e.isDisabled()},...e.variation&&{variation:e.variation}}},getComponentListeners(e,t){if("function"!=typeof e.handler||"oc-button"!==e.componentType)return{};const s=()=>e.handler({resources:t,...e.handlerData});return e.keepOpen?{click:e=>{e.stopPropagation(),s()}}:{click:s}},hasExternalImageIcon:e=>e.icon&&/^https?:\/\//i.test(e.icon)}};var At=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",[s(e.action.componentType,e._g(e._b({tag:"component",class:[e.action.class,"action-menu-item"],attrs:{"data-testid":"action-handler",size:"small"}},"component",e.getComponentProps(e.action,e.items),!1),e.getComponentListeners(e.action,e.items)),[e.action.img?s("oc-img",{staticClass:"oc-icon oc-icon-m",attrs:{"data-testid":"action-img",src:e.action.img,alt:""}}):e.hasExternalImageIcon(e.action)?s("oc-img",{staticClass:"oc-icon oc-icon-m",attrs:{"data-testid":"action-img",src:e.action.icon,alt:""}}):e.action.icon?s("oc-icon",{attrs:{"data-testid":"action-icon",name:e.action.icon,"fill-type":e.action.iconFillType||"line",size:"medium"}}):e._e(),e._v(" "),s("span",{staticClass:"oc-files-context-action-label",attrs:{"data-testid":"action-label"}},[e._v(e._s(e.action.label(e.filterParams)))]),e._v(" "),e.action.opensInNewWindow?s("span",{staticClass:"oc-invisible-sr",attrs:{"data-testid":"action-sr-hint"},domProps:{textContent:e._s(e.$gettext("(Opens in new window)"))}}):e._e()],1)],1)};At._withStripped=!0;const Mt=e.normalizeComponent({render:At,staticRenderFns:[]},undefined,Lt,undefined,false,undefined,!1,void 0,void 0,void 0);var Ot={computed:{...e.mapGetters("Files",["activeFiles"]),...e.mapGetters(["capabilities"]),...e.mapState(["user"]),$_emptyTrashBin_items(){return[{name:"empty-trash-bin",icon:"delete-bin-5",label:()=>this.$gettext("Empty trash bin"),handler:this.$_emptyTrashBin_trigger,isEnabled:({resources:e})=>!(!fe(this.$router,"files-trash-personal")&&!fe(this.$router,"files-trash-spaces-project"))&&(!1!==this.capabilities?.files?.permanent_deletion&&0===e.length),isDisabled:()=>0===this.activeFiles.length,componentType:"oc-button",class:"oc-files-actions-empty-trash-bin-trigger",variation:"danger"}]}},methods:{...e.mapActions(["showMessage","createModal","hideModal","toggleModalConfirmButton"]),...e.mapActions("Files",["clearTrashBin"]),$_emptyTrashBin_trigger(){const e={variation:"danger",title:this.$gettext("Empty trash bin"),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Delete"),icon:"alarm-warning",message:this.$gettext("Are you sure you want to permanently delete your items in the trash bin? You can’t undo this action."),hasInput:!1,onCancel:this.hideModal,onConfirm:()=>this.$_emptyTrashBin_emptyTrashBin()};this.createModal(e)},$_emptyTrashBin_emptyTrashBin(){const e=fe(this.$router,"files-trash-spaces-project")?t.buildWebDavSpacesTrashPath(this.$route.params.storageId):t.buildWebDavFilesTrashPath(this.user.id);return this.$client.fileTrash.clearTrashBin(e).then((()=>{this.hideModal(),this.showMessage({title:this.$gettext("All deleted files were removed")}),this.clearTrashBin()})).catch((e=>{console.error(e),this.showMessage({title:this.$pgettext("Error message in case clearing the trash bin fails","Failed to delete all files permanently"),status:"danger"})}))}}};const Nt={name:"BatchActions",components:{ActionMenuItem:Mt},mixins:[_t,bt,St,yt,$t,Ct,Ot,Et,Tt],computed:{...e.mapGetters("Files",["selectedFiles"]),filterParams(){return{resources:this.selectedFiles}},menuItemsBatchActions(){return[...this.$_acceptShare_items,...this.$_declineShare_items,...this.$_downloadArchive_items,...this.$_downloadFile_items,...this.$_move_items,...this.$_copy_items,...this.$_emptyTrashBin_items,...this.$_delete_items,...this.$_restore_items].filter((e=>e.isEnabled({resources:this.selectedFiles})))}}};var Ut=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-list",{staticClass:"oc-files-appbar-batch-actions oc-width-1-1"},e._l(e.menuItemsBatchActions,(function(t,i){return s("action-menu-item",{key:"batch-action-"+i,staticClass:"oc-mr-s",attrs:{action:t,items:e.selectedFiles,appearance:"outline"}})})),1)};Ut._withStripped=!0;const zt=e.normalizeComponent({render:Ut,staticRenderFns:[]},undefined,Nt,undefined,false,undefined,!1,void 0,void 0,void 0);const Bt={name:"ContextActionMenu",components:{ActionMenuItem:Mt},props:{menuSections:{type:Array,required:!0},items:{type:Array,required:!0}},methods:{getSectionClasses(e){const t=[];return this.menuSections.length?(e<this.menuSections.length-1&&t.push("oc-pb-s"),e>0&&t.push("oc-pt-s"),e<this.menuSections.length-1&&t.push("oc-files-context-actions-border"),t):t}}};var Gt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-files-context-menu"}},e._l(e.menuSections,(function(t,i){return s("oc-list",{key:"section-"+t.name+"-list",staticClass:"oc-files-context-actions",class:e.getSectionClasses(i),attrs:{id:"oc-files-context-actions-"+t.name}},e._l(t.items,(function(i,a){return s("action-menu-item",{key:"section-"+t.name+"-action-"+a,staticClass:"oc-files-context-action oc-px-s oc-rounded",attrs:{action:i,items:e.items}})})),1)})),1)};Gt._withStripped=!0;const qt=e.normalizeComponent({render:Gt,staticRenderFns:[]},undefined,Bt,undefined,false,undefined,!1,void 0,void 0,void 0);function Vt(t){const s={name:t.$gettext("Quick action link"),permissions:1},i=t.store.state.user.capabilities.files_sharing.public.expire_date;return i.enabled&&(s.expireDate=e.DateTime_1.now().plus({days:parseInt(i.days,10)}).endOf("day").toISO()),t.storageId&&(s.spaceRef=`${t.storageId}${t.item.path}`),new Promise(((i,a)=>{t.store.dispatch("Files/addLink",{path:t.item.path,client:t.client,params:s,storageId:t.storageId}).then((s=>{t.store.dispatch("Files/sidebar/openWithPanel","sharing-item").then((()=>{e.copyToClipboard(s.url),t.store.dispatch("showMessage",{title:t.$gettext("Public link created"),desc:t.$gettext("Public link was created successfully and copied into your clipboard.")})})),i()})).catch((e=>{a(e)}))}))}async function jt(e){await e.store.dispatch("Files/sidebar/openWithPanel","sharing-item")}function Ht(e,t){return t.state.user.capabilities.files_sharing&&t.state.user.capabilities.files_sharing.api_enabled&&e.canShare()}var Wt={collaborators:{id:"collaborators",label:e=>e("Add people"),icon:"user-add",handler:jt,displayed:Ht},publicLink:{id:"public-link",label:e=>e("Create and copy public link"),icon:"link",handler:Vt,displayed:Ht}};const Qt={name:"ContextActions",components:{ContextActionMenu:qt},mixins:[It,_t,bt,{computed:{$_createPublicLink_items(){return[{name:"create-public-link",icon:Wt.publicLink.icon,iconFillType:Wt.publicLink.iconFillType,label:()=>this.$gettext("Create & copy public link"),handler:this.$_createPublicLink_trigger,isEnabled:({resources:e})=>1===e.length&&((!ee(this.$router,"files-shares-with-me")||e[0].status===s.ShareStatus.accepted)&&Ht(e[0],this.$store)),componentType:"oc-button",class:"oc-files-actions-create-public-link-trigger"}]}},methods:{$_createPublicLink_trigger({resources:e}){Vt({item:e[0],client:this.$client,store:this.$store,$gettext:this.$gettext,storageId:this.$route.params.storageId})}}},St,yt,$t,Ct,Ot,Ft,Et,Rt,pt,Tt,{mixins:[wt],computed:{$_showActions_items(){return[{name:"show-actions",icon:"slideshow-3",label:()=>this.$gettext("All Actions"),handler:this.$_showActions_trigger,isEnabled:({resources:e})=>!!this.$_isFilesAppActive&&1===e.length,componentType:"oc-button",class:"oc-files-actions-show-actions-trigger"}]}},methods:{...e.mapActions("Files/sidebar",{openSidebarWithPanel:"openWithPanel"}),async $_showActions_trigger(){await this.openSidebarWithPanel(fe(this.$router,"files-trash-personal")||fe(this.$router,"files-trash-spaces-project")?null:"actions-item")}}},{mixins:[wt],computed:{$_showDetails_items(){return[{name:"show-details",icon:"information",label:()=>this.$gettext("Details"),handler:this.$_showDetails_trigger,isEnabled:({resources:e})=>!!this.$_isFilesAppActive&&(!fe(this.$router,"files-trash-personal")&&!fe(this.$router,"files-trash-spaces-project")&&e.length>0),componentType:"oc-button",class:"oc-files-actions-show-details-trigger"}]}},methods:{...e.mapActions("Files/sidebar",{openSidebar:"open"}),async $_showDetails_trigger(){await this.openSidebar()}}},{mixins:[wt],computed:{$_showShares_items(){return[{name:"show-shares",icon:Wt.collaborators.icon,iconFillType:Wt.collaborators.iconFillType,label:()=>this.$gettext("Share"),handler:this.$_showShares_trigger,isEnabled:({resources:e})=>!!this.$_isFilesAppActive&&(!fe(this.$router,"files-trash-personal")&&!fe(this.$router,"files-trash-spaces-project")&&(1===e.length&&((!ee(this.$router,"files-shares-with-me")||e[0].status===s.ShareStatus.accepted)&&Ht(e[0],this.$store)))),componentType:"oc-button",class:"oc-files-actions-show-shares-trigger"}]}},methods:{$_showShares_trigger({resources:e}){jt({item:e[0],client:this.$client,store:this.$store})}}},{inject:{currentSpace:{default:null}},computed:{...e.mapGetters(["configuration"]),...e.mapState(["user"]),$_setSpaceImage_items(){return[{name:"set-space-image",icon:"image-edit",handler:this.$_setSpaceImage_trigger,label:()=>this.$gettext("Set as space image"),isEnabled:({resources:e})=>1===e.length&&(!!e[0].mimeType&&(!!w.isMimetypeSupported(e[0].mimeType,!0)&&(!!Q(this.$router,"files-spaces-project")&&(!!this.space&&this.space.canEditImage({user:this.user}))))),canBeDefault:!1,componentType:"oc-button",class:"oc-files-actions-set-space-image-trigger"}]},space(){return this.currentSpace?.value}},methods:{...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),...e.mapActions(["showMessage"]),async $_setSpaceImage_trigger({resources:e}){const i=s.clientService.graphAuthenticated(this.configuration.server,this.getToken),a=this.$route.params.storageId,o=e[0].webDavPath,n=`/spaces/${a}/.space/${e[0].name}`;if(o!==n)try{await this.$client.files.copy(o,n);const e=await this.$client.files.fileInfo(n),s=t.buildResource(e),{data:l}=await i.drives.updateDrive(a,{special:[{specialFolder:{name:"image"},id:s.id}]},{});this.UPDATE_RESOURCE_FIELD({id:a,field:"spaceImageData",value:l.special.find((e=>"image"===e.specialFolder.name))}),this.showMessage({title:this.$gettext("Space image was set successfully")}),r.bus.publish("app.files.list.load")}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to set space image"),status:"danger"})}}}},{inject:{currentSpace:{default:null}},computed:{...e.mapState("Files",["currentFolder"]),...e.mapState(["user"]),$_setSpaceReadme_items(){return[{name:"set-space-readme",icon:"markdown",handler:this.$_setSpaceReadme_trigger,label:()=>this.$gettext("Set as space description"),isEnabled:({resources:e})=>1===e.length&&(!!e[0].mimeType?.startsWith("text/")&&(!!Q(this.$router,"files-spaces-project")&&(!!this.space&&this.space.canEditReadme({user:this.user})))),canBeDefault:!1,componentType:"oc-button",class:"oc-files-actions-set-space-readme-trigger"}]},space(){return this.currentSpace?.value}},methods:{...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),...e.mapActions(["showMessage"]),async $_setSpaceReadme_trigger({resources:e}){const t=this.currentFolder;try{const s=await this.$client.files.getFileContents(e[0].webDavPath),i=await this.$client.files.putFileContents(`/spaces/${t.id}/.space/readme.md`,s);this.UPDATE_RESOURCE_FIELD({id:t.id,field:"spaceReadmeData",value:{...t.spaceReadmeData,etag:i?.ETag}}),this.showMessage({title:this.$gettext("Space description was set successfully")}),r.bus.publish("app.files.list.load")}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to set space description"),status:"danger"})}}}},{computed:{$_navigate_space_items(){return[{name:"navigate",icon:"layout-grid",label:()=>this.$gettext("Navigate to space"),handler:this.$_navigate_space_trigger,isEnabled:({resources:e})=>!e.length&&fe(this.$router,"files-trash-spaces-project"),componentType:"oc-button",class:"oc-files-actions-navigate-trigger"}]}},methods:{$_navigate_space_trigger(){this.$router.push(V("files-spaces-project",{params:{storageId:this.$router.currentRoute.params.storageId}}))}}}],props:{items:{type:Array,required:!0}},computed:{menuSections(){const e=[];return this.items.length>1?(this.menuItemsBatchActions.length&&e.push({name:"batch-actions",items:[...this.menuItemsBatchActions]}),e.push({name:"batch-details",items:[...this.$_showDetails_items]}),e):(this.menuItemsContext.length&&e.push({name:"context",items:this.menuItemsContext}),this.menuItemsShare.length&&e.push({name:"share",items:this.menuItemsShare}),this.menuItemsActions.length&&e.push({name:"actions",items:this.menuItemsActions}),this.menuItemsSidebar.length&&e.push({name:"sidebar",items:this.menuItemsSidebar}),e)},filterParams(){return{resources:this.items}},menuItemsBatchActions(){return[...this.$_acceptShare_items,...this.$_declineShare_items,...this.$_downloadArchive_items,...this.$_delete_items,...this.$_move_items,...this.$_copy_items,...this.$_emptyTrashBin_items,...this.$_restore_items].filter((e=>e.isEnabled(this.filterParams)))},menuItemsContext(){return[...[...this.$_fileActions_editorActions,...this.$_fileActions_loadExternalAppActions(this.filterParams.resources)]].filter((e=>e.isEnabled(this.filterParams)))},menuItemsShare(){return[...this.$_showShares_items,...this.$_createPublicLink_items].filter((e=>e.isEnabled(this.filterParams)))},menuItemsActions(){return[...this.$_downloadArchive_items,...this.$_downloadFile_items,...this.$_delete_items,...this.$_move_items,...this.$_copy_items,...this.$_rename_items,...this.$_restore_items,...this.$_acceptShare_items,...this.$_declineShare_items,...this.$_setSpaceImage_items,...this.$_setSpaceReadme_items,...this.$_navigate_space_items].filter((e=>e.isEnabled(this.filterParams)))},menuItemsSidebar(){const e=[...this.$_navigate_items];return[...this.$_favorite_items.map((e=>(e.keepOpen=!0,e))),...e,...this.$_showDetails_items].filter((e=>e.isEnabled(this.filterParams)))}}};var Yt=function(){var e=this,t=e.$createElement;return(e._self._c||t)("context-action-menu",{attrs:{"menu-sections":e.menuSections,items:e.items}})};Yt._withStripped=!0;const Jt=e.normalizeComponent({render:Yt,staticRenderFns:[]},undefined,Qt,undefined,false,undefined,!1,void 0,void 0,void 0);const Kt={setup(){const t=e.getCurrentInstance().proxy.$gettext,s=i.useRouter(),a=[K,Z,X].reduce(((e,t)=>(e[t.name]=s.getRoutes().find((e=>e.name===t.name)),e)),{}),r=Ze(ee,K.name),o=Ze(ee,Z.name),n=Ze(ee,X.name),l=e.computed((()=>[{icon:"share-forward",to:a[K.name].path,text:t("Shared with me"),active:e.unref(r)},{icon:"reply",to:a[Z.name].path,text:t("Shared with others"),active:e.unref(o)},{icon:"link",to:a[X.name].path,text:t("Shared via link"),active:e.unref(n)}]));return{currentNavItem:e.computed((()=>e.unref(l).find((e=>e.active)))),navItems:l}}};var Zt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("nav",{staticClass:"oc-py-s",attrs:{id:"shares-navigation","aria-label":e.$gettext("Shares pages navigation")}},[s("oc-list",{staticClass:"oc-flex oc-visible@s"},e._l(e.navItems,(function(t){return s("li",{key:"shares-navigation-desktop-"+t.to},[s("oc-button",{staticClass:"oc-mr-m oc-py-s shares-nav-desktop",attrs:{type:"router-link",appearance:"raw",to:t.to}},[s("oc-icon",{attrs:{size:"small",name:t.icon}}),e._v(" "),s("span",{domProps:{textContent:e._s(t.text)}})],1)],1)})),0),e._v(" "),s("div",{staticClass:"oc-hidden@s"},[s("oc-button",{attrs:{id:"shares_navigation_mobile",appearance:"raw"}},[s("span",{domProps:{textContent:e._s(e.currentNavItem.text)}}),e._v(" "),s("oc-icon",{attrs:{name:"arrow-down-s","fill-type":"line",size:"small"}})],1),e._v(" "),s("oc-drop",{attrs:{toggle:"#shares_navigation_mobile",mode:"click","close-on-click":"","padding-size":"small"}},[s("oc-list",e._l(e.navItems,(function(t){return s("li",{key:"shares-navigation-mobile-"+t.to},[s("oc-button",{staticClass:"oc-my-xs shares-nav-mobile",class:{"oc-background-primary-gradient":t.active},attrs:{type:"router-link",appearance:"raw",to:t.to,variation:t.active?"inverse":"passive"}},[s("span",{staticClass:"icon-box",class:{"icon-box-active":t.active}},[s("oc-icon",{attrs:{name:t.icon}})],1),e._v(" "),s("span",{domProps:{textContent:e._s(t.text)}})])],1)})),0)],1)],1)],1)};Zt._withStripped=!0;const Xt=e.normalizeComponent({render:Zt,staticRenderFns:[]},undefined,Kt,"data-v-18dfdb62",false,undefined,!1,void 0,void 0,void 0);const es={mixins:[be],computed:{...e.mapGetters("Files",["selectedFiles"]),selectedResourcesAmount(){return this.selectedFiles.length},selectedResourcesSize(){const e=xt(this.selectedFiles);let t=0;for(const s of e)t+=parseInt(s.size,10);return this.getResourceSize(t)},clearSelectionLabel(){return this.$gettext("Clear selection")}},methods:{...e.mapMutations("Files",["RESET_SELECTION"])}};var ts=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex oc-flex-middle oc-text-nowrap size-info"},["?"!==e.selectedResourcesSize?s("translate",{key:"multiple-select-info-with-size",attrs:{"translate-n":e.selectedResourcesAmount,"translate-params":{amount:e.selectedResourcesAmount,size:e.selectedResourcesSize},"translate-plural":"%{ amount } selected - %{ size }","translate-comment":"Number of selected resources and their size displayed above the files list"}},[e._v("%{ amount } selected - %{ size }\n  ")]):s("translate",{key:"multiple-select-info",attrs:{"translate-n":e.selectedResourcesAmount,"translate-params":{amount:e.selectedResourcesAmount},"translate-plural":"%{ amount } selected","translate-comment":"Number of selected resources displayed above the files list"}},[e._v("%{ amount } selected\n  ")]),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.clearSelectionLabel,expression:"clearSelectionLabel"}],staticClass:"oc-ml-m",attrs:{id:"files-clear-selection","aria-label":e.clearSelectionLabel,appearance:"outline"},on:{click:e.RESET_SELECTION}},[s("oc-icon",{attrs:{name:"close"}})],1)],1)};ts._withStripped=!0;const ss=e.normalizeComponent({render:ts,staticRenderFns:[]},undefined,es,undefined,false,undefined,!1,void 0,void 0,void 0);const is={computed:{...e.mapState("Files/sidebar",{sidebarClosed:"closed"}),toggleSidebarButtonLabel(){return this.sidebarClosed?this.$gettext("Open sidebar to view details"):this.$gettext("Close sidebar to hide details")},toggleSidebarButtonIconFillType(){return this.sidebarClosed?"line":"fill"}},methods:{...e.mapActions("Files/sidebar",{toggleSidebar:"toggle"})}};var as=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.toggleSidebarButtonLabel,expression:"toggleSidebarButtonLabel"}],staticClass:"oc-my-s oc-p-xs",attrs:{id:"files-toggle-sidebar","aria-label":e.toggleSidebarButtonLabel,appearance:"raw"},on:{click:function(t){return t.stopPropagation(),e.toggleSidebar.apply(null,arguments)}}},[s("oc-icon",{attrs:{name:"side-bar-right","fill-type":e.toggleSidebarButtonIconFillType}})],1)};as._withStripped=!0;const rs=e.normalizeComponent({render:as,staticRenderFns:[]},undefined,is,"data-v-44102f5a",false,undefined,!1,void 0,void 0,void 0);const os={setup:()=>({itemsPerPage:c({name:Fe.perPageQueryName,defaultValue:Fe.perPageDefault})}),computed:{...e.mapState("Files",["areHiddenFilesShown"]),viewOptionsButtonLabel(){return this.$gettext("Display customization options of the files list")},hiddenFilesShownModel:{get(){return this.areHiddenFilesShown},set(e){this.SET_HIDDEN_FILES_VISIBILITY(e)}}},methods:{...e.mapMutations("Files",["SET_HIDDEN_FILES_VISIBILITY"])}};var ns=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.viewOptionsButtonLabel,expression:"viewOptionsButtonLabel"}],key:"files-view-options-btn",staticClass:"oc-my-s oc-p-xs",attrs:{id:"files-view-options-btn","data-testid":"files-view-options-btn","aria-label":e.viewOptionsButtonLabel,appearance:"raw"}},[s("oc-icon",{attrs:{name:"settings-3","fill-type":"line"}})],1),e._v(" "),s("oc-drop",{staticClass:"oc-width-auto",attrs:{"drop-id":"files-view-options-drop",toggle:"#files-view-options-btn",mode:"click","padding-size":"small"}},[s("oc-list",[s("li",{staticClass:"files-view-options-list-item"},[s("oc-switch",{attrs:{"data-testid":"files-switch-hidden-files",label:e.$gettext("Show hidden files")},model:{value:e.hiddenFilesShownModel,callback:function(t){e.hiddenFilesShownModel=t},expression:"hiddenFilesShownModel"}})],1),e._v(" "),s("li",{staticClass:"files-view-options-list-item"},[s("oc-page-size",{staticClass:"files-pagination-size",attrs:{"data-testid":"files-pagination-size",label:e.$gettext("Items per page"),options:[100,500,1e3,e.$gettext("All")]},model:{value:e.itemsPerPage,callback:function(t){e.itemsPerPage=t},expression:"itemsPerPage"}})],1)])],1)],1)};ns._withStripped=!0;const ls={components:{BatchActions:zt,ContextActions:Jt,SharesNavigation:Xt,SidebarToggle:rs,SizeInfo:ss,ViewOptions:e.normalizeComponent({render:ns,staticRenderFns:[]},undefined,os,"data-v-8441b19e",false,undefined,!1,void 0,void 0,void 0)},mixins:[L,It],props:{breadcrumbs:{type:Array,default:()=>[]},breadcrumbsContextActionsItems:{type:Array,default:()=>[]},hasBulkActions:{type:Boolean,default:!1},hasSharesNavigation:{type:Boolean,default:!1},hasSidebarToggle:{type:Boolean,default:!0},hasViewOptions:{type:Boolean,default:!0}},computed:{...e.mapGetters("Files",["files","selectedFiles"]),...e.mapState("Files",["areHiddenFilesShown"]),pageTitle(){const e=this.$route.meta.title;return this.$gettext(e)},areDefaultActionsVisible(){return this.selectedFiles.length<1},showContextActions(){return e.last(this.breadcrumbs).allowContextActions},showSelectionInfo(){return this.hasBulkActions&&this.selectedFiles.length>0},showBatchActions(){return this.hasBulkActions},selectedResourcesAnnouncement(){if(0===this.selectedFiles.length)return this.$gettext("No items selected.");const e=this.$ngettext("%{ amount } item selected. Actions are available above the table.","%{ amount } items selected. Actions are available above the table.",this.selectedFiles.length);return this.$gettextInterpolate(e,{amount:this.selectedFiles.length})}},created(){const e="true"===(window.localStorage.getItem("oc_hiddenFilesShown")||"false");e!==this.areHiddenFilesShown&&this.SET_HIDDEN_FILES_VISIBILITY(e)},methods:{...e.mapMutations("Files",["SET_HIDDEN_FILES_VISIBILITY"])}};var cs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"files-app-bar"}},[s("oc-hidden-announcer",{attrs:{announcement:e.selectedResourcesAnnouncement,level:"polite"}}),e._v(" "),s("div",{staticClass:"files-topbar oc-py-s"},[s("h1",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.pageTitle)}}),e._v(" "),s("div",{staticClass:"oc-flex",class:{"oc-flex-between":e.breadcrumbs.length||e.hasSharesNavigation,"oc-flex-right":!e.breadcrumbs.length&&!e.hasSharesNavigation}},[e.breadcrumbs.length?s("oc-breadcrumb",{staticClass:"oc-flex oc-flex-middle",attrs:{id:"files-breadcrumb","data-testid":"files-breadcrumbs","context-menu-padding":"small",items:e.breadcrumbs},scopedSlots:e._u([{key:"contextMenu",fn:function(){return[e.showContextActions?s("context-actions",{attrs:{items:e.breadcrumbsContextActionsItems.filter(Boolean)}}):e._e()]},proxy:!0}],null,!1,4003141064)}):e._e(),e._v(" "),e.hasSharesNavigation?s("shares-navigation"):e._e(),e._v(" "),e.hasViewOptions||e.hasSidebarToggle?s("div",{staticClass:"oc-flex"},[e.hasViewOptions?s("view-options"):e._e(),e._v(" "),e.hasSidebarToggle?s("sidebar-toggle"):e._e()],1):e._e()],1),e._v(" "),s("div",{staticClass:"files-app-bar-actions"},[s("div",{staticClass:"oc-flex-1 oc-flex oc-flex-start",staticStyle:{gap:"15px"}},[0===e.selectedFiles.length?e._t("actions"):e._e(),e._v(" "),e.showSelectionInfo?s("size-info",{staticClass:"oc-visible@l"}):e._e(),e._v(" "),e.showBatchActions?s("batch-actions"):e._e()],2)]),e._v(" "),e._t("content")],2)],1)};cs._withStripped=!0;const ds=e.normalizeComponent({render:cs,staticRenderFns:[]},undefined,ls,"data-v-23ccbc58",false,undefined,!1,void 0,void 0,void 0);const us={name:"QuickActions",props:{actions:{type:Object,required:!0},item:{type:Object,required:!0}},computed:{filteredActions(){return e.pickBy(this.actions,(e=>!0===e.displayed(this.item,this.$store)))}}};var hs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex"},e._l(e.filteredActions,(function(t){return s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:t.label(e.$gettext),expression:"action.label($gettext)"}],key:t.label(e.$gettext),staticClass:"oc-mr-xs quick-action-button oc-p-xs",class:"files-quick-action-"+t.id,attrs:{"aria-label":t.label(e.$gettext),appearance:"raw"},on:{click:function(s){return t.handler({item:e.item,client:e.$client,store:e.$store,$gettext:e.$gettext})}}},[s("oc-icon",{attrs:{name:t.icon,"fill-type":"line"}})],1)})),1)};hs._withStripped=!0;const ps=e.normalizeComponent({render:hs,staticRenderFns:[]},undefined,us,undefined,false,undefined,!1,void 0,void 0,void 0);const ms={props:{files:{type:Number,required:!0},folders:{type:Number,required:!0},size:{type:[String,Number],required:!1,default:null}},computed:{items(){return this.files+this.folders},text(){const t=this.$gettextInterpolate(this.$ngettext("%{ filesCount } file","%{ filesCount } files",this.files),{filesCount:this.files}),s=this.$gettextInterpolate(this.$ngettext("%{ foldersCount } folder","%{ foldersCount } folders",this.folders),{foldersCount:this.folders}),i=e.getResourceSize(this.size),a=this.size>0?this.$ngettext("%{ itemsCount } item with %{ itemSize } in total (%{ filesStr}, %{foldersStr})","%{ itemsCount } items with %{ itemSize } in total (%{ filesStr}, %{foldersStr})",this.items):this.$ngettext("%{ itemsCount } item in total (%{ filesStr}, %{foldersStr})","%{ itemsCount } items in total (%{ filesStr}, %{foldersStr})",this.items);return this.$gettextInterpolate(a,{itemsCount:this.items,itemSize:i,filesStr:t,foldersStr:s})}}};var fs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-text-nowrap oc-text-center"},[s("p",{staticClass:"oc-text-muted",attrs:{"data-testid":"files-list-footer-info","data-test-items":e.items,"data-test-files":e.files,"data-test-folders":e.folders,"data-test-size":e.size}},[e._v("\n    "+e._s(e.text)+"\n  ")])])};fs._withStripped=!0;const gs=e.normalizeComponent({render:fs,staticRenderFns:[]},undefined,ms,undefined,false,undefined,!1,void 0,void 0,void 0);const vs={props:{pages:{type:Number,required:!0},currentPage:{type:Number,required:!0}}};var _s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.pages>1?s("oc-pagination",{staticClass:"files-pagination oc-flex oc-flex-center oc-my-s",attrs:{pages:e.pages,"current-page":e.currentPage,"max-displayed":3,"current-route":e.$route}}):e._e()};_s._withStripped=!0;const bs=e.normalizeComponent({render:_s,staticRenderFns:[]},undefined,vs,undefined,false,undefined,!1,void 0,void 0,void 0),Ss=new e.VisibilityObserver;const xs=e.defineComponent({components:{AppBar:ds,ResourceTable:gt,QuickActions:ps,AppLoadingSpinner:e.__vue_component__$1,Pagination:bs,NoContentMessage:e.__vue_component__$2,ListInfo:gs,ContextActions:Jt},mixins:[It,Pt,Dt],setup:()=>({...Ke(),resourceTargetLocation:V("files-spaces-personal-home")}),computed:{...e.mapState(["app"]),...e.mapState("Files",["files"]),...e.mapGetters("Files",["highlightedFile","totalFilesCount","totalFilesSize"]),...e.mapState("Files/sidebar",{sidebarClosed:"closed"}),...e.mapGetters(["user","configuration"]),isEmpty(){return this.paginatedResources.length<1},displayThumbnails(){return!this.configuration.options.disablePreviews}},created(){this.loadResourcesTask.perform()},beforeDestroy(){Ss.disconnect()},methods:{...e.mapActions("Files",["loadPreview"]),rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:ut.Thumbnail,type:ht.Thumbnail})}),250);Ss.observe(s.$el,{onEnter:i,onExit:i.cancel})}}});var ys=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("app-bar"),e._v(" "),e.loadResourcesTask.isRunning?s("app-loading-spinner"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-favorites-empty",icon:"star"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources marked as favorite")])]},proxy:!0}],null,!1,2464274424)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-favorites-table","are-paths-displayed":!0,"are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"quickActions",fn:function(t){return[s("quick-actions",{staticClass:"oc-visible@s",attrs:{item:t.resource,actions:e.app.quickActions}})]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResources,callback:function(t){e.selectedResources=t},expression:"selectedResources"}})]],2)};ys._withStripped=!0;const ws=e.normalizeComponent({render:ys,staticRenderFns:[]},undefined,xs,undefined,false,undefined,!1,void 0,void 0,void 0);const $s={components:{vueDropzone:e.vue2Dropzone},mixins:[L],data:()=>({loading:!0,errorMessage:null,uploadedFiles:new Map,uploadedFilesChangeTracker:0}),computed:{...e.mapGetters(["configuration"]),...e.mapGetters("Files",["publicLinkPassword"]),pageTitle(){return this.$gettext(this.$route.meta.title)},publicLinkToken(){return this.$route.params.token},title(){if(this.share){const e=this.$gettext("%{owner} shared this folder with you for uploading");return this.$gettextInterpolate(e,{owner:this.share.getProperty(this.$client.publicFiles.PUBLIC_LINK_SHARE_OWNER)},!0)}return""},url(){return this.$client.publicFiles.getFileUrl(this.publicLinkToken)+"/"},getUploadedFiles(){return this.uploadedFilesChangeTracker&&this.uploadedFiles.values()},dropzoneOptions(){return{url:this.url,clickable:!0,createImageThumbnails:!1,autoQueue:!1,previewsContainer:"#previews"}}},mounted(){this.resolvePublicLink()},methods:{resolvePublicLink(){this.loading=!0,this.$client.publicFiles.list(this.publicLinkToken,this.publicLinkPassword,s.DavProperties.PublicLink,"0").then((e=>{const t=parseInt(e[0].getProperty(s.DavProperty.PublicLinkPermission));s.linkRoleUploaderFolder.bitmask(!1)===t?this.share=e[0]:this.$router.replace(ne("files-public-files",{params:{item:this.publicLinkToken}}))})).catch((e=>{401!==e.statusCode?this.errorMessage=e:this.$router.push(se("files-operations-resolver-public-link",{params:{token:this.publicLinkToken}}))})).finally((()=>{this.loading=!1}))},dropZoneFileAdded(e){const t=e.upload.uuid;this.uploadedFilesChangeTracker++,this.uploadedFiles.set(t,{name:e.name,size:e.size,status:"init"}),this.uploadQueue.add((()=>this.$client.publicFiles.putFileContents(this.publicLinkToken,e.name,this.publicLinkPassword,e,{headers:{"OC-Autorename":1},onProgress:s=>{this.uploadedFilesChangeTracker++,this.uploadedFiles.set(t,{name:e.name,size:e.size,status:"uploading"})}}))).then((s=>{this.uploadedFilesChangeTracker++,this.uploadedFiles.set(t,{name:e.name,size:e.size,status:"done"})})).catch((s=>{console.error("Error uploading file ",e.name,": ",s),this.uploadedFilesChangeTracker++,this.uploadedFiles.set(t,{name:e.name,size:e.size,status:"error"})}))},$_ocUploadingFileMessage(e){const t=this.$gettext('Uploading file "%{fileName}"');return this.$gettextInterpolate(t,{fileName:e},!0)}}};var Cs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-height-1-1 oc-flex oc-flex-column oc-flex-between",attrs:{id:"files-drop-container"}},[s("h1",{staticClass:"oc-invisible-sr"},[e._v(e._s(e.pageTitle))]),e._v(" "),s("div",{staticClass:"oc-p oc-height-1-1"},[e.loading?s("div",{key:"loading-drop",staticClass:"oc-flex oc-flex-column oc-flex-middle"},[s("h2",{staticClass:"oc-login-card-title"},[s("translate",[e._v("Loading public link…")])],1),e._v(" "),s("oc-spinner",{attrs:{"aria-hidden":!0}})],1):s("div",{key:"loaded-drop",staticClass:"oc-flex oc-flex-column oc-flex-middle oc-height-1-1"},[s("div",{staticClass:"oc-text-center oc-width-1-1 oc-width-xxlarge@m"},[s("h2",{domProps:{textContent:e._s(e.title)}}),e._v(" "),s("vue-dropzone",{attrs:{id:"oc-dropzone",options:e.dropzoneOptions,"use-custom-slot":!0,"include-styling":!1},on:{"vdropzone-file-added":e.dropZoneFileAdded}},[s("div",{staticClass:"oc-flex oc-flex-middle oc-flex-center oc-files-drop-drag-area"},[s("oc-icon",{attrs:{name:"file-upload"}}),e._v(" "),s("translate",[e._v("Drop files here to upload or click to select file")])],1)]),e._v(" "),s("div",{attrs:{id:"previews",hidden:""}})],1),e._v(" "),s("div",{staticClass:"oc-flex oc-flex-center oc-overflow-auto oc-width-1-1 oc-mt",class:{"files-empty":!e.getUploadedFiles}},[e.getUploadedFiles?s("oc-table-simple",{staticClass:"oc-width-1-1 oc-width-xxlarge@m"},[s("oc-tbody",e._l(e.getUploadedFiles,(function(t,i){return s("oc-tr",{key:i},[s("oc-td",{staticClass:"oc-pl-rm",domProps:{textContent:e._s(t.name)}}),e._v(" "),s("oc-td",{staticClass:"oc-text-nowrap oc-text-muted",attrs:{width:"shrink"}},[s("oc-resource-size",{attrs:{size:t.size}})],1),e._v(" "),s("oc-td",{staticClass:"oc-pr-rm",attrs:{width:"shrink"}},["done"===t.status?s("oc-icon",{attrs:{name:"checkbox-circle",size:"small",variation:"success"}}):e._e(),e._v(" "),"error"===t.status?s("oc-icon",{attrs:{name:"information",size:"small",variation:"danger"}}):e._e(),e._v(" "),"uploading"===t.status||"init"===t.status?s("oc-spinner",{attrs:{size:"small","aria-label":e.$_ocUploadingFileMessage(t.name)}}):e._e()],1)],1)})),1)],1):e._e()],1),e._v(" "),e.errorMessage?s("div",{staticClass:"oc-text-center"},[s("h2",[s("translate",[e._v("An error occurred while loading the public link")])],1),e._v(" "),s("p",{staticClass:"oc-m-rm",domProps:{textContent:e._s(e.errorMessage)}})]):e._e()])]),e._v(" "),s("div",{staticClass:"oc-text-center"},[s("p",{domProps:{textContent:e._s(e.configuration.currentTheme.general.slogan)}})])])};Cs._withStripped=!0;const Fs=e.normalizeComponent({render:Cs,staticRenderFns:[]},undefined,$s,undefined,false,undefined,!1,void 0,void 0,void 0),Es="move",Rs="copy";const Ts={metaInfo(){return{title:`${this.title} - ${this.configuration.currentTheme.general.name}`}},components:{ResourceTable:gt,NoContentMessage:e.__vue_component__$2,AppLoadingSpinner:e.__vue_component__$1,ListInfo:gs,Pagination:bs},mixins:[L,Dt],setup(){const i=e.q((function*(e,i,a){i.CLEAR_CURRENT_FILES_LIST(),"object"==typeof a&&(a=i.target);const{context:r}=i.$route.params;let o;switch(r){case"public":o=yield i.$client.publicFiles.list(a,i.publicLinkPassword,s.DavProperties.Default);break;case"space":o=yield i.$client.files.list(t.buildWebDavSpacesPath(i.$route.query.storageId,a),1,s.DavProperties.Default);break;default:o=yield i.$client.files.list(t.buildWebDavFilesPath(i.user.id,a),1,s.DavProperties.Default)}i.loadFiles({currentFolder:o[0],files:o.slice(1)}),i.loadIndicators({client:i.$client,currentFolder:i.$route.params.item||"/"}),i.refreshFileListHeaderPosition()})).restartable();return{...Ke({loadResourcesTask:i}),hasSpaces:P()}},data:()=>({originalLocation:""}),computed:{...e.mapState("Files",["selectedResourcesForMove","locationPickerTargetFolder","currentFolder"]),...e.mapGetters("Files",["publicLinkPassword","totalFilesCount","totalFilesSize"]),...e.mapGetters(["configuration"]),...e.mapGetters(["homeFolder"]),...e.mapState(["user"]),title(){const t=this.hasSpaces?this.$gettext("Personal"):this.$gettext("All files"),s=e.basename(this.target)||t?this.$gettext("Personal"):this.$gettext("All files"),i=this.currentAction===Es?this.$gettext("Move into »%{ target }«"):this.$gettext("Copy into »%{ target }«");return this.$gettextInterpolate(i,{target:s})},currentAction(){return this.$route.params.action},isPublicContext(){return"public"===this.$route.params.context},target(){return this.$route.params.item||this.homeFolder},resources(){const e=xt(this.$route.query.resource);return"string"==typeof e?[e]:e},resourcesCount(){return this.resources.length},breadcrumbs(){const t=[],s=this.target.split("/").filter((e=>""!==e));if(this.isPublicContext){const i=e.join.apply(null,s.slice(0,1));t.push(this.createBreadcrumbNode(0,this.$gettext("Public link"),i));for(let i=1;i<s.length;i++){const a=e.join.apply(null,s.slice(0,i+1));t.push(this.createBreadcrumbNode(i+1,s[i],a))}}else{const i=this.hasSpaces?this.$gettext("Personal"):this.$gettext("All files");t.push(this.createBreadcrumbNode(0,i,"/"));for(let i=0;i<s.length;i++){const a=e.join.apply(null,s.slice(0,i+1));t.push(this.createBreadcrumbNode(i+1,s[i],a))}}return delete t[t.length-1].to,t},canConfirm(){return this.currentFolder&&this.currentFolder.canCreate()},confirmBtnText(){switch(this.currentAction){case Es:return this.$pgettext("Confirm action in the location picker for move","Move here");case Rs:return this.$pgettext("Confirm action in the location picker for copy","Paste here");default:return this.$gettext("Confirm")}},disabledResources(){return xt(this.paginatedResources).filter((e=>"folder"!==e.type||this.resources.includes(e.path))).map((e=>e.id))},isEmpty(){return this.paginatedResources.length<1},targetRoute(){const e={name:this.$route.name,query:{resource:this.resources},params:{action:this.currentAction}};return this.$route.query.storageId&&(e.query.storageId=this.$route.query.storageId),e},currentHint(){return"move"===this.currentAction?this.$gettext("Navigate into the desired folder and move selected resources into it.\n          You can navigate into a folder by clicking on its name.\n          To navigate back, you can click on the breadcrumbs.\n          Resources will be moved into the folder where you are currently located."):this.$gettext("Navigate into the desired folder and copy selected resources into it.\n        You can navigate into a folder by clicking on its name.\n        To navigate back, you can click on the breadcrumbs.\n        Resources will be copied into the folder where you are currently located.")}},watch:{$route:{handler:function(e,t){const s=e.name===t?.name,i=e.params?.item===t?.params?.item;s&&i||this.loadResourcesTask.perform(this,this.$route)},immediate:!0}},created(){this.originalLocation=this.target},methods:{...e.mapMutations("Files",["CLEAR_CURRENT_FILES_LIST"]),...e.mapActions("Files",["loadFiles","loadIndicators"]),...e.mapActions(["showMessage"]),createBreadcrumbNode(e,t,s){return{index:e,text:t,to:{name:this.$route.name,params:{action:this.currentAction,item:s},query:{resource:this.resources}}}},leaveLocationPicker(e){switch(this.$route.params.context){case"public":this.$router.push(ne("files-public-files",{params:{item:e}}));break;case"space":this.$router.push(V("files-spaces-project",{params:{storageId:this.$route.query.storageId,item:e||"/"}}));break;default:this.$router.push(V("files-spaces-personal-home",{params:{item:e||"/"}}))}},isRowDisabled(e){return"folder"!==e.type||!e.canCreate()||this.resources.some((t=>t===e.path))},async confirmAction(){const s=[];let i=null;for(const a of this.resources){let r,o=e.basename(a);if(this.paginatedResources.some((t=>e.basename(t.name)===o))){const e=this.$gettext("Resource with name %{name} already exists");s.push({resource:o,message:this.$gettextInterpolate(e,{name:o},!0)})}else{switch(this.currentAction){case Es:switch(this.$route.params.context){case"public":r=`${this.target||"/"}`,r+=`/${o}`,i=this.$client.publicFiles.move(a,r,this.publicLinkPassword);break;case"space":r=t.buildWebDavSpacesPath(this.$route.query.storageId,this.target||"/"),r+=`/${o}`,i=this.$client.files.move(t.buildWebDavSpacesPath(this.$route.query.storageId,a),r);break;default:r=t.buildWebDavFilesPath(this.user.id,this.target||"/"),r+=`/${o}`,i=this.$client.files.move(t.buildWebDavFilesPath(this.user.id,a),r)}break;case Rs:switch(this.$route.params.context){case"public":r=`${this.target||"/"}`,r+=`/${o}`,i=this.$client.publicFiles.copy(a,r,this.publicLinkPassword);break;case"space":r=t.buildWebDavSpacesPath(this.$route.query.storageId,this.target||"/"),o=e.basename(a),r+=`/${o}`,i=this.$client.files.copy(t.buildWebDavSpacesPath(this.$route.query.storageId,a),r);break;default:r=t.buildWebDavFilesPath(this.user.id,this.target||"/"),r+=`/${o}`,i=this.$client.files.copy(t.buildWebDavFilesPath(this.user.id,a),r)}break;default:return}await i.catch((e=>{e.resource=o,s.push(e)}))}}if(0===s.length)return void this.leaveLocationPicker(this.target);let a="";if(1!==s.length){switch(this.currentAction){case Es:a=this.$gettext("Failed to move %{count} resources");break;case Rs:a=this.$gettext("Failed to copy %{count} resources");break;default:return}this.showMessage({title:this.$gettextInterpolate(a,{count:s.length}),status:"danger"})}else{switch(this.currentAction){case Es:a=this.$gettext('Failed to move "%{resourceName}"');break;case Rs:a=this.$gettext('Failed to copy "%{resourceName}"');break;default:return}this.showMessage({title:this.$gettextInterpolate(a,{resourceName:s[0].resource},!0),status:"danger"})}}}};var ks=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("main",{staticClass:"oc-flex oc-height-1-1",attrs:{id:"files-location-picker"}},[s("div",{staticClass:"files-list-wrapper oc-width-expand",attrs:{tabindex:"-1"}},[s("div",{staticClass:"oc-p-s",attrs:{id:"files-location-picker-app-bar"}},[s("h1",{staticClass:"location-picker-selection-info oc-mb",domProps:{textContent:e._s(e.title)}}),e._v(" "),s("p",{staticClass:"oc-text-muted oc-text-meta",attrs:{"data-testid":"location-picker-current-hint"},domProps:{textContent:e._s(e.currentHint)}}),e._v(" "),s("hr",{staticClass:"oc-mt-rm"}),e._v(" "),s("oc-breadcrumb",{staticClass:"oc-mb-s",attrs:{items:e.breadcrumbs}}),e._v(" "),s("oc-grid",{staticClass:"oc-flex-middle",attrs:{gutter:"small",flex:""}},[s("div",[s("oc-button",{attrs:{id:"location-picker-btn-cancel",size:"small"},on:{click:function(t){return e.leaveLocationPicker(e.originalLocation)}}},[s("translate",[e._v("Cancel")])],1)],1),e._v(" "),s("div",[s("oc-button",{attrs:{id:"location-picker-btn-confirm",variation:"primary",appearance:"filled",size:"small",disabled:!e.canConfirm},on:{click:e.confirmAction}},[s("span",{domProps:{textContent:e._s(e.confirmBtnText)}})])],1)])],1),e._v(" "),s("div",{attrs:{id:"files-view"}},[e.loadResourcesTask.isRunning?s("app-loading-spinner"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-location-picker-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources in this folder.")])]},proxy:!0}],null,!1,3449492595)}):s("resource-table",{staticClass:"files-table",attrs:{id:"files-location-picker-table","are-thumbnails-displayed":!1,resources:e.paginatedResources,disabled:e.disabledResources,"target-route":e.targetRoute,"has-actions":!1,"is-selectable":!1,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{sort:e.handleSort},scopedSlots:e._u([{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}])})]],2)])])};ks._withStripped=!0;const Is=e.normalizeComponent({render:ks,staticRenderFns:[]},undefined,Ts,"data-v-54c76fb1",false,undefined,!1,void 0,void 0,void 0);const Ds={data:()=>({loading:!0,errorMessage:null}),computed:{...e.mapGetters(["configuration","user"]),pageTitle(){return this.$gettext(this.$route.meta.title)}},async mounted(){this.loading=!0;try{let i=await this.$client.files.getPathForFileId(this.$route.params.fileId);i=t.buildWebDavFilesPath(this.user.id,i);let a=await this.$client.files.fileInfo(i,s.DavProperties.Default);a=t.buildResource(a);const r={},o={};a.isFolder?r.item=a.path||"":(r.item=e.path.dirname(a.path),o.scrollTo=a.name),this.$router.push(V("files-spaces-personal-home",{params:r,query:o}))}catch(e){console.error(e),this.errorMessage=e}finally{this.loading=!1}}};var Ps=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-height-1-1 oc-link-resolve"},[s("h1",{staticClass:"oc-invisible-sr"},[e._v(e._s(e.pageTitle))]),e._v(" "),s("div",{staticClass:"oc-card oc-border oc-rounded oc-position-center oc-text-center oc-width-large"},[e.loading?[s("div",{staticClass:"oc-card-header"},[s("h2",{key:"private-link-loading"},[s("translate",[e._v("Resolving private link…")])],1)]),e._v(" "),s("div",{staticClass:"oc-card-body"},[s("oc-spinner",{attrs:{"aria-hidden":!0}})],1)]:e.errorMessage?[s("div",{staticClass:"oc-card-header oc-link-resolve-error-title"},[s("h2",{key:"private-link-error"},[s("translate",[e._v("An error occurred while resolving the private link")])],1)]),e._v(" "),s("div",{staticClass:"oc-card-body oc-link-resolve-error-message"},[s("p",{staticClass:"oc-text-lead"},[e._v(e._s(e.errorMessage))])])]:e._e(),e._v(" "),s("div",{staticClass:"oc-card-footer"},[s("p",[e._v("\n        "+e._s(e.configuration.currentTheme.general.slogan)+"\n      ")])])],2)])};Ps._withStripped=!0;const Ls=e.normalizeComponent({render:Ps,staticRenderFns:[]},undefined,Ds,undefined,false,undefined,!1,void 0,void 0,void 0);var As={computed:{...e.mapGetters("Files",["totalFilesCount"])},methods:{accessibleBreadcrumb_focusAndAnnounceBreadcrumb(t){const s=e.last(document.getElementById("files-breadcrumb").children[0].children),i=s.lastChild;if(!i)return;const a=this.totalFilesCount.files+this.totalFilesCount.folders,r=this.$gettextInterpolate(this.$ngettext("This folder contains %{ amount } item.","This folder contains %{ amount } items.",a),{amount:a}),o=a>0?r:this.$gettext("This folder has no content.");document.querySelectorAll(".oc-breadcrumb-sr").forEach((e=>e.remove()));const n=document.createElement("p");n.className="oc-invisible-sr oc-breadcrumb-sr",n.innerHTML=o,s.append(n),t&&i.focus()}}};const Ms={filters:{toInt:e=>parseInt(e)},mixins:[L,be],props:{items:{type:Array,default:()=>[],required:!0}}};var Os=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ul",{staticClass:"oc-list oc-list-divider oc-ml-rm oc-mr-rm"},e._l(e.items,(function(t){return s("li",{key:t.id},[s("div",{staticClass:"oc-flex oc-flex-middle"},[s("oc-icon",{staticClass:"oc-mr-s",attrs:{name:"file-copy2"}}),e._v(" "),s("div",{staticClass:"oc-width-expand"},[s("div",{staticClass:"oc-flex"},[s("div",{staticClass:"oc-text-bold oc-width-expand oc-text-truncate upload-details-item-name"},[e._v("\n            "+e._s(t.name)+"\n          ")]),e._v(" "),s("div",{staticClass:"oc-width-auto oc-text-nowrap upload-details-item-size"},[e._v("\n            "+e._s(e.getResourceSize(t.size))+"\n          ")])]),e._v(" "),s("div",{staticClass:"oc-m-rm oc-position-relative oc-width-expand"},[s("oc-progress",{staticClass:"oc-width-expand oc-m-rm",attrs:{"aria-hidden":!0,max:100,value:e._f("toInt")(t.progress)}}),e._v(" "),s("span",{staticClass:"oc-position-center oc-progress-text",attrs:{"aria-hidden":!0}},[e._v("\n            "+e._s(e._f("roundNumber")(t.progress))+" %\n          ")])],1)])],1)])})),0)};Os._withStripped=!0;const Ns={name:"UploadProgress",components:{DetailsWidget:e.normalizeComponent({render:Os,staticRenderFns:[]},undefined,Ms,undefined,false,undefined,!1,void 0,void 0,void 0)},mixins:[L],data(){return{expanded:!1,announcement:"",announcementOnComplete:this.$gettext("Upload complete")}},computed:{...e.mapGetters("Files",["inProgress","uploaded"]),count(){return this.inProgress.length},totalUploadProgress(){let e=0,t=0;for(const s of this.inProgress)e+=s.size,t+=s.size*s.progress/100;for(const s of this.uploaded)e+=s.size,t+=s.size;return this.inProgress.length>0&&e>0?t/e*100:100},uploadPending(){return this.totalUploadProgress<100}},watch:{totalUploadProgress(e){100===e&&(this.expanded=!1,this.announcement=this.announcementOnComplete)}},created(){this.$root.$on("upload-start",(()=>{this.$nextTick((()=>{this.delayForScreenreader((()=>this.$refs.progressbar.$el.focus()))}))})),window.addEventListener("beforeunload",this.confirmUnload)},beforeDestroy(){window.removeEventListener("beforeunload",this.confirmUnload)},methods:{$_toggleExpanded(){this.expanded=!this.expanded},confirmUnload(e){this.uploadPending&&(e.preventDefault(),e.returnValue="")}}};var Us=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-upload-progress oc-clearfix oc-py-rm"},[s("div",{staticClass:"oc-m-rm oc-position-relative oc-width-expand"},[s("oc-progress",{ref:"progressbar",staticClass:"oc-width-expand oc-m-rm",attrs:{"aria-hidden":!0,max:100,value:e.totalUploadProgress}}),e._v(" "),s("span",{staticClass:"oc-position-center oc-progress-text",attrs:{"aria-hidden":!0}},[e._v("\n      "+e._s(e._f("roundNumber")(e.totalUploadProgress))+" %\n    ")]),e._v(" "),s("oc-hidden-announcer",{attrs:{announcement:e.announcement,level:"assertive"}})],1),e._v(" "),s("oc-grid",{staticClass:"oc-mt-s oc-mb-s oc-text-muted oc-cursor-pointer",attrs:{flex:"","aria-label":e.$gettext("Click row to toggle upload progress details")},nativeOn:{click:function(t){return e.$_toggleExpanded.apply(null,arguments)}}},[s("oc-icon",{staticClass:"oc-width-auto",attrs:{name:e.expanded?"arrow-up-s":"arrow-down-s","fill-type":"line"}}),e._v(" "),s("div",{staticClass:"oc-width-expand oc-text-truncate"},[1===e.count?s("span",{directives:[{name:"translate",rawName:"v-translate",value:{fileName:e.inProgress[0].name},expression:"{ fileName: inProgress[0].name }"}],key:"upload-progress-single",attrs:{id:"files-upload-progress-single","translate-comment":"Upload progress when only uploading one file shows the name of the file."}},[e._v('\n        Uploading "%{ fileName }"\n      ')]):s("span",{directives:[{name:"translate",rawName:"v-translate",value:{count:e.count},expression:"{ count }"}],key:"upload-progress-multi",attrs:{id:"files-upload-progress-multi","translate-n":e.count,"translate-plural":"Uploading %{ count } items","translate-comment":"Upload progress when uploading multiple files only shows the number of uploads."}},[e._v("\n        Uploading %{ count } item\n      ")])]),e._v(" "),s("div",{staticClass:"oc-width-auto"},[e.expanded?s("span",{directives:[{name:"translate",rawName:"v-translate"}],key:"upload-progress-collapse-details",attrs:{id:"files-upload-progress-collapse-details","translate-comment":"Hide details panel of upload progress"}},[e._v("\n        Hide Details\n      ")]):s("span",{directives:[{name:"translate",rawName:"v-translate"}],key:"upload-progress-expand-details",attrs:{id:"files-upload-progress-expand-details","translate-comment":"Show details panel of upload progress"}},[e._v("\n        Show Details\n      ")])])],1),e._v(" "),e.expanded?s("details-widget",{staticClass:"oc-width-expand oc-upload-details-scrollable",attrs:{items:e.inProgress}}):e._e()],1)};Us._withStripped=!0;const zs=e.normalizeComponent({render:Us,staticRenderFns:[]},undefined,Ns,"data-v-a5ae380a",false,undefined,!1,void 0,void 0,void 0);const Bs={components:{vueDropzone:e.vue2Dropzone},mixins:[L],props:{rootPath:{type:String,required:!0},path:{type:String,required:!0},headers:{type:Object,default:()=>({})},requestType:{type:String,default:"PUT"}},setup:()=>({isPublicLocation:Ze(de,"files-public-files"),activeApp:a.useActiveApp()}),data:()=>({ocDropzone_options:{url:"#",clickable:!1,autoQueue:!1}}),computed:{...e.mapState(["navigation","user"]),...e.mapGetters(["getNavItemsByExtension"]),...e.mapGetters("Files",["dropzone"]),hasSidebarNavItems(){return!this.isPublicLocation&&(this.getNavItemsByExtension(this.activeApp)||[]).length},sidebarStateClass(){return this.hasSidebarNavItems?this.navigation.closed?"oc-dropzone-navigation-collapsed":"oc-dropzone-navigation-expanded":"oc-dropzone-navigation-hidden"}},methods:{...e.mapActions("Files",["dragOver"]),$_ocDropzone_dragEnd(){this.dragOver(!1)},$_ocDropzone_removeFiles(e){this.$refs.ocDropzone.removeFile(e)}}};var Gs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.dropzone?s("div",{class:[e.sidebarStateClass]},[s("vue-dropzone",{ref:"ocDropzone",staticClass:"oc-dropzone-container",class:[e.sidebarStateClass],attrs:{id:"oc-dropzone",options:e.ocDropzone_options,"use-custom-slot":!0,"include-styling":!1},on:{"vdropzone-drop":e.$_ocUpload_addDropToQueue,"vdropzone-files-added":e.$_ocDropzone_dragEnd,"vdropzone-file-added":e.$_ocDropzone_removeFiles,"vdropzone-drag-leave":e.$_ocDropzone_dragEnd}},[s("oc-dropzone",[s("translate",[e._v(" Drag and drop to upload content into current folder ")])],1)],1)],1):e._e()};Gs._withStripped=!0;const qs=e.normalizeComponent({render:Gs,staticRenderFns:[]},undefined,Bs,undefined,false,undefined,!1,void 0,void 0,void 0);const Vs={mixins:[L],props:{path:{type:String,required:!0},headers:{type:Object,default:()=>({})},additionalData:{type:Object,default:()=>({})},requestType:{type:String,default:"PUT"}},computed:{...e.mapState(["user"])},methods:{triggerUpload(){this.$refs.input.click()}}};var js=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("oc-button",{staticClass:"oc-width-1-1",attrs:{"justify-content":"left",appearance:"raw"},on:{click:e.triggerUpload}},[s("oc-resource-icon",{attrs:{resource:{extension:""}}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{id:"files-file-upload-button"}},[e._v("Files")])],1),e._v(" "),s("input",{ref:"input",attrs:{id:"fileUploadInput",type:"file","aria-labelledby":"files-file-upload-button",name:"file",multiple:"",tabindex:"-1"},on:{change:e.$_ocUpload_addFileToQueue}})],1)};js._withStripped=!0;const Hs=e.normalizeComponent({render:js,staticRenderFns:[]},undefined,Vs,"data-v-468e6832",false,undefined,!1,void 0,void 0,void 0);const Ws={mixins:[L],props:{rootPath:{type:String,required:!0},path:{type:String,required:!0},headers:{type:Object,default:()=>({})},additionalData:{type:Object,default:()=>({})},requestType:{type:String,default:"PUT"}},methods:{triggerUpload(){this.$refs.input.click()}}};var Qs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("oc-button",{staticClass:"oc-width-1-1",attrs:{"justify-content":"left",appearance:"raw"},on:{click:e.triggerUpload}},[s("oc-resource-icon",{attrs:{resource:{isFolder:!0,extension:""}}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{id:"files-folder-upload-button"}},[e._v("Folder")])],1),e._v(" "),s("input",{ref:"input",attrs:{id:"folderUploadInput",type:"file",name:"folder","aria-labelledby":"files-folder-upload-button",webkitdirectory:"",mozdirectory:"",allowdirs:"",tabindex:"-1"},on:{change:e.$_ocUpload_addDirectoryToQueue}})],1)};Qs._withStripped=!0;const Ys={components:{FileDrop:qs,FileUpload:Hs,FolderUpload:e.normalizeComponent({render:Qs,staticRenderFns:[]},undefined,Ws,"data-v-d2a176c8",false,undefined,!1,void 0,void 0,void 0)},mixins:[L,It],setup:()=>({isPersonalLocation:Ze(Q,"files-spaces-personal-home"),isPublicLocation:Ze(de,"files-public-files"),isSpacesProjectsLocation:Ze(Q,"files-spaces-projects"),isSpacesProjectLocation:Ze(Q,"files-spaces-project")}),data:()=>({newFileAction:null,path:"",fileFolderCreationLoading:!1}),computed:{...e.mapGetters(["getToken","capabilities","configuration","newFileHandlers","user"]),...e.mapGetters("Files",["files","currentFolder","publicLinkPassword"]),mimetypesAllowedForCreation(){const e=this.$store.getters["External/mimeTypes"];return e&&e.filter((e=>e.allow_creation))||[]},currentPath(){const e=this.$route.params.item||"";return e.endsWith("/")?e:e+"/"},headers(){if(this.isPublicLocation){const t=this.publicLinkPassword;return t?{Authorization:"Basic "+e.Buffer.from("public:"+t).toString("base64")}:{}}return{Authorization:"Bearer "+this.getToken}},showActions(){return!(this.uploadOrFileCreationBlocked&&this.isPublicLocation)},createFileActionsAvailable(){return this.newFileHandlers.length>0||this.mimetypesAllowedForCreation.length>0},newButtonTooltip(){return this.canUpload?this.hasFreeSpace?null:this.$gettext("You have not enough space left to create new files!"):this.$gettext("You have no permission to create new files!")},newButtonAriaLabel(){const e=this.newButtonTooltip;return e||(this.createFileActionsAvailable?this.$gettext("Create new files or folders"):this.$gettext("Create a new folder"))},uploadButtonTooltip(){return this.canUpload?this.hasFreeSpace?null:this.$gettext("You have not enough space left to upload!"):this.$gettext("You have no permission to upload!")},uploadButtonAriaLabel(){const e=this.uploadButtonTooltip;return e||this.$gettext("Upload files or folders")},uploadOrFileCreationBlocked(){return!this.canUpload||!this.hasFreeSpace},canUpload(){return!!this.currentFolder&&this.currentFolder.canUpload({user:this.user})},hasFreeSpace(){return!this.quota||this.quota.free>0||this.currentFolder&&this.currentFolder.permissions&&this.currentFolder.permissions.indexOf("M")>=0||this.isPublicLocation}},methods:{...e.mapActions("Files",["updateFileProgress","loadIndicators"]),...e.mapActions(["showMessage","createModal","setModalInputErrorMessage"]),...e.mapMutations("Files",["UPSERT_RESOURCE"]),...e.mapMutations(["SET_QUOTA"]),async onFileSuccess(i,a){try{a.name&&(a=a.name),await this.$nextTick();let i,r=e.path.join(this.currentPath,a);this.isPersonalLocation?(r=t.buildWebDavFilesPath(this.user.id,r),i=await this.$client.files.fileInfo(r,s.DavProperties.Default)):this.isSpacesProjectLocation?(r=t.buildWebDavSpacesPath(this.$route.params.storageId,r),i=await this.$client.files.fileInfo(r,s.DavProperties.Default)):i=await this.$client.publicFiles.getFileInfo(r,this.publicLinkPassword,s.DavProperties.PublicLink),i=t.buildResource(i),this.UPSERT_RESOURCE(i),this.isPersonalLocation&&this.loadIndicators({client:this.$client,currentFolder:this.currentFolder.path,encodePath:this.encodePath});const o=await this.$client.users.getUser(this.user.id);this.SET_QUOTA(o.quota)}catch(e){console.error(e)}},onFileError(e){console.error(e),this.showMessage({title:this.$gettext("Failed to upload"),status:"danger"})},onFileProgress(e){this.updateFileProgress(e)},showCreateResourceModal(e=!0,t="txt",s=null,i=!1){const a=e?this.$gettext("New folder"):this.$gettext("New file")+"."+t;e||(this.newFileAction=s);const r={variation:"passive",title:e?this.$gettext("Create a new folder"):this.$gettext("Create a new file"),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Create"),hasInput:!0,inputValue:a,inputLabel:e?this.$gettext("Folder name"):this.$gettext("File name"),inputError:e?this.checkNewFolderName(a):this.checkNewFileName(a),onCancel:this.hideModal,onConfirm:e?this.addNewFolder:i?this.addAppProviderFile:this.addNewFile,onInput:t=>{this.setModalInputErrorMessage(e?this.checkNewFolderName(t):this.checkNewFileName(t))}};this.createModal(r)},async addNewFolder(i){if(""!==i){this.fileFolderCreationLoading=!0;try{let a,r=e.path.join(this.currentPath,i);this.isPersonalLocation?(r=t.buildWebDavFilesPath(this.user.id,r),await this.$client.files.createFolder(r),a=await this.$client.files.fileInfo(r,s.DavProperties.Default)):this.isSpacesProjectLocation?(r=t.buildWebDavSpacesPath(this.$route.params.storageId,r),await this.$client.files.createFolder(r),a=await this.$client.files.fileInfo(r,s.DavProperties.Default)):(await this.$client.publicFiles.createFolder(r,null,this.publicLinkPassword),a=await this.$client.publicFiles.getFileInfo(r,this.publicLinkPassword,s.DavProperties.PublicLink)),a=t.buildResource(a),this.UPSERT_RESOURCE(a),this.hideModal(),this.isPersonalLocation&&this.loadIndicators({client:this.$client,currentFolder:this.currentFolder.path}),this.showMessage({title:this.$gettextInterpolate(this.$gettext('"%{folderName}" was created successfully'),{folderName:i})})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to create folder"),status:"danger"})}this.fileFolderCreationLoading=!1}},checkNewFolderName(e){if(""===e)return this.$gettext("Folder name cannot be empty");if(/[/]/.test(e))return this.$gettext('Folder name cannot contain "/"');if("."===e)return this.$gettext('Folder name cannot be equal to "."');if(".."===e)return this.$gettext('Folder name cannot be equal to ".."');if(/\s+$/.test(e))return this.$gettext("Folder name cannot end with whitespace");if(this.files.find((t=>t.name===e))){const t=this.$gettext("%{name} already exists");return this.$gettextInterpolate(t,{name:e},!0)}return null},async addNewFile(i){if(""!==i){this.fileFolderCreationLoading=!0;try{let a,r=e.path.join(this.currentPath,i);if(this.isPersonalLocation?(r=t.buildWebDavFilesPath(this.user.id,r),await this.$client.files.putFileContents(r,""),a=await this.$client.files.fileInfo(r,s.DavProperties.Default)):this.isSpacesProjectLocation?(r=t.buildWebDavSpacesPath(this.$route.params.storageId,r),await this.$client.files.putFileContents(r,""),a=await this.$client.files.fileInfo(r,s.DavProperties.Default)):(await this.$client.publicFiles.putFileContents("",r,this.publicLinkPassword,""),a=await this.$client.publicFiles.getFileInfo(r,this.publicLinkPassword,s.DavProperties.PublicLink)),this.UPSERT_RESOURCE(t.buildResource(a)),this.newFileAction){const e=a.fileInfo[s.DavProperty.FileId];return this.$_fileActions_openEditor(this.newFileAction,r,e,"create"),void this.hideModal()}this.hideModal(),this.isPersonalLocation&&this.loadIndicators({client:this.$client,currentFolder:this.currentFolder.path}),this.showMessage({title:this.$gettextInterpolate(this.$gettext('"%{fileName}" was created successfully'),{fileName:i})})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to create file"),status:"danger"})}this.fileFolderCreationLoading=!1}},async addAppProviderFile(i){if(""!==i)try{const a=this.currentFolder.fileId,r=(this.$router.currentRoute.params.item||"").split("/")[0],o=this.configuration.server,n=o+this.capabilities.files.app_providers[0].new_url.replace(/^\/+/,"")+`?parent_container_id=${a}&filename=${encodeURIComponent(i)}`,l={"X-Requested-With":"XMLHttpRequest",...this.isPublicLocation&&r&&{"public-token":r},...this.isPublicLocation&&this.publicLinkPassword&&{Authorization:"Basic "+e.Buffer.from(["public",this.publicLinkPassword].join(":")).toString("base64")},...this.getToken&&{Authorization:"Bearer "+this.getToken}},c=await fetch(n,{method:"POST",headers:l});if(200!==c.status)throw new Error(`An error has occurred: ${c.status}`);let d,u=e.path.join(this.currentPath,i);this.isPersonalLocation?(u=t.buildWebDavFilesPath(this.user.id,u),d=await this.$client.files.fileInfo(u,s.DavProperties.Default)):this.isSpacesProjectLocation?(u=t.buildWebDavSpacesPath(this.$route.params.storageId,u),d=await this.$client.files.fileInfo(u,s.DavProperties.Default)):d=await this.$client.publicFiles.getFileInfo(u,this.publicLinkPassword,s.DavProperties.PublicLink),d=t.buildResource(d),this.$_fileActions_triggerDefaultAction(d),this.UPSERT_RESOURCE(d),this.hideModal(),this.isPersonalLocation&&this.loadIndicators({client:this.$client,currentFolder:this.currentFolder.path}),this.showMessage({title:this.$gettextInterpolate(this.$gettext('"%{fileName}" was created successfully'),{fileName:i})})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to create file"),status:"danger"})}},checkNewFileName(e){if(""===e)return this.$gettext("File name cannot be empty");if(/[/]/.test(e))return this.$gettext('File name cannot contain "/"');if("."===e)return this.$gettext('File name cannot be equal to "."');if(".."===e)return this.$gettext('File name cannot be equal to ".."');if(/\s+$/.test(e))return this.$gettext("File name cannot end with whitespace");if(this.files.find((t=>t.name===e))){const t=this.$gettext("%{name} already exists");return this.$gettextInterpolate(t,{name:e},!0)}return null}}};var Js=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.showActions?s("div",{staticClass:"oc-flex-inline oc-width-1-1",staticStyle:{gap:"15px"}},[e.createFileActionsAvailable?[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.newButtonTooltip,expression:"newButtonTooltip"}],key:"new-file-menu-btn-enabled",attrs:{id:"new-file-menu-btn","aria-label":e.newButtonAriaLabel,appearance:"filled",variation:"primary",disabled:e.uploadOrFileCreationBlocked}},[s("oc-icon",{attrs:{name:"add"}}),e._v(" "),s("translate",[e._v("New")])],1),e._v(" "),s("oc-drop",{staticClass:"oc-width-auto",attrs:{"drop-id":"new-file-menu-drop",toggle:"#new-file-menu-btn",mode:"click","close-on-click":"","padding-size":"small"}},[s("oc-list",{attrs:{id:"create-list"}},[s("li",{staticClass:"create-list-folder"},[s("oc-button",{attrs:{id:"new-folder-btn",appearance:"raw"},on:{click:e.showCreateResourceModal}},[s("oc-resource-icon",{attrs:{resource:{isFolder:!0,extension:""}}}),e._v(" "),s("translate",[e._v("Folder")])],1)],1),e._v(" "),e._l(e.newFileHandlers,(function(t,i){return s("li",{key:i,staticClass:"create-list-file"},[s("oc-button",{class:["new-file-btn-"+t.ext],attrs:{appearance:"raw"},on:{click:function(s){return e.showCreateResourceModal(!1,t.ext,t.action)}}},[s("oc-resource-icon",{attrs:{resource:{type:"file",extension:t.ext}}}),e._v(" "),s("span",[e._v(e._s(t.menuTitle(e.$gettext)))])],1)],1)})),e._v(" "),e.mimetypesAllowedForCreation?e._l(e.mimetypesAllowedForCreation,(function(t,i){return s("li",{key:i,staticClass:"create-list-file"},[s("oc-button",{attrs:{appearance:"raw"},on:{click:function(s){return e.showCreateResourceModal(!1,t.ext,!1,!0)}}},[s("oc-resource-icon",{attrs:{resource:{type:"file",extension:t.ext}}}),e._v(" "),s("translate",{attrs:{"translate-params":{name:t.name}}},[e._v("%{name}")])],1)],1)})):e._e()],2)],1)]:[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.newButtonAriaLabel,expression:"newButtonAriaLabel"}],attrs:{id:"new-folder-btn",appearance:"filled",variation:"primary","aria-label":e.newButtonAriaLabel,disabled:e.uploadOrFileCreationBlocked},on:{click:e.showCreateResourceModal}},[s("oc-icon",{attrs:{name:"resource-type-folder"}}),e._v(" "),s("translate",[e._v("New folder")])],1)],e._v(" "),e.uploadOrFileCreationBlocked?e._e():s("file-drop",{attrs:{"root-path":e.currentPath,path:e.currentPath,headers:e.headers},on:{success:e.onFileSuccess,error:e.onFileError,progress:e.onFileProgress}}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.uploadButtonTooltip,expression:"uploadButtonTooltip"}],key:"upload-menu-btn-enabled",attrs:{id:"upload-menu-btn","aria-label":e.uploadButtonAriaLabel,disabled:e.uploadOrFileCreationBlocked}},[s("oc-icon",{attrs:{name:"upload","fill-type":"line"}}),e._v(" "),s("translate",[e._v("Upload")])],1),e._v(" "),s("oc-drop",{staticClass:"oc-width-auto",attrs:{"drop-id":"upload-menu-drop",toggle:"#upload-menu-btn",mode:"click","close-on-click":"","padding-size":"small"}},[s("oc-list",{attrs:{id:"upload-list"}},[s("li",[s("folder-upload",{attrs:{"root-path":e.currentPath,path:e.currentPath,headers:e.headers},on:{success:e.onFileSuccess,error:e.onFileError,progress:e.onFileProgress}})],1),e._v(" "),s("li",[s("file-upload",{attrs:{path:e.currentPath,headers:e.headers},on:{success:e.onFileSuccess,error:e.onFileError,progress:e.onFileProgress}})],1)])],1)],2):e._e()};Js._withStripped=!0;const Ks=e.normalizeComponent({render:Js,staticRenderFns:[]},undefined,Ys,"data-v-611e359f",false,undefined,!1,void 0,void 0,void 0);const Zs={name:"NotFoundMessage",setup(){const e=i.useRouter(),t=s.useStore();return{showPublicLinkButton:de(e,"files-public-files"),showHomeButton:Q(e,"files-spaces-personal-home"),showSpacesButton:Q(e,"files-spaces-project"),homeRoute:V("files-spaces-personal-home",{params:{item:t.getters.homeFolder}}),publicLinkRoute:ne("files-public-files",{params:{item:e.currentRoute.params?.item?.split("/")[0]}}),spacesRoute:V("files-spaces-projects")}}};var Xs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-text-center oc-flex-middle oc-flex oc-flex-center oc-flex-column",attrs:{id:"files-list-not-found-message"}},[s("oc-icon",{attrs:{name:"cloud",type:"div",size:"xxlarge"}}),e._v(" "),s("div",{staticClass:"oc-text-muted oc-text-large"},[s("translate",[e._v("Resource not found")])],1),e._v(" "),s("div",{staticClass:"oc-text-muted"},[s("translate",[e._v("\n      We went looking everywhere, but were unable to find the selected resource.\n    ")])],1),e._v(" "),s("div",{staticClass:"oc-mt-s"},[e.showSpacesButton?s("oc-button",{attrs:{id:"space-not-found-button-go-spaces",type:"router-link",appearance:"raw",to:e.spacesRoute}},[s("translate",[e._v("Go to »Spaces Overview«")])],1):e._e(),e._v(" "),e.showHomeButton?s("oc-button",{attrs:{id:"files-list-not-found-button-go-home",type:"router-link",appearance:"raw",to:e.homeRoute}},[s("translate",[e._v("Go to »Personal« page")])],1):e._e(),e._v(" "),e.showPublicLinkButton?s("oc-button",{attrs:{id:"files-list-not-found-button-reload-link",type:"router-link",appearance:"raw",to:e.publicLinkRoute}},[s("translate",[e._v("Reload public link")])],1):e._e()],1)],1)};Xs._withStripped=!0;const ei=e.normalizeComponent({render:Xs,staticRenderFns:[]},undefined,Zs,undefined,false,undefined,!1,void 0,void 0,void 0),ti=(e,t)=>{const s=(e="")=>e.split("/").filter(Boolean),i=s(e),a=s(t);return a.map(((e,t)=>({allowContextActions:!0,text:e,to:"/"+[...i].splice(0,i.length-a.length+t+1).join("/")})))},si=(...e)=>{const t=e.pop();return[...e,{allowContextActions:t.allowContextActions,text:t.text,onClick:()=>r.bus.publish("app.files.list.load")}]},ii=new e.VisibilityObserver;const ai=e.defineComponent({components:{AppBar:ds,ProgressBar:zs,CreateAndUpload:Ks,ResourceTable:gt,ListInfo:gs,Pagination:bs,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,NotFoundMessage:ei,ContextActions:Jt},mixins:[As,It,Pt],setup:()=>({...Ke()}),computed:{...e.mapGetters("Files",["publicLinkPassword","currentFolder","highlightedFile","inProgress","totalFilesCount","totalFilesSize"]),...e.mapGetters(["configuration"]),...e.mapState("Files/sidebar",{sidebarClosed:"closed"}),$_uploadProgressVisible(){return this.inProgress.length>0},breadcrumbs(){const e=ti(this.$route.path,this.$route.params.item),t=e.shift();return si({text:this.$gettext("Public link"),to:t.to},...e)},isEmpty(){return this.paginatedResources.length<1},folderNotFound(){return null===this.currentFolder},targetRoute(){return{name:this.$route.name}},displayThumbnails(){return!this.configuration.options.disablePreviews}},watch:{$route:{handler:function(e,t){const s=e.name===t?.name,i=e.params?.item===t?.params?.item;s&&i||this.loadResourcesTask.perform(this,s)},immediate:!0}},beforeDestroy(){ii.disconnect()},created(){const e=r.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.$route.params.item===e,e)}));this.$on("beforeDestroy",(()=>r.bus.unsubscribe("app.files.list.load",e)))},methods:{...e.mapActions("Files",["loadPreview"]),...e.mapMutations("Files",["SET_CURRENT_FOLDER","LOAD_FILES","CLEAR_CURRENT_FILES_LIST"]),rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!0,dimensions:ut.Thumbnail,type:ht.Thumbnail})}),250);ii.observe(s.$el,{onEnter:i,onExit:i.cancel})},redirectToResolvePage(){this.$router.push(se("files-operations-resolver-public-link",{params:{token:this.$route.params.item}}))}}});var ri=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("app-bar",{attrs:{"has-bulk-actions":!0,breadcrumbs:e.breadcrumbs,"breadcrumbs-context-actions-items":[e.currentFolder]},scopedSlots:e._u([{key:"actions",fn:function(){return[s("create-and-upload")]},proxy:!0}])}),e._v(" "),e.loadResourcesTask.isRunning?s("app-loading-spinner"):[s("progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.$_uploadProgressVisible,expression:"$_uploadProgressVisible"}],staticClass:"oc-p-s",attrs:{id:"files-upload-progress"}}),e._v(" "),e.folderNotFound?s("not-found-message",{staticClass:"files-not-found oc-height-1-1"}):e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-public-list-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources in this folder")])]},proxy:!0},e.currentFolder.canCreate()?{key:"callToAction",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"data-testid":"public-files-call-to-action"}},[e._v('\n          Drag files and folders here or use the "New" or "Upload" buttons to add files\n        ')])]},proxy:!0}:null],null,!0)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-public-files-table","are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.targetRoute,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResources,callback:function(t){e.selectedResources=t},expression:"selectedResources"}})]],2)};ri._withStripped=!0;const oi=e.normalizeComponent({render:ri,staticRenderFns:[]},undefined,ai,undefined,false,undefined,!1,void 0,void 0,void 0);const ni={mixins:[L],data:()=>({loading:!0,errorMessage:null,firstTime:!0,passwordRequired:!1,password:null,inputErrorMessage:null}),computed:{...e.mapGetters(["configuration"]),...e.mapGetters("Files",["publicLinkPassword"]),pageTitle(){return this.$gettext(this.$route.meta.title)},passwordFieldLabel(){return this.$gettext("Enter password for public link")}},created(){this.resolvePublicLink()},methods:{...e.mapActions("Files",["setPublicLinkPassword"]),resolvePublicLink(){const e=this.password||this.publicLinkPassword;this.loading=!0,this.inputErrorMessage=null,this.$client.publicFiles.list(this.$route.params.token,e,s.DavProperties.PublicLink,"0").then((t=>{this.passwordRequired=!1,this.setPublicLinkPassword(e);const s="4"===t[0].getProperty(this.$client.publicFiles.PUBLIC_LINK_PERMISSION)?"files-public-drop":"files-public-files";this.$router.push(ne(s,{params:{item:this.$route.params.token}}))})).catch((e=>{401===e.statusCode?(this.passwordRequired=!0,this.firstTime||(this.inputErrorMessage=this.$gettext("Incorrect password")),this.firstTime=!1,this.loading=!1,this.$nextTick((()=>{this.$refs.passwordInput.focus()}))):this.errorMessage=e})).finally((()=>{this.loading=!1}))}}};var li=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-height-1-1 oc-link-resolve"},[s("h1",{staticClass:"oc-invisible-sr"},[e._v(e._s(e.pageTitle))]),e._v(" "),s("div",{staticClass:"oc-card oc-border oc-rounded oc-position-center oc-text-center oc-width-large"},[e.loading?[s("div",{staticClass:"oc-card-header"},[s("h2",{key:"public-link-loading"},[s("translate",[e._v("Loading public link…")])],1)]),e._v(" "),s("div",{staticClass:"oc-card-body"},[s("oc-spinner",{attrs:{"aria-hidden":!0}})],1)]:e.errorMessage?[s("div",{staticClass:"oc-card-header oc-link-resolve-error-title"},[s("h2",{key:"public-link-error"},[s("translate",[e._v("An error occurred while loading the public link")])],1)]),e._v(" "),s("div",{staticClass:"oc-card-body oc-link-resolve-error-message"},[s("p",{staticClass:"oc-text-lead"},[e._v(e._s(e.errorMessage))])])]:e.passwordRequired?[s("form",{on:{submit:function(t){return t.preventDefault(),e.resolvePublicLink.apply(null,arguments)}}},[s("div",{staticClass:"oc-card-header"},[s("h2",[s("translate",[e._v("This resource is password-protected")])],1)]),e._v(" "),s("div",{staticClass:"oc-card-body"},[s("oc-text-input",{ref:"passwordInput",staticClass:"oc-mb-s",attrs:{"error-message":e.inputErrorMessage,label:e.passwordFieldLabel,type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),s("oc-button",{staticClass:"oc-login-authorize-button",attrs:{variation:"primary",appearance:"filled",disabled:!e.password,submit:"submit"}},[s("translate",[e._v("Continue")])],1)],1)])]:e._e(),e._v(" "),s("div",{staticClass:"oc-card-footer"},[s("p",[e._v("\n        "+e._s(e.configuration.currentTheme.general.slogan)+"\n      ")])])],2)])};li._withStripped=!0;const ci=e.normalizeComponent({render:li,staticRenderFns:[]},undefined,ni,undefined,false,undefined,!1,void 0,void 0,void 0);var di={methods:{scrollToResource(e){let t=document.querySelector("#files-app-bar").getBoundingClientRect().bottom;t+=document.querySelector(".files-table thead").getBoundingClientRect().height,this.$scrollTo(`.oc-tbody-tr-${e.id}`,300,{offset:-t})}}};const ui=new e.VisibilityObserver;const hi=e.defineComponent({components:{AppBar:ds,ProgressBar:zs,CreateAndUpload:Ks,ResourceTable:gt,QuickActions:ps,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,NotFoundMessage:ei,ListInfo:gs,Pagination:bs,ContextActions:Jt},mixins:[As,It,di,Pt,Dt],setup:()=>({...Ke(),resourceTargetLocation:V("files-spaces-personal-home"),hasSpaces:P()}),computed:{...e.mapState(["app"]),...e.mapState("Files",["files"]),...e.mapState("Files/sidebar",{sidebarClosed:"closed"}),...e.mapGetters("Files",["highlightedFile","currentFolder","inProgress","totalFilesCount","totalFilesSize"]),...e.mapGetters(["user","homeFolder","configuration"]),$_uploadProgressVisible(){return this.inProgress.length>0},isEmpty(){return this.paginatedResources.length<1},breadcrumbs(){const e=this.hasSpaces?this.$gettext("Personal"):this.$gettext("All files");return si({text:e,to:"/"},...ti(this.$route.path,this.$route.params.item))},folderNotFound(){return null===this.currentFolder},displayThumbnails(){return!this.configuration.options.disablePreviews}},watch:{$route:{handler:function(t,s){if("/"!==this.homeFolder&&e.isNil(t.params.item)&&!t.path.endsWith("/"))return void this.$router.replace({name:t.name,params:{...t.params,item:this.homeFolder},query:t.query},(()=>{}),(e=>{console.error(e)}));const i=t.name===s?.name,a=t.params?.item===s?.params?.item;i&&a||this.loadResourcesTask.perform(this,i)},immediate:!0}},mounted(){const e=r.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.$route.params.item===e,e)}));this.$on("beforeDestroy",(()=>r.bus.unsubscribe("app.files.list.load",e)))},beforeDestroy(){ui.disconnect()},methods:{...e.mapActions("Files",["loadPreview"]),...e.mapActions(["showMessage"]),...e.mapMutations("Files",["REMOVE_FILE","REMOVE_FILE_FROM_SEARCHED","REMOVE_FILE_SELECTION"]),fetchResources:Te,async fileDropped(t){const s=[...this.selectedResources],i=this.paginatedResources.find((e=>e.id===t));if(s.some((e=>e.id===t)))return;if("folder"!==i.type)return;const a=await this.fetchResources(this.$client,i.webDavPath),r=[],o=[],n=new e._default({concurrency:4});let l;if(s.forEach((t=>{o.push(n.add((async()=>{if(a.some((s=>e.basename(s.name)===t.name))){const e=this.$gettext("Resource with name %{name} already exists");r.push({resourceName:t.name,message:this.$gettextInterpolate(e,{name:t.name},!0)})}else try{await this.$client.files.move(t.webDavPath,e.join(i.webDavPath,t.name)),this.REMOVE_FILE(t),this.REMOVE_FILE_FROM_SEARCHED(t),this.REMOVE_FILE_SELECTION(t)}catch(e){console.error(e),e.resourceName=t.name,r.push(e)}})))})),await Promise.all(o),0===r.length){const e=s.length;return l=this.$ngettext("%{count} item was moved successfully","%{count} items were moved successfully",e),void this.showMessage({title:this.$gettextInterpolate(l,{count:e}),status:"success"})}if(1===r.length)return l=this.$gettext('Failed to move "%{resourceName}"'),void this.showMessage({title:this.$gettextInterpolate(l,{resourceName:r[0]?.resourceName},!0),status:"danger"});l=this.$gettext("Failed to move %{count} resources"),this.showMessage({title:this.$gettextInterpolate(l,{count:r.length}),status:"danger"})},rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:ut.Thumbnail,type:ht.Thumbnail})}),250);ui.observe(s.$el,{onEnter:i,onExit:i.cancel})},scrollToResourceFromRoute(){const e=this.$route.query.scrollTo;e&&this.paginatedResources.length>0&&this.$nextTick((()=>{const t=this.paginatedResources.find((t=>t.name===e));t&&(this.selectedResources=[t],this.$_mountSideBar_showDefaultPanel(t),this.scrollToResource(t))}))}}});var pi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("app-bar",{attrs:{"has-bulk-actions":!0,breadcrumbs:e.breadcrumbs,"breadcrumbs-context-actions-items":[e.currentFolder]},scopedSlots:e._u([{key:"actions",fn:function(){return[s("create-and-upload")]},proxy:!0}])}),e._v(" "),e.loadResourcesTask.isRunning?s("app-loading-spinner"):[s("progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.$_uploadProgressVisible,expression:"$_uploadProgressVisible"}],staticClass:"oc-p-s",attrs:{id:"files-upload-progress"}}),e._v(" "),e.folderNotFound?s("not-found-message",{staticClass:"files-not-found oc-height-1-1"}):e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-personal-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources in this folder")])]},proxy:!0},{key:"callToAction",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v('\n          Drag files and folders here or use the "New" or "Upload" buttons to add files\n        ')])]},proxy:!0}])}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-personal-table","are-thumbnails-displayed":e.displayThumbnails,resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"header-position":e.fileListHeaderY,"drag-drop":!0,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileDropped:e.fileDropped,fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"quickActions",fn:function(t){var i=t.resource;return[s("quick-actions",{staticClass:"oc-visible@s",class:i.preview,attrs:{item:i,actions:e.app.quickActions}})]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResources,callback:function(t){e.selectedResources=t},expression:"selectedResources"}})]],2)};pi._withStripped=!0;const mi=e.normalizeComponent({render:pi,staticRenderFns:[]},undefined,hi,undefined,false,undefined,!1,void 0,void 0,void 0),fi=new e.VisibilityObserver,gi=["name","status","owner","sdate","sharedWith"];const vi=e.defineComponent({components:{AppBar:ds,ResourceTable:gt,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,ListInfo:gs,ContextActions:Jt},mixins:[It,_t,St,Pt,Dt],setup(){const{fileListHeaderY:t,storeItems:i,fields:a,loadResourcesTask:r}=Ke(),o=e.computed((()=>parseInt(String(e.unref(l("view-mode",s.ShareStatus.accepted.toString())))))),n=e.computed((()=>e.unref(i).filter((e=>e.status===s.ShareStatus.pending)))),{sortBy:c,sortDir:d,items:u,handleSort:h}=Ge({items:n,fields:a,sortByQueryName:"pending-sort-by",sortDirQueryName:"pending-sort-dir"}),p=e.computed((()=>e.unref(i).filter((t=>t.status===e.unref(o))))),{sortBy:m,sortDir:f,items:g,handleSort:v}=Ge({items:p,fields:a,sortByQueryName:"shares-sort-by",sortDirQueryName:"shares-sort-dir"});return{fileListHeaderY:t,loadResourcesTask:r,viewMode:o,pendingHandleSort:h,pendingSortBy:c,pendingSortDir:d,pendingItems:u,sharesHandleSort:v,sharesSortBy:m,sharesSortDir:f,sharesItems:g,displayedFields:gi,resourceTargetLocation:V("files-spaces-personal-home")}},data:()=>({ShareStatus:s.ShareStatus,showMorePending:!1}),computed:{...e.mapGetters("Files",["selectedFiles"]),...e.mapGetters(["configuration","getToken"]),...e.mapState("Files/sidebar",{sidebarClosed:"closed"}),pendingSelected:{get(){return this.selectedFiles.filter((e=>e.status===s.ShareStatus.pending))},set(e){this.SET_FILE_SELECTION(e.filter((e=>e.status===s.ShareStatus.pending)))}},pendingTitle(){return this.$gettext("Pending shares")},pendingHasMore(){return this.pendingCount>3},pendingToggleMoreLabel(){return this.showMorePending?this.$gettext("Show less"):this.$gettext("Show more")},hasPending(){return this.pendingCount>0},pendingCount(){return this.pendingItems.length},showsAcceptedShares(){return this.viewMode===s.ShareStatus.accepted},showsDeclinedShares(){return this.viewMode===s.ShareStatus.declined},sharesSelected:{get(){return this.selectedFiles.filter((e=>e.status===this.viewMode))},set(e){this.SET_FILE_SELECTION(e.filter((e=>e.status===this.viewMode)))}},sharesTitle(){return this.showsDeclinedShares?this.$gettext("Declined shares"):this.$gettext("Accepted shares")},sharesToggleLabel(){return this.showsDeclinedShares?this.$gettext("Show accepted shares"):this.$gettext("Show declined shares")},sharesEmptyMessage(){return this.showsDeclinedShares?this.$gettext("You don't have any previously declined shares."):this.$gettext("You are not collaborating on other people's resources.")},hasShares(){return this.sharesCount>0},sharesCount(){return this.sharesItems.length},sharesCountFiles(){return this.sharesItems.filter((e=>"folder"!==e.type)).length},sharesCountFolders(){return this.sharesItems.filter((e=>"folder"===e.type)).length},sharesInvertedViewMode(){return this.showsAcceptedShares?s.ShareStatus.declined:s.ShareStatus.accepted},sharesToggleRouterLink(){return{name:this.$route.name,params:{...this.$route.params},query:{...this.$route.query,"view-mode":this.sharesInvertedViewMode}}},displayThumbnails(){return!this.configuration.options.disablePreviews&&this.viewMode===s.ShareStatus.accepted}},created(){this.loadResourcesTask.perform()},beforeDestroy(){fi.disconnect()},methods:{...e.mapActions("Files",["loadIndicators","loadPreview","loadAvatars"]),...e.mapActions(["showMessage"]),...e.mapMutations("Files",["LOAD_FILES","SET_FILE_SELECTION","CLEAR_CURRENT_FILES_LIST"]),rowMounted(t,s){const i=e.debounce((({unobserve:e})=>{e(),this.loadAvatars({resource:t}),this.displayThumbnails&&this.loadPreview({resource:t,isPublic:!1,dimensions:ut.Thumbnail,type:ht.Thumbnail})}),250);fi.observe(s.$el,{onEnter:i,onExit:i.cancel})},togglePendingShowMore(){this.showMorePending=!this.showMorePending},isResourceInPendingSelection(e){return this.pendingSelected?.includes(e)},isResourceInSharesSelection(e){return this.sharesSelected?.includes(e)}}});var _i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex oc-flex-column"},[s("app-bar",{attrs:{"has-shares-navigation":!0,"has-bulk-actions":!0}}),e._v(" "),e.loadResourcesTask.isRunning?s("app-loading-spinner"):[e.hasPending?s("div",[s("h2",{staticClass:"oc-px-m oc-py-s"},[e._v("\n        "+e._s(e.pendingTitle)+"\n        "),s("span",{staticClass:"oc-text-initial"},[e._v("("+e._s(e.pendingCount)+")")])]),e._v(" "),s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-shared-with-me-pending-table","data-test-share-status":e.ShareStatus.pending,"fields-displayed":e.displayedFields,"are-thumbnails-displayed":e.displayThumbnails,resources:e.showMorePending?e.pendingItems:e.pendingItems.slice(0,3),"are-resources-clickable":!1,"header-position":e.fileListHeaderY,"sort-by":e.pendingSortBy,"sort-dir":e.pendingSortDir},on:{sort:e.pendingHandleSort},scopedSlots:e._u([{key:"status",fn:function(t){var i=t.resource;return[s("div",{key:i.id+i.status,staticClass:"oc-text-nowrap oc-flex oc-flex-middle oc-flex-right"},[s("oc-button",{staticClass:"file-row-share-status-accept",attrs:{size:"small",variation:"success"},on:{click:function(t){return t.stopPropagation(),e.$_acceptShare_trigger({resources:[i]})}}},[s("oc-icon",{attrs:{size:"small",name:"check"}}),e._v(" "),s("translate",[e._v("Accept")])],1),e._v(" "),s("oc-button",{staticClass:"file-row-share-decline oc-ml-s",attrs:{size:"small"},on:{click:function(t){return t.stopPropagation(),e.$_declineShare_trigger({resources:[i]})}}},[s("oc-icon",{attrs:{size:"small",name:"close"}}),e._v(" "),s("translate",[e._v("Decline")])],1)],1)]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInPendingSelection(i)?s("context-actions",{attrs:{items:e.pendingSelected}}):e._e()]}},e.pendingHasMore?{key:"footer",fn:function(){return[s("div",{staticClass:"oc-width-1-1 oc-text-center oc-mt"},[s("oc-button",{attrs:{id:"files-shared-with-me-pending-show-all",appearance:"raw","gap-size":"xsmall",size:"small","data-test-expand":(!e.showMorePending).toString()},on:{click:e.togglePendingShowMore}},[e._v("\n              "+e._s(e.pendingToggleMoreLabel)+"\n              "),s("oc-icon",{attrs:{name:"arrow-"+(e.showMorePending?"up":"down")+"-s","fill-type":"line"}})],1)],1)]},proxy:!0}:null],null,!0),model:{value:e.pendingSelected,callback:function(t){e.pendingSelected=t},expression:"pendingSelected"}})],1):e._e(),e._v(" "),s("h2",{staticClass:"oc-px-m oc-py-s"},[e._v("\n      "+e._s(e.sharesTitle)+"\n      "),s("span",{staticClass:"oc-text-initial"},[e._v("("+e._s(e.sharesCount)+")")]),e._v(" "),s("oc-button",{attrs:{id:"files-shared-with-me-toggle-view-mode",appearance:"raw",type:"router-link",to:e.sharesToggleRouterLink,"data-test-set-view-mode":e.sharesInvertedViewMode.toString()}},[e._v("\n        "+e._s(e.sharesToggleLabel)+"\n      ")])],1),e._v(" "),e.hasShares?s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-shared-with-me-shares-table","data-test-share-status":e.viewMode,"fields-displayed":e.displayedFields,"are-thumbnails-displayed":e.displayThumbnails,resources:e.sharesItems,"are-resources-clickable":e.showsAcceptedShares,"target-route":e.resourceTargetLocation,"header-position":e.fileListHeaderY,"sort-by":e.sharesSortBy,"sort-dir":e.sharesSortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.sharesHandleSort},scopedSlots:e._u([{key:"status",fn:function(t){var i=t.resource;return[s("div",{key:i.id+i.status,staticClass:"oc-text-nowrap oc-flex oc-flex-middle oc-flex-right"},[i.status===e.ShareStatus.declined?s("oc-button",{staticClass:"file-row-share-status-accept",attrs:{size:"small",variation:"success"},on:{click:function(t){return t.stopPropagation(),e.$_acceptShare_trigger({resources:[i]})}}},[s("oc-icon",{attrs:{size:"small",name:"check"}}),e._v(" "),s("translate",[e._v("Accept")])],1):e._e(),e._v(" "),i.status===e.ShareStatus.accepted?s("oc-button",{staticClass:"file-row-share-status-decline",attrs:{size:"small"},on:{click:function(t){return t.stopPropagation(),e.$_declineShare_trigger({resources:[i]})}}},[s("oc-icon",{attrs:{size:"small",name:"close"}}),e._v(" "),s("translate",[e._v("Decline")])],1):e._e()],1)]}},{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSharesSelection(i)?s("context-actions",{attrs:{items:e.sharesSelected}}):e._e()]}},{key:"footer",fn:function(){return[e.hasShares?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.sharesCountFiles,folders:e.sharesCountFolders}}):e._e()]},proxy:!0}]),model:{value:e.sharesSelected,callback:function(t){e.sharesSelected=t},expression:"sharesSelected"}}):s("no-content-message",{staticClass:"files-empty oc-flex-stretch",attrs:{id:"files-shared-with-me-shares-empty",icon:"group"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",[e._v(e._s(e.sharesEmptyMessage))])]},proxy:!0}],null,!1,912116512)})]],2)};_i._withStripped=!0;const bi=e.normalizeComponent({render:_i,staticRenderFns:[]},undefined,vi,undefined,false,undefined,!1,void 0,void 0,void 0),Si=new e.VisibilityObserver;const xi=e.defineComponent({components:{AppBar:ds,ResourceTable:gt,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,ListInfo:gs,Pagination:bs,ContextActions:Jt},mixins:[It,be,Pt,Dt],setup:()=>({...Ke(),resourceTargetLocation:V("files-spaces-personal-home")}),computed:{...e.mapState(["app"]),...e.mapState("Files",["files"]),...e.mapGetters("Files",["highlightedFile","totalFilesCount"]),...e.mapGetters(["configuration","getToken","user"]),...e.mapState("Files/sidebar",{sidebarClosed:"closed"}),isEmpty(){return this.paginatedResources.length<1},displayThumbnails(){return!this.configuration.options.disablePreviews}},created(){this.loadResourcesTask.perform()},beforeDestroy(){Si.disconnect()},methods:{...e.mapActions("Files",["loadIndicators","loadPreview","loadAvatars"]),...e.mapMutations("Files",["LOAD_FILES","CLEAR_CURRENT_FILES_LIST"]),rowMounted(t,s){const i=e.debounce((({unobserve:e})=>{e(),this.loadAvatars({resource:t}),this.displayThumbnails&&this.loadPreview({resource:t,isPublic:!1,dimensions:ut.Thumbnail,type:ht.Thumbnail})}),250);Si.observe(s.$el,{onEnter:i,onExit:i.cancel})}}});var yi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("app-bar",{attrs:{"has-shares-navigation":!0}}),e._v(" "),e.loadResourcesTask.isRunning?s("app-loading-spinner"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-shared-with-others-empty",icon:"group"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("\n          You are currently not collaborating on any of your resources with other people\n        ")])]},proxy:!0}],null,!1,1652169698)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-shared-with-others-table","fields-displayed":["name","sharedWith","sdate"],"are-thumbnails-displayed":e.displayThumbnails,"are-paths-displayed":!0,resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders}}):e._e()]},proxy:!0}]),model:{value:e.selectedResources,callback:function(t){e.selectedResources=t},expression:"selectedResources"}})]],2)};yi._withStripped=!0;const wi=e.normalizeComponent({render:yi,staticRenderFns:[]},undefined,xi,undefined,false,undefined,!1,void 0,void 0,void 0),$i=new e.VisibilityObserver;const Ci=e.defineComponent({components:{AppBar:ds,ResourceTable:gt,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,ListInfo:gs,Pagination:bs,ContextActions:Jt},mixins:[It,be,Pt,Dt],setup:()=>({...Ke(),resourceTargetLocation:V("files-spaces-personal-home")}),computed:{...e.mapState(["app"]),...e.mapState("Files",["files"]),...e.mapGetters("Files",["highlightedFile","totalFilesCount"]),...e.mapGetters(["configuration"]),...e.mapState("Files/sidebar",{sidebarClosed:"closed"}),isEmpty(){return this.paginatedResources.length<1},displayThumbnails(){return!this.configuration.options.disablePreviews}},created(){this.loadResourcesTask.perform()},beforeDestroy(){$i.disconnect()},methods:{...e.mapActions("Files",["loadIndicators","loadPreview"]),...e.mapMutations("Files",["LOAD_FILES","CLEAR_CURRENT_FILES_LIST"]),rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:ut.Thumbnail,type:ht.Thumbnail})}),250);$i.observe(s.$el,{onEnter:i,onExit:i.cancel})}}});var Fi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("app-bar",{attrs:{"has-shares-navigation":!0}}),e._v(" "),e.loadResourcesTask.isRunning?s("app-loading-spinner"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-shared-via-link-empty",icon:"link"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("There are no resources with a public link at the moment")])]},proxy:!0}],null,!1,2205227924)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-shared-via-link-table","fields-displayed":["name","sharedWith","sdate"],"are-thumbnails-displayed":e.displayThumbnails,"are-paths-displayed":!0,resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted,sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders}}):e._e()]},proxy:!0}]),model:{value:e.selectedResources,callback:function(t){e.selectedResources=t},expression:"selectedResources"}})]],2)};Fi._withStripped=!0;const Ei=e.normalizeComponent({render:Fi,staticRenderFns:[]},undefined,Ci,undefined,false,undefined,!1,void 0,void 0,void 0);const Ri={name:"SpaceQuotaModal",props:{space:{type:Object,required:!0},cancel:{type:Function,required:!0}},data:function(){return{selectedOption:{},options:[]}},computed:{...e.mapGetters(["getToken","configuration"]),confirmButtonDisabled(){return this.space.spaceQuota.total===this.selectedOption.value},modalTitle(){return this.$gettextInterpolate(this.$gettext("Change quota for space %{name}"),{name:this.space.name})},DEFAULT_OPTIONS(){return[{displayValue:"1",displayUnit:"GB",value:Math.pow(10,9)},{displayValue:"5",displayUnit:"GB",value:5*Math.pow(10,9)},{displayValue:"10",displayUnit:"GB",value:10*Math.pow(10,9)},{displayValue:"50",displayUnit:"GB",value:50*Math.pow(10,9)},{displayValue:"100",displayUnit:"GB",value:100*Math.pow(10,9)},{displayValue:"500",displayUnit:"GB",value:500*Math.pow(10,9)},{displayValue:"1000",displayUnit:"GB",value:1e3*Math.pow(10,9)},{displayValue:this.$gettext("No restriction"),displayUnit:"",value:0,unlimited:!0}]}},mounted(){this.setOptions()},methods:{...e.mapActions(["showMessage"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),editQuota(){const e=this.selectedOption;if(!e.unlimited&&isNaN(e.value))return this.showMessage({title:this.$gettext("Changing space quota failed…"),status:"danger"});return s.clientService.graphAuthenticated(this.configuration.server,this.getToken).drives.updateDrive(this.space.id,{quota:{total:this.selectedOption.value}},{}).then((({data:e})=>{this.cancel(),this.UPDATE_RESOURCE_FIELD({id:this.space.id,field:"spaceQuota",value:e.quota}),this.showMessage({title:this.$gettext("Space quota was changed successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to change space quota"),desc:e,status:"danger"})}))},optionSelectable:e=>!!e.unlimited||!!e.value&&!isNaN(e.value),createOption(e){(e.endsWith(".")||e.endsWith(","))&&(e=e.slice(0,-1));return/^[1-9]\d*(([.,])\d+)?$/g.test(e)?(e=e.replace(",","."),{displayValue:parseFloat(e).toFixed(2).toString().replace(".00",""),displayUnit:"GB",value:parseFloat(e).toFixed(2)*Math.pow(10,9)}):{displayValue:e,error:this.$gettext("Please enter only numbers")}},setOptions(){this.options=[...this.DEFAULT_OPTIONS];let e=null;if(e="total"in this.space.spaceQuota?this.options.find((e=>e.value===this.space.spaceQuota.total)):this.options.find((e=>!0===e.unlimited)),e)return void(this.selectedOption=e);const t={displayValue:(this.space.spaceQuota.total*Math.pow(10,-9)).toFixed(2).toString().replace(".00",""),displayUnit:"GB",value:this.space.spaceQuota.total};this.options.push(t),this.options=[...this.options.filter((e=>e.value)).sort(((e,t)=>e.value-t.value)),...this.options.filter((e=>!e.value))],this.selectedOption=t}}};var Ti=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("portal",{attrs:{to:"app.runtime.modal"}},[s("oc-modal",{attrs:{title:e.modalTitle,"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Confirm"),"button-confirm-disabled":e.confirmButtonDisabled},on:{confirm:e.editQuota,cancel:e.cancel},scopedSlots:e._u([{key:"content",fn:function(){return[s("oc-select",{attrs:{selectable:e.optionSelectable,taggable:"","push-tags":"",clearable:!1,options:e.options,"create-option":e.createOption,"option-label":"displayValue",label:e.$gettext("Space quota")},scopedSlots:e._u([{key:"selected-option",fn:function(t){var i=t.displayValue,a=t.displayUnit;return[s("span",[e._v(e._s(i))]),e._v(" "),a?s("span",{staticClass:"oc-text-muted oc-ml-s"},[e._v(e._s(a))]):e._e()]}},{key:"search",fn:function(t){var i=t.attributes,a=t.events;return[s("input",e._g(e._b({staticClass:"vs__search"},"input",i,!1),a))]}},{key:"option",fn:function(t){var i=t.displayValue,a=t.displayUnit,r=t.error;return[s("div",{staticClass:"oc-flex oc-flex-between"},[s("span",[e._v(e._s(i))]),e._v(" "),a?s("span",{staticClass:"oc-text-muted"},[e._v(e._s(a))]):e._e()]),e._v(" "),r?s("div",{staticClass:"oc-text-input-danger"},[e._v(e._s(r))]):e._e()]}}]),model:{value:e.selectedOption,callback:function(t){e.selectedOption=t},expression:"selectedOption"}}),e._v(" "),s("p",{staticClass:"oc-mt-xs oc-text-meta",domProps:{textContent:e._s(e.$gettext("Select a quota option or enter your own value"))}})]},proxy:!0}])})],1)};Ti._withStripped=!0;const ki=e.normalizeComponent({render:Ti,staticRenderFns:[]},undefined,Ri,undefined,false,undefined,!1,void 0,void 0,void 0);const Ii={name:"SpaceReadmeContentModal",props:{space:{type:Object,required:!0},cancel:{type:Function,required:!0}},data:function(){return{readmeContent:""}},computed:{modalTitle(){return this.$gettextInterpolate(this.$gettext("Edit description for space %{name}"),{name:this.space.name})}},watch:{"space.spaceQuota":{handler:function(e){e&&this.setOptions()},deep:!0}},async mounted(){const e=this.space.spaceReadmeData.webDavUrl.split("/"),t=e.slice(e.indexOf("dav")+1).join("/");this.readmeContent=await this.$client.files.getFileContents(t)},methods:{...e.mapActions(["showMessage"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),setReadmeContent(){const e=this.space.spaceReadmeData.webDavUrl.split("/"),t=e.slice(e.indexOf("dav")+1).join("/");this.$client.files.getFileContents(t).then((e=>{this.readmeContent=e}))},editReadme(){const e=this.space.spaceReadmeData.webDavUrl.split("/"),t=e.slice(e.indexOf("dav")+1).join("/");return this.$client.files.putFileContents(t,this.readmeContent).then((e=>{this.cancel(),this.UPDATE_RESOURCE_FIELD({id:this.space.id,field:"spaceReadmeData",value:{...this.space.spaceReadmeData,etag:e.ETag}}),this.showMessage({title:this.$gettext("Space description was edited successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to edit space description"),status:"danger"})}))}}};var Di=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("portal",{attrs:{to:"app.runtime.modal"}},[s("oc-modal",{attrs:{"focus-trap-initial":"#description-input-area",title:e.modalTitle,"button-cancel-text":e.$gettext("Cancel"),"button-confirm-text":e.$gettext("Confirm")},on:{confirm:e.editReadme,cancel:e.cancel},scopedSlots:e._u([{key:"content",fn:function(){return[s("label",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-label",attrs:{for:"description-input-area"}},[e._v("Space description")]),e._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.readmeContent,expression:"readmeContent"}],staticClass:"oc-width-1-1 oc-height-1-1 oc-text-input",attrs:{id:"description-input-area",rows:"30"},domProps:{value:e.readmeContent},on:{input:function(t){t.target.composing||(e.readmeContent=t.target.value)}}})]},proxy:!0}])})],1)};Di._withStripped=!0;const Pi=e.normalizeComponent({render:Di,staticRenderFns:[]},undefined,Ii,undefined,false,undefined,!1,void 0,void 0,void 0);var Li={computed:{...e.mapGetters(["configuration","getToken"]),...e.mapState(["user"]),$_delete_items(){return[{name:"delete",icon:"close-circle",label:()=>this.$gettext("Delete"),handler:this.$_delete_trigger,isEnabled:({resources:e})=>1===e.length&&e[0].canBeDeleted({user:this.user}),componentType:"oc-button",class:"oc-files-actions-delete-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapMutations("Files",["REMOVE_FILE"]),$_delete_trigger({resources:e}){if(1!==e.length)return;const t={variation:"danger",title:this.$gettext("Delete space")+" "+e[0].name,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Delete"),icon:"alarm-warning",message:this.$gettext("Are you sure you want to delete this space?"),hasInput:!1,onCancel:this.hideModal,onConfirm:()=>this.$_delete_deleteSpace(e[0].id)};this.createModal(t)},$_delete_deleteSpace(e){return s.clientService.graphAuthenticated(this.configuration.server,this.getToken).drives.deleteDrive(e,"",{headers:{Purge:"T"}}).then((()=>{this.hideModal(),this.REMOVE_FILE({id:e}),this.showMessage({title:this.$gettext("Space was deleted successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to delete space"),status:"danger"})}))}}},Ai={computed:{...e.mapGetters(["configuration","getToken","user"]),$_rename_items(){return[{name:"rename",icon:"pencil",label:()=>this.$gettext("Rename"),handler:this.$_rename_trigger,isEnabled:({resources:e})=>1===e.length&&e[0].canRename({user:this.user}),componentType:"oc-button",class:"oc-files-actions-rename-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),$_rename_trigger({resources:e}){if(1!==e.length)return;const t={variation:"passive",title:this.$gettext("Rename space")+" "+e[0].name,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Rename"),hasInput:!0,inputLabel:this.$gettext("Space name"),inputValue:e[0].name,onCancel:this.hideModal,onConfirm:t=>this.$_rename_renameSpace(e[0].id,t),onInput:this.$_rename_checkName};this.createModal(t)},$_rename_checkName(e){return""===e.trim()?this.setModalInputErrorMessage(this.$gettext("Space name cannot be empty")):this.setModalInputErrorMessage(null)},$_rename_renameSpace(e,t){return s.clientService.graphAuthenticated(this.configuration.server,this.getToken).drives.updateDrive(e,{name:t},{}).then((()=>{this.hideModal(),this.UPDATE_RESOURCE_FIELD({id:e,field:"name",value:t}),this.showMessage({title:this.$gettext("Space name was changed successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to rename space"),status:"danger"})}))}}},Mi={computed:{...e.mapGetters(["configuration","getToken"]),...e.mapState(["user"]),$_restore_items(){return[{name:"restore",icon:"play-circle",label:()=>this.$gettext("Enable"),handler:this.$_restore_trigger,isEnabled:({resources:e})=>1===e.length&&e[0].canRestore({user:this.user}),componentType:"oc-button",class:"oc-files-actions-restore-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),$_restore_trigger({resources:e}){if(1!==e.length)return;const t={variation:"passive",title:this.$gettext("Restore space")+" "+e[0].name,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Restore"),icon:"alarm-warning",message:this.$gettext("Are you sure you want to restore this space?"),hasInput:!1,onCancel:this.hideModal,onConfirm:()=>this.$_restore_restoreSpace(e[0].id)};this.createModal(t)},$_restore_restoreSpace(e){return s.clientService.graphAuthenticated(this.configuration.server,this.getToken).drives.updateDrive(e,{},{headers:{Restore:!0}}).then((()=>{this.hideModal(),this.UPDATE_RESOURCE_FIELD({id:e,field:"disabled",value:!1}),this.showMessage({title:this.$gettext("Space was restored successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to restore space"),status:"danger"})}))}}},Oi={computed:{$_showDetails_items(){return[{name:"show-details",icon:"information",label:()=>this.$gettext("Details"),handler:this.$_showDetails_trigger,isEnabled:({resources:e})=>1===e.length,componentType:"oc-button",class:"oc-files-actions-show-details-trigger"}]}},methods:{...e.mapActions("Files/sidebar",{openSidebar:"open",closeSidebar:"close"}),...e.mapMutations("Files",["SET_FILE_SELECTION"]),$_showDetails_trigger({resources:e}){1===e.length&&(this.SET_FILE_SELECTION([e[0]]),this.openSidebar())}}},Ni={computed:{...e.mapGetters(["configuration","getToken"]),$_editDescription_items(){return[{name:"editDescription",icon:"h-2",iconFillType:"none",label:()=>this.$gettext("Edit subtitle"),handler:this.$_editDescription_trigger,isEnabled:({resources:e})=>1===e.length&&e[0].canEditDescription({user:this.user}),componentType:"oc-button",class:"oc-files-actions-edit-description-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),$_editDescription_trigger({resources:e}){if(1!==e.length)return;const t={variation:"passive",title:this.$gettext("Change subtitle for space")+" "+e[0].name,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Confirm"),hasInput:!0,inputLabel:this.$gettext("Space subtitle"),inputValue:e[0].description,onCancel:this.hideModal,onConfirm:t=>this.$_editDescription_editDescriptionSpace(e[0].id,t)};this.createModal(t)},$_editDescription_editDescriptionSpace(e,t){return s.clientService.graphAuthenticated(this.configuration.server,this.getToken).drives.updateDrive(e,{description:t},{}).then((()=>{this.hideModal(),this.UPDATE_RESOURCE_FIELD({id:e,field:"description",value:t}),this.showMessage({title:this.$gettext("Space subtitle was changed successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to change space subtitle"),status:"danger"})}))}}},Ui={data:()=>({$_editQuota_modalOpen:!1,$_editQuota_selectedSpace:null}),computed:{...e.mapState("Files",["currentFolder"]),...e.mapState(["user"]),$_editQuota_items(){return[{name:"editQuota",icon:"cloud",label:()=>this.$gettext("Edit quota"),handler:this.$_editQuota_trigger,isEnabled:({resources:e})=>1===e.length&&(!!e[0].spaceQuota&&e[0].canEditQuota({user:this.user})),componentType:"oc-button",class:"oc-files-actions-edit-quota-trigger"}]}},methods:{$_editQuota_trigger({resources:e}){this.$data.$_editQuota_selectedSpace=e[0],this.$data.$_editQuota_modalOpen=!0},$_editQuota_closeModal(){this.$data.$_editQuota_modalOpen=!1}}},zi={computed:{$_deletedFiles_items(){return[{name:"deletedFiles",icon:"delete-bin-5",label:()=>this.$gettext("Deleted files"),handler:this.$_deletedFiles_trigger,isEnabled:({resources:e})=>1===e.length,componentType:"oc-button",class:"oc-files-actions-delete-trigger"}]}},methods:{$_deletedFiles_trigger({resources:e}){this.$router.push(he("files-trash-spaces-project",{params:{storageId:e[0].id}}))}}},Bi={computed:{...e.mapGetters(["configuration","getToken"]),...e.mapState(["user"]),$_disable_items(){return[{name:"disable",icon:"stop-circle",label:()=>this.$gettext("Disable"),handler:this.$_disable_trigger,isEnabled:({resources:e})=>1===e.length&&e[0].canDisable({user:this.user}),componentType:"oc-button",class:"oc-files-actions-disable-trigger"}]}},methods:{...e.mapActions(["createModal","hideModal","setModalInputErrorMessage","showMessage","toggleModalConfirmButton"]),...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),$_disable_trigger({resources:e}){if(1!==e.length)return;const t={variation:"danger",title:this.$gettext("Disable space")+" "+e[0].name,cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Disable"),icon:"alarm-warning",message:this.$gettext("Are you sure you want to disable this space?"),hasInput:!1,onCancel:this.hideModal,onConfirm:()=>this.$_disable_disableSpace(e[0].id)};this.createModal(t)},$_disable_disableSpace(e){return s.clientService.graphAuthenticated(this.configuration.server,this.getToken).drives.deleteDrive(e).then((()=>{this.hideModal(),this.UPDATE_RESOURCE_FIELD({id:e,field:"disabled",value:!0}),this.showMessage({title:this.$gettext("Space was disabled successfully")})})).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to disable space"),status:"danger"})}))},isDisabled:e=>!1}},Gi={computed:{$_showMembers_items(){return[{name:"show-members",icon:"group",label:()=>this.$gettext("Members"),handler:this.$_showMembers_trigger,isEnabled:({resources:e})=>1===e.length,componentType:"oc-button",class:"oc-files-actions-show-details-trigger"}]}},methods:{...e.mapMutations("Files",["SET_FILE_SELECTION"]),$_showMembers_trigger({resources:e}){this.SET_FILE_SELECTION(e),async function(e){await e.store.dispatch("Files/sidebar/openWithPanel","space-share-item")}({item:e[0],client:this.$client,store:this.$store})}}},qi={data:function(){return{$_uploadImage_selectedSpace:null}},computed:{...e.mapState("Files",["currentFolder"]),...e.mapGetters(["configuration"]),$_uploadImage_items(){return[{name:"upload-space-image",icon:"image-add",handler:this.$_uploadImage_trigger,label:()=>this.$gettext("Edit image"),isEnabled:({resources:e})=>1===e.length&&e[0].canEditImage({user:this.user}),componentType:"oc-button",class:"oc-files-actions-upload-space-image-trigger"}]}},methods:{...e.mapMutations("Files",["UPDATE_RESOURCE_FIELD"]),...e.mapActions(["showMessage"]),$_uploadImage_trigger({resources:e}){1===e.length&&(this.$data.$_uploadImage_selectedSpace=e[0],this.$refs.spaceImageInput.click())},$_uploadImage_uploadImageSpace(e){const t=s.clientService.graphAuthenticated(this.configuration.server,this.getToken),i=e.currentTarget.files[0];if(!i)return;if(!w.isMimetypeSupported(i.type,!0))return this.showMessage({title:this.$gettext("The file type is unsupported"),status:"danger"});const a={};return i.lastModifiedDate?a["X-OC-Mtime"]=""+i.lastModifiedDate.getTime()/1e3:i.lastModified&&(a["X-OC-Mtime"]=""+i.lastModified/1e3),this.$client.files.putFileContents(`/spaces/${this.$data.$_uploadImage_selectedSpace.id}/.space/${i.name}`,i,{headers:a,overwrite:!0}).then((e=>t.drives.updateDrive(this.$data.$_uploadImage_selectedSpace.id,{special:[{specialFolder:{name:"image"},id:e["OC-FileId"]}]},{}).then((({data:e})=>{this.UPDATE_RESOURCE_FIELD({id:this.$data.$_uploadImage_selectedSpace.id,field:"spaceImageData",value:e.special.find((e=>"image"===e.specialFolder.name))}),this.showMessage({title:this.$gettext("Space image was uploaded successfully")}),r.bus.publish("app.files.list.load")})))).catch((e=>{console.error(e),this.showMessage({title:this.$gettext("Failed to upload space image"),status:"danger"})}))}}},Vi={data:function(){return{$_editReadmeContent_modalOpen:!1}},computed:{...e.mapState(["user"]),$_editReadmeContent_items(){return[{name:"editReadmeContent",icon:"article",label:()=>this.$gettext("Edit description"),handler:this.$_editReadmeContent_trigger,isEnabled:({resources:e})=>1===e.length&&(!!e[0].canEditReadme({user:this.user})&&!!e[0].spaceReadmeData),componentType:"oc-button",class:"oc-files-actions-edit-readme-content-trigger"}]}},methods:{$_editReadmeContent_trigger(){this.$data.$_editReadmeContent_modalOpen=!0},$_editReadmeContent_closeModal(){this.$data.$_editReadmeContent_modalOpen=!1}}};const ji={name:"SpaceContextActions",components:{ContextActionMenu:qt,QuotaModal:ki,ReadmeContentModal:Pi},mixins:[Ai,Li,Ni,Ui,zi,Bi,Oi,Gi,Mi,qi,Vi],props:{items:{type:Array,required:!0}},computed:{quotaModalSelectedSpace(){return this.$data.$_editQuota_selectedSpace},quotaModalIsOpen(){return this.$data.$_editQuota_modalOpen},readmeContentModalIsOpen(){return this.$data.$_editReadmeContent_modalOpen},menuSections(){const e=[];return this.menuItemsMembers.length&&e.push({name:"members",items:this.menuItemsMembers}),this.menuItemsPrimaryActions.length&&e.push({name:"primaryActions",items:this.menuItemsPrimaryActions}),this.menuItemsSecondaryActions.length&&e.push({name:"secondaryActions",items:this.menuItemsSecondaryActions}),this.menuItemsTrashBin.length&&e.push({name:"trashBin",items:this.menuItemsTrashBin}),this.menuItemsSidebar.length&&e.push({name:"sidebar",items:this.menuItemsSidebar}),e},filterParams(){return{resources:this.items}},menuItemsMembers(){return[...[...this.$_showMembers_items]].filter((e=>e.isEnabled(this.filterParams)))},menuItemsPrimaryActions(){const e=[...this.$_rename_items,...this.$_editDescription_items,...this.$_uploadImage_items];return Q(this.$router,"files-spaces-project")&&this.$route.params.storageId&&e.splice(2,0,...this.$_editReadmeContent_items),[...e].filter((e=>e.isEnabled(this.filterParams)))},menuItemsSecondaryActions(){return[...[...this.$_editQuota_items,...this.$_disable_items,...this.$_restore_items,...this.$_delete_items]].filter((e=>e.isEnabled(this.filterParams)))},menuItemsTrashBin(){return[...[...this.$_deletedFiles_items]].filter((e=>e.isEnabled(this.filterParams)))},menuItemsSidebar(){return[...[...this.$_showDetails_items]].filter((e=>e.isEnabled(this.filterParams)))}},methods:{closeQuotaModal(){this.$_editQuota_closeModal()},closeReadmeContentModal(){this.$_editReadmeContent_closeModal()}}};var Hi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("context-action-menu",{attrs:{"menu-sections":e.menuSections,items:e.items}}),e._v(" "),e.quotaModalIsOpen?s("quota-modal",{attrs:{cancel:e.closeQuotaModal,space:e.quotaModalSelectedSpace}}):e._e(),e._v(" "),e.readmeContentModalIsOpen?s("readme-content-modal",{attrs:{cancel:e.closeReadmeContentModal,space:e.items[0]}}):e._e(),e._v(" "),s("input",{ref:"spaceImageInput",attrs:{id:"space-image-upload-input",type:"file",name:"file",multiple:"",tabindex:"-1",accept:"image/*"},on:{change:e.$_uploadImage_uploadImageSpace}})],1)};Hi._withStripped=!0;const Wi=e.normalizeComponent({render:Hi,staticRenderFns:[]},undefined,ji,undefined,false,undefined,!1,void 0,void 0,void 0),Qi=new e.VisibilityObserver;const Yi=e.defineComponent({components:{AppBar:ds,ProgressBar:zs,CreateAndUpload:Ks,NoContentMessage:e.__vue_component__$2,AppLoadingSpinner:e.__vue_component__$1,NotFoundMessage:ei,ResourceTable:gt,ListInfo:gs,Pagination:bs,ContextActions:Jt,SpaceContextActions:Wi},mixins:[As,It,L],provide(){return{currentSpace:e.computed((()=>this.space))}},setup(){const t=e.ref({});return{...Ke(),resourceTargetLocation:V("files-spaces-project"),space:t}},data:function(){return{markdownContent:"",markdownCollapsed:!0,markdownContainerCollapsedClass:"collapsed",showMarkdownCollapse:!1,markdownResizeObserver:new ResizeObserver(this.onMarkdownResize),imageExpanded:!1,imageContent:null}},computed:{...e.mapGetters("Files",["highlightedFile","currentFolder","inProgress","totalFilesCount","totalFilesSize"]),...e.mapGetters(["user","getToken","configuration"]),breadcrumbs(){return si({text:this.$gettext("Spaces"),to:"/files/spaces/projects"},{text:this.space?.name,to:`/files/spaces/projects/${this.$route.params.storageId}`},...ti(this.$route.path,this.$route.params.item))},isSpaceRoot(){return!this.$route.params.item},isEmpty(){return this.paginatedResources.length<1},$_uploadProgressVisible(){return this.inProgress.length>0},markdownCollapseIcon(){return!0===this.markdownCollapsed?"add":"subtract"},markdownCollapseText(){return!0===this.markdownCollapsed?this.$gettext("Show more"):this.$gettext("Show less")},displayThumbnails(){return!this.configuration.options.disablePreviews},memberCount(){return this.space.spaceMemberIds.length},memberCountString(){const e=this.$ngettext("%{count} member","%{count} members",this.memberCount);return this.$gettextInterpolate(e,{count:this.memberCount})}},watch:{$route:{handler:async function(e,t){const s=e.name===t?.name&&e.params?.storageId===t?.params?.storageId,i=e.params?.item===t?.params?.item;s&&i||!t||await this.loadResourcesTask.perform(this,s,e.params.item),this.$refs.markdownContainer&&(this.markdownResizeObserver&&this.markdownResizeObserver.unobserve(this.$refs.markdownContainer),this.markdownResizeObserver.observe(this.$refs.markdownContainer))},immediate:!0},"space.spaceImageData":{handler:function(e){if(!e)return;const s=this.space.spaceImageData.webDavUrl.split("/"),i=s.slice(s.indexOf(this.space.id)+1).join("/");this.$client.files.fileInfo(t.buildWebDavSpacesPath(this.space.id,i)).then((e=>{const s=t.buildResource(e);R({resource:s,isPublic:!1,dimensions:ut.Preview,server:this.configuration.server,userId:this.user.id,token:this.getToken}).then((e=>{this.imageContent=e}))}))},deep:!0},"space.spaceReadmeData":{handler:function(s){if(!s)return;const i=this.space.spaceReadmeData.webDavUrl.split("/"),a=i.slice(i.indexOf(this.space.id)+1).join("/");this.$client.files.getFileContents(t.buildWebDavSpacesPath(this.space.id,a)).then((t=>{this.markdownResizeObserver&&this.$refs.markdownContainer&&this.markdownResizeObserver.unobserve(this.$refs.markdownContainer);const s=e.marked_umd.marked.parse(t);this.markdownContent=e.sanitizeHtml_1(s),this.markdownContent&&this.markdownResizeObserver.observe(this.$refs.markdownContainer)}))},deep:!0}},async mounted(){await this.loadResourcesTask.perform(this,!1,this.$route.params.item||""),document.title=`${this.$route.meta.title} - ${this.space.name} - ${this.configuration.currentTheme.general.name}`,this.$route.params.name=this.space.name;const e=r.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.$route.params.item===e,e)}));this.$on("beforeDestroy",(()=>{r.bus.unsubscribe("app.files.list.load",e)}))},beforeDestroy(){Qi.disconnect(),this.$refs.markdownContainer&&this.markdownResizeObserver.unobserve(this.$refs.markdownContainer)},methods:{...e.mapActions("Files",["loadIndicators","loadPreview","loadCurrentFileOutgoingShares"]),...e.mapActions("Files/sidebar",{openSidebarWithPanel:"openWithPanel"}),...e.mapMutations("Files",["SET_CURRENT_FOLDER","LOAD_FILES","CLEAR_CURRENT_FILES_LIST","REMOVE_FILE","REMOVE_FILE_FROM_SEARCHED","REMOVE_FILE_SELECTION"]),rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:ut.Thumbnail,type:ht.Thumbnail})}),250);Qi.observe(s.$el,{onEnter:i,onExit:i.cancel})},toggleCollapseMarkdown(){return this.markdownCollapsed=!this.markdownCollapsed,this.$refs.markdownContainer.classList.toggle(this.markdownContainerCollapsedClass)},toggleImageExpanded(){this.imageExpanded=!this.imageExpanded},onMarkdownResize(){if(!this.$refs.markdownContainer)return;this.$refs.markdownContainer.classList.remove(this.markdownContainerCollapsedClass);if(this.$refs.markdownContainer.offsetHeight<150)return this.showMarkdownCollapse=!1;this.showMarkdownCollapse=!0,this.markdownCollapsed&&this.$refs.markdownContainer.classList.add(this.markdownContainerCollapsedClass)},openSidebarSharePanel(){this.selectedResources=[this.space],this.openSidebarWithPanel("space-share-item")}}});var Ji=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"space-overview"},[s("app-bar",{attrs:{"has-bulk-actions":!0,breadcrumbs:e.breadcrumbs,"breadcrumbs-context-actions-items":[e.currentFolder]},scopedSlots:e._u([{key:"actions",fn:function(){return[s("create-and-upload")]},proxy:!0}])}),e._v(" "),e.loadResourcesTask.isRunning?s("app-loading-spinner"):[s("progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.$_uploadProgressVisible,expression:"$_uploadProgressVisible"}],staticClass:"oc-p-s",attrs:{id:"files-upload-progress"}}),e._v(" "),e.space.id?e.isSpaceRoot?s("div",[s("div",{staticClass:"oc-px-m oc-mt-m",class:{"oc-flex":e.imageContent&&!e.imageExpanded}},[e.imageContent?s("div",{class:{"oc-width-1-4 oc-mr-l":!e.imageExpanded}},[s("img",{staticClass:"space-overview-image oc-cursor-pointer",class:{expanded:e.imageExpanded},attrs:{alt:"",src:e.imageContent},on:{click:e.toggleImageExpanded}})]):e._e(),e._v(" "),s("div",{class:{"oc-width-3-4":e.imageContent&&!e.imageExpanded}},[s("div",{staticClass:"oc-flex oc-mb-s oc-flex-middle oc-flex-between"},[s("div",{staticClass:"oc-flex oc-flex-middle"},[s("h1",{staticClass:"space-overview-name oc-text-truncate"},[e._v(e._s(e.space.name))]),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Show context menu"),expression:"$gettext('Show context menu')"}],staticClass:"oc-ml-s",attrs:{id:"space-context-btn","aria-label":e.$gettext("Show context menu"),appearance:"raw"}},[s("oc-icon",{attrs:{name:"more-2"}})],1),e._v(" "),s("oc-drop",{attrs:{"drop-id":"space-context-drop",toggle:"#space-context-btn",mode:"click","close-on-click":"",options:{delayHide:0},"padding-size":"small",position:"right-start"}},[s("space-context-actions",{attrs:{items:[e.space]}})],1)],1),e._v(" "),e.memberCount?s("oc-button",{attrs:{"aria-label":e.$gettext("Open context menu and show members"),appearance:"raw"},on:{click:e.openSidebarSharePanel}},[s("oc-icon",{attrs:{name:"group","fill-type":"line",size:"small"}}),e._v(" "),s("span",{staticClass:"space-overview-people-count oc-text-small",domProps:{textContent:e._s(e.memberCountString)}})],1):e._e()],1),e._v(" "),e.space.description?s("p",{staticClass:"oc-mt-rm"},[e._v(e._s(e.space.description))]):e._e(),e._v(" "),s("div",[s("div",{ref:"markdownContainer",staticClass:"markdown-container",domProps:{innerHTML:e._s(e.markdownContent)}}),e._v(" "),e.showMarkdownCollapse?s("div",{staticClass:"markdown-collapse oc-text-center oc-mt-s"},[s("oc-button",{attrs:{appearance:"raw"},on:{click:e.toggleCollapseMarkdown}},[s("oc-icon",{attrs:{name:e.markdownCollapseIcon}}),e._v(" "),s("span",[e._v(e._s(e.markdownCollapseText))])],1)],1):e._e()])])])]):e._e():s("not-found-message",{staticClass:"space-not-found oc-height-1-1"}),e._v(" "),e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-space-empty",icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-text-muted"},[e._v("No resources found")])]},proxy:!0}],null,!1,1941445188)}):s("resource-table",{staticClass:"files-table oc-mt-xl",attrs:{id:"files-spaces-table",resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{sort:e.handleSort,fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResources,callback:function(t){e.selectedResources=t},expression:"selectedResources"}})]],2)};Ji._withStripped=!0;const Ki=e.normalizeComponent({render:Ji,staticRenderFns:[]},undefined,Yi,undefined,false,undefined,!1,void 0,void 0,void 0);const Zi=e.defineComponent({name:"TrashBin",components:{AppBar:ds,ResourceTable:gt,AppLoadingSpinner:e.__vue_component__$1,NoContentMessage:e.__vue_component__$2,ListInfo:gs,Pagination:bs,ContextActions:Jt},mixins:[be,Pt,Dt],props:{breadcrumbs:{type:Array,default:()=>[]},noContentMessage:{type:String,required:!1,default:""}},setup:()=>({...Ke()}),computed:{...e.mapState("Files",["files"]),...e.mapGetters("Files",["highlightedFile","selectedFiles","totalFilesCount"]),...e.mapState("Files/sidebar",{sidebarClosed:"closed"}),isEmpty(){return this.paginatedResources.length<1}},created(){this.loadResourcesTask.perform(this);const e=r.bus.subscribe("app.files.list.load",(e=>{this.loadResourcesTask.perform(this,this.$route.params.item===e,e)}));this.$on("beforeDestroy",(()=>{r.bus.unsubscribe("app.files.list.load",e)}))},methods:{...e.mapMutations("Files",["LOAD_FILES","CLEAR_CURRENT_FILES_LIST"])}});var Xi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("app-bar",{attrs:{breadcrumbs:e.breadcrumbs,"has-bulk-actions":!0}}),e._v(" "),e.loadResourcesTask.isRunning?s("app-loading-spinner"):[e.isEmpty?s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-trashbin-empty",icon:"delete-bin-5"},scopedSlots:e._u([{key:"message",fn:function(){return[e.noContentMessage?s("span",[e._v(e._s(e.noContentMessage))]):s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("You have no deleted files")])]},proxy:!0}],null,!1,1977983392)}):s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!e.sidebarClosed},attrs:{id:"files-trashbin-table","fields-displayed":["name","ddate"],"are-paths-displayed":!0,"are-thumbnails-displayed":!1,resources:e.paginatedResources,"are-resources-clickable":!1,"header-position":e.fileListHeaderY,"sort-by":e.sortBy,"sort-dir":e.sortDir},on:{sort:e.handleSort},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders}}):e._e()]},proxy:!0}]),model:{value:e.selectedResources,callback:function(t){e.selectedResources=t},expression:"selectedResources"}})]],2)};Xi._withStripped=!0;const ea=e.normalizeComponent({render:Xi,staticRenderFns:[]},undefined,Zi,undefined,false,undefined,!1,void 0,void 0,void 0);const ta=e.defineComponent({components:{TrashBin:ea},setup(){const i=s.useStore(),a=e.ref({}),r=s.clientService.graphAuthenticated(i.getters.configuration.server,i.getters.getToken),o=e.q((function*(e,s){const i=(yield r.drives.getDrive(s.$router.currentRoute.params.storageId)).data||{};a.value=t.buildSpace(i)}));return{space:a,loadResourcesTask:o}},computed:{...e.mapGetters(["configuration"]),breadcrumbs(){return[{text:this.$gettext("Deleted files"),to:"/files/trash"},{allowContextActions:!0,text:this.space?.name,onClick:()=>r.bus.publish("app.files.list.load")}]}},async mounted(){await this.loadResourcesTask.perform(this),document.title=`${this.$router.currentRoute.meta.title} - ${this.space.name} - ${this.configuration.currentTheme.general.name}`}});var sa=function(){var e=this,t=e.$createElement;return(e._self._c||t)("trash-bin",{attrs:{breadcrumbs:e.breadcrumbs,"no-content-message":e.$gettext("Space has no deleted files")}})};sa._withStripped=!0;const ia=e.normalizeComponent({render:sa,staticRenderFns:[]},undefined,ta,undefined,false,undefined,!1,void 0,void 0,void 0);const aa={setup(){const e=s.useStore();return{graphClient:s.clientService.graphAuthenticated(e.getters.configuration.server,e.getters.getToken)}},computed:{...e.mapGetters(["getToken","configuration"])},methods:{...e.mapActions(["showMessage","createModal","hideModal","setModalInputErrorMessage"]),...e.mapMutations("Files",["SET_CURRENT_FOLDER","LOAD_FILES","CLEAR_CURRENT_FILES_LIST","SET_FILE_SELECTION","UPSERT_RESOURCE","UPDATE_RESOURCE_FIELD"]),showCreateSpaceModal(){const e={variation:"passive",title:this.$gettext("Create a new space"),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Create"),hasInput:!0,inputLabel:this.$gettext("Space name"),inputValue:this.$gettext("New space"),onCancel:this.hideModal,onConfirm:this.addNewSpace,onInput:this.checkSpaceName};this.createModal(e)},checkSpaceName(e){if(""!==e.trim())return this.setModalInputErrorMessage(null);this.setModalInputErrorMessage(this.$gettext("Space name cannot be empty"))},addNewSpace(e){return this.graphClient.drives.createDrive({name:e},{}).then((({data:e})=>{this.hideModal();const s=t.buildSpace(e);this.UPSERT_RESOURCE(s),this.$client.files.createFolder(`spaces/${e.id}/.space`).then((()=>{this.$client.files.putFileContents(`spaces/${e.id}/.space/readme.md`,`### 👋 ${this.$gettext("Hello!")}\r\n${this.$gettext("Add a description to welcome the members of the Space.")}\r\n${this.$gettext("Use markdown to format your text. [More info]")}(https://www.markdownguide.org/basic-syntax/)`).then((t=>{this.graphClient.drives.updateDrive(e.id,{special:[{specialFolder:{name:"readme"},id:t["OC-FileId"]}]},{}).then((({data:t})=>{this.UPDATE_RESOURCE_FIELD({id:e.id,field:"spaceReadmeData",value:t.special.find((e=>"readme"===e.specialFolder.name))})}))}))}))})).catch((e=>{this.showMessage({title:this.$gettext("Creating space failed…"),desc:e,status:"danger"})}))}}};var ra=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Create a new space"),expression:"$gettext('Create a new space')"}],key:"new-space-menu-btn-enabled",staticClass:"oc-background-primary-gradient oc-px-s oc-text-nowrap oc-py-s",attrs:{id:"new-space-menu-btn","aria-label":e.$gettext("Create a new space"),appearance:"raw",variation:"inverse"},on:{click:e.showCreateSpaceModal}},[s("oc-icon",{attrs:{name:"add"}}),e._v(" "),s("translate",[e._v("Create Space")])],1)};ra._withStripped=!0;const oa=e.normalizeComponent({render:ra,staticRenderFns:[]},undefined,aa,undefined,false,undefined,!1,void 0,void 0,void 0);const na=e.defineComponent({components:{AppBar:ds,AppLoadingSpinner:e.__vue_component__$1,CreateSpace:oa,NoContentMessage:e.__vue_component__$2,SpaceContextActions:Wi},setup(){const i=s.useStore(),a=e.computed((()=>i.getters["Files/activeFiles"]||[])),r=s.clientService.graphAuthenticated(i.getters.configuration.server,i.getters.getToken),o=e.q((function*(e,s){s.CLEAR_CURRENT_FILES_LIST();let i=(yield r.drives.listMyDrives("name asc","driveType eq project")).data?.value||[];i=i.map(t.buildSpace),s.LOAD_FILES({currentFolder:null,files:i})}));return{spaces:a,graphClient:r,loadResourcesTask:o}},data:function(){return{imageContentObject:{}}},computed:{...e.mapGetters(["user","getToken"]),breadcrumbs(){return[{text:this.$gettext("Spaces")}]},spacesHint(){return this.$gettext("Store your project related files in Spaces for seamless collaboration.")},hasCreatePermission:()=>!0},watch:{spaces:{handler:function(e){if(e)for(const e of this.spaces){if(!e.spaceImageData)continue;if(this.imageContentObject[e.id]?.fileId===e.spaceImageData?.id)continue;const s=e.spaceImageData.webDavUrl.split("/"),i=s.slice(s.indexOf(e.id)+1).join("/");this.$client.files.fileInfo(t.buildWebDavSpacesPath(e.id,i)).then((s=>{const i=t.buildResource(s);R({resource:i,isPublic:!1,dimensions:ut.Preview,server:this.configuration.server,userId:this.user.id,token:this.getToken}).then((t=>{this.$set(this.imageContentObject,e.id,{fileId:e.spaceImageData.id,data:t})}))}))}},deep:!0}},created(){this.loadResourcesTask.perform(this)},methods:{...e.mapActions("Files/sidebar",{openSidebarWithPanel:"openWithPanel"}),...e.mapMutations("Files",["SET_CURRENT_FOLDER","LOAD_FILES","CLEAR_CURRENT_FILES_LIST","SET_FILE_SELECTION"]),getSpaceProjectRoute:({id:e,name:t})=>V("files-spaces-project",{params:{storageId:e,name:t}}),sanitizeStorageId:e=>e.replace("!","\\!").split(".")[0],getSpaceCardAdditionalClass:e=>e.disabled?"state-trashed":"",openSidebarSharePanel(e){this.SET_FILE_SELECTION([e]),this.openSidebarWithPanel("space-share-item")}}});var la=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("app-bar",{staticClass:"oc-border-b",attrs:{breadcrumbs:e.breadcrumbs,"has-view-options":!1,"has-sidebar-toggle":!1},scopedSlots:e._u([{key:"actions",fn:function(){return[s("create-space")]},proxy:!0},{key:"content",fn:function(){return[s("p",{domProps:{textContent:e._s(e.spacesHint)}})]},proxy:!0}])}),e._v(" "),e.loadResourcesTask.isRunning?s("app-loading-spinner"):[e.spaces.length?s("div",{staticClass:"spaces-list oc-px-m oc-mt-l"},[s("ul",{staticClass:"\n          oc-grid\n          oc-grid-match\n          oc-grid-column-small\n          oc-grid-row-large\n          oc-text-center\n          oc-child-width-1-3@m\n          oc-child-width-1-4@l\n          oc-child-width-1-5@xl\n        "},e._l(e.spaces,(function(t){return s("li",{key:t.id,staticClass:"oc-mb-m"},[s("div",{staticClass:"spaces-list-card oc-card oc-card-default oc-rounded",class:e.getSpaceCardAdditionalClass(t),attrs:{"data-space-id":t.id}},[s("div",{staticClass:"oc-card-media-top oc-border-b"},[s("router-link",{attrs:{to:e.getSpaceProjectRoute(t)}},[t.disabled?s("oc-tag",{staticClass:"oc-position-absolute space-disabled-indicator",attrs:{type:"span"}},[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("Disabled")])]):e._e(),e._v(" "),e.imageContentObject[t.id]?s("img",{staticClass:"space-image oc-rounded-top",attrs:{src:e.imageContentObject[t.id].data,alt:""}}):s("oc-icon",{staticClass:"space-default-image oc-px-m oc-py-m",attrs:{name:"layout-grid",size:"xxlarge"}})],1)],1),e._v(" "),s("div",{staticClass:"oc-card-body oc-p-s"},[s("div",{staticClass:"oc-flex oc-flex-between oc-flex-middle"},[s("div",{staticClass:"oc-flex oc-flex-middle"},[s("oc-icon",{staticClass:"oc-mr-s",attrs:{name:"layout-grid"}}),e._v(" "),s("router-link",{staticClass:"space-name oc-text-left",attrs:{to:e.getSpaceProjectRoute(t)}},[s("span",{domProps:{textContent:e._s(t.name)}})])],1),e._v(" "),s("div",{staticClass:"oc-flex oc-flex-middle"},[s("div",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Show members"),expression:"$gettext('Show members')"}],attrs:{"aria-label":e.$gettext("Show members"),appearance:"raw"},on:{click:function(s){return e.openSidebarSharePanel(t)}}},[s("oc-icon",{attrs:{name:"group"}})],1)],1),e._v(" "),s("div",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Show context menu"),expression:"$gettext('Show context menu')"}],attrs:{id:"space-context-btn-"+e.sanitizeStorageId(t.id),"aria-label":e.$gettext("Show context menu"),appearance:"raw"}},[s("oc-icon",{attrs:{name:"more-2"}})],1),e._v(" "),s("oc-drop",{attrs:{"drop-id":"space-context-drop-"+t.id,toggle:"#space-context-btn-"+e.sanitizeStorageId(t.id),mode:"click","close-on-click":"",options:{delayHide:0},"padding-size":"small",position:"bottom-end"}},[s("space-context-actions",{attrs:{items:[t]}})],1)],1)])]),e._v(" "),t.description?s("p",{staticClass:"oc-text-left oc-ml-xs oc-mt-xs oc-mb-rm oc-text-truncate"},[s("small",{domProps:{textContent:e._s(t.description)}})]):e._e()])])])})),0)]):s("no-content-message",{staticClass:"files-empty",attrs:{id:"files-spaces-empty",icon:"layout-grid"},scopedSlots:e._u([{key:"message",fn:function(){return[s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("You don't have access to any spaces")])]},proxy:!0}],null,!1,960882363)})]],2)};la._withStripped=!0;const ca=e.normalizeComponent({render:la,staticRenderFns:[]},undefined,na,undefined,false,undefined,!1,void 0,void 0,void 0);const da={components:{TrashBin:ea},setup:()=>({hasSpaces:P()}),computed:{breadcrumbs(){const e=this.hasSpaces?this.$gettext("Personal"):this.$gettext("All files");return[{text:this.$gettext("Deleted files"),to:"/files/trash"},{text:e,onClick:()=>r.bus.publish("app.files.list.load")}]}}};var ua=function(){var e=this,t=e.$createElement;return(e._self._c||t)("trash-bin",{attrs:{breadcrumbs:e.breadcrumbs}})};ua._withStripped=!0;const ha=e.normalizeComponent({render:ua,staticRenderFns:[]},undefined,da,undefined,false,undefined,!1,void 0,void 0,void 0);const pa=async(e,t=!1)=>{const s=e.size||ut.Avatar;if(t)return ma({...e,size:s});const i=[e.server,"remote.php/dav/avatars/",e.username,`/${s}.png`].join(""),{status:a,statusText:r}=await e.clientService.httpAuthenticated(e.token).head(i);if(200!==a)throw new Error(r);const{owncloudSdk:o}=e.clientService;return o&&"function"==typeof o.signUrl?o.signUrl(i):i},ma=async e=>{const t=s.cacheService.avatarUrl.get(e.username);if(t&&t.size===e.size)return t.src;try{const t=await pa(e);return s.cacheService.avatarUrl.set(e.username,{src:t,size:e.size},0).src}catch(e){}},fa=e=>[...e.filter((e=>e.role.name===s.spaceRoleManager.name)).sort(((e,t)=>e.collaborator.displayName.localeCompare(t.collaborator.displayName))),...e.filter((e=>e.role.name!==s.spaceRoleManager.name)).sort(((e,t)=>e.collaborator.displayName.localeCompare(t.collaborator.displayName)))],ga=t=>e.get(t,"capabilities.files_sharing.resharing",!0);function va(e){const t=new Set;return e.forEach((e=>{t.add(e.shareType)})),Array.from(t)}function _a(e,t,s){const i=[...e.files],a=i.findIndex((e=>e.id===t.id)),r=a>-1;e.filesSearched=null,(r||s)&&(r?i.splice(a,1,t):i.push(t),e.files=i)}var ba={namespaced:!0,state:{currentFolder:null,files:[],filesSearched:null,selectedIds:[],inProgress:[],dropzone:!1,shareOpen:null,versions:[],currentFileOutgoingShares:[],currentFileOutgoingSharesError:null,currentFileOutgoingSharesLoading:!1,incomingShares:[],incomingSharesError:null,incomingSharesLoading:!1,sharesTree:{},sharesTreeError:null,sharesTreeLoading:!1,loadingFolder:!1,publicLinkPassword:null,uploaded:[],actionsInProgress:[],publicLinkInEdit:{id:null,name:"",permissions:1,hasPassword:!1,expireDate:null},areHiddenFilesShown:!0},getters:{inProgress:e=>e.inProgress,selectedFiles:(e,t)=>t.filesAll.filter((t=>e.selectedIds.includes(t.id))),files:e=>e.files,filesAll:e=>e.filesSearched||e.files,currentFolder:e=>e.currentFolder,flatFileList:e=>!1==!!e.currentFolder,activeFiles:(e,t)=>{let s=[].concat(t.filesAll);return e.areHiddenFilesShown||(s=s.filter((e=>!e.name.startsWith(".")))),s},totalFilesSize:(e,t)=>t.filesAll.map((e=>parseInt(e.size))).reduce(((e,t)=>e+t),0),totalFilesCount:(e,t)=>({files:t.filesAll.filter((e=>"file"===e.type)).length,folders:t.filesAll.filter((e=>"folder"===e.type)).length}),dropzone:e=>e.dropzone,currentFileOutgoingCollaborators:e=>e.currentFileOutgoingShares.filter((e=>s.ShareTypes.containsAnyValue(s.ShareTypes.authenticated,[e.shareType]))),currentFileOutgoingLinks:e=>e.currentFileOutgoingShares.filter((e=>s.ShareTypes.containsAnyValue(s.ShareTypes.unauthenticated,[e.shareType]))),currentFileOutgoingSharesLoading:e=>e.currentFileOutgoingSharesLoading,sharesTree:e=>e.sharesTree,sharesTreeLoading:e=>e.sharesTreeLoading,loadingFolder:(e,t)=>e.loadingFolder||null===t.highlightedFile&&e.sharesTreeLoading,quota:e=>e.quota,highlightedFile:(e,t)=>t.selectedFiles.length>0?t.selectedFiles[0]:e.currentFolder,versions:e=>e.versions,publicLinkPassword:t=>{if(t.publicLinkPassword)return t.publicLinkPassword;let s=sessionStorage.getItem("publicLinkInfo");if(s)try{s=e.Buffer.from(s,"base64").toString()}catch(e){sessionStorage.removeItem("publicLinkInfo")}return s},uploaded:e=>e.uploaded,actionsInProgress:e=>e.actionsInProgress},actions:{updateFileProgress({commit:e},t){e("UPDATE_FILE_PROGRESS",t)},addFileToProgress({commit:e},t){e("ADD_FILE_TO_PROGRESS",t)},removeFileFromProgress({commit:e},t){e("REMOVE_FILE_FROM_PROGRESS",t)},loadFiles(e,{currentFolder:s,files:i}){s&&(s=t.buildResource(s)),i=i.map(t.buildResource),e.commit("LOAD_FILES",{currentFolder:s,files:i})},toggleFileSelection(e,t){e.state.selectedIds.includes(t.id)?e.commit("REMOVE_FILE_SELECTION",t):e.commit("ADD_FILE_SELECTION",t)},resetFileSelection(e){e.commit("RESET_SELECTION")},markFavorite(e,t){const s=t.file,i=t.client,a=!s.starred;return i.files.favorite(s.webDavPath,a).then((()=>{e.commit("UPDATE_RESOURCE_FIELD",{id:s.id,field:"starred",value:a})})).catch((e=>{throw new Error(e)}))},deleteFiles(e,{files:t,client:i,publicPage:a,firstRun:r=!0}){const o=[];for(const n of t){let t=null;t=a?i.publicFiles.delete(n.path,null,e.getters.publicLinkPassword):i.files.delete(n.webDavPath);const l=t.then((()=>{e.dispatch("sidebar/close"),e.commit("REMOVE_FILE",n),e.commit("REMOVE_FILE_SELECTION",n),e.commit("REMOVE_FILE_FROM_SEARCHED",n)})).catch((t=>{let o=s.$gettext('Failed to delete "%{file}"');if(423===t.statusCode){if(r)return e.dispatch("deleteFiles",{files:[n],client:i,publicPage:a,firstRun:!1});o=s.$gettext('Failed to delete "%{file}" - the file is locked')}const l=s.$gettextInterpolate(o,{file:n.name},!0);e.dispatch("showMessage",{title:l,status:"danger"},{root:!0})}));o.push(l)}return Promise.all(o)},async clearTrashBin(e){await e.dispatch("sidebar/close"),e.commit("CLEAR_FILES"),e.commit("RESET_SELECTION"),e.commit("CLEAR_FILES_SEARCHED")},async removeFilesFromTrashbin(e,t){await e.dispatch("sidebar/close");for(const s of t)e.commit("REMOVE_FILE",s),e.commit("REMOVE_FILE_SELECTION",s),e.commit("REMOVE_FILE_FROM_SEARCHED",s)},renameFile(e,{file:t,newValue:s,client:i,publicPage:a,isSameResource:r}){if(void 0!==t&&void 0!==s&&s!==t.name){const o=t.webDavPath.substr(1,t.webDavPath.lastIndexOf("/"));return a?i.publicFiles.move(t.webDavPath,o+s,e.getters.publicLinkPassword).then((()=>{r||e.commit("RENAME_FILE",{file:t,newValue:s,newPath:o})})):i.files.move(t.webDavPath,o+s).then((()=>{r||e.commit("RENAME_FILE",{file:t,newValue:s,newPath:o})}))}},updateCurrentFileShareTypes({state:e,getters:t,commit:s}){const i=t.highlightedFile;i&&s("UPDATE_RESOURCE_FIELD",{id:i.id,field:"shareTypes",value:va(e.currentFileOutgoingShares)})},loadCurrentFileOutgoingShares(e,{client:s,graphClient:i,path:a,resource:r,storageId:o}){let n;if(e.commit("CURRENT_FILE_OUTGOING_SHARES_SET",[]),e.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",null),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!0),o&&(n=`${o}${a}`),"space"===r?.type){const o=[],l=[],c=[];for(const e of Object.keys(r.spaceRoles))for(const s of r.spaceRoles[e])o.push(i.users.getUser(s).then((s=>{l.push(t.buildSpaceShare({...s.data,role:e},r.id))})));return o.push(s.shares.getShares(a,{reshares:!0,spaceRef:n}).then((s=>{for(const i of s)c.push(t.buildShare(i.shareInfo,e.getters.highlightedFile,!e.rootGetters.isOcis))}))),Promise.all(o).then((()=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_SET",[...fa(l),...c]),e.dispatch("updateCurrentFileShareTypes"),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)})).catch((t=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",t.message),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)}))}s.shares.getShares(a,{reshares:!0,spaceRef:n}).then((s=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_SET",s.map((s=>t.buildShare(s.shareInfo,e.getters.highlightedFile,ga(e.rootGetters))))),e.dispatch("updateCurrentFileShareTypes"),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)})).catch((t=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",t.message),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)}))},loadIncomingShares(e,s){e.commit("INCOMING_SHARES_LOAD",[]),e.commit("INCOMING_SHARES_ERROR",null),e.commit("INCOMING_SHARES_LOADING",!0);const i=s.client,a=s.path;i.shares.getShares(a,{shared_with_me:!0}).then((s=>{e.commit("INCOMING_SHARES_LOAD",s.map((s=>t.buildCollaboratorShare(s.shareInfo,e.getters.highlightedFile,ga(e.rootGetters))))),e.commit("INCOMING_SHARES_LOADING",!1)})).catch((t=>{e.commit("INCOMING_SHARES_ERROR",t.message),e.commit("INCOMING_SHARES_LOADING",!1)}))},changeShare({commit:e,getters:i,rootGetters:a},{client:r,graphClient:o,share:n,permissions:l,expirationDate:c}){const d={permissions:l,expireDate:c};return d.permissions?n.shareType===s.ShareTypes.space.value?new Promise(((i,a)=>{r.shares.shareSpaceWithUser("",n.collaborator.name,n.id,{permissions:l}).then((()=>{const a={role:s.SpacePeopleShareRoles.getByBitmask(l).name,onPremisesSamAccountName:n.collaborator.name,displayName:n.collaborator.displayName},r=t.buildSpaceShare(a,n.id);e("CURRENT_FILE_OUTGOING_SHARES_UPDATE",r),o.drives.getDrive(n.id).then((s=>{const i=t.buildSpace(s.data);e("UPDATE_RESOURCE_FIELD",{id:n.id,field:"spaceRoles",value:i.spaceRoles})})),i(r)})).catch((e=>{a(e)}))})):new Promise(((s,o)=>{r.shares.updateShare(n.id,d).then((r=>{const o=t.buildCollaboratorShare(r.shareInfo,i.highlightedFile,ga(a));e("CURRENT_FILE_OUTGOING_SHARES_UPDATE",o),s(o)})).catch((e=>{o(e)}))})):new Promise(((e,t)=>{t(new Error("Nothing changed"))}))},addShare(e,{client:i,graphClient:a,path:r,shareWith:o,shareType:n,permissions:l,expirationDate:c,storageId:d,displayName:u}){let h;if(d&&(h=`${d}${r}`),n===s.ShareTypes.group.value)return void i.shares.shareFileWithGroup(r,o,{permissions:l,expirationDate:c,spaceRef:h}).then((s=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_ADD",t.buildCollaboratorShare(s.shareInfo,e.getters.highlightedFile,ga(e.rootGetters))),e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:i,currentFolder:r})})).catch((t=>{e.dispatch("showMessage",{title:s.$gettext("Error while sharing."),desc:t,status:"danger"},{root:!0})}));if(n===s.ShareTypes.space.value)return void i.shares.shareSpaceWithUser(r,o,d,{permissions:l}).then((()=>{const i={role:s.SpacePeopleShareRoles.getByBitmask(l).name,onPremisesSamAccountName:o,displayName:u};return e.commit("CURRENT_FILE_OUTGOING_SHARES_ADD",t.buildSpaceShare(i,d)),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!0),a.drives.getDrive(d).then((s=>{const i=t.buildSpace(s.data);e.commit("UPDATE_RESOURCE_FIELD",{id:d,field:"spaceRoles",value:i.spaceRoles}),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)}))})).catch((t=>{e.dispatch("showMessage",{title:s.$gettext("Error while sharing."),desc:t,status:"danger"},{root:!0})}));const p=n===s.ShareTypes.remote.value;i.shares.shareFileWithUser(r,o,{permissions:l,remoteUser:p,expirationDate:c,spaceRef:h}).then((s=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_ADD",t.buildCollaboratorShare(s.shareInfo,e.getters.highlightedFile,ga(e.rootGetters))),e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:i,currentFolder:r,storageId:d})})).catch((t=>{e.dispatch("showMessage",{title:s.$gettext("Error while sharing."),desc:t,status:"danger"},{root:!0})}))},deleteShare(e,{client:i,graphClient:a,share:r,resource:o,storageId:n}){const l={};r.shareType===s.ShareTypes.space.value&&(l.shareWith=r.collaborator.name),i.shares.deleteShare(r.id,l).then((()=>{if(e.commit("CURRENT_FILE_OUTGOING_SHARES_REMOVE",r),r.shareType===s.ShareTypes.space.value)return e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!0),a.drives.getDrive(r.id).then((s=>{const i=t.buildSpace(s.data);e.commit("UPDATE_RESOURCE_FIELD",{id:r.id,field:"spaceRoles",value:i.spaceRoles}),e.commit("CURRENT_FILE_OUTGOING_SHARES_LOADING",!1)}));e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:i,currentFolder:o.path,storageId:n})})).catch((e=>{console.error(e)}))},pruneSharesTreeOutsidePath(e,t){e.commit("SHARESTREE_PRUNE_OUTSIDE_PATH",t)},loadSharesTree(s,{client:i,path:a,storageId:r}){s.commit("SHARESTREE_ERROR",null),s.dispatch("pruneSharesTreeOutsidePath",a);const o=u(a,!0),n={};if(!o.length)return Promise.resolve();let l;r&&(l=`${r}${a}`),o.pop(),s.commit("SHARESTREE_LOADING",!0);const c=new e._default({concurrency:2}),d=[];return o.forEach((e=>{if(s.getters.sharesTree[e])return Promise.resolve();n[e]=[],d.push(c.add((()=>i.shares.getShares(e,{reshares:!0,spaceRef:l}).then((i=>{i.forEach((i=>{n[e].push({...t.buildShare(i.shareInfo,{type:"folder"},ga(s.rootGetters)),outgoing:!0,indirect:!0})}))})).catch((e=>{console.error("SHARESTREE_ERROR",e),s.commit("SHARESTREE_ERROR",e.message),s.commit("SHARESTREE_LOADING",!1)}))))),d.push(c.add((()=>i.shares.getShares(e,{shared_with_me:!0,spaceRef:l}).then((i=>{i.forEach((i=>{n[e].push({...t.buildCollaboratorShare(i.shareInfo,{type:"folder"},ga(s.rootGetters)),incoming:!0,indirect:!0})}))})).catch((e=>{console.error("SHARESTREE_ERROR",e),s.commit("SHARESTREE_ERROR",e.message),s.commit("SHARESTREE_LOADING",!1)})))))})),Promise.all(d).then((()=>{s.commit("SHARESTREE_ADD",n),s.commit("SHARESTREE_LOADING",!1)}))},async loadVersions(e,{client:t,fileId:s}){let i;try{i=await t.fileVersions.listVersions(s)}catch(e){console.error(e),i=[]}e.commit("SET_VERSIONS",i)},dragOver(e,t){e.commit("DRAG_OVER",t)},setPublicLinkPassword(e,t){e.commit("SET_PUBLIC_LINK_PASSWORD",t)},addLink:(e,{path:s,client:i,params:a,storageId:r})=>new Promise(((o,n)=>{i.shares.shareFileWithLink(s,a).then((a=>{const n=t.buildShare(a.shareInfo,null,ga(e.rootGetters));e.commit("CURRENT_FILE_OUTGOING_SHARES_ADD",n),e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:i,currentFolder:s,storageId:r}),o(n)})).catch((e=>{n(e)}))})),updateLink:(e,{id:s,client:i,params:a})=>new Promise(((r,o)=>{i.shares.updateShare(s,a).then((s=>{const i=t.buildShare(s.shareInfo,null,ga(e.rootGetters));e.commit("CURRENT_FILE_OUTGOING_SHARES_UPDATE",i),r(i)})).catch((e=>{o(e)}))})),removeLink(e,{share:t,client:s,resource:i,storageId:a}){s.shares.deleteShare(t.id).then((()=>{e.commit("CURRENT_FILE_OUTGOING_SHARES_REMOVE",t),e.dispatch("updateCurrentFileShareTypes"),e.dispatch("loadIndicators",{client:s,currentFolder:i.path,storageId:a})})).catch((t=>e.commit("CURRENT_FILE_OUTGOING_SHARES_ERROR",t.message)))},addActionToProgress({commit:e},t){e("ADD_ACTION_TO_PROGRESS",t)},removeActionFromProgress({commit:e},t){e("REMOVE_ACTION_FROM_PROGRESS",t)},pushResourcesToDeleteList({commit:e},t){e("PUSH_RESOURCES_TO_DELETE_LIST",t)},clearResourcesToDeleteList({commit:e}){e("CLEAR_RESOURCES_TO_DELETE_LIST")},async loadIndicators({dispatch:t,commit:s},{client:i,currentFolder:a,storageId:r}){s("SHARESTREE_PRUNE_OUTSIDE_PATH",e.dirname(a)),await t("loadSharesTree",{client:i,path:a,storageId:r}),s("LOAD_INDICATORS")},loadAvatars({commit:t,rootGetters:s},{resource:i}){s.capabilities.files_sharing.user.profile_picture&&["sharedWith","owner"].forEach((a=>{(i[a]||[]).forEach(((r,o)=>{e.has(r,"avatar")&&pa({clientService:this.$clientService,username:r.username,server:s.configuration.server,token:s.getToken},!0).then((e=>t("UPDATE_RESOURCE_FIELD",{id:i.id,field:`${a}.[${o}].avatar`,value:e})))}))}))},async loadPreview({commit:e,rootGetters:t},{resource:s,isPublic:i,dimensions:a,type:r}){if(t.previewFileExtensions.length&&!t.previewFileExtensions.includes(s.extension.toLowerCase()))return;const o=await R({resource:s,isPublic:i,dimensions:a,server:t.configuration.server,userId:t.user.id,token:t.getToken},!0);o&&e("UPDATE_RESOURCE_FIELD",{id:s.id,field:r,value:o})}},mutations:{UPDATE_FILE_PROGRESS(e,t){const s=[...e.inProgress],i=s.findIndex((e=>e.id===t.id));-1!==i&&(s[i].progress=t.progress,e.inProgress=s)},ADD_FILE_TO_PROGRESS(e,t){const s=[...e.inProgress];s.push({id:t.id,name:t.name,type:t.type,size:t.size,progress:0,action:"upload"}),e.inProgress=s},REMOVE_FILE_FROM_PROGRESS(e,t){const s=[...e.inProgress],i=s.findIndex((e=>e.id===t.id));if(s.splice(i,1),s.length<1)return e.inProgress=[],void(e.uploaded=[]);e.inProgress=s;const a=[...e.uploaded];t.progress=100,a.push(t),e.uploaded=a},LOAD_FILES(e,{currentFolder:t,files:s}){e.currentFolder=t,e.files=s},SET_CURRENT_FOLDER(e,t){e.currentFolder=t},CLEAR_FILES(e){e.files=[]},LOAD_FILES_SEARCHED(e,t){e.filesSearched=t},REMOVE_FILE_FROM_SEARCHED(e,t){e.filesSearched&&(e.filesSearched=e.filesSearched.filter((e=>t.id!==e.id)))},CLEAR_FILES_SEARCHED(e){e.filesSearched=null},SET_FILE_SELECTION(e,t){e.selectedIds=t.map((e=>e.id))},ADD_FILE_SELECTION(e,t){const s=[...e.selectedIds];-1===s.findIndex((e=>e===t.id))&&(s.push(t.id),e.selectedIds=s)},REMOVE_FILE_SELECTION(e,t){const s=[...e.selectedIds];s.length>1?e.selectedIds=s.filter((e=>t.id!==e)):e.selectedIds=[]},RESET_SELECTION(e){e.selectedIds=[]},REMOVE_FILE(e,t){e.files=[...e.files].filter((e=>e.id!==t.id))},RENAME_FILE(e,{file:s,newValue:i,newPath:a}){const r=[...e.files],o=r.findIndex((e=>e.id===s.id));t.renameResource(r[o],i,a),e.files=r},DRAG_OVER(e,t){e.dropzone=t},CURRENT_FILE_OUTGOING_SHARES_SET(e,t){e.currentFileOutgoingShares=t},CURRENT_FILE_OUTGOING_SHARES_ADD(e,t){e.currentFileOutgoingShares.push(t)},CURRENT_FILE_OUTGOING_SHARES_REMOVE(e,t){t.shareType!==s.ShareTypes.space.value?e.currentFileOutgoingShares=e.currentFileOutgoingShares.filter((e=>t.id!==e.id)):e.currentFileOutgoingShares=e.currentFileOutgoingShares.filter((e=>t.id===e.id&&t.collaborator.name!==e.collaborator.name))},CURRENT_FILE_OUTGOING_SHARES_UPDATE(t,i){let a;a=i.shareType===s.ShareTypes.space.value?t.currentFileOutgoingShares.findIndex((e=>i.id===e.id&&i.collaborator.name===e.collaborator.name)):t.currentFileOutgoingShares.findIndex((e=>e.id===i.id)),a>=0?e.Vue.set(t.currentFileOutgoingShares,a,i):t.currentFileOutgoingShares.push(i)},CURRENT_FILE_OUTGOING_SHARES_ERROR(e,t){e.currentFileOutgoingShares=[],e.currentFileOutgoingSharesError=t},CURRENT_FILE_OUTGOING_SHARES_LOADING(e,t){e.currentFileOutgoingSharesLoading=t},INCOMING_SHARES_LOAD(e,t){e.incomingShares=t},INCOMING_SHARES_ERROR(e,t){e.incomingShares=[],e.incomingSharesError=t},INCOMING_SHARES_LOADING(e,t){e.incomingSharesLoading=t},SHARESTREE_PRUNE_OUTSIDE_PATH(t,s){""!==s&&"/"!==s?("/"!==(s+="/").charAt(0)&&(s="/"+s),t.sharesTree=e.pickBy(t.sharesTree,((e,t)=>s.startsWith(t+"/")))):t.sharesTree={}},SHARESTREE_ADD(e,t){e.sharesTree=Object.assign({},e.sharesTree,t)},SHARESTREE_ERROR(e,t){e.sharesTreeError=t},SHARESTREE_LOADING(e,t){e.sharesTreeLoading=t},UPDATE_FOLDER_LOADING(e,t){e.loadingFolder=t},SET_PUBLIC_LINK_PASSWORD(t,s){if(t.publicLinkPassword=s,s){const t=e.Buffer.from(s).toString("base64");sessionStorage.setItem("publicLinkInfo",t)}else sessionStorage.removeItem("publicLinkInfo")},ADD_ACTION_TO_PROGRESS(e,t){e.actionsInProgress.push(t)},REMOVE_ACTION_FROM_PROGRESS(e,t){const s=e.actionsInProgress.findIndex((e=>e===t));e.actionsInProgress.splice(s,1)},CLEAR_CURRENT_FILES_LIST(e){e.currentFolder=null,e.selectedIds=[],e.files.forEach((e=>{e.previewUrl&&e.previewUrl.startsWith("blob:")&&window.URL.revokeObjectURL(e.previewUrl)})),e.files=[]},SET_VERSIONS(e,t){e.versions=t},TRIGGER_PUBLIC_LINK_EDIT(t,s){s={id:s.id,name:s.name,permissions:parseInt(s.permissions,10),hasPassword:s.password,expireDate:null!==s.expiration?e.DateTime_1.fromISO(s.expiration).endOf("day").toISO():null},t.publicLinkInEdit=s},TRIGGER_PUBLIC_LINK_CREATE(e,{name:t,expireDate:s}){e.publicLinkInEdit={id:null,name:t,permissions:1,hasPassword:!1,expireDate:s}},LOAD_INDICATORS(e){for(const t of e.files){const s=S(t,e.sharesTree);(s||t.indicators.length)&&this.commit("Files/UPDATE_RESOURCE_FIELD",{id:t.id,field:"indicators",value:s})}},UPSERT_RESOURCE(e,t){_a(e,t,!0)},UPDATE_RESOURCE(e,t){_a(e,t,!1)},UPDATE_RESOURCE_FIELD(t,s){let i=t.filesSearched||t.files,a=i.findIndex((e=>e.id===s.id));if(a<0){if(t.currentFolder?.id!==s.id)return;i=[t.currentFolder],a=0}const r=i[a],o=e.has(r,s.field),n=e.set(r,s.field,s.value);o||e.Vue.set(i,a,n)},SET_HIDDEN_FILES_VISIBILITY(e,t){e.areHiddenFilesShown=t,window.localStorage.setItem("oc_hiddenFilesShown",t)}},modules:{sidebar:{namespaced:!0,state:()=>({closed:!0,activePanel:null}),mutations:{SET_CLOSED(e,t){e.closed=t},SET_ACTIVE_PANEL(e,t){e.activePanel=t}},actions:{open({commit:e}){e("SET_CLOSED",!1),e("SET_ACTIVE_PANEL",null)},openWithPanel({commit:e},t){e("SET_CLOSED",!1),e("SET_ACTIVE_PANEL",t)},close({commit:e}){e("SET_CLOSED",!0),e("SET_ACTIVE_PANEL",null)},toggle({commit:e,state:t}){e("SET_CLOSED",!t.closed)},setActivePanel({commit:e},t){e("SET_ACTIVE_PANEL",t)},resetActivePanel({commit:e}){e("SET_ACTIVE_PANEL",null)}}}}};const Sa=new e.VisibilityObserver;const xa={mixins:[It],props:{searchResult:{type:Object,default:function(){return{}}},provider:{type:Object,default:function(){return{}}}},setup:()=>({hasSpaces:P(),resourceTargetLocation:V("files-spaces-personal-home")}),data:()=>({resource:void 0}),computed:{...e.mapGetters(["configuration","user","getToken"]),defaultParentFolderName(){return this.hasSpaces?this.$gettext("Personal"):this.$gettext("All files and folders")}},beforeMount(){this.resource=this.searchResult.data},mounted(){const t=e.debounce((async({unobserve:t})=>{t();const s=await R({resource:this.resource,isPublic:!1,dimensions:ut.ThumbNail,server:this.configuration.server,userId:this.user.id,token:this.getToken},!0);s&&e.Vue.set(this.resource,"preview",s)}),250);Sa.observe(this.$el,{onEnter:t,onExit:t.cancel})},beforeDestroy(){Sa.disconnect()},methods:{folderLink(e){return this.createFolderLink(e.path,e.storageId)},parentFolderLink(t){return this.createFolderLink(e.path.dirname(t.path),t.storageId)},createFolderLink(e,t){return null===this.resourceTargetLocation?{}:{name:this.resourceTargetLocation.name,query:this.resourceTargetLocation.query,params:{item:e.replace(/^\//,""),...this.resourceTargetLocation.params,...t&&{storageId:t}}}}}};var ya=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-search-preview",on:{click:function(t){return e.$_fileActions_triggerDefaultAction(e.resource)}}},[s("oc-resource",{attrs:{resource:e.resource,"is-path-displayed":!0,"folder-link":e.folderLink(e.resource),"parent-folder-link":e.parentFolderLink(e.resource),"parent-folder-name-default":e.defaultParentFolderName}})],1)};ya._withStripped=!0;const wa=e.normalizeComponent({render:ya,staticRenderFns:[]},undefined,xa,undefined,false,undefined,!1,void 0,void 0,void 0);class $a{component;available;store;constructor(e){this.component=wa,this.store=e,this.available=!0}search(e){const t=T(this.store.getters["Files/files"],e,5).map((e=>({id:e.id,data:{...e}})));return Promise.resolve(t)}activate(){}}class Ca extends r.EventBus{id;label;previewSearch;store;router;constructor(e,t){super(),this.id="files.filter",this.label="Search current folder ↵",this.store=e,this.router=t,this.previewSearch=new $a(e)}activate(e){if(!e)return;const t=T(this.store.getters["Files/files"],e);this.publish("activate",{term:e,resources:t})}reset(){this.publish("reset")}updateTerm(e){this.publish("updateTerm",e)}get available(){return Q(this.router,"files-spaces-personal-home")}}var Fa,Ea;class Ra{component;cache;router;constructor(e){this.component=wa,this.router=e,this.cache=new s.Cache({ttl:1e4,capacity:100})}async search(e){if(!e)return;if(this.cache.has(e))return this.cache.get(e);const i=await s.clientService.owncloudSdk.files.search(e,5,s.DavProperties.Default);return this.cache.set(e,i.map((e=>{const s=t.buildResource(e);return{id:s.id,data:s}})))}get available(){return"search-provider-list"!==this.router.currentRoute.name}activate(){}}e.__decorate([(Fa=500,function(t,s,i){const a=i.value,r=e.debounce((async function(e,...t){try{const s=await a.apply(this,t);e.resolve(s)}catch(t){e.reject(t)}}),Fa,Ea);i.value=function(...e){return new Promise(((t,s)=>{r.apply(this,[{resolve:t,reject:s},...e])}))}})],Ra.prototype,"search",null);const Ta=new e.VisibilityObserver;const ka=e.defineComponent({components:{AppBar:ds,ContextActions:Jt,ListInfo:gs,Pagination:bs,NoContentMessage:e.__vue_component__$2,ResourceTable:gt},mixins:[It,Dt,di],props:{searchResults:{type:Array,default:function(){return[]}}},setup:()=>({...Ke(),resourceTargetLocation:V("files-spaces-personal-home")}),computed:{...e.mapGetters(["configuration"]),...e.mapGetters("Files",["totalFilesCount","totalFilesSize"]),displayThumbnails(){return!this.configuration.options.disablePreviews}},watch:{searchResults:{handler:function(){this.CLEAR_CURRENT_FILES_LIST(),this.LOAD_FILES({currentFolder:null,files:this.searchResults.length?this.searchResults.map((e=>e.data)):[]})},immediate:!0}},beforeDestroy(){Ta.disconnect()},methods:{...e.mapMutations("Files",["CLEAR_CURRENT_FILES_LIST","LOAD_FILES"]),...e.mapActions("Files",["loadPreview"]),rowMounted(t,s){if(!this.displayThumbnails)return;const i=e.debounce((({unobserve:e})=>{e(),this.loadPreview({resource:t,isPublic:!1,dimensions:ut.Thumbnail,type:ht.Thumbnail})}),250);Ta.observe(s.$el,{onEnter:i,onExit:i.cancel})}}});var Ia=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-search-result"},[s("app-bar",{attrs:{"has-bulk-actions":!0}}),e._v(" "),e.paginatedResources.length?s("resource-table",{staticClass:"files-table",class:{"files-table-squashed":!1},attrs:{resources:e.paginatedResources,"target-route":e.resourceTargetLocation,"are-paths-displayed":!0,"are-thumbnails-displayed":e.displayThumbnails,"has-actions":!0,"is-selectable":!1},on:{fileClick:e.$_fileActions_triggerDefaultAction,rowMounted:e.rowMounted},scopedSlots:e._u([{key:"contextMenu",fn:function(t){var i=t.resource;return[e.isResourceInSelection(i)?s("context-actions",{attrs:{items:e.selectedResources}}):e._e()]}},{key:"footer",fn:function(){return[s("pagination",{attrs:{pages:e.paginationPages,"current-page":e.paginationPage}}),e._v(" "),e.paginatedResources.length>0?s("list-info",{staticClass:"oc-width-1-1 oc-my-s",attrs:{files:e.totalFilesCount.files,folders:e.totalFilesCount.folders,size:e.totalFilesSize}}):e._e()]},proxy:!0}]),model:{value:e.selectedResources,callback:function(t){e.selectedResources=t},expression:"selectedResources"}}):s("no-content-message",{staticClass:"files-empty",attrs:{icon:"folder"},scopedSlots:e._u([{key:"message",fn:function(){return[s("p",{staticClass:"oc-text-muted"},[e.$route.query.term?s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("No resource found")]):s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("No search term entered")])])]},proxy:!0}],null,!1,390334571)})],1)};Ia._withStripped=!0;const Da=e.normalizeComponent({render:Ia,staticRenderFns:[]},undefined,ka,undefined,false,undefined,!1,void 0,void 0,void 0);class Pa{component;constructor(){this.component=Da}async search(e){if(!e)return[];return(await s.clientService.owncloudSdk.files.search(e,void 0,s.DavProperties.Default)).map((e=>{const s=t.buildResource(e);return{id:s.id,data:s}}))}}class La extends r.EventBus{id;label;previewSearch;listSearch;store;router;constructor(e,t){super(),this.id="files.sdk",this.label="Search all files ↵",this.previewSearch=new Ra(t),this.listSearch=new Pa,this.store=e,this.router=t}activate(e){const t="files-common-search";(e||this.router.currentRoute.name===t)&&this.router.push({name:t,query:{term:e,provider:this.id}}).catch((()=>{}))}reset(){}updateTerm(){}get available(){const{hideSearchBar:t}=this.store.getters["Search/options"];return!e.get(this.store,"state.config.options.hideSearchBar",t)}}const Aa=e.defineComponent({name:"FileDetails",mixins:[L,be],inject:["displayedItem"],setup(){const t=e.ref(""),s=i.useRouter(),a=i.useRoute(),r=e.computed((()=>Q(s,"files-spaces-project")?V("files-spaces-project",{params:{storageId:a.value.params.storageId,item:t.value}}):V("files-spaces-personal-home",{params:{item:t.value}})));return{sharedParentDir:t,sharedParentRoute:r}},data:()=>({loading:!1,sharedByName:"",sharedByDisplayName:"",sharedTime:0,sharedItem:null,shareIndicators:[]}),computed:{...e.mapGetters("Files",["versions","sharesTree","sharesTreeLoading"]),...e.mapGetters(["user","getToken","configuration"]),file(){return this.displayedItem.value},hasContent(){return this.hasTimestamp||this.ownerDisplayName||this.showSize||this.showShares||this.showVersions},noContentText(){return this.$gettext("No information to display")},detailsTableLabel(){return this.$gettext("Overview of the information about the selected file")},shareDateLabel(){return this.$gettext("Shared:")},sharedViaLabel(){return this.$gettext("Shared via:")},sharedViaTooltip(){return this.$gettextInterpolate(this.$gettext("Navigate to '%{folder}'"),{folder:this.sharedParentDir||""},!0)},showSharedBy(){return this.showShares&&!this.ownedByCurrentUser&&!this.sharesTreeLoading&&this.sharedByDisplayName&&this.sharedByName!==this.file.ownerId},showSharedVia(){return this.showShares&&!this.sharesTreeLoading&&this.file.path!==this.sharedParentDir&&null!==this.sharedParentDir},showShares(){return this.hasAnyShares&&O(this.$route)},detailSharingInformation(){return"folder"===this.file.type?this.$gettext("This folder has been shared."):this.$gettext("This file has been shared.")},sharedByLabel(){return this.$gettext("Shared by:")},hasTimestamp(){return this.file.mdate?.length>0},timestampTitle(){return this.$gettext("Last modified:")},ownerTitle(){return this.$gettext("Owner:")},ownerDisplayName(){return this.file.ownerDisplayName||this.file.shareOwnerDisplayname||this.file.owner?.[0].displayName},ownerAdditionalInfo(){return this.file.owner?.[0].additionalInfo},showSize(){return"?"!==this.getResourceSize(this.file.size)},sizeTitle(){return this.$gettext("Size:")},showVersions(){if("folder"!==this.file.type)return this.versions.length>0&&O(this.$route)},versionsTitle(){return this.$gettext("Versions:")},seeVersionsLabel(){return this.$gettext("See all versions")},capitalizedTimestamp(){const t=this.formDateFromHTTP(this.file.mdate);return e.upperFirst(t)},hasAnyShares(){return this.file.shareTypes?.length>0||this.file.indicators?.length>0||null!==this.sharedItem},ownedByCurrentUser(){return this.file.ownerId===this.user.id||this.file.owner?.[0].username===this.user.id||this.file.shareOwner===this.user.id}},watch:{file(){this.loadData().then(this.refreshShareDetailsTree)},sharesTree(){this.sharedItem=null,this.shareIndicators=S(this.file,this.sharesTree);const e=this.getParentSharePath(this.file.path,this.sharesTree);if(null===e)return;const t=this.sharesTree[e]?.filter((e=>s.ShareTypes.containsAnyValue(s.ShareTypes.individuals,[e.shareType])));0!==t.length&&(this.sharedItem=t[0],this.sharedByName=this.sharedItem.owner?.name,this.sharedByDisplayName=this.sharedItem.owner?.displayName,this.sharedItem.owner?.additionalInfo&&(this.sharedByDisplayName+=" ("+this.sharedItem.owner.additionalInfo+")"),this.sharedTime=this.sharedItem.stime,this.sharedParentDir=e)}},mounted(){this.loadData(),this.refreshShareDetailsTree()},asyncComputed:{preview:{async get(){return await new Promise((e=>setTimeout(e,500))),R({resource:this.file,isPublic:!O(this.$route),dimensions:ut.Preview,server:this.configuration.server,userId:this.user.id,token:this.getToken})},lazy:!0,watch:["file.id"]}},methods:{...e.mapActions("Files",["loadPreview","loadVersions","loadSharesTree"]),...e.mapActions("Files/sidebar",{setSidebarPanel:"setActivePanel"}),async refreshShareDetailsTree(){await this.loadSharesTree({client:this.$client,path:this.file.path,$gettext:this.$gettext,storageId:this.$route.params.storageId}),this.shareIndicators=S(this.file,this.sharesTree)},getParentSharePath(t,s){let i=t;if(!i)return null;for(;"/"!==i;){const t=s[i];if(void 0!==t&&void 0!==t[0])return i;i=e.path.dirname(i)}return null},expandPeoplesPanel(){this.setSidebarPanel("sharing-item")},expandLinksPanel(){this.setSidebarPanel("links-item")},expandVersionsPanel(){this.setSidebarPanel("versions-item")},async loadData(){this.loading=!0;const e=[];"file"===this.file.type&&O(this.$route)&&e.push(this.loadVersions({client:this.$client,fileId:this.file.id})),await Promise.all(e.map((e=>e.catch((e=>e))))),this.loading=!1}}});var Ma=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-file-details-sidebar"}},[e.hasContent?s("div",[e.file.thumbnail?s("div",{key:"file-thumbnail",staticClass:"details-preview oc-flex oc-flex-middle oc-flex-center oc-mb",style:{"background-image":e.$asyncComputed.preview.updating?"none":"url("+e.preview+")"},attrs:{"data-testid":"preview"}},[e.$asyncComputed.preview.updating?s("oc-spinner"):e._e()],1):e._e(),e._v(" "),e.shareIndicators.length?s("div",{key:"file-shares",staticClass:"oc-flex oc-flex-middle oc-my-m",attrs:{"data-testid":"sharingInfo"}},[s("oc-status-indicators",{attrs:{resource:e.file,indicators:e.shareIndicators}}),e._v(" "),s("p",{staticClass:"oc-my-rm oc-mx-s",domProps:{textContent:e._s(e.detailSharingInformation)}})],1):e._e(),e._v(" "),s("table",{staticClass:"details-table",attrs:{"aria-label":e.detailsTableLabel}},[e.hasTimestamp?s("tr",{attrs:{"data-testid":"timestamp"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.timestampTitle)}}),e._v(" "),s("td",[e.showVersions?s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.seeVersionsLabel,expression:"seeVersionsLabel"}],attrs:{appearance:"raw","aria-label":e.seeVersionsLabel},domProps:{textContent:e._s(e.capitalizedTimestamp)},on:{click:e.expandVersionsPanel}}):s("span",{domProps:{textContent:e._s(e.capitalizedTimestamp)}})],1)]):e._e(),e._v(" "),e.showSharedVia?s("tr",{attrs:{"data-testid":"shared-via"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sharedViaLabel)}}),e._v(" "),s("td",[s("router-link",{attrs:{to:e.sharedParentRoute}},[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.sharedViaTooltip,expression:"sharedViaTooltip"}],domProps:{textContent:e._s(e.sharedParentDir)}})])],1)]):e._e(),e._v(" "),e.showSharedBy?s("tr",{attrs:{"data-testid":"shared-by"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sharedByLabel)}}),e._v(" "),s("td",[s("span",{domProps:{textContent:e._s(e.sharedByDisplayName)}})])]):e._e(),e._v(" "),e.ownerDisplayName?s("tr",{attrs:{"data-testid":"ownerDisplayName"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.ownerTitle)}}),e._v(" "),s("td",[s("p",{staticClass:"oc-m-rm"},[e._v("\n            "+e._s(e.ownerDisplayName)+"\n            "),e.ownedByCurrentUser?s("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("(me)")]):e._e(),e._v(" "),!e.ownedByCurrentUser&&e.ownerAdditionalInfo?s("span",[e._v("("+e._s(e.ownerAdditionalInfo)+")")]):e._e()])])]):e._e(),e._v(" "),e.showSize?s("tr",{attrs:{"data-testid":"sizeInfo"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sizeTitle)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.getResourceSize(e.file.size))}})]):e._e(),e._v(" "),e.showVersions?s("tr",{attrs:{"data-testid":"versionsInfo"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.versionsTitle)}}),e._v(" "),s("td",[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.seeVersionsLabel,expression:"seeVersionsLabel"}],attrs:{appearance:"raw","aria-label":e.seeVersionsLabel},domProps:{textContent:e._s(e.versions.length)},on:{click:e.expandVersionsPanel}})],1)]):e._e()])]):s("p",{attrs:{"data-testid":"noContentText"},domProps:{textContent:e._s(e.noContentText)}})])};Ma._withStripped=!0;const Oa=e.normalizeComponent({render:Ma,staticRenderFns:[]},undefined,Aa,"data-v-3408ba44",false,undefined,!1,void 0,void 0,void 0);const Na=e.defineComponent({name:"FileDetailsMultiple",mixins:[L,be],computed:{...e.mapGetters("Files",["selectedFiles"]),selectedFilesCount(){return this.selectedFiles.length},selectedFilesString(){return this.$gettextInterpolate(this.$ngettext("%{ itemCount } item selected","%{ itemCount } items selected",this.selectedFilesCount),{itemCount:this.selectedFilesCount})},sizeValue(){let e=0;return this.selectedFiles.forEach((t=>e+=parseInt(t.size))),this.getResourceSize(e)},showSize(){return"?"!==this.getResourceSize(this.selectedFiles[0].size)},sizeText(){return this.$gettext("Size")},filesCount(){return this.selectedFiles.filter((e=>"file"===e.type)).length},filesText(){return this.$gettext("Files")},foldersCount(){return this.selectedFiles.filter((e=>"folder"===e.type)).length},foldersText(){return this.$gettext("Folders")},detailsTableLabel(){return this.$gettext("Overview of the information about the selected files")}}});var Ua=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-file-details-multiple-sidebar"}},[s("div",{staticClass:"files-preview oc-mb"},[s("div",{staticClass:"files-preview-body"},[s("oc-icon",{staticClass:"preview-icon",attrs:{size:"xxlarge",variation:"passive",name:"file-copy"}}),e._v(" "),s("p",{staticClass:"preview-text",attrs:{"data-testid":"selectedFilesText"},domProps:{textContent:e._s(e.selectedFilesString)}})],1)]),e._v(" "),s("div",[s("table",{staticClass:"details-table",attrs:{"aria-label":e.detailsTableLabel}},[s("tr",{attrs:{"data-testid":"filesCount"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.filesText)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.filesCount)}})]),e._v(" "),s("tr",{attrs:{"data-testid":"foldersCount"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.foldersText)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.foldersCount)}})]),e._v(" "),e.showSize?s("tr",{attrs:{"data-testid":"size"}},[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.sizeText)}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.sizeValue)}})]):e._e()])])])};Ua._withStripped=!0;const za=e.normalizeComponent({render:Ua,staticRenderFns:[]},undefined,Na,"data-v-b0bdea02",false,undefined,!1,void 0,void 0,void 0);const Ba=e.defineComponent({name:"FileActions",components:{ActionMenuItem:Mt},mixins:[It],computed:{...e.mapGetters("Files",["highlightedFile"]),resources(){return[this.highlightedFile]},actions(){return this.$_fileActions_getAllAvailableActions(this.resources)}}});var Ga=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-list",{staticClass:"oc-mt-s",attrs:{id:"oc-files-actions-sidebar"}},e._l(e.actions,(function(t,i){return s("action-menu-item",{key:"action-"+i,staticClass:"oc-py-xs",attrs:{action:t,items:e.resources}})})),1)};Ga._withStripped=!0;const qa=e.normalizeComponent({render:Ga,staticRenderFns:[]},undefined,Ba,undefined,false,undefined,!1,void 0,void 0,void 0);const Va={name:"FileVersions",mixins:[L,be],data:()=>({loading:!1,DavProperty:s.DavProperty}),computed:{...e.mapGetters("Files",["highlightedFile","versions"]),...e.mapGetters(["getToken"]),hasVersion(){return this.versions.length>0}},watch:{highlightedFile(){this.fetchFileVersions()}},mounted(){this.fetchFileVersions()},methods:{...e.mapActions("Files",["loadVersions"]),currentVersionId(e){const t=e.name.split("/");return t[t.length-1]},async fetchFileVersions(){this.loading=!0,await this.loadVersions({client:this.$client,fileId:this.highlightedFile.id}),this.loading=!1},revertVersion(e){this.$client.fileVersions.restoreFileVersion(this.highlightedFile.id,this.currentVersionId(e),this.highlightedFile.path).then((()=>{this.fetchFileVersions()}))},downloadVersion(e){const t=this.currentVersionId(e);return this.downloadFile(this.highlightedFile,null,t)}}};var ja=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-file-versions-sidebar"}},[e.loading?s("oc-loader"):e._e(),e._v(" "),!e.loading&&e.hasVersion?s("oc-table-simple",[s("oc-tbody",e._l(e.versions,(function(t,i){return s("oc-tr",{key:i,staticClass:"file-row"},[s("oc-td",{attrs:{width:"shrink","data-testid":"file-versions-file-icon"}},[s("oc-resource-icon",{attrs:{resource:e.highlightedFile,size:"medium"}})],1),e._v(" "),s("oc-td",{staticClass:"oc-text-muted oc-text-nowrap",attrs:{width:"shrink","data-testid":"file-versions-file-last-modified-date"}},[e._v("\n          "+e._s(e.formRelativeDateFromHTTP(t.fileInfo[e.DavProperty.LastModifiedDate]))+"\n        ")]),e._v(" "),s("oc-td",{staticClass:"oc-text-muted oc-text-nowrap",attrs:{"data-testid":"file-versions-file-size"}},[e._v("\n          "+e._s(e.getResourceSize(t.fileInfo[e.DavProperty.ContentLength]))+"\n        ")]),e._v(" "),s("oc-td",{attrs:{width:"shrink"}},[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Restore older version"),expression:"$gettext('Restore older version')"}],attrs:{"data-testid":"file-versions-revert-button",appearance:"raw","aria-label":e.$gettext("Restore older version")},on:{click:function(s){return e.revertVersion(t)}}},[s("oc-icon",{attrs:{name:"restart","fill-type":"line"}})],1)],1),e._v(" "),s("oc-td",{attrs:{width:"shrink"}},[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Download older version"),expression:"$gettext('Download older version')"}],attrs:{"data-testid":"file-versions-download-button",appearance:"raw","aria-label":e.$gettext("Download older version")},on:{click:function(s){return e.downloadVersion(t)}}},[s("oc-icon",{attrs:{name:"download-cloud","fill-type":"line"}})],1)],1)],1)})),1)],1):s("div",[s("p",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"data-testid":"file-versions-no-versions"}},[e._v("No Versions available for this file")])])],1)};ja._withStripped=!0;const Ha=e.normalizeComponent({render:ja,staticRenderFns:[]},undefined,Va,undefined,false,undefined,!1,void 0,void 0,void 0);function Wa(e){const t=[];let s,i=0,a=-1,r=0;for(;i<e.length;){s=e.charAt(i);const o=!r&&"."===s||s>="0"&&s<="9";o!==r&&(a++,t[a]="",r=o),t[a]+=s,i++}return t}const Qa={naturalSortCompare:function(e,t){const s=Wa(e),i=Wa(t);let a,r,o;for(a=0;s[a]&&i[a];a++)if(s[a]!==i[a])return r=Number(s[a]),o=Number(i[a]),r==s[a]&&o==i[a]?r-o:s[a].localeCompare(i[a],"en");return s.length-i.length}};const Ya={name:"RoleItem",props:{role:{type:s.ShareRole,required:!0},allowSharePermission:{type:Boolean,required:!0}}};var Ja=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"roles-select-role-item",attrs:{id:"files-role-"+e.role.name}},[s("span",{staticClass:"oc-text-bold oc-display-block oc-width-1-1",domProps:{textContent:e._s(e.$gettext(e.role.label))}}),e._v(" "),s("span",{staticClass:"oc-m-rm",domProps:{textContent:e._s(e.$gettext(e.role.description(e.allowSharePermission)))}})])};Ja._withStripped=!0;const Ka=e.normalizeComponent({render:Ja,staticRenderFns:[]},undefined,Ya,"data-v-3295002e",false,undefined,!1,void 0,void 0,void 0);const Za={components:{RoleItem:Ka},mixins:[L],inject:["changeView"],data(){return{saving:!1,password:null,errors:!1,name:null,hasPassword:!1,expireDate:null,placeholder:{mailTo:this.$gettext("Mail recipients"),mailBody:this.$gettext("Personal note")},selectedRoleOption:null}},title:e=>e("Links"),computed:{...e.mapGetters("Files",["highlightedFile"]),...e.mapGetters(["getToken","capabilities"]),...e.mapState("Files",["publicLinkInEdit"]),selectedRole(){return this.getRoleFromSelectOption(this.selectedRoleOption)},$_isNew(){return!this.publicLinkInEdit.id},$_hasChanges(){const e=this.publicLinkInEdit.expireDate;return this.expireDate!==e||this.name!==this.publicLinkInEdit.name||this.selectedRole.bitmask(!1)!==this.publicLinkInEdit.permissions||(this.publicLinkInEdit.hasPassword?null!==this.password:null!==this.password&&this.password.trim().length>0)},$_sendMailEnabled(){return Object.keys(this.capabilities.files_sharing.public.send_mail).length>0},availableRoleOptions(){return s.LinkShareRoles.list(this.highlightedFile.isFolder,this.capabilities.files_sharing?.public?.can_edit).map((e=>this.convertRoleToSelectOption(e)))},$_expirationDate(){const e=this.capabilities.files_sharing.public.expire_date;return{enabled:!!e.enabled,days:!!e.days&&e.days,enforced:!!e.enforced}},minExpirationDate(){return e.DateTime_1.now().setLocale(this.$language.current).toJSDate()},maxExpirationDate(){if(!this.$_expirationDate.enforced)return null;const t=parseInt(this.$_expirationDate.days,10);return e.DateTime_1.now().setLocale(this.$language.current).plus({days:t}).toJSDate()},$_expirationIsValid(){return!(this.$_expirationDate.enforced&&!this.expireDate)},$_passwordIsValid(){return!!this.hasPassword||!(this.$_passwordEnforced&&(""===this.password||null===this.password))},$_isValid(){return this.$_expirationIsValid&&this.$_passwordIsValid},$_passwordEnforced(){const e=this.capabilities.files_sharing.public.password.enforced_for;return"1"===e.read_only?this.selectedRole.hasPermission(s.SharePermissions.read)&&!this.selectedRole.hasPermission(s.SharePermissions.create):"1"===e.upload_only?!this.selectedRole.hasPermission(s.SharePermissions.read)&&this.selectedRole.hasPermission(s.SharePermissions.create):"1"===e.read_write&&(this.selectedRole.hasPermission(s.SharePermissions.read)&&this.selectedRole.hasPermission(s.SharePermissions.create))},expirationDateLabel(){return this.$_expirationDate.enforced?this.$gettext("Expiration date (required)"):this.$gettext("Expiration date")},passwordLabel(){return this.$_passwordEnforced?this.$gettext("Password (required)"):this.$gettext("Password")},selectedRoleLabel(){return this.$gettext("Role")},relativeExpirationDate(){return e.DateTime_1.fromJSDate(this.expireDate).setLocale(this.$language.current).endOf("day").toRelative()},defaultExpireDate(){if(!this.$_expirationDate.days)return null;const t=parseInt(this.$_expirationDate.days);return e.DateTime_1.now().setLocale(this.$language.current).plus({days:t}).toJSDate()}},created(){const e=this.publicLinkInEdit;this.name=e?.name,this.hasPassword=e?.hasPassword;const t=e.expireDate?new Date(this.publicLinkInEdit.expireDate):null;this.expireDate=e?.id?t:this.defaultExpireDate,this.setRole()},mounted(){this.$nextTick((()=>{this.$refs.nameInput.focus()}))},methods:{...e.mapActions("Files",["addLink","updateLink"]),setRole(){const e=parseInt(this.publicLinkInEdit.permissions);if(e){const t=s.LinkShareRoles.getByBitmask(e,this.highlightedFile.isFolder);if(t)return void(this.selectedRoleOption=this.convertRoleToSelectOption(t))}this.selectedRoleOption=this.availableRoleOptions[0]},$_addLink(){this.saving=!0;const t=e.DateTime_1.fromJSDate(this.expireDate).setLocale(this.$language.current).endOf("day"),s={expireDate:t.isValid?t.toFormat("yyyy-MM-dd'T'HH:mm:ssZZZ"):"",permissions:this.selectedRole.bitmask(!1),name:this.name};let i;null!==this.password&&(s.password=this.password),"space"===this.highlightedFile.type?i=this.highlightedFile.id:this.$route.params.storageId&&(i=this.$route.params.storageId),i&&(s.spaceRef=`${i}${this.highlightedFile.path}`),this.addLink({path:this.highlightedFile.path,client:this.$client,$gettext:this.$gettext,params:s,storageId:i}).then((()=>{this.saving=!1,this.errors=!1,this.$_closeForm()})).catch((e=>{this.saving=!1,this.errors=e}))},$_updateLink(){this.saving=!0;const t=e.DateTime_1.fromJSDate(this.expireDate).setLocale(this.$language.current).endOf("day"),s={expireDate:t.isValid?t.toFormat("yyyy-MM-dd'T'HH:mm:ssZZZ"):"",permissions:this.selectedRole.bitmask(!1),name:this.name};null!==this.password&&(s.password=this.password),this.updateLink({id:this.publicLinkInEdit.id,client:this.$client,$gettext:this.$gettext,params:s}).then((()=>{this.saving=!1,this.errors=!1,this.$_closeForm()})).catch((e=>{this.saving=!1,this.errors=e}))},$_closeForm(){this.changeView("showLinks")},removePassword:function(){this.password="",this.hasPassword=!1},getRoleFromSelectOption:e=>e.role,convertRoleToSelectOption(e){return{role:e,name:e.name,label:this.$gettext(e.label)}}}};var Xa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-files-edit-public-link oc-files-file-link-form",attrs:{"data-testid":"new-files-link"}},[s("form",{on:{submit:function(e){e.preventDefault()}}},[e.errors?s("oc-alert",{staticClass:"oc-files-file-link-error-alert",attrs:{variation:"danger"}},[e._v("\n      "+e._s(e.errors)+"\n    ")]):e._e(),e._v(" "),s("div",{staticClass:"oc-mb"},[s("oc-text-input",{ref:"nameInput",attrs:{id:"oc-files-file-link-name",label:e.$gettext("Name")},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),s("oc-select",{staticClass:"oc-mb files-file-link-role-button-wrapper",attrs:{id:"files-file-link-role-button",options:e.availableRoleOptions,clearable:!1,label:e.selectedRoleLabel},scopedSlots:e._u([{key:"option",fn:function(t){return[s("role-item",{attrs:{role:e.getRoleFromSelectOption(t),"allow-share-permission":!1}})]}},{key:"no-options",fn:function(){return[e._v(" No matching role found ")]},proxy:!0}]),model:{value:e.selectedRoleOption,callback:function(t){e.selectedRoleOption=t},expression:"selectedRoleOption"}}),e._v(" "),e.$_expirationDate?s("div",{staticClass:"oc-mb"},[s("label",{attrs:{for:"files-links-expiration-btn"},domProps:{textContent:e._s(e.expirationDateLabel)}}),e._v(" "),s("oc-datepicker",{key:"oc-datepicker-"+e.expireDate,staticClass:"files-recipient-expiration-datepicker",attrs:{id:"oc-files-file-link-expire-date","min-date":e.minExpirationDate,"max-date":e.maxExpirationDate,locale:e.$language.current,"is-required":e.$_expirationDate.enforced,"data-testid":"recipient-datepicker"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.togglePopover;return[s("oc-button",{staticClass:"oc-width-1-1 expiration-dialog-btn",attrs:{id:"files-links-expiration-btn","data-testid":"recipient-datepicker-btn","justify-content":"space-between","gap-size":"xsmall"},on:{click:i}},[e.expireDate?s("translate",{key:"set-expiration-date-label",attrs:{"translate-params":{expires:e.relativeExpirationDate}}},[e._v("\n              Expires %{expires}\n            ")]):s("translate",{key:"no-expiration-date-label"},[e._v("Set expiration date")]),e._v(" "),s("oc-icon",{attrs:{name:"arrow-down-s","fill-type":"line"}})],1)]}}],null,!1,3655271715),model:{value:e.expireDate,callback:function(t){e.expireDate=t},expression:"expireDate"}}),e._v(" "),!e.$_expirationDate.enforced&&e.expireDate?s("oc-button",{staticClass:"oc-mt-s",attrs:{id:"oc-files-file-link-expire-date-delete",appearance:"raw","data-testid":"files-link-remove-expiration-date"},domProps:{textContent:e._s(e.$gettext("Remove expiration date"))},on:{click:function(t){e.expireDate=null}}}):e._e()],1):e._e(),e._v(" "),s("div",[s("oc-text-input",{attrs:{id:"oc-files-file-link-password",type:"password",label:e.passwordLabel},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),e.$_passwordEnforced||!e.password&&!e.hasPassword?e._e():s("oc-button",{staticClass:"oc-mt-s",attrs:{id:"oc-files-file-link-password-delete",appearance:"raw"},domProps:{textContent:e._s(e.$gettext("Remove password"))},on:{click:e.removePassword}})],1),e._v(" "),s("hr",{staticClass:"divider"}),e._v(" "),s("div",{staticClass:"oc-mb"},[s("oc-button",{attrs:{id:"oc-files-file-link-cancel",disabled:e.saving},on:{click:e.$_closeForm}},[s("translate",[e._v("Cancel")])],1),e._v(" "),e.saving?s("oc-button",{attrs:{id:"oc-files-file-link-saving",variation:"primary",appearance:"filled",disabled:""}},[e.$_isNew?[s("oc-spinner",{attrs:{"aria-label":e.$gettext("Creating Public Link"),size:"small"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"data-testid":"files-link-being-created","aria-hidden":!0}},[e._v("Creating")])]:[s("oc-spinner",{attrs:{"aria-label":e.$gettext("Saving Public Link"),size:"small"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"data-testid":"files-link-being-saved","aria-hidden":!0}},[e._v("Saving")])]],2):[e.$_isNew?s("oc-button",{attrs:{id:"oc-files-file-link-create","data-testid":"new-files-link-btn",disabled:!e.$_isValid,variation:"primary",appearance:"filled",submit:"submit"},on:{click:e.$_addLink}},[s("translate",[e._v("Create")])],1):s("oc-button",{attrs:{id:"oc-files-file-link-save","data-testid":"save-files-link-btn",disabled:!e.$_isValid||!e.$_hasChanges,variation:"primary",appearance:"filled",submit:"submit"},on:{click:e.$_updateLink}},[s("translate",[e._v("Save")])],1)]],2)],1)])};Xa._withStripped=!0;const er=e.normalizeComponent({render:Xa,staticRenderFns:[]},undefined,Za,undefined,false,undefined,!1,void 0,void 0,void 0);const tr={name:"LinkActions",inject:["changeView"],props:{link:{type:Object,required:!0}},data:()=>({removalInProgress:!1}),computed:{...e.mapGetters("Files",["highlightedFile"]),editButtonLabel(){return this.$gettext("Edit public link")},deleteButtonLabel(){return this.$gettext("Delete public link")}},methods:{...e.mapActions(["showMessage","createModal","hideModal"]),...e.mapActions("Files",["removeLink"]),...e.mapMutations("Files",["TRIGGER_PUBLIC_LINK_EDIT"]),$_removeLink(){const e={variation:"danger",title:this.$gettext("Delete public link"),message:this.$gettext("Are you sure you want to delete this link? Recreating the same link again is not possible."),cancelText:this.$gettext("Cancel"),confirmText:this.$gettext("Delete"),onCancel:this.hideModal,onConfirm:()=>this.deleteLink({client:this.$client,share:this.link,resource:this.highlightedFile})};this.createModal(e)},deleteLink({client:e,share:t,resource:s}){let i;"space"===this.highlightedFile.type?i=this.highlightedFile.id:this.$route.params.storageId&&(i=this.$route.params.storageId),this.hideModal(),this.removeLink({client:e,share:t,resource:s,storageId:i}),this.showMessage({title:this.$gettext("Public link was deleted successfully")})},editLink(){this.TRIGGER_PUBLIC_LINK_EDIT(this.link),this.changeView("editPublicLink")}}};var sr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex oc-flex-nowrap oc-flex-middle"},[e.removalInProgress?s("oc-spinner",{attrs:{"aria-label":e.$gettext("Removing public link")}}):[s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.editButtonLabel,expression:"editButtonLabel"}],staticClass:"oc-files-file-link-edit oc-mr-xs",attrs:{"aria-label":e.editButtonLabel,"data-testid":"files-link-id-"+e.link.id+"-btn-edit",appearance:"raw"},on:{click:e.editLink}},[s("oc-icon",{attrs:{name:"pencil"}})],1),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.deleteButtonLabel,expression:"deleteButtonLabel"}],staticClass:"oc-files-file-link-delete",attrs:{"aria-label":e.deleteButtonLabel,appearance:"raw"},on:{click:e.$_removeLink}},[s("oc-icon",{attrs:{name:"delete-bin-5"}})],1)]],2)};sr._withStripped=!0;const ir=e.normalizeComponent({render:sr,staticRenderFns:[]},undefined,tr,undefined,false,undefined,!1,void 0,void 0,void 0);const ar={name:"LinkInfo",components:{CopyToClipboardButton:ye},mixins:[L],props:{link:{type:Object,required:!0}},computed:{linkName(){return this.link.name?this.link.name:this.link.token},roleTagIcon(){switch(this.link.description){case"Viewer":return{name:"eye"};case"Contributor":case"Editor":return{name:"pencil"};case"Uploader":return{name:"upload",fillType:"line"};default:return{name:"key"}}},viaLabel(){if(!this.link.indirect)return null;const t=this.$gettext("Via %{folderName}");return this.$gettextInterpolate(t,{folderName:e.basename(this.link.path)},!0)},viaRouterParams(){const t=this.link.path,s=Q(this.$router,"files-spaces-project")?"files-spaces-project":"files-spaces-personal-home";return V(s,{params:{item:t||"/",storageId:this.$route.params.storageId},query:{scrollTo:e.basename(t)}})},viaTooltip(){return this.$gettext("Navigate to the parent")},copyToClipboardLabel(){return this.$gettext("Copy link to clipboard")},copyToClipboardSuccessMsgTitle(){return this.$gettext("Public link copied")},expirationDate(){return e.DateTime_1.fromISO(this.link.expiration).setLocale(this.$language.current).endOf("day").toLocaleString(e.DateTime_1.DATETIME_FULL)},expirationDateRelative(){return e.DateTime_1.fromISO(this.link.expiration).setLocale(this.$language.current).endOf("day").toRelative()}},methods:{getCopyToClipboardSuccessMsgText(e){const t=this.$gettext('The public link "%{linkName}" has been copied to your clipboard.');return this.$gettextInterpolate(t,{linkName:e.name?e.name:""},!0)}}};var rr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-width-expand"},[s("div",{staticClass:"oc-mb-s oc-width-1-1"},[s("h5",{staticClass:"oc-text-bold oc-text-truncate oc-files-file-link-name oc-my-rm oc-text-initial",domProps:{textContent:e._s(e.linkName)}}),e._v(" "),s("div",{staticClass:"oc-flex oc-flex-middle oc-width-1-1"},[s("a",{staticClass:"oc-files-file-link-url oc-text-truncate",attrs:{href:e.link.url,target:"_blank"},domProps:{textContent:e._s(e.link.url)}}),e._v(" "),s("copy-to-clipboard-button",{staticClass:"oc-files-public-link-copy-url oc-ml-xs",attrs:{value:e.link.url,label:e.copyToClipboardLabel,"success-msg-title":e.copyToClipboardSuccessMsgTitle,"success-msg-text":e.getCopyToClipboardSuccessMsgText(e.link)}})],1)]),e._v(" "),s("oc-grid",{attrs:{gutter:"small"}},[s("div",[s("oc-tag",{staticClass:"oc-files-file-link-role"},[s("oc-icon",{attrs:{name:e.roleTagIcon.name,"fill-type":e.roleTagIcon.fillType||"fill"}}),e._v("\n        "+e._s(e.link.description)+"\n      ")],1)],1),e._v(" "),e.link.expiration?s("div",[s("oc-tag",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.expirationDate,expression:"expirationDate"}],staticClass:"oc-files-public-link-expires",attrs:{tabindex:"0","data-testid":"files-link-id-"+e.link.id+"-expiration-date","aria-label":e.expirationDateRelative+" ("+e.expirationDate+")"}},[s("oc-icon",{attrs:{name:"calendar-2","fill-type":"line"}}),e._v(" "),s("translate",{attrs:{"translate-params":{expires:e.expirationDateRelative}}},[e._v("\n          Expires %{expires}\n        ")])],1)],1):e._e(),e._v(" "),e.link.password?s("div",[s("oc-tag",{staticClass:"oc-files-file-link-password"},[s("oc-icon",{attrs:{name:"lock"}}),e._v(" "),s("translate",[e._v("Password protected")])],1)],1):e._e(),e._v(" "),e.link.indirect?s("div",[s("oc-tag",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.viaTooltip,expression:"viaTooltip"}],staticClass:"oc-files-file-link-via",attrs:{type:"router-link",to:e.viaRouterParams}},[s("oc-icon",{attrs:{name:"close"}}),e._v(" "),s("span",{staticClass:"oc-text-truncate files-file-links-link-via-label",domProps:{textContent:e._s(e.viaLabel)}})],1)],1):e._e()])],1)};rr._withStripped=!0;const or={name:"PublicLinkListItem",components:{LinkActions:ir,LinkInfo:e.normalizeComponent({render:rr,staticRenderFns:[]},undefined,ar,undefined,false,undefined,!1,void 0,void 0,void 0)},props:{link:{type:Object,required:!0}}};var nr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-grid",{staticClass:"\n    files-file-links-link files-file-links-link-table-row-info\n    oc-flex oc-flex-top oc-flex-between\n  ",attrs:{gutter:"small"}},[s("link-info",{attrs:{link:e.link}}),e._v(" "),e.link.indirect?e._e():s("link-actions",{attrs:{link:e.link}})],1)};nr._withStripped=!0;const lr=e.normalizeComponent({render:nr,staticRenderFns:[]},undefined,or,"data-v-e47218dc",false,undefined,!1,void 0,void 0,void 0),cr="showLinks",dr="editPublicLink";const ur=e.defineComponent({name:"FileLinks",components:{LinkEdit:er,ListItem:lr},mixins:[L],provide(){return{changeView:e=>this.$data.currentView=e}},setup(){const e=s.useStore();return{graphClient:s.clientService.graphAuthenticated(e.getters.configuration.server,e.getters.getToken),hasSpaces:P()}},data:()=>({VIEW_SHOW:cr,VIEW_EDIT:dr,currentView:cr}),computed:{...e.mapGetters("Files",["highlightedFile","currentFileOutgoingLinks","currentFileOutgoingSharesLoading","sharesTreeLoading"]),...e.mapGetters(["capabilities"]),...e.mapState("Files",["sharesTree"]),...e.mapState(["user"]),canCreatePublicLinks(){return this.highlightedFile.canShare({user:this.user})},noResharePermsMessage(){const e=this.$gettext("You don't have permission to share this file."),t=this.$gettext("You don't have permission to share this folder.");return"file"===this.highlightedFile.type?e:t},linksLoading(){return this.currentFileOutgoingSharesLoading||this.sharesTreeLoading},linksHeading(){return this.hasSpaces?this.$gettext("Share via link"):this.$gettext("Share via public link")},links(){return[...this.currentFileOutgoingLinks,...this.indirectLinks].sort(this.linksComparator).map((e=>(e.key="direct-link-"+e.id,e)))},indirectLinks(){const e=[],t=u(this.highlightedFile.path,!1);return 0===t.length?[]:(t.pop(),t.forEach((t=>{const i=xt(this.sharesTree[t]);i&&i.forEach((t=>{t.outgoing&&t.shareType===s.ShareTypes.link.value&&(t.key="indirect-link-"+t.id,e.push(t))}))})),e.sort(this.linksComparator))},$_noPublicLinks(){return 0===this.links.length},$_expirationDate(){const e=this.capabilities.files_sharing.public.expire_date;return{enabled:!!e.enabled,days:!!e.days&&e.days,enforced:"1"===e.enforced}},$_addButtonLabel(){return this.$gettext("Public link")},$_addButtonAriaLabel(){return this.$gettext("Create new public link")},resourceIsSpace(){return"space"===this.highlightedFile.type}},watch:{highlightedFile(e,t){t!==e&&this.$_reloadLinks()}},mounted(){this.$_reloadLinks()},methods:{...e.mapActions("Files",["loadSharesTree","loadCurrentFileOutgoingShares"]),...e.mapMutations("Files",["TRIGGER_PUBLIC_LINK_CREATE"]),$_showList(){this.currentView=cr},$_reloadLinks(){let t;this.resourceIsSpace?t=this.highlightedFile.id:this.$route.params.storageId&&(t=this.$route.params.storageId),this.$_showList(),this.loadCurrentFileOutgoingShares({client:this.$client,graphClient:this.graphClient,path:this.highlightedFile.path,$gettext:this.$gettext,storageId:t,resource:this.highlightedFile}),this.loadSharesTree({client:this.$client,path:""===this.highlightedFile.path?"/":e.dirname(this.highlightedFile.path),$gettext:this.$gettext,storageId:t})},linksComparator(e,t){const s=e.name.toLowerCase().trim(),i=t.name.toLowerCase().trim(),a=!e.indirect;return a===!t.indirect?s===i?e.stime-t.stime:Qa.naturalSortCompare(s,i):a?-1:1},addNewLink(){this.TRIGGER_PUBLIC_LINK_CREATE({name:this.capabilities.files_sharing.public.defaultPublicLinkShareName,expireDate:this.$_expirationDate.days?e.DateTime_1.now().plus({days:this.$_expirationDate.days}).endOf("day").toISO():null}),this.currentView=dr}}});var hr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-position-relative",attrs:{id:"oc-files-file-link"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.currentView===e.VIEW_SHOW,expression:"currentView === VIEW_SHOW"}],key:e.VIEW_SHOW,attrs:{"aria-hidden":e.currentView!==e.VIEW_SHOW}},[e.linksLoading?s("oc-loader",{attrs:{"aria-label":e.$gettext("Loading list of file links")}}):[s("h3",{staticClass:"oc-text-bold oc-m-rm oc-text-initial",domProps:{textContent:e._s(e.linksHeading)}}),e._v(" "),e.canCreatePublicLinks?s("div",{staticClass:"oc-my-s"},[s("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-text-muted"},[e._v("\n          Any external person with the respective link can access this resource. No sign-in\n          required. Assign a password to avoid unintended document exposure.\n        ")]),e._v(" "),s("oc-button",{attrs:{id:"files-file-link-add",icon:"add",variation:"primary","data-testid":"files-link-add-btn","aria-label":e.$_addButtonAriaLabel},on:{click:e.addNewLink}},[s("oc-icon",{attrs:{name:"add"}}),e._v("\n          "+e._s(e.$_addButtonLabel)+"\n        ")],1)],1):s("p",{staticClass:"oc-mt-s",attrs:{"data-testid":"files-links-no-reshare-permissions-message"},domProps:{textContent:e._s(e.noResharePermsMessage)}}),e._v(" "),s("ul",{staticClass:"oc-list oc-list-divider oc-overflow-hidden oc-m-rm"},e._l(e.links,(function(e){return s("li",{key:e.key},[s("list-item",{attrs:{"data-testid":"files-link-id-"+e.id,link:e}})],1)})),0),e._v(" "),e.$_noPublicLinks&&e.canCreatePublicLinks?s("p",{directives:[{name:"translate",rawName:"v-translate"}],key:"oc-file-links-no-results",staticClass:"oc-my-rm",attrs:{id:"oc-file-links-no-results"}},[e._v("\n        No public links\n      ")]):e._e()]],2),e._v(" "),e.currentView===e.VIEW_EDIT?s("div",{key:e.VIEW_EDIT},[s("link-edit")],1):e._e()])};hr._withStripped=!0;const pr=e.normalizeComponent({render:hr,staticRenderFns:[]},undefined,ur,undefined,false,undefined,!1,void 0,void 0,void 0);const mr={name:"AutocompleteItem",props:{item:{type:Object,required:!0}},data:()=>({loading:!1}),computed:{shareType(){return s.ShareTypes.getByValue(this.item.value.shareType)},isUser(){return this.shareType===s.ShareTypes.user},isSpace(){return this.shareType===s.ShareTypes.space},isGroup(){return this.shareType===s.ShareTypes.group},collaboratorClass(){return`files-collaborators-search-${this.shareType.key}`}}};var fr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-flex oc-flex-middle oc-py-xs",class:e.collaboratorClass,attrs:{"data-testid":"recipient-autocomplete-item-"+e.item.label}},[e.isUser||e.isSpace?s("avatar-image",{staticClass:"oc-mr-s",attrs:{width:48,userid:e.item.value.shareWith,"user-name":e.item.label}}):e.isGroup?s("oc-icon",{key:"avatar-group",staticClass:"oc-mr-s files-recipient-suggestion-avatar",attrs:{name:"group",size:"xlarge","accessible-label":e.$gettext("Group")}}):s("oc-icon",{key:"avatar-generic-person",staticClass:"oc-mr-s files-recipient-suggestion-avatar",attrs:{name:"person",size:"xlarge","accessible-label":e.$gettext("User")}}),e._v(" "),s("div",{staticClass:"files-collaborators-autocomplete-user-text"},[s("span",{staticClass:"oc-text-bold files-collaborators-autocomplete-username",domProps:{textContent:e._s(e.item.label)}}),e._v(" "),e.item.value.shareWithAdditionalInfo?s("span",{staticClass:"files-collaborators-autocomplete-additional-info",domProps:{textContent:e._s("("+e.item.value.shareWithAdditionalInfo+")")}}):e._e(),e._v(" "),s("div",{staticClass:"files-collaborators-autocomplete-share-type",domProps:{textContent:e._s(e.$gettext(e.shareType.label))}})])],1)};fr._withStripped=!0;const gr=e.normalizeComponent({render:fr,staticRenderFns:[]},undefined,mr,undefined,false,undefined,!1,void 0,void 0,void 0);const vr={name:"RoleDropdown",components:{RoleItem:Ka},props:{resource:{type:Object,required:!0},existingRole:{type:s.ShareRole,required:!1,default:void 0},existingPermissions:{type:Array,required:!1,default:()=>[]},shareId:{type:String,required:!1,default:void 0},allowSharePermission:{type:Boolean,required:!0}},data:()=>({selectedRole:null,customPermissions:[]}),computed:{...e.mapGetters(["capabilities"]),roleButtonId(){return this.shareId?`files-collaborators-role-button-${this.shareId}-${e.v4()}`:"files-collaborators-role-button-new"},rolesListAriaLabel(){return this.$gettext("Select role for the invitation")},inviteLabel(){return this.selectedRole.hasCustomPermissions?this.$gettext("Invite with custom permissions"):this.$gettextInterpolate(this.$gettext("Invite as %{ name }"),{name:this.selectedRole.inlineLabel||""})},customPermissionsRole(){return s.PeopleShareRoles.custom(this.resource.isFolder)},availableRoles(){return this.resourceIsSpace?s.SpacePeopleShareRoles.list():s.PeopleShareRoles.list(this.resource.isFolder,!1!==this.capabilities?.files_sharing?.allow_custom)},availablePermissions(){return this.customPermissionsRole.permissions(this.allowSharePermission)},resourceIsSpace(){return"space"===this.resource.type}},created(){this.applyRoleAndPermissions()},beforeDestroy(){window.removeEventListener("keydown",this.cycleRoles)},mounted(){this.applyRoleAndPermissions(),window.addEventListener("keydown",this.cycleRoles)},methods:{applyRoleAndPermissions(){this.existingRole?this.selectedRole=this.existingRole:this.resourceIsSpace?this.selectedRole=s.SpacePeopleShareRoles.list()[0]:this.selectedRole=s.PeopleShareRoles.list(this.resource.isFolder)[0],this.selectedRole.hasCustomPermissions?this.customPermissions=this.existingPermissions:this.customPermissions=[...this.selectedRole.permissions(this.allowSharePermission)]},publishChange(){this.$emit("optionChange",{role:this.selectedRole,permissions:this.customPermissions})},selectRole(e){e.hasCustomPermissions?this.$refs.customPermissionsDrop.show():(this.selectedRole=e,this.customPermissions=e.permissions(this.allowSharePermission),this.publishChange())},isSelectedRole(e){return this.selectedRole.name===e.name},isPermissionDisabled:e=>e.bit===s.SharePermissions.read.bit,confirmCustomPermissions(){this.$refs.customPermissionsDrop.hide();const e=s.SharePermissions.permissionsToBitmask(this.customPermissions);this.selectedRole=s.PeopleShareRoles.getByBitmask(e,this.resource.isFolder,this.allowSharePermission),this.publishChange()},cancelCustomPermissions(){this.customPermissions=this.existingPermissions,this.$refs.customPermissionsDrop.hide(),this.$refs.rolesDrop.show()},cycleRoles(t){if(!e.get(this.$refs.rolesDrop,"tippy.state.isShown",!1))return;const{keyCode:s}=t,i=38===s,a=40===s;if(!i&&!a)return;const r=this.$refs.roleSelect||[];if(r.length<=1)return;const o=r.find((e=>e.$el===document.activeElement))||r.find((e=>e.$el.classList.contains("selected")))||r[0],n=r.indexOf(o),l=e=>r[e].$el.focus();i&&n-1<0?l(r.length-1):a&&n+1>=r.length?l(0):l(n+(i?-1:1))}}};var _r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.selectedRole?s("span",{staticClass:"oc-flex oc-flex-middle"},[s("oc-button",{staticClass:"files-recipient-role-select-btn",attrs:{id:e.roleButtonId,appearance:"raw","gap-size":"none"}},[e.existingRole?s("span",[e._v(e._s(e.$gettext(e.selectedRole.label)))]):s("span",{domProps:{textContent:e._s(e.inviteLabel)}}),e._v(" "),s("oc-icon",{attrs:{name:"arrow-down-s"}})],1),e._v(" "),s("oc-drop",{ref:"rolesDrop",attrs:{toggle:"#"+e.roleButtonId,mode:"click","padding-size":"remove","close-on-click":""}},[s("oc-list",{staticClass:"files-recipient-role-drop-list",attrs:{"aria-label":e.rolesListAriaLabel}},e._l(e.availableRoles,(function(t){return s("li",{key:t.key},[s("oc-button",{ref:"roleSelect",refInFor:!0,staticClass:"files-recipient-role-drop-btn oc-py-xs oc-px-s",class:{selected:e.isSelectedRole(t)},attrs:{id:"files-recipient-role-drop-btn-"+t.name,appearance:"raw","justify-content":"space-between"},on:{click:function(s){return e.selectRole(t)}}},[s("role-item",{attrs:{role:t,"allow-share-permission":e.allowSharePermission}}),e._v(" "),e.isSelectedRole(t)?s("oc-icon",{attrs:{name:"check"}}):e._e()],1)],1)})),0)],1),e._v(" "),s("oc-drop",{ref:"customPermissionsDrop",staticClass:"files-recipient-custom-permissions-drop",attrs:{mode:"manual",target:"#"+e.roleButtonId,"padding-size":"small"}},[s("h4",{staticClass:"oc-text-bold oc-text-initial",domProps:{textContent:e._s(e.$gettext(e.customPermissionsRole.label))}}),e._v(" "),s("oc-list",{staticClass:"oc-mb"},e._l(e.availablePermissions,(function(t){return s("li",{key:"files-collaborators-permission-"+t.key,staticClass:"oc-my-xs"},[s("oc-checkbox",{key:"files-collaborators-permission-checkbox-"+t.key,staticClass:"oc-mr-xs files-collaborators-permission-checkbox",attrs:{id:"files-collaborators-permission-"+t.key,"data-testid":"files-collaborators-permission-"+t.key,label:e.$gettext(t.label),option:t,disabled:e.isPermissionDisabled(t)},model:{value:e.customPermissions,callback:function(t){e.customPermissions=t},expression:"customPermissions"}})],1)})),0),e._v(" "),s("div",{staticClass:"files-recipient-custom-permissions-drop-cancel-confirm-btns"},[s("oc-button",{attrs:{size:"small"},domProps:{textContent:e._s(e.$gettext("Cancel"))},on:{click:e.cancelCustomPermissions}}),e._v(" "),s("oc-button",{attrs:{size:"small",variation:"primary",appearance:"filled"},domProps:{textContent:e._s(e.$gettext("Apply"))},on:{click:e.confirmCustomPermissions}})],1)],1)],1):e._e()};_r._withStripped=!0;const br=e.normalizeComponent({render:_r,staticRenderFns:[]},undefined,vr,"data-v-300ef9bd",false,undefined,!1,void 0,void 0,void 0);const Sr={props:{recipient:{type:Object,required:!0},deselect:{type:Function,required:!1,default:null}},data(){return{formattedRecipient:{name:this.recipient.label,icon:this.getRecipientIcon(),hasAvatar:[s.ShareTypes.user.value,s.ShareTypes.space.value].includes(this.recipient.value.shareType),isLoadingAvatar:!0}}},computed:{...e.mapGetters(["configuration","getToken","capabilities"]),btnDeselectRecipientLabel(){const e=this.$gettext("Deselect %{name}");return this.$gettextInterpolate(e,{name:this.recipient.label})}},async created(){if(this.capabilities.files_sharing.user.profile_picture&&this.hasAvatar)try{this.formattedRecipient.avatar=await pa({clientService:this.$clientService,server:this.configuration.server,username:this.recipient.value.shareWith,token:this.getToken})}catch(e){console.error(e)}this.formattedRecipient.isLoadingAvatar=!1},methods:{getRecipientIcon(){switch(this.recipient.value.shareType){case s.ShareTypes.group.value:return{name:"group",label:this.$gettext("Group")};case s.ShareTypes.guest.value:return{name:"user_remote",label:this.$gettext("Guest user")};case s.ShareTypes.remote.value:return{name:"user_remote",label:this.$gettext("Remote user")};default:return{name:"person",label:this.$gettext("User")}}}}};var xr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("oc-recipient",{staticClass:"files-share-invite-recipient",attrs:{"data-testid":"recipient-container-"+e.formattedRecipient.name,recipient:e.formattedRecipient},scopedSlots:e._u([{key:"append",fn:function(){return[s("oc-button",{staticClass:"files-share-invite-recipient-btn-remove",attrs:{appearance:"raw","aria-label":e.btnDeselectRecipientLabel},on:{click:function(t){return t.stopPropagation(),e.deselect(e.recipient)}}},[s("oc-icon",{attrs:{name:"close",size:"small"}})],1)]},proxy:!0}])})};xr._withStripped=!0;const yr=e.normalizeComponent({render:xr,staticRenderFns:[]},undefined,Sr,"data-v-5989b8a0",false,undefined,!1,void 0,void 0,void 0);const wr=e.defineComponent({name:"DateCurrentpicker",props:{shareTypes:{type:Array,required:!1,default:()=>[]}},setup(t,{emit:i}){const a=e.getCurrentInstance().proxy,r=e.computed((()=>a.$language)),o=s.useStore(),n=e.computed((()=>o.getters.capabilities)),l=e.computed((()=>n.value.files_sharing.user?.expire_date)),c=e.computed((()=>n.value.files_sharing.group?.expire_date)),d=e.computed((()=>l.value||c.value)),u=e.computed((()=>l.value?.enforced||c.value?.enforced)),h=e.DateTime_1.now().setLocale(r.value.current).toJSDate(),p=e.computed((()=>{const i=t.shareTypes.includes(s.ShareTypes.user.value),a=t.shareTypes.includes(s.ShareTypes.group.value),o=parseInt(l.value?.days),n=parseInt(c.value?.days);if(!l.value?.enabled&&!c.value?.enabled)return null;let d=0;return o&&i&&n&&a?d=Math.min(o,n):o&&i?d=o:n&&a&&(d=n),d?e.DateTime_1.now().setLocale(r.value.current).plus({days:d}).toJSDate():null})),m=e.computed((()=>u.value?p.value:null)),f=e.customRef(((e,t)=>{let s=null;return{get:()=>(e(),s||p.value),set(e){s=e,t()}}})),g=e.computed((()=>e.DateTime_1.fromJSDate(f.value).setLocale(r.value.current).endOf("day").toRelative()));return e.watch(f,(t=>{const s=e.DateTime_1.fromJSDate(t).setLocale(r.value.current).endOf("day");i("optionChange",{expirationDate:s.isValid?s.toFormat("yyyy-MM-dd'T'HH:mm:ssZZZ"):null})})),e.watch(m,(e=>{!e||f.value<e||(f.value=e)})),{language:r,enforced:u,available:d,dateCurrent:f,dateMin:h,dateMax:m,dateExpire:g}}});var $r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.available?s("div",{staticClass:"oc-flex oc-flex-middle oc-flex-nowrap"},[s("oc-datepicker",{staticClass:"files-recipient-expiration-datepicker",attrs:{"min-date":e.dateMin,"max-date":e.dateMax,locale:e.language.current,"is-required":e.enforced,"data-testid":"recipient-datepicker"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.togglePopover;return[s("oc-button",{staticClass:"files-collaborators-expiration-button",attrs:{"data-testid":"recipient-datepicker-btn",appearance:"raw","gap-size":"none"},on:{click:i}},[e.dateCurrent?s("translate",{key:"set-expiration-date-label",attrs:{"translate-params":{expires:e.dateExpire}}},[e._v("\n          Expires %{expires}\n        ")]):s("translate",{key:"no-expiration-date-label"},[e._v("Set expiration date")]),e._v(" "),e.dateCurrent?e._e():s("oc-icon",{attrs:{name:"arrow-down-s"}})],1)]}}],null,!1,3138950553),model:{value:e.dateCurrent,callback:function(t){e.dateCurrent=t},expression:"dateCurrent"}}),e._v(" "),!e.enforced&&e.dateCurrent?s("oc-button",{staticClass:"recipient-edit-expiration-btn-remove",attrs:{appearance:"raw","aria-label":e.$gettext("Remove expiration date")},on:{click:function(t){e.dateCurrent=null}}},[s("oc-icon",{attrs:{name:"close"}})],1):e._e()],1):e._e()};$r._withStripped=!0;const Cr={name:"InviteCollaboratorForm",components:{AutocompleteItem:gr,RoleDropdown:br,RecipientContainer:yr,ExpirationDatepicker:e.normalizeComponent({render:$r,staticRenderFns:[]},undefined,wr,"data-v-7d98422c",false,undefined,!1,void 0,void 0,void 0)},setup:()=>({hasResharing:D()}),data:()=>({autocompleteResults:[],announcement:"",searchInProgress:!1,selectedCollaborators:[],selectedRole:null,customPermissions:null,saving:!1,expirationDate:null,searchQuery:""}),computed:{...e.mapGetters("Files",["currentFileOutgoingCollaborators","highlightedFile"]),...e.mapGetters(["configuration","getToken","user"]),inviteDescriptionMessage(){return this.$gettext("Add new person by name, email or federation IDs")},$_announcementWhenCollaboratorAdded(){return this.$gettext("Person was added")},$_isValid(){return this.selectedCollaborators.length>0},minSearchLength(){return parseInt(this.user.capabilities.files_sharing.search_min_length,10)},selectedCollaboratorsLabel(){return this.$gettext("Invite")},resourceIsSpace(){return"space"===this.highlightedFile.type},graphClient(){return s.clientService.graphAuthenticated(this.configuration.server,this.getToken)}},mounted(){this.fetchRecipients=e.debounce(this.fetchRecipients,500),this.selectedRole=this.resourceIsSpace?s.SpacePeopleShareRoles.list()[0]:s.PeopleShareRoles.list(this.highlightedFile.isFolder)[0]},methods:{...e.mapActions("Files",["addShare"]),async fetchRecipients(e){try{const t=await this.$client.shares.getRecipients(e,"folder",1,this.configuration.options.sharingRecipientsPerPage),i=this.resourceIsSpace?s.ShareTypes.space.value:s.ShareTypes.user.value,a=t.exact.users.concat(t.users).filter((e=>e.value.shareWith!==this.user.id)).map((e=>({...e,value:{...e.value,shareType:i}})));let r=[];this.resourceIsSpace||(r=t.exact.groups.concat(t.groups));const o=t.exact.remotes.concat(t.remotes);this.autocompleteResults=a.concat(r,o).filter((e=>{const t=this.selectedCollaborators.find((t=>e.value.shareWith===t.value.shareWith&&parseInt(e.value.shareType,10)===parseInt(t.value.shareType,10))),s=this.currentFileOutgoingCollaborators.find((t=>e.value.shareWith===t.collaborator.name&&parseInt(e.value.shareType,10)===t.shareType));return!t&&!s&&(this.announcement=this.$_announcementWhenCollaboratorAdded,!0)}))}catch(e){console.error(e)}this.searchInProgress=!1},onSearch(e){this.autocompleteResults=[],this.searchQuery=e,e.length<this.minSearchLength?this.searchInProgress=!1:(this.searchInProgress=!0,this.fetchRecipients(e))},filterRecipients:(e,t)=>e.length<1?[]:(t=t.split(":")[1]||t,e.filter((e=>e.value.shareType===s.ShareTypes.remote.value||e.label.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1||e.value.shareWith.toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1||(e.value.shareWithAdditionalInfo||"").toLocaleLowerCase().indexOf(t.toLocaleLowerCase())>-1))),collaboratorRoleChanged({role:e,permissions:t}){this.selectedRole=e,this.customPermissions=t},collaboratorExpiryChanged({expirationDate:e}){this.expirationDate=e},async share(){this.saving=!0;const t=new e._default({concurrency:4}),i=[];this.selectedCollaborators.forEach((e=>{i.push(t.add((()=>{const t=this.selectedRole.hasCustomPermissions?s.SharePermissions.permissionsToBitmask(this.customPermissions):s.SharePermissions.permissionsToBitmask(this.selectedRole.permissions(this.hasResharing||this.resourceIsSpace));let i;this.resourceIsSpace?i=this.highlightedFile.id:this.$route.params.storageId&&(i=this.$route.params.storageId),this.addShare({client:this.$client,graphClient:this.graphClient,path:this.highlightedFile.path,$gettext:this.$gettext,shareWith:e.value.shareWith,displayName:e.label,shareType:e.value.shareType,permissions:t,expirationDate:this.expirationDate,storageId:i})})))})),await Promise.all(i),this.selectedCollaborators=[],this.saving=!1},resetFocusOnInvite(){this.autocompleteResults=[],this.$nextTick((()=>{document.getElementById("files-share-invite-input").focus()}))}}};var Fr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"new-collaborators-form","data-testid":"new-collaborators-form"}},[s("oc-select",{ref:"ocSharingAutocomplete",attrs:{id:"files-share-invite-input",options:e.autocompleteResults,loading:e.searchInProgress,multiple:!0,filter:e.filterRecipients,label:e.selectedCollaboratorsLabel,"aria-describedby":"files-share-invite-hint","dropdown-should-open":function(t){var s=t.open,i=t.search;return s&&i.length>=e.minSearchLength&&!e.searchInProgress}},on:{"search:input":e.onSearch,input:e.resetFocusOnInvite},scopedSlots:e._u([{key:"option",fn:function(e){return[s("autocomplete-item",{attrs:{item:e}})]}},{key:"no-options",fn:function(){return[e.resourceIsSpace?s("translate",[e._v(" No users found. ")]):s("translate",[e._v(" No users or groups found. ")])]},proxy:!0},{key:"selected-option-container",fn:function(e){var t=e.option,i=e.deselect;return[s("recipient-container",{key:t.value.shareWith,attrs:{recipient:t,deselect:i}})]}},{key:"open-indicator",fn:function(){return[s("span")]},proxy:!0}]),model:{value:e.selectedCollaborators,callback:function(t){e.selectedCollaborators=t},expression:"selectedCollaborators"}}),e._v(" "),s("p",{staticClass:"oc-mt-xs oc-text-meta",attrs:{id:"files-share-invite-hint"},domProps:{textContent:e._s(e.inviteDescriptionMessage)}}),e._v(" "),s("div",{staticClass:"oc-flex oc-flex-middle oc-flex-between oc-mb-l"},[s("role-dropdown",{attrs:{resource:e.highlightedFile,"allow-share-permission":e.hasResharing||e.resourceIsSpace},on:{optionChange:e.collaboratorRoleChanged}}),e._v(" "),s("expiration-datepicker",{attrs:{"share-types":e.selectedCollaborators.map((function(e){return e.value.shareType}))},on:{optionChange:e.collaboratorExpiryChanged}}),e._v(" "),e.saving?s("oc-button",{key:"new-collaborator-saving-button",attrs:{disabled:!0}},[s("oc-spinner",{attrs:{"aria-label":e.$gettext("Creating share"),size:"small"}}),e._v(" "),s("span",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"aria-hidden":!0}},[e._v("Share")])],1):s("oc-button",{key:"new-collaborator-save-button",attrs:{id:"new-collaborators-form-create-button","data-testid":"new-collaborators-form-create-button",disabled:!e.$_isValid,variation:"primary",appearance:"filled",submit:"submit"},domProps:{textContent:e._s(e.$gettext("Share"))},on:{click:e.share}})],1),e._v(" "),s("oc-hidden-announcer",{attrs:{level:"assertive",announcement:e.announcement}})],1)};Fr._withStripped=!0;const Er=e.normalizeComponent({render:Fr,staticRenderFns:[]},undefined,Cr,undefined,false,undefined,!1,void 0,void 0,void 0);const Rr={name:"EditDropdown",mixins:[L],props:{expirationDate:{type:Date,required:!1,default:void 0},shareCategory:{type:String,required:!1,default:null,validator:function(e){return["user","group"].includes(e)||!e}}},data:function(){return{enteredExpirationDate:null}},computed:{...e.mapGetters(["capabilities"]),options(){const e=[];return this.isRemoveExpirationPossible&&e.push({title:this.$gettext("Remove expiration date"),method:this.removeExpirationDate,class:"remove-expiration-date",additionalAttributes:{"data-testid":"collaborator-remove-expiration-btn"}}),[...e,{title:this.$gettext("Remove share"),method:this.removeShare,class:"remove-share",additionalAttributes:{variation:"danger","data-testid":"collaborator-remove-share-btn"}}]},editShareBtnId(){return"files-collaborators-edit-button-"+this._uid},shareEditOptions(){return this.$gettext("Context menu of the share")},editingUser(){return"user"===this.shareCategory},editingGroup(){return"group"===this.shareCategory},isExpirationSupported(){return this.editingUser&&this.userExpirationDate||this.editingGroup&&this.groupExpirationDate},isExpirationDateSet(){return!!this.expirationDate},isRemoveExpirationPossible(){return this.isExpirationSupported&&this.isExpirationDateSet&&!this.isExpirationDateEnforced},isDefaultExpirationEnabled(){return this.editingUser?this.userExpirationDate.enabled:this.editingGroup?this.groupExpirationDate.enabled:this.userExpirationDate.enabled||this.groupExpirationDate.enabled},userExpirationDate(){return this.capabilities.files_sharing.user.expire_date},groupExpirationDate(){return this.capabilities.files_sharing.group?.expire_date},defaultExpirationDate(){if(!this.isDefaultExpirationEnabled)return null;const e=parseInt(this.userExpirationDate.days),t=parseInt(this.groupExpirationDate.days);let s=0;s=this.editingUser?e:this.editingGroup?t:e&&t?Math.min(e,t):e||t;const i=new Date;return i.setDate((new Date).getDate()+s),i},isExpirationDateEnforced(){return this.editingUser?this.userExpirationDate.enforced:this.editingGroup?this.groupExpirationDate.enforced:this.userExpirationDate.enforced||this.groupExpirationDate.enforced},maxExpirationDate(){return this.isExpirationDateEnforced?this.defaultExpirationDate:null},minExpirationDate(){const e=new Date;return e.setDate((new Date).getDate()+1),e},relativeExpirationDate(){return e.DateTime_1.fromJSDate(this.enteredExpirationDate).setLocale(this.$language.current).endOf("day").toRelative()}},watch:{enteredExpirationDate:{handler:"updateExpirationDate"}},methods:{updateExpirationDate(){this.$emit("expirationDateChanged",{expirationDate:e.DateTime_1.fromJSDate(this.enteredExpirationDate).endOf("day").toISO()}),this.$refs.expirationDateDrop.hide()},removeExpirationDate(){this.$emit("expirationDateChanged",{expirationDate:null}),this.$refs.expirationDateDrop.hide()},removeShare(){this.$emit("removeShare")}}};var Tr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",{staticClass:"oc-flex oc-flex-middle"},[s("oc-button",{staticClass:"collaborator-edit-dropdown-options-btn",attrs:{id:e.editShareBtnId,appearance:"raw"}},[s("oc-icon",{attrs:{name:"more-2"}})],1),e._v(" "),s("oc-drop",{ref:"expirationDateDrop",attrs:{toggle:"#"+e.editShareBtnId,mode:"click","padding-size":"remove"}},[s("oc-list",{staticClass:"collaborator-edit-dropdown-options-list",attrs:{"aria-label":e.shareEditOptions}},[e.isExpirationSupported?s("li",{staticClass:"oc-px-s oc-py-xs"},[s("oc-datepicker",{staticClass:"files-recipient-expiration-datepicker",attrs:{"min-date":e.minExpirationDate,"max-date":e.maxExpirationDate,locale:e.$language.current,"is-required":e.isExpirationDateEnforced,"data-testid":"recipient-datepicker"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.togglePopover;return[s("oc-button",{staticClass:"files-collaborators-expiration-button",attrs:{"data-testid":"recipient-datepicker-btn",appearance:"raw"},on:{click:i}},[e.isExpirationDateSet?s("span",{domProps:{textContent:e._s(e.$gettext("Edit expiration date"))}}):s("span",{domProps:{textContent:e._s(e.$gettext("Set expiration date"))}})])]}}],null,!1,3345608471),model:{value:e.enteredExpirationDate,callback:function(t){e.enteredExpirationDate=t},expression:"enteredExpirationDate"}})],1):e._e(),e._v(" "),e._l(e.options,(function(t,i){return s("li",{key:i,staticClass:"oc-px-s oc-py-xs"},[s("oc-button",e._b({class:t.class,attrs:{appearance:"raw"},on:{click:function(e){return t.method()}}},"oc-button",t.additionalAttributes||{},!1),[s("span",{domProps:{textContent:e._s(t.title)}})])],1)}))],2)],1)],1)};Tr._withStripped=!0;const kr={name:"ListItem",components:{EditDropdown:e.normalizeComponent({render:Tr,staticRenderFns:[]},undefined,Rr,undefined,false,undefined,!1,void 0,void 0,void 0),RoleDropdown:br},mixins:[L],props:{share:{type:Object,required:!0},modifiable:{type:Boolean,default:!1},sharedParentRoute:{type:Object,default:null}},setup:()=>({hasResharing:D()}),computed:{...e.mapGetters("Files",["highlightedFile"]),...e.mapGetters(["getToken","configuration"]),...e.mapState(["user"]),shareType(){return s.ShareTypes.getByValue(this.share.shareType)},shareTypeKey(){return this.shareType.key},isGroup(){return this.shareType===s.ShareTypes.group},isUser(){return this.shareType===s.ShareTypes.user},isSpace(){return this.shareType===s.ShareTypes.space},shareTypeText(){return this.$gettext(this.shareType.label)},shareCategory(){return s.ShareTypes.isIndividual(this.shareType)?"user":"group"},shareDisplayName(){return this.user.id===this.share.collaborator.name?this.$gettextInterpolate(this.$gettext("%{collaboratorName} (me)"),{collaboratorName:this.share.collaborator.displayName}):this.share.collaborator.displayName},shareAdditionalInfo(){if(this.share.collaborator.additionalInfo)return` (${this.share.collaborator.additionalInfo})`},shareDisplayNameTooltip(){return this.shareDisplayName+(this.shareAdditionalInfo||"")},screenreaderShareDisplayName(){const e={displayName:this.share.collaborator.displayName,...this.share.collaborator.additionalInfo&&{additionalInfo:this.share.collaborator.additionalInfo}};let t=this.$gettext("Share receiver name: %{ displayName }");return this.shareAdditionalInfo&&(t=this.$gettext("Share receiver name: %{ displayName } (%{ additionalInfo })")),this.$gettextInterpolate(t,e)},screenreaderShareDetails(){const e=this.$gettext("Share type: %{ shareType }");return this.$gettextInterpolate(e,{shareType:this.shareTypeText})},shareExpirationText(){const e=this.$gettext("Expires %{ expiryDateRelative }");return this.$gettextInterpolate(e,{expiryDateRelative:this.expirationDateRelative})},screenreaderShareExpiration(){const e=this.$gettext("Share expires %{ expiryDateRelative } (%{ expiryDate })");return this.$gettextInterpolate(e,{expiryDateRelative:this.expirationDateRelative,expiryDate:this.expirationDate})},canEditOrDelete(){return this.modifiable},hasExpirationDate(){return this.share.expires},expirationDate(){return e.DateTime_1.fromJSDate(this.share.expires).endOf("day").setLocale(this.$language.current).toLocaleString(e.DateTime_1.DATETIME_FULL)},expirationDateRelative(){return e.DateTime_1.fromJSDate(this.share.expires).endOf("day").setLocale(this.$language.current).toRelative()},graphClient(){return s.clientService.graphAuthenticated(this.configuration.server,this.getToken)},sharedParentDir(){return this.sharedParentRoute?.params?.item.split("/").pop()}},methods:{...e.mapActions(["showMessage"]),...e.mapActions("Files",["changeShare"]),removeShare(){this.$emit("onDelete",this.share)},shareRoleChanged({role:e,permissions:t}){const s=this.share.expires;try{this.saveShareChanges({role:e,permissions:t,expirationDate:s})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to apply new permissions"),status:"danger"})}},shareExpirationChanged({expirationDate:e}){const t=this.share.role,s=this.share.customPermissions;try{this.saveShareChanges({role:t,permissions:s,expirationDate:e})}catch(e){console.error(e),this.showMessage({title:this.$gettext("Failed to apply expiration date"),status:"danger"})}},saveShareChanges({role:e,permissions:t,expirationDate:i}){const a=e.hasCustomPermissions?s.SharePermissions.permissionsToBitmask(t):s.SharePermissions.permissionsToBitmask(e.permissions(this.hasResharing||this.shareType===s.ShareTypes.space));this.changeShare({client:this.$client,graphClient:this.graphClient,share:this.share,permissions:a,expirationDate:i||""})}}};var Ir=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"files-collaborators-collaborator oc-flex oc-flex-middle oc-py-xs oc-flex-between",attrs:{"data-testid":"collaborator-"+(e.isUser||e.isSpace?"user":"group")+"-item-"+e.share.collaborator.name}},[s("div",{staticClass:"oc-width-2-3 oc-flex oc-flex-middle",staticStyle:{gap:"10px"}},[e.isUser||e.isSpace?s("avatar-image",{staticClass:"files-collaborators-collaborator-indicator",attrs:{userid:e.share.collaborator.name,"user-name":e.share.collaborator.displayName,width:48}}):s("oc-avatar-item",{staticClass:"files-collaborators-collaborator-indicator",attrs:{width:48,"icon-size":"medium",icon:e.shareTypeKey,name:e.shareTypeKey}}),e._v(" "),s("div",{staticClass:"oc-text-truncate"},[s("p",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.shareDisplayNameTooltip,expression:"shareDisplayNameTooltip"}],staticClass:"oc-text-bold oc-text-truncate oc-m-rm"},[s("span",{staticClass:"files-collaborators-collaborator-name",attrs:{"aria-hidden":"true"},domProps:{textContent:e._s(e.shareDisplayName)}}),e._v(" "),e.shareAdditionalInfo?s("span",{staticClass:"files-collaborators-collaborator-additional-info",attrs:{"aria-hidden":"true"},domProps:{textContent:e._s(e.shareAdditionalInfo)}}):e._e(),e._v(" "),s("span",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.screenreaderShareDisplayName)}})]),e._v(" "),s("p",{staticClass:"oc-m-rm oc-flex"},[s("span",{staticClass:"files-collaborators-collaborator-share-type",attrs:{"aria-hidden":"true"},domProps:{textContent:e._s(e.shareTypeText)}}),e._v(" "),e.sharedParentRoute?s("span",{staticClass:"oc-resource-indicators oc-text-truncate"},[s("span",{staticClass:"oc-mx-s"},[e._v("·")]),e._v(" "),s("router-link",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.$gettext("Navigate to parent folder"),expression:"$gettext('Navigate to parent folder')"}],staticClass:"parent-folder oc-text-truncate",attrs:{to:e.sharedParentRoute}},[s("span",{staticClass:"text",domProps:{textContent:e._s(e.$gettext("via"))}}),e._v(" "),s("oc-icon",{staticClass:"oc-px-xs",attrs:{name:"folder-2",size:"small","fill-type":"line"}}),e._v(" "),s("span",{staticClass:"text oc-text-truncate",domProps:{textContent:e._s(e.sharedParentDir)}})],1)],1):e._e(),e._v(" "),s("span",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.screenreaderShareDetails)}})]),e._v(" "),e.hasExpirationDate?s("p",{staticClass:"oc-m-rm"},[s("span",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.expirationDate,expression:"expirationDate"}],staticClass:"files-collaborators-collaborator-expiration",attrs:{"aria-hidden":"true","data-testid":"recipient-info-expiration-date",tabindex:"0"},domProps:{textContent:e._s(e.shareExpirationText)}}),e._v(" "),s("span",{staticClass:"oc-invisible-sr",domProps:{textContent:e._s(e.screenreaderShareExpiration)}})]):e._e()])],1),e._v(" "),e.canEditOrDelete?s("div",{staticClass:"oc-width-1-3 oc-flex oc-flex-nowrap oc-flex-right oc-flex-middle"},[s("role-dropdown",{staticClass:"files-collaborators-collaborator-role",attrs:{resource:e.highlightedFile,"share-id":e.share.id,"existing-permissions":e.share.customPermissions,"existing-role":e.share.role,"allow-share-permission":e.hasResharing||e.isSpace},on:{optionChange:e.shareRoleChanged}}),e._v(" "),s("edit-dropdown",{staticClass:"files-collaborators-collaborator-edit",attrs:{"data-testid":"collaborator-edit","expiration-date":e.share.expires?e.share.expires:null,"share-category":e.shareCategory},on:{expirationDateChanged:e.shareExpirationChanged,removeShare:e.removeShare}})],1):e.share.role?s("div",[s("span",{staticClass:"oc-mr-xs",domProps:{textContent:e._s(e.share.role.label)}})]):e._e()])};Ir._withStripped=!0;const Dr=e.normalizeComponent({render:Ir,staticRenderFns:[]},undefined,kr,"data-v-8987c160",false,undefined,!1,void 0,void 0,void 0);const Pr={name:"FileShares",components:{InviteCollaboratorForm:Er,CollaboratorListItem:Dr},setup(){const i=s.useStore(),a=e.computed((()=>i.getters["Files/currentFileOutgoingSharesLoading"])),r=e.computed((()=>i.state.Files.incomingSharesLoading)),o=e.computed((()=>i.state.Files.sharesTreeLoading)),n=((t,s,i)=>{const a=e.ref(t);return e.customRef(((t,r)=>({get:()=>(t(),a.value),set:e.debounce((e=>{a.value=e,r()}),s,i)})))})(!0,250);e.watch([a,r,o],(()=>{n.value=a.value||r.value||o.value}));const l=s.clientService.graphAuthenticated(i.getters.configuration.server,i.getters.getToken),c=e.q((function*(e,s,i){const a=yield l.drives.getDrive(i);a.data&&(s.currentSpace=t.buildSpace(a.data))})),d=e.q((function*(e,s){const i=[],a=[];for(const e of Object.keys(s.currentSpace.spaceRoles))for(const r of s.currentSpace.spaceRoles[e])i.push(l.users.getUser(r).then((i=>{a.push(t.buildSpaceShare({...i.data,role:e},s.currentSpace.id))})));yield Promise.all(i).then((()=>{s.spaceMembers=fa(a)}))}));return{sharesLoading:n,loadSpaceTask:c,loadSpaceMembersTask:d}},data:()=>({currentShare:null,showShareesList:!0,currentSpace:null,spaceMembers:[]}),computed:{...e.mapGetters("Files",["highlightedFile","currentFileOutgoingCollaborators"]),...e.mapState("Files",["incomingShares","sharesTree"]),...e.mapState(["user"]),sharedWithLabel(){return this.$gettext("Shared with")},spaceMemberLabel(){return this.$gettext("Space members")},hasSharees(){return this.collaboratorsAvatar.length>0},sharedWithTooltip(){return this.showShareesList?this.$gettext("Collapse list of invited people"):this.$gettext("Show all invited people")},collaboratorsAvatar(){return this.collaborators.map((e=>({...e.collaborator,shareType:e.shareType})))},$_allIncomingShares(){const e=[...this.incomingShares],t=u(this.highlightedFile.path,!0);return 0===t.length?[]:(t.pop(),t.forEach((t=>{const s=this.sharesTree[t];s&&s.forEach((t=>{t.incoming&&e.push(t)}))})),e)},collaborators(){return[...this.currentFileOutgoingCollaborators,...this.indirectOutgoingShares].sort(this.collaboratorsComparator).map((e=>(e.key="collaborator-"+e.id,e.owner.name!==e.fileOwner.name&&e.owner.name!==this.user.id&&(e.resharers=[e.owner]),e)))},indirectOutgoingShares(){const e=[],t=u(this.highlightedFile.path,!1);return 0===t.length?[]:(t.pop(),t.forEach((t=>{const s=this.sharesTree[t];s&&s.forEach((t=>{t.outgoing&&this.$_isCollaboratorShare(t)&&(t.key="indirect-collaborator-"+t.id,e.push(t))}))})),e)},currentUserCanShare(){return this.highlightedFile.canShare({user:this.user})},noResharePermsMessage(){const e=this.$gettext("You don't have permission to share this file."),t=this.$gettext("You don't have permission to share this folder.");return"file"===this.highlightedFile.type?e:t},currentUsersPermissions(){if(this.$_allIncomingShares.length>0){let e=0;for(const t of this.$_allIncomingShares)e|=t.permissions;return e}return null},currentUserIsMemberOfSpace(){return this.currentSpace?.spaceMemberIds.includes(this.user.uuid)},showSpaceMembers(){return this.currentSpace&&"space"!==this.highlightedFile.type&&this.currentUserIsMemberOfSpace}},watch:{highlightedFile:{handler:function(e,t){t!==e&&(this.$_reloadShares(),this.showShareesList=!0)},immediate:!0}},async mounted(){this.$route.params.storageId&&(await this.loadSpaceTask.perform(this,this.$route.params.storageId),this.showSpaceMembers&&this.loadSpaceMembersTask.perform(this))},methods:{...e.mapActions("Files",["loadCurrentFileOutgoingShares","loadSharesTree","deleteShare","loadIncomingShares"]),$_isCollaboratorShare:e=>s.ShareTypes.containsAnyValue(s.ShareTypes.authenticated,[e.shareType]),collaboratorsComparator(e,t){const i=e.collaborator?e.collaborator.displayName:e.displayName,a=t.collaborator?t.collaborator.displayName:t.displayName,r=i.toLowerCase().trim(),o=a.toLowerCase().trim(),n=s.ShareTypes.containsAnyValue(s.ShareTypes.individuals,[e.shareType]),l=s.ShareTypes.containsAnyValue(s.ShareTypes.individuals,[t.shareType]),c=!e.indirect,d=!t.indirect;return n===l?c===d?r===o?Qa.naturalSortCompare(e.stime+"",t.stime+""):Qa.naturalSortCompare(r,o):c?-1:1:n?-1:1},toggleShareeList(){this.showShareesList=!this.showShareesList},$_ocCollaborators_deleteShare(e){this.deleteShare({client:this.$client,share:e,resource:this.highlightedFile,storageId:this.$route.params.storageId})},$_reloadShares(){this.loadCurrentFileOutgoingShares({client:this.$client,path:this.highlightedFile.path,$gettext:this.$gettext,storageId:this.$route.params.storageId}),this.loadIncomingShares({client:this.$client,path:this.highlightedFile.path,$gettext:this.$gettext,storageId:this.$route.params.storageId}),this.loadSharesTree({client:this.$client,path:e.dirname(this.highlightedFile.path),$gettext:this.$gettext,storageId:this.$route.params.storageId})},getSharedParentRoute(e){return e.indirect&&this.sharesTree[e.path]?Q(this.$router,"files-spaces-project")?V("files-spaces-project",{params:{storageId:this.$route.params.storageId,item:e.path}}):V("files-spaces-personal-home",{params:{item:e.path}}):null}}};var Lr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-position-relative",attrs:{id:"oc-files-sharing-sidebar"}},[e.sharesLoading?s("oc-loader",{attrs:{"aria-label":e.$gettext("Loading people list")}}):[s("h3",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"oc-text-bold oc-m-rm oc-text-initial"},[e._v("Share with people")]),e._v(" "),e.currentUserCanShare?s("invite-collaborator-form",{key:"new-collaborator",staticClass:"oc-my-s"}):s("p",{key:"no-reshare-permissions-message",attrs:{"data-testid":"files-collaborators-no-reshare-permissions-message"},domProps:{textContent:e._s(e.noResharePermsMessage)}}),e._v(" "),e.hasSharees?s("div",{staticClass:"avatars-wrapper oc-flex oc-flex-middle oc-flex-between"},[s("h4",{staticClass:"oc-text-initial oc-text-bold oc-my-rm",domProps:{textContent:e._s(e.sharedWithLabel)}}),e._v(" "),s("oc-button",{directives:[{name:"oc-tooltip",rawName:"v-oc-tooltip",value:e.sharedWithTooltip,expression:"sharedWithTooltip"}],attrs:{"data-testid":"collaborators-show-people",appearance:"raw","aria-label":e.sharedWithTooltip},on:{click:e.toggleShareeList}},[e.showShareesList?s("oc-icon",{attrs:{name:"arrow-up-s"}}):s("oc-avatars",{staticClass:"sharee-avatars",attrs:{items:e.collaboratorsAvatar,stacked:!0,"is-tooltip-displayed":!1}})],1)],1):e._e(),e._v(" "),e.showShareesList&&e.hasSharees?[s("ul",{staticClass:"oc-list oc-list-divider oc-overflow-hidden",class:{"oc-mb-l":e.showSpaceMembers,"oc-m-rm":!e.showSpaceMembers},attrs:{id:"files-collaborators-list","aria-label":e.$gettext("Share receivers")}},e._l(e.collaborators,(function(t){return s("li",{key:t.key},[s("collaborator-list-item",{attrs:{share:t,modifiable:!t.indirect,"shared-parent-route":e.getSharedParentRoute(t)},on:{onDelete:e.$_ocCollaborators_deleteShare}})],1)})),0)]:e._e(),e._v(" "),e.showSpaceMembers?[s("h4",{staticClass:"oc-text-initial oc-text-bold oc-my-s",domProps:{textContent:e._s(e.spaceMemberLabel)}}),e._v(" "),s("ul",{staticClass:"oc-list oc-list-divider oc-overflow-hidden oc-m-rm",attrs:{id:"space-collaborators-list","aria-label":e.spaceMemberLabel}},e._l(e.spaceMembers,(function(e){return s("li",{key:e.key},[s("collaborator-list-item",{attrs:{share:e,modifiable:!1}})],1)})),0)]:e._e()]],2)};Lr._withStripped=!0;const Ar=e.normalizeComponent({render:Lr,staticRenderFns:[]},undefined,Pr,undefined,false,undefined,!1,void 0,void 0,void 0);const Mr=e.defineComponent({name:"SpaceMembers",components:{CollaboratorListItem:Dr,InviteCollaboratorForm:Er},inject:["displayedItem"],setup(){const t=s.useStore(),i=s.clientService.graphAuthenticated(t.getters.configuration.server,t.getters.getToken),a=e.q((function*(e,t){yield t.loadCurrentFileOutgoingShares({client:t.$client,graphClient:i,path:t.space.id,storageId:t.space.id,resource:t.space})}));return{graphClient:i,loadSharesTask:a}},computed:{...e.mapGetters("Files",["highlightedFile","currentFileOutgoingCollaborators","currentFileOutgoingSharesLoading","sharesTreeLoading"]),...e.mapState(["user"]),space(){return this.displayedItem.value},members(){return this.currentFileOutgoingCollaborators.filter((e=>e.shareType===s.ShareTypes.space.value))},sharesLoading(){return this.currentFileOutgoingSharesLoading},hasCollaborators(){return this.members.length>0},currentUserCanShare(){return this.currentUserIsManager},currentUserIsManager(){return this.members.find((e=>e.collaborator.name===this.user.id))?.role?.name===s.spaceRoleManager.name}},watch:{highlightedFile:{handler:function(e,t){t!==e&&this.loadSharesTask.perform(this)},immediate:!0}},methods:{...e.mapActions("Files",["loadCurrentFileOutgoingShares","deleteShare"]),isModifiable(e){if(!this.currentUserIsManager)return!1;if(e.role.name!==s.spaceRoleManager.name)return!0;return this.members.filter((e=>e.role.name===s.spaceRoleManager.name)).length>1},$_ocCollaborators_deleteShare(e){this.deleteShare({client:this.$client,graphClient:this.graphClient,share:e,resource:this.highlightedFile}).then((()=>{if(e.collaborator.name===this.user.id)return Q(this.$router,"files-spaces-projects")?this.$router.go():this.$router.push(V("files-spaces-projects"))}))}}});var Or=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-position-relative",attrs:{id:"oc-files-sharing-sidebar"}},[e.sharesLoading?s("oc-loader",{attrs:{"aria-label":e.$gettext("Loading members")}}):[e.currentUserCanShare?s("invite-collaborator-form",{key:"new-collaborator",staticClass:"oc-my-s"}):e._e(),e._v(" "),e.hasCollaborators?[s("ul",{staticClass:"oc-list oc-list-divider oc-overflow-hidden oc-m-rm",attrs:{id:"files-collaborators-list","aria-label":e.$gettext("Space members")}},e._l(e.members,(function(t){return s("li",{key:t.key},[s("collaborator-list-item",{attrs:{share:t,modifiable:e.isModifiable(t)},on:{onDelete:function(s){return e.$_ocCollaborators_deleteShare(t)}}})],1)})),0)]:e._e()]],2)};Or._withStripped=!0;const Nr=e.normalizeComponent({render:Or,staticRenderFns:[]},undefined,Mr,undefined,false,undefined,!1,void 0,void 0,void 0);const Ur=e.defineComponent({name:"SharesPanel",components:{FileLinks:pr,FileShares:Ar,SpaceMembers:Nr},props:{showSpaceMembers:{type:Boolean,default:!1},showLinks:{type:Boolean,default:!1}}});var zr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"oc-background-highlight oc-p-m oc-mb-m"},[e.showSpaceMembers?s("space-members"):s("file-shares")],1),e._v(" "),e.showLinks?s("div",{staticClass:"oc-background-highlight oc-p-m"},[s("file-links")],1):e._e()])};zr._withStripped=!0;const Br=e.normalizeComponent({render:zr,staticRenderFns:[]},undefined,Ur,undefined,false,undefined,!1,void 0,void 0,void 0);const Gr=e.defineComponent({name:"NoSelection",mixins:[L,be],computed:{selectedFilesString(){return this.$gettext("Select a file or folder to view details.")}}});var qr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"oc-text-center oc-mt-xl",attrs:{id:"oc-no-selection"}},[s("oc-icon",{attrs:{size:"xxlarge",name:"drag-drop","fill-type":"line"}}),e._v(" "),s("p",{attrs:{"data-testid":"selectedFilesText"},domProps:{textContent:e._s(e.selectedFilesString)}})],1)};qr._withStripped=!0;const Vr=e.normalizeComponent({render:qr,staticRenderFns:[]},undefined,Gr,undefined,false,undefined,!1,void 0,void 0,void 0);const jr=e.defineComponent({name:"SpaceActions",components:{ActionMenuItem:Mt,QuotaModal:ki,ReadmeContentModal:Pi},mixins:[Ai,Li,zi,Ni,Vi,Bi,Mi,qi,Ui],computed:{...e.mapGetters("Files",["highlightedFile"]),resources(){return[this.highlightedFile]},actions(){return[...this.$_rename_items,...this.$_editDescription_items,...this.$_uploadImage_items,...this.$_editReadmeContent_items,...this.$_editQuota_items,...this.$_deletedFiles_items,...this.$_restore_items,...this.$_delete_items,...this.$_disable_items].filter((e=>e.isEnabled({resources:this.resources})))},readmeContentModalIsOpen(){return this.$data.$_editReadmeContent_modalOpen},quotaModalIsOpen(){return this.$data.$_editQuota_modalOpen},supportedSpaceImageMimeTypes:()=>w.getSupportedMimeTypes("image/").join(",")},methods:{closeReadmeContentModal(){this.$_editReadmeContent_closeModal()},closeQuotaModal(){this.$_editQuota_closeModal()}}});var Hr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.readmeContentModalIsOpen?s("readme-content-modal",{attrs:{cancel:e.closeReadmeContentModal,space:e.resources[0]}}):e._e(),e._v(" "),e.quotaModalIsOpen?s("quota-modal",{attrs:{cancel:e.closeQuotaModal,space:e.resources[0]}}):e._e(),e._v(" "),s("input",{ref:"spaceImageInput",attrs:{id:"space-image-upload-input",type:"file",name:"file",tabindex:"-1",accept:e.supportedSpaceImageMimeTypes},on:{change:e.$_uploadImage_uploadImageSpace}}),e._v(" "),s("oc-list",{attrs:{id:"oc-spaces-actions-sidebar","class-name":"oc-mt-s"}},e._l(e.actions,(function(t,i){return s("action-menu-item",{key:"action-"+i,staticClass:"oc-py-xs",attrs:{action:t,items:e.resources}})})),1)],1)};Hr._withStripped=!0;const Wr=e.normalizeComponent({render:Hr,staticRenderFns:[]},undefined,jr,undefined,false,undefined,!1,void 0,void 0,void 0);const Qr={name:"SpaceQuota",props:{spaceQuota:{type:Object,required:!0}},computed:{spaceStorageDetailsLabel(){return this.spaceQuota.total?this.$gettextInterpolate(this.$gettext("%{used} of %{total} used (%{percentage}% used)"),{used:this.quotaUsed,total:this.quotaTotal,percentage:this.quotaUsagePercent}):this.$gettextInterpolate(this.$gettext("%{used} used (no restriction)"),{used:this.quotaUsed})},quotaTotal(){return e.filesize_min(this.spaceQuota.total)},quotaUsed(){return e.filesize_min(this.spaceQuota.used)},quotaUsagePercent(){return(this.spaceQuota.used/this.spaceQuota.total*100).toFixed(1)},quotaProgressVariant(){switch(this.spaceQuota.state){case"normal":return"primary";case"nearing":case"critical":return"warning";default:return"danger"}}}};var Yr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"space-quota"},[s("p",{staticClass:"oc-mb-s oc-mt-rm",domProps:{textContent:e._s(e.spaceStorageDetailsLabel)}}),e._v(" "),s("oc-progress",{attrs:{value:parseInt(e.quotaUsagePercent),max:100,size:"small",variation:e.quotaProgressVariant}})],1)};Yr._withStripped=!0;const Jr=e.normalizeComponent({render:Yr,staticRenderFns:[]},undefined,Qr,undefined,false,undefined,!1,void 0,void 0,void 0);const Kr=e.defineComponent({name:"SpaceDetails",components:{SpaceQuota:Jr},mixins:[L,be],inject:["displayedItem"],setup(){const s=e.ref("");return{loadImageTask:e.q((function*(e,i){if(!i.space?.spaceImageData)return;const a=i.space.spaceImageData.webDavUrl.split("/"),r=a.slice(a.indexOf(i.space.id)+1).join("/"),o=yield i.$client.files.fileInfo(t.buildWebDavSpacesPath(i.space.id,r)),n=t.buildResource(o);s.value=yield R({resource:n,isPublic:!1,dimensions:ut.Preview,server:i.configuration.server,userId:i.user.id,token:i.getToken})})),spaceImage:s}},computed:{...e.mapGetters("Files",["highlightedFile","currentFileOutgoingCollaborators","currentFileOutgoingLinks"]),...e.mapGetters(["user","getToken"]),space(){return this.displayedItem.value},detailsTableLabel(){return this.$gettext("Overview of the information about the selected space")},lastModifyDate(){return this.formDateFromISO(this.space.mdate)},ownerUsernames(){const e=this.user?.id;return this.currentFileOutgoingCollaborators.filter((e=>e.role.name===s.spaceRoleManager.name)).map((t=>t.collaborator.name===e?this.$gettextInterpolate(this.$gettext("%{displayName} (me)"),{displayName:t.collaborator.displayName}):t.collaborator.displayName)).join(", ")},hasMemberShares(){return this.memberShareCount>1},hasLinkShares(){return this.linkShareCount>0},memberShareCount(){return this.currentFileOutgoingCollaborators.length},linkShareCount(){return this.currentFileOutgoingLinks.length},memberShareLabel(){return this.$gettextInterpolate(this.$ngettext("This space has %{memberShareCount} member.","This space has %{memberShareCount} members.",this.memberShareCount),{memberShareCount:this.memberShareCount})},linkShareLabel(){return this.$gettextInterpolate(this.$ngettext("%{linkShareCount} link giving access.","%{linkShareCount} links giving access.",this.linkShareCount),{linkShareCount:this.linkShareCount})}},watch:{"space.spaceImageData":{handler(e){e&&this.loadImageTask.perform(this)},deep:!0}},mounted(){this.loadImageTask.perform(this)},methods:{...e.mapActions("Files/sidebar",{setSidebarPanel:"setActivePanel",closeSidebar:"close"}),expandMemberPanel(){this.setSidebarPanel("space-share-item")},expandLinkPanel(){this.setSidebarPanel("links-item")}}});var Zr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"oc-space-details-sidebar"}},[s("div",{staticClass:"oc-space-details-sidebar-image oc-text-center"},[e.loadImageTask.isRunning?s("oc-spinner"):e.spaceImage?s("div",{staticClass:"oc-position-relative"},[s("img",{staticClass:"oc-mb-m",attrs:{src:e.spaceImage,alt:""}})]):s("oc-icon",{staticClass:"space-default-image oc-px-m oc-py-m",attrs:{name:"layout-grid",size:"xxlarge"}})],1),e._v(" "),e.hasMemberShares||e.hasLinkShares?s("div",{staticClass:"oc-flex oc-flex-middle oc-mb-m oc-text-small"},[e.hasMemberShares?s("div",{staticClass:"oc-flex oc-flex-middle"},[s("oc-button",{attrs:{appearance:"raw","aria-label":e.$gettext("Open the member panel")},on:{click:e.expandMemberPanel}},[s("oc-icon",{staticClass:"oc-mr-s",attrs:{name:"group"}})],1)],1):e._e(),e._v(" "),e.hasLinkShares?s("div",{staticClass:"oc-flex oc-flex-middle"},[s("oc-button",{attrs:{appearance:"raw","aria-label":e.$gettext("Open the link panel")},on:{click:e.expandLinkPanel}},[s("oc-icon",{staticClass:"oc-mr-s",attrs:{name:"link"}})],1)],1):e._e(),e._v(" "),s("div",[e.hasMemberShares?s("span",[s("span",{domProps:{textContent:e._s(e.memberShareLabel)}}),e._v(" "),s("oc-button",{attrs:{appearance:"raw","aria-label":e.$gettext("Open the member panel"),size:"small"},on:{click:e.expandMemberPanel}},[s("span",{staticClass:"oc-text-small",domProps:{textContent:e._s(e.$gettext("Show"))}})])],1):e._e(),e._v(" "),e.hasMemberShares&&e.hasLinkShares?s("span",[e._v("·")]):e._e(),e._v(" "),e.hasLinkShares?s("span",[s("span",{domProps:{textContent:e._s(e.linkShareLabel)}}),e._v(" "),s("oc-button",{attrs:{appearance:"raw","aria-label":e.$gettext("Open the link panel"),size:"small"},on:{click:e.expandLinkPanel}},[s("span",{staticClass:"oc-text-small",domProps:{textContent:e._s(e.$gettext("Show"))}})])],1):e._e()])]):e._e(),e._v(" "),s("div",[s("table",{staticClass:"details-table",attrs:{"aria-label":e.detailsTableLabel}},[s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Last activity"))}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.lastModifyDate)}})]),e._v(" "),e.space.description?s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Subtitle"))}}),e._v(" "),s("td",{domProps:{textContent:e._s(e.space.description)}})]):e._e(),e._v(" "),s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Manager"))}}),e._v(" "),s("td",[s("span",{domProps:{textContent:e._s(e.ownerUsernames)}})])]),e._v(" "),s("tr",[s("th",{staticClass:"oc-pr-s",attrs:{scope:"col"},domProps:{textContent:e._s(e.$gettext("Quota"))}}),e._v(" "),s("td",[s("space-quota",{attrs:{"space-quota":e.space.spaceQuota}})],1)])])])])};Zr._withStripped=!0;const Xr=e.normalizeComponent({render:Zr,staticRenderFns:[]},undefined,Kr,"data-v-6a2df864",false,undefined,!1,void 0,void 0,void 0);const eo={name:"Files",id:"files",icon:"resource-type-folder",isFileEditor:!1,extensions:[],fileSideBars:[({rootFolder:e,highlightedFile:t})=>({app:"no-selection-item",icon:"questionnaire-line",title:"Details",component:Vr,default:()=>!0,get enabled(){return e&&"space"!==t?.type}}),({router:e,multipleSelection:t,rootFolder:s})=>({app:"details-item",icon:"questionnaire-line",title:"Details",component:Oa,default:!fe(e,"files-trash-personal")&&!fe(e,"files-trash-spaces-project"),get enabled(){return!(fe(e,"files-trash-personal")||fe(e,"files-trash-spaces-project")||t||s)}}),({multipleSelection:e,rootFolder:t})=>({app:"details-multiple-item",icon:"questionnaire-line",title:"Details",component:za,default:()=>!0,get enabled(){return e&&!t}}),({router:e,highlightedFile:t})=>({app:"details-space-item",icon:"questionnaire-line",title:"Details",component:Xr,default:Q(e,"files-spaces-projects"),get enabled(){return"space"===t?.type}}),({router:e,multipleSelection:t,rootFolder:s})=>({app:"actions-item",icon:"slideshow-3",title:"Actions",component:qa,default:fe(e,"files-trash-personal")||fe(e,"files-trash-spaces-project"),get enabled(){return!t&&!s}}),({highlightedFile:e,user:t})=>({app:"space-actions-item",icon:"slideshow-3",title:"Actions",component:Wr,get enabled(){return"space"===e?.type&&[...e.spaceRoles[s.spaceRoleManager.name],...e.spaceRoles[s.spaceRoleEditor.name]].includes(t.uuid)}}),({capabilities:e,router:t,multipleSelection:s,rootFolder:i})=>({app:"sharing-item",icon:"user-add",iconFillType:"line",title:"Shares",component:Br,componentAttrs:{showSpaceMembers:!1,get showLinks(){return!!e.files_sharing&&e.files_sharing.public.enabled}},get enabled(){return!s&&!i&&(!(fe(t,"files-trash-personal")||fe(t,"files-trash-spaces-project")||de(t,"files-public-files"))&&(!!e.files_sharing&&e.files_sharing.api_enabled))}}),({highlightedFile:e,capabilities:t})=>({app:"space-share-item",icon:"group",title:"Members",component:Br,componentAttrs:{showSpaceMembers:!0,get showLinks(){return!!t.files_sharing&&t.files_sharing.public.enabled}},get enabled(){return"space"===e?.type}}),({capabilities:e,highlightedFile:t,router:s,multipleSelection:i,rootFolder:a})=>({app:"versions-item",icon:"git-branch",title:"Versions",component:Ha,get enabled(){return!i&&!a&&(!(fe(s,"files-trash-personal")||fe(s,"files-trash-spaces-project")||de(s,"files-public-files"))&&(!!e.core&&t&&"folder"!==t.type))}})]},to=[{name:e=>e.spaces?.enabled?"Personal":"All files",icon:eo.icon,route:{path:`/${eo.id}/spaces/personal/home`}},{name:"Favorites",icon:"star",route:{path:`/${eo.id}/favorites`},enabled:e=>e.files&&e.files.favorites},{name:"Shares",icon:"share-forward",route:{path:`/${eo.id}/shares`}},{name:"Spaces",icon:"layout-grid",tag:"beta",route:{path:`/${eo.id}/spaces/projects`},enabled:e=>e.spaces&&!0===e.spaces.enabled},{name:"Deleted files",icon:"delete-bin-5",route:{path:`/${eo.id}/trash`},enabled:e=>e.dav&&"1.0"===e.dav.trashbin}];var so;return{appInfo:eo,store:ba,routes:(so={App:dt,Favorites:ws,Personal:mi,FilesDrop:Fs,LocationPicker:Is,PrivateLink:Ls,PublicFiles:oi,PublicLink:ci,SearchResults:o.__vue_component__,SharedViaLink:Ei,SharedWithMe:bi,SharedWithOthers:wi,Spaces:{Project:Ki,Projects:ca,Trashbin:ia},Trashbin:ha},[_e,...q(so),...te(so),...ue(so),...Y(so),...oe(so),...ge(so),...[{path:"/list",redirect:e=>V("files-spaces-personal-home",e)},{path:"/list/all/:item*",redirect:e=>V("files-spaces-personal-home",e)},{path:"/list/favorites",redirect:e=>U("files-common-favorites",e)},{path:"/list/shared-with-me",redirect:e=>J("files-shares-with-me",e)},{path:"/list/shared-with-others",redirect:e=>J("files-shares-with-others",e)},{path:"/list/shared-via-link",redirect:e=>J("files-shares-via-link",e)},{path:"/trash-bin",redirect:e=>he("files-trash-personal",e)},{path:"/public/list/:item*",meta:{auth:!1},redirect:e=>ne("files-public-files",e)},{path:"/private-link/:fileId",meta:{auth:!1},redirect:e=>se("files-operations-resolver-private-link",e)},{path:"/public-link/:token",meta:{auth:!1},redirect:e=>se("files-operations-resolver-public-link",e)}].map(ve)]),navItems:to,quickActions:Wt,translations:s.translations,ready({router:e,store:t}){$.filterSearch=new Ca(t,e),$.sdkSearch=new La(t,e),r.bus.publish("app.search.register.provider",$.filterSearch),r.bus.publish("app.search.register.provider",$.sdkSearch)},userReady({store:t}){y.initialize(t.getters.configuration.server||window.location.origin,e.get(t,"getters.capabilities.files.archivers",[{enabled:!0,version:"1.0.0",formats:["tar","zip"],archiver_url:`${t.getters.configuration.server}index.php/apps/files/ajax/download.php`}])),w.initialize(e.get(t,"getters.capabilities.files.thumbnail",{enabled:!0,version:"v0.1",supportedMimeTypes:["image/png","image/jpg","image/jpeg","image/gif","text/plain"]}))}}}));
